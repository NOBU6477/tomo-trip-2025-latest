<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>協賛店詳細 - Local Guide</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="login-modal-styles.css" rel="stylesheet" />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .sponsor-hero {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        padding: 80px 0;
      }
      .sponsor-logo {
        width: 120px;
        height: 120px;
        object-fit: cover;
        border: 4px solid white;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }
      .benefit-badge {
        background: linear-gradient(45deg, #4CAF50, #45a049);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: bold;
        display: inline-block;
        margin: 10px 0;
      }
      .info-card {
        border: none;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        border-radius: 15px;
      }
      .back-btn {
        background: #1976d2;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 25px;
        text-decoration: none;
        transition: all 0.3s ease;
      }
      .back-btn:hover {
        background: #1565c0;
        color: white;
        transform: translateY(-2px);
      }
      .gallery-image {
        border-radius: 12px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
      }
      .gallery-image:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      }
      .gallery-image img {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }
      .image-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .gallery-image:hover .image-overlay {
        opacity: 1;
      }
    </style>
  </head>

  <body>
    <!-- ヘッダー -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand fw-bold text-primary" href="index.html">
          Local Guide
        </a>
        <div class="d-flex">
          <a href="index.html" class="back-btn">
            <i class="bi bi-arrow-left me-2"></i>戻る
          </a>
        </div>
      </div>
    </nav>

    <!-- ヒーローセクション -->
    <section class="sponsor-hero">
      <div class="container text-center">
        <img id="sponsor-logo" src="" alt="" class="sponsor-logo rounded-circle mb-3" />
        <h1 id="sponsor-name" class="fw-bold mb-3"></h1>
        <div id="sponsor-benefit" class="benefit-badge"></div>
        <p class="lead mt-3" id="sponsor-description"></p>
      </div>
    </section>

    <!-- 詳細情報 -->
    <div class="container py-5">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <!-- 基本情報 -->
          <div class="card info-card mb-4">
            <div class="card-body p-4">
              <h3 class="card-title mb-4">
                <i class="bi bi-info-circle-fill text-primary me-2"></i>基本情報
              </h3>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <strong>営業時間:</strong>
                  <p id="sponsor-hours" class="mb-0"></p>
                </div>
                <div class="col-md-6 mb-3">
                  <strong>電話番号:</strong>
                  <p id="sponsor-phone" class="mb-0"></p>
                </div>
                <div class="col-12 mb-3">
                  <strong>住所:</strong>
                  <p id="sponsor-address" class="mb-0"></p>
                </div>
                <div class="col-12">
                  <strong>アクセス:</strong>
                  <p id="sponsor-access" class="mb-0"></p>
                </div>
              </div>
            </div>
          </div>

          <!-- 特典詳細 -->
          <div class="card info-card mb-4">
            <div class="card-body p-4">
              <h3 class="card-title mb-4">
                <i class="bi bi-gift-fill text-success me-2"></i>特典詳細
              </h3>
              <div id="sponsor-benefit-detail"></div>
              <hr>
              <h5>利用条件:</h5>
              <ul id="sponsor-conditions">
                <li>Local Guideアプリの提示が必要です</li>
                <li>他の割引サービスとの併用はできません</li>
                <li>予告なく特典内容が変更される場合があります</li>
              </ul>
            </div>
          </div>

          <!-- 店舗写真ギャラリー -->
          <div class="card info-card mb-4">
            <div class="card-body p-4">
              <h3 class="card-title mb-4">
                <i class="bi bi-camera-fill text-info me-2"></i>店舗写真
              </h3>
              <div id="sponsor-gallery" class="row g-3">
                <!-- 写真がここに表示されます -->
              </div>
            </div>
          </div>

          <!-- おすすめポイント -->
          <div class="card info-card mb-4">
            <div class="card-body p-4">
              <h3 class="card-title mb-4">
                <i class="bi bi-star-fill text-warning me-2"></i>おすすめポイント
              </h3>
              <div id="sponsor-highlights"></div>
            </div>
          </div>

          <!-- アクションボタン -->
          <div class="text-center">
            <a href="index.html" class="btn btn-primary btn-lg me-3">
              <i class="bi bi-house-fill me-2"></i>ホームに戻る
            </a>
            <button class="btn btn-outline-primary btn-lg" onclick="shareStore()">
              <i class="bi bi-share-fill me-2"></i>共有する
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      // 協賛店の詳細データ
      const sponsorDetails = {
        1: {
          name: "◯◯温泉旅館",
          benefit: "宿泊10%オフ",
          logo: "https://placehold.co/120x120/e3f2fd/1976d2/png?text=Logo1",
          description: "創業100年の歴史ある温泉旅館。源泉かけ流しの温泉と地元の食材を使った料理でおもてなしいたします。",
          hours: "チェックイン 15:00 / チェックアウト 10:00",
          phone: "0123-45-6789",
          address: "〒123-4567 ○○県○○市温泉町1-2-3",
          access: "○○駅から車で15分、送迎バスあり",
          benefitDetail: "1泊2食付きプランが通常料金より10%割引になります。平日・休日問わずご利用いただけます。",
          highlights: [
            "源泉かけ流しの天然温泉",
            "地元産の新鮮な食材を使った会席料理",
            "無料送迎バスサービス",
            "WiFi完備の快適な客室"
          ],
          gallery: [
            { url: "https://images.unsplash.com/photo-1571003123894-1f0594d2b5d9?auto=format&fit=crop&w=800&q=80", caption: "温泉旅館外観" },
            { url: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?auto=format&fit=crop&w=800&q=80", caption: "源泉かけ流し温泉" },
            { url: "https://images.unsplash.com/photo-1566073771259-6a8506099945?auto=format&fit=crop&w=800&q=80", caption: "会席料理" },
            { url: "https://images.unsplash.com/photo-1578911373434-0cb395d2cbfb?auto=format&fit=crop&w=800&q=80", caption: "客室" }
          ]
        },
        2: {
          name: "地元レストラン",
          benefit: "ドリンク1杯無料",
          logo: "https://placehold.co/120x120/e3f2fd/1976d2/png?text=Logo2",
          description: "地元の新鮮な食材にこだわった創作料理レストラン。シェフ自慢の季節のコースをお楽しみください。",
          hours: "11:30-14:00 / 17:30-21:00（月曜定休）",
          phone: "0123-45-6790",
          address: "〒123-4567 ○○県○○市中央区2-3-4",
          access: "○○駅徒歩5分",
          benefitDetail: "お食事のご注文でソフトドリンクまたはアルコール1杯を無料サービスいたします。",
          highlights: [
            "地元農家直送の新鮮野菜",
            "シェフ厳選の季節メニュー",
            "落ち着いた大人の空間",
            "個室もご用意"
          ],
          gallery: [
            { url: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?auto=format&fit=crop&w=800&q=80", caption: "レストラン内観" },
            { url: "https://images.unsplash.com/photo-1565299624946-b28f40a0ca4b?auto=format&fit=crop&w=800&q=80", caption: "シェフ特製料理" },
            { url: "https://images.unsplash.com/photo-1578474846511-04ba529f0b88?auto=format&fit=crop&w=800&q=80", caption: "地元食材" }
          ]
        },
        3: {
          name: "お土産屋",
          benefit: "5%割引",
          logo: "https://placehold.co/120x120/e3f2fd/1976d2/png?text=Logo3",
          description: "地域の特産品や伝統工芸品を取り揃えた老舗のお土産屋です。",
          hours: "9:00-18:00（年中無休）",
          phone: "0123-45-6791",
          address: "〒123-4567 ○○県○○市観光通り3-4-5",
          access: "観光地入口すぐ",
          benefitDetail: "店内商品（一部除く）が5%割引でお買い求めいただけます。",
          highlights: [
            "地域限定の特産品",
            "手作り伝統工芸品",
            "オリジナル商品も充実",
            "配送サービスあり"
          ],
          gallery: [
            { url: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=800&q=80", caption: "店舗外観" },
            { url: "https://images.unsplash.com/photo-1573408301185-9146fe634ad0?auto=format&fit=crop&w=800&q=80", caption: "特産品コーナー" }
          ]
        },
        4: {
          name: "カフェ◯◯",
          benefit: "デザート無料",
          logo: "https://placehold.co/120x120/e3f2fd/1976d2/png?text=Logo4",
          description: "自家焙煎コーヒーと手作りスイーツが自慢のアットホームなカフェです。",
          hours: "8:00-20:00（火曜定休）",
          phone: "0123-45-6792",
          address: "〒123-4567 ○○県○○市カフェ通り4-5-6",
          access: "○○駅徒歩3分",
          benefitDetail: "ドリンクご注文で本日のデザートを1品無料サービスいたします。",
          highlights: [
            "自家焙煎の香り高いコーヒー",
            "手作りの季節スイーツ",
            "WiFi・電源完備",
            "テラス席もあり"
          ],
          gallery: [
            { url: "https://images.unsplash.com/photo-1554118811-1e0d58224f24?auto=format&fit=crop&w=800&q=80", caption: "カフェ内観" },
            { url: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=800&q=80", caption: "自家焙煎コーヒー" },
            { url: "https://images.unsplash.com/photo-1551024506-0bccd828d307?auto=format&fit=crop&w=800&q=80", caption: "手作りスイーツ" }
          ]
        },
        5: {
          name: "観光案内所",
          benefit: "地図無料配布",
          logo: "https://placehold.co/120x120/e3f2fd/1976d2/png?text=Logo5",
          description: "地域の観光情報やおすすめスポットをご案内する公式観光案内所です。",
          hours: "9:00-17:00（年中無休）",
          phone: "0123-45-6793",
          address: "〒123-4567 ○○県○○市駅前1-1-1",
          access: "○○駅構内",
          benefitDetail: "観光マップと周辺スポットガイドブックを無料でお渡しします。",
          highlights: [
            "最新の観光情報",
            "多言語対応スタッフ",
            "イベント情報も充実",
            "荷物預かりサービス"
          ],
          gallery: [
            { url: "https://images.unsplash.com/photo-1564501049412-61c2a3083791?auto=format&fit=crop&w=800&q=80", caption: "案内所内部" },
            { url: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&w=800&q=80", caption: "観光マップ" }
          ]
        }
      };

      // URLパラメータから協賛店IDを取得
      function getSponsorId() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('id') || '1';
      }

      // ページ読み込み時に詳細情報を表示
      document.addEventListener('DOMContentLoaded', function() {
        const sponsorId = getSponsorId();
        const sponsor = sponsorDetails[sponsorId];
        
        if (sponsor) {
          document.getElementById('sponsor-name').textContent = sponsor.name;
          document.getElementById('sponsor-benefit').textContent = sponsor.benefit;
          document.getElementById('sponsor-logo').src = sponsor.logo;
          document.getElementById('sponsor-logo').alt = sponsor.name;
          document.getElementById('sponsor-description').textContent = sponsor.description;
          document.getElementById('sponsor-hours').textContent = sponsor.hours;
          document.getElementById('sponsor-phone').textContent = sponsor.phone;
          document.getElementById('sponsor-address').textContent = sponsor.address;
          document.getElementById('sponsor-access').textContent = sponsor.access;
          document.getElementById('sponsor-benefit-detail').textContent = sponsor.benefitDetail;
          
          // 写真ギャラリーを表示（複数ソースから最新データを取得）
          let currentSponsor = sponsor;
          
          // 個別ストレージから取得を試行
          const individualKey = `sponsor_${sponsorId}`;
          const individualData = localStorage.getItem(individualKey);
          if (individualData) {
            try {
              currentSponsor = JSON.parse(individualData);
            } catch (e) {
              console.log('個別データの解析に失敗:', e);
            }
          }
          
          // 全体データからも取得を試行
          const sponsorData = JSON.parse(localStorage.getItem('sponsorData')) || [];
          const sponsorFromList = sponsorData.find(s => s.id === parseInt(sponsorId));
          if (sponsorFromList) {
            currentSponsor = sponsorFromList;
          }
          
          // 公開用データからも取得を試行
          const publicSponsors = JSON.parse(localStorage.getItem('publicSponsors')) || [];
          const publicSponsor = publicSponsors.find(s => s.id === parseInt(sponsorId));
          if (publicSponsor) {
            currentSponsor = publicSponsor;
          }
          
          // 基本情報も更新
          if (currentSponsor.name && currentSponsor.name !== sponsor.name) {
            document.getElementById('sponsor-name').textContent = currentSponsor.name;
            document.getElementById('sponsor-benefit').textContent = currentSponsor.benefit || sponsor.benefit;
            if (currentSponsor.phone) document.getElementById('sponsor-phone').textContent = currentSponsor.phone;
            if (currentSponsor.hours) document.getElementById('sponsor-hours').textContent = currentSponsor.hours;
            if (currentSponsor.address) document.getElementById('sponsor-address').textContent = currentSponsor.address;
            if (currentSponsor.access) document.getElementById('sponsor-access').textContent = currentSponsor.access;
            if (currentSponsor.benefitDetail) document.getElementById('sponsor-benefit-detail').textContent = currentSponsor.benefitDetail;
          }
          
          const galleryContainer = document.getElementById('sponsor-gallery');
          if (currentSponsor.gallery && currentSponsor.gallery.length > 0) {
            galleryContainer.innerHTML = '';
            
            // 写真が6枚を超える場合は最初の6枚のみ表示
            const displayImages = currentSponsor.gallery.length > 6 ? currentSponsor.gallery.slice(0, 6) : currentSponsor.gallery;
            
            displayImages.forEach((image, index) => {
              const col = document.createElement('div');
              col.className = 'col-12 col-sm-6 col-md-4 mb-3';
              col.innerHTML = `
                <div class="gallery-image" onclick="openImageModal('${image.url}', '${image.caption}')">
                  <img src="${image.url}" alt="${image.caption}" loading="lazy" />
                  <div class="image-overlay">
                    <i class="bi bi-zoom-in" style="font-size: 1.5rem;"></i>
                  </div>
                </div>
              `;
              galleryContainer.appendChild(col);
            });
            
            // 「もっと見る」ボタン
            if (currentSponsor.gallery.length > 6) {
              const moreCol = document.createElement('div');
              moreCol.className = 'col-12 text-center mt-3';
              moreCol.innerHTML = `
                <button class="btn btn-outline-primary" onclick="showAllImages()">
                  <i class="bi bi-grid-3x3-gap me-2"></i>すべての写真を見る（${currentSponsor.gallery.length}枚）
                </button>
              `;
              galleryContainer.appendChild(moreCol);
            }
          } else {
            galleryContainer.innerHTML = '<div class="col-12"><p class="text-muted text-center py-4">現在、写真は登録されていません。</p></div>';
          }

          // おすすめポイントを表示
          const highlightsContainer = document.getElementById('sponsor-highlights');
          const highlightsList = document.createElement('ul');
          sponsor.highlights.forEach(highlight => {
            const li = document.createElement('li');
            li.textContent = highlight;
            highlightsList.appendChild(li);
          });
          highlightsContainer.appendChild(highlightsList);
          
          // ページタイトルを更新
          document.title = `${sponsor.name} - 協賛店詳細 - Local Guide`;
        }
      });

      // 画像モーダル機能
      function openImageModal(imageUrl, caption) {
        const modal = document.createElement('div');
        modal.className = 'modal fade';
        modal.innerHTML = `
          <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">${caption}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body text-center p-0">
                <img src="${imageUrl}" alt="${caption}" class="img-fluid" style="max-height: 70vh;" />
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        
        const bsModal = new bootstrap.Modal(modal);
        bsModal.show();
        
        modal.addEventListener('hidden.bs.modal', () => {
          document.body.removeChild(modal);
        });
      }

      // すべての写真を表示
      function showAllImages() {
        const sponsorId = getSponsorId();
        const sponsorData = JSON.parse(localStorage.getItem('sponsorData')) || [];
        const currentSponsor = sponsorData.find(s => s.id === parseInt(sponsorId)) || sponsorDetails[sponsorId];
        const galleryContainer = document.getElementById('sponsor-gallery');
        
        galleryContainer.innerHTML = '';
        currentSponsor.gallery.forEach((image, index) => {
          const col = document.createElement('div');
          col.className = 'col-12 col-sm-6 col-md-4 col-lg-3 mb-3';
          col.innerHTML = `
            <div class="gallery-image" onclick="openImageModal('${image.url}', '${image.caption}')">
              <img src="${image.url}" alt="${image.caption}" loading="lazy" />
              <div class="image-overlay">
                <i class="bi bi-zoom-in" style="font-size: 1.5rem;"></i>
              </div>
            </div>
          `;
          galleryContainer.appendChild(col);
        });
        
        // 「表示を縮小」ボタン
        const lessCol = document.createElement('div');
        lessCol.className = 'col-12 text-center mt-3';
        lessCol.innerHTML = `
          <button class="btn btn-outline-secondary" onclick="location.reload()">
            <i class="bi bi-arrow-up me-2"></i>表示を縮小
          </button>
        `;
        galleryContainer.appendChild(lessCol);
      }

      // 共有機能
      function shareStore() {
        const sponsorId = getSponsorId();
        const sponsor = sponsorDetails[sponsorId];
        const url = window.location.href;
        const text = `${sponsor.name}をチェック！${sponsor.benefit}の特典があります。`;
        
        if (navigator.share) {
          navigator.share({
            title: sponsor.name,
            text: text,
            url: url
          });
        } else {
          // フォールバック: URLをクリップボードにコピー
          navigator.clipboard.writeText(url).then(() => {
            alert('URLをクリップボードにコピーしました！');
          });
        }
      }
    </script>
  </body>
</html>