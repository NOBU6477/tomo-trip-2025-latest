<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>協賛店管理 - Local Guide Admin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- login-modal-styles.css 削除 - 404エラー防止 -->
    <style>
      body {
        background-color: #f8f9fa;
      }
      .admin-header {
        background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
        color: white;
        padding: 2rem 0;
      }
      .sponsor-card {
        transition: all 0.3s ease;
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .sponsor-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      }
      .status-badge {
        position: absolute;
        top: 10px;
        right: 10px;
      }
      .action-buttons {
        gap: 5px;
      }
      .preview-logo {
        width: 60px;
        height: 60px;
        object-fit: cover;
      }
      .form-section {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      .required-field {
        color: #dc3545;
      }
    </style>
  </head>

  <body>
    <!-- ヘッダー -->
    <div class="admin-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col">
            <h1 class="mb-0">
              <i class="bi bi-shop me-2"></i>協賛店管理システム
            </h1>
            <p class="mb-0 opacity-75">Local Guide 管理画面</p>
          </div>
          <div class="col-auto">
            <a href="test-sponsor.html" class="btn btn-outline-light me-2">
              <i class="bi bi-building me-2"></i>スポンサー企業
            </a>
            <a href="index.html" class="btn btn-light">
              <i class="bi bi-house-fill me-2"></i>メイン画面へ
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="container py-4">
      <!-- 統計情報 -->
      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title text-primary">総協賛店数</h5>
              <h2 id="total-sponsors" class="text-primary">0</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title text-success">公開中</h5>
              <h2 id="active-sponsors" class="text-success">0</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title text-warning">下書き</h5>
              <h2 id="draft-sponsors" class="text-warning">0</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title text-info">今月の追加</h5>
              <h2 id="monthly-additions" class="text-info">2</h2>
            </div>
          </div>
        </div>
      </div>

      <!-- アクションボタン -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>協賛店一覧</h3>
        <div>
          <button class="btn btn-success" onclick="showAddModal()">
            <i class="bi bi-plus-circle me-2"></i>新規追加
          </button>
          <button class="btn btn-primary" onclick="previewSlider()">
            <i class="bi bi-eye me-2"></i>スライダープレビュー
          </button>
        </div>
      </div>

      <!-- 協賛店リスト -->
      <div class="row" id="sponsor-list">
        <!-- 協賛店カードがここに表示されます -->
      </div>
    </div>

    <!-- 新規追加/編集モーダル -->
    <div class="modal fade" id="sponsorModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">協賛店追加</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="sponsorForm">
              <input type="hidden" id="editingSponsorId" />
              
              <!-- 基本情報 -->
              <div class="form-section p-4 mb-4">
                <h6 class="mb-3"><i class="bi bi-info-circle me-2"></i>基本情報</h6>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">店舗名 <span class="required-field">*</span></label>
                    <input type="text" class="form-control" id="sponsor-name" required />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">特典内容 <span class="required-field">*</span></label>
                    <input type="text" class="form-control" id="sponsor-benefit" required />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">店舗説明</label>
                    <textarea class="form-control" id="sponsor-description" rows="3"></textarea>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">ロゴURL</label>
                    <input type="url" class="form-control" id="sponsor-logo" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">状態</label>
                    <select class="form-select" id="sponsor-status">
                      <option value="active">公開中</option>
                      <option value="draft">下書き</option>
                      <option value="inactive">非公開</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- 詳細情報 -->
              <div class="form-section p-4 mb-4">
                <h6 class="mb-3"><i class="bi bi-geo-alt me-2"></i>詳細情報</h6>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label class="form-label">営業時間</label>
                    <input type="text" class="form-control" id="sponsor-hours" />
                  </div>
                  <div class="col-md-6 mb-3">
                    <label class="form-label">電話番号</label>
                    <input type="tel" class="form-control" id="sponsor-phone" />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">住所</label>
                    <input type="text" class="form-control" id="sponsor-address" />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">アクセス情報</label>
                    <input type="text" class="form-control" id="sponsor-access" />
                  </div>
                  <div class="col-12 mb-3">
                    <label class="form-label">特典詳細</label>
                    <textarea class="form-control" id="sponsor-benefit-detail" rows="3"></textarea>
                  </div>
                </div>
              </div>

              <!-- おすすめポイント -->
              <div class="form-section p-4">
                <h6 class="mb-3"><i class="bi bi-star me-2"></i>おすすめポイント</h6>
                <div id="highlights-container">
                  <div class="input-group mb-2">
                    <input type="text" class="form-control highlight-input" placeholder="おすすめポイントを入力" />
                    <button type="button" class="btn btn-outline-danger" onclick="removeHighlight(this)">
                      <i class="bi bi-trash"></i>
                    </button>
                  </div>
                </div>
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="addHighlight()">
                  <i class="bi bi-plus me-1"></i>ポイント追加
                </button>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
            <button type="button" class="btn btn-primary" onclick="saveSponsor()">保存</button>
          </div>
        </div>
      </div>
    </div>

    <!-- プレビューモーダル -->
    <div class="modal fade" id="previewModal" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">スライダープレビュー</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div id="preview-slider-container">
              <!-- プレビュースライダーがここに表示されます -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Swiper.js -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    
    <script>
      // 協賛店データの管理
      let sponsors = JSON.parse(localStorage.getItem('sponsorData')) || [
        { id: 1, name: "◯◯温泉旅館", benefit: "宿泊10%オフ", logo: "https://placehold.co/100x100/e3f2fd/1976d2/png?text=Logo1", status: "active", description: "創業100年の歴史ある温泉旅館。源泉かけ流しの温泉と地元の食材を使った料理でおもてなしいたします。", hours: "チェックイン 15:00 / チェックアウト 10:00", phone: "0123-45-6789", address: "〒123-4567 ○○県○○市温泉町1-2-3", access: "○○駅から車で15分、送迎バスあり", benefitDetail: "1泊2食付きプランが通常料金より10%割引になります。平日・休日問わずご利用いただけます。", highlights: ["源泉かけ流しの天然温泉", "地元産の新鮮な食材を使った会席料理", "無料送迎バスサービス", "WiFi完備の快適な客室"] },
        { id: 2, name: "地元レストラン", benefit: "ドリンク1杯無料", logo: "https://placehold.co/100x100/e3f2fd/1976d2/png?text=Logo2", status: "active", description: "地元の新鮮な食材にこだわった創作料理レストラン。シェフ自慢の季節のコースをお楽しみください。", hours: "11:30-14:00 / 17:30-21:00（月曜定休）", phone: "0123-45-6790", address: "〒123-4567 ○○県○○市中央区2-3-4", access: "○○駅徒歩5分", benefitDetail: "お食事のご注文でソフトドリンクまたはアルコール1杯を無料サービスいたします。", highlights: ["地元農家直送の新鮮野菜", "シェフ厳選の季節メニュー", "落ち着いた大人の空間", "個室もご用意"] },
        { id: 3, name: "お土産屋", benefit: "5%割引", logo: "https://placehold.co/100x100/e3f2fd/1976d2/png?text=Logo3", status: "active", description: "地域の特産品や伝統工芸品を取り揃えた老舗のお土産屋です。", hours: "9:00-18:00（年中無休）", phone: "0123-45-6791", address: "〒123-4567 ○○県○○市観光通り3-4-5", access: "観光地入口すぐ", benefitDetail: "店内商品（一部除く）が5%割引でお買い求めいただけます。", highlights: ["地域限定の特産品", "手作り伝統工芸品", "オリジナル商品も充実", "配送サービスあり"] },
        { id: 4, name: "カフェ◯◯", benefit: "デザート無料", logo: "https://placehold.co/100x100/e3f2fd/1976d2/png?text=Logo4", status: "draft", description: "自家焙煎コーヒーと手作りスイーツが自慢のアットホームなカフェです。", hours: "8:00-20:00（火曜定休）", phone: "0123-45-6792", address: "〒123-4567 ○○県○○市カフェ通り4-5-6", access: "○○駅徒歩3分", benefitDetail: "ドリンクご注文で本日のデザートを1品無料サービスいたします。", highlights: ["自家焙煎の香り高いコーヒー", "手作りの季節スイーツ", "WiFi・電源完備", "テラス席もあり"] },
        { id: 5, name: "観光案内所", benefit: "地図無料配布", logo: "https://placehold.co/100x100/e3f2fd/1976d2/png?text=Logo5", status: "active", description: "地域の観光情報やおすすめスポットをご案内する公式観光案内所です。", hours: "9:00-17:00（年中無休）", phone: "0123-45-6793", address: "〒123-4567 ○○県○○市駅前1-1-1", access: "○○駅構内", benefitDetail: "観光マップと周辺スポットガイドブックを無料でお渡しします。", highlights: ["最新の観光情報", "多言語対応スタッフ", "イベント情報も充実", "荷物預かりサービス"] }
      ];

      // 次のIDを取得
      function getNextId() {
        return sponsors.length > 0 ? Math.max(...sponsors.map(s => s.id)) + 1 : 1;
      }

      // データ保存
      function saveData() {
        localStorage.setItem('sponsorData', JSON.stringify(sponsors));
        updateIndexPage();
      }

      // メインページのスライダーを更新
      function updateIndexPage() {
        const activeSponsors = sponsors.filter(s => s.status === 'active');
        localStorage.setItem('activeSponsorData', JSON.stringify(activeSponsors));
      }

      // 統計情報の更新
      function updateStats() {
        document.getElementById('total-sponsors').textContent = sponsors.length;
        document.getElementById('active-sponsors').textContent = sponsors.filter(s => s.status === 'active').length;
        document.getElementById('draft-sponsors').textContent = sponsors.filter(s => s.status === 'draft').length;
      }

      // 協賛店リストの表示
      function renderSponsorList() {
        const container = document.getElementById('sponsor-list');
        container.innerHTML = '';

        sponsors.forEach(sponsor => {
          const statusColor = {
            active: 'success',
            draft: 'warning',
            inactive: 'secondary'
          };
          
          const statusText = {
            active: '公開中',
            draft: '下書き',
            inactive: '非公開'
          };

          const card = document.createElement('div');
          card.className = 'col-md-6 col-lg-4 mb-4';
          card.innerHTML = `
            <div class="card sponsor-card h-100 position-relative">
              <span class="badge bg-${statusColor[sponsor.status]} status-badge">${statusText[sponsor.status]}</span>
              <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                  <img src="${sponsor.logo}" alt="${sponsor.name}" class="preview-logo rounded-circle me-3" />
                  <div>
                    <h6 class="card-title mb-1">${sponsor.name}</h6>
                    <small class="text-muted">${sponsor.benefit}</small>
                  </div>
                </div>
                <p class="card-text small text-muted">${sponsor.description || '説明なし'}</p>
                <div class="action-buttons d-flex">
                  <button class="btn btn-outline-primary btn-sm" onclick="editSponsor(${sponsor.id})">
                    <i class="bi bi-pencil"></i> 編集
                  </button>
                  <button class="btn btn-outline-info btn-sm" onclick="viewDetail(${sponsor.id})">
                    <i class="bi bi-eye"></i> 詳細
                  </button>
                  <button class="btn btn-outline-danger btn-sm" onclick="deleteSponsor(${sponsor.id})">
                    <i class="bi bi-trash"></i> 削除
                  </button>
                </div>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      }

      // 新規追加モーダルを表示
      function showAddModal() {
        document.getElementById('modalTitle').textContent = '協賛店追加';
        document.getElementById('sponsorForm').reset();
        document.getElementById('editingSponsorId').value = '';
        resetHighlights();
        new bootstrap.Modal(document.getElementById('sponsorModal')).show();
      }

      // 編集モーダルを表示
      function editSponsor(id) {
        const sponsor = sponsors.find(s => s.id === id);
        if (!sponsor) return;

        document.getElementById('modalTitle').textContent = '協賛店編集';
        document.getElementById('editingSponsorId').value = id;
        document.getElementById('sponsor-name').value = sponsor.name;
        document.getElementById('sponsor-benefit').value = sponsor.benefit;
        document.getElementById('sponsor-description').value = sponsor.description || '';
        document.getElementById('sponsor-logo').value = sponsor.logo;
        document.getElementById('sponsor-status').value = sponsor.status;
        document.getElementById('sponsor-hours').value = sponsor.hours || '';
        document.getElementById('sponsor-phone').value = sponsor.phone || '';
        document.getElementById('sponsor-address').value = sponsor.address || '';
        document.getElementById('sponsor-access').value = sponsor.access || '';
        document.getElementById('sponsor-benefit-detail').value = sponsor.benefitDetail || '';

        // おすすめポイントの設定
        resetHighlights();
        if (sponsor.highlights && sponsor.highlights.length > 0) {
          const container = document.getElementById('highlights-container');
          container.innerHTML = '';
          sponsor.highlights.forEach(highlight => {
            const div = document.createElement('div');
            div.className = 'input-group mb-2';
            div.innerHTML = `
              <input type="text" class="form-control highlight-input" value="${highlight}" />
              <button type="button" class="btn btn-outline-danger" onclick="removeHighlight(this)">
                <i class="bi bi-trash"></i>
              </button>
            `;
            container.appendChild(div);
          });
        }

        new bootstrap.Modal(document.getElementById('sponsorModal')).show();
      }

      // 協賛店保存
      function saveSponsor() {
        const id = document.getElementById('editingSponsorId').value;
        const name = document.getElementById('sponsor-name').value;
        const benefit = document.getElementById('sponsor-benefit').value;

        if (!name || !benefit) {
          alert('店舗名と特典内容は必須項目です。');
          return;
        }

        // おすすめポイントを収集
        const highlights = Array.from(document.querySelectorAll('.highlight-input'))
          .map(input => input.value.trim())
          .filter(value => value);

        const sponsorData = {
          name: name,
          benefit: benefit,
          description: document.getElementById('sponsor-description').value,
          logo: document.getElementById('sponsor-logo').value || `https://placehold.co/100x100/e3f2fd/1976d2/png?text=${encodeURIComponent(name.charAt(0))}`,
          status: document.getElementById('sponsor-status').value,
          hours: document.getElementById('sponsor-hours').value,
          phone: document.getElementById('sponsor-phone').value,
          address: document.getElementById('sponsor-address').value,
          access: document.getElementById('sponsor-access').value,
          benefitDetail: document.getElementById('sponsor-benefit-detail').value,
          highlights: highlights
        };

        if (id) {
          // 編集
          const index = sponsors.findIndex(s => s.id === parseInt(id));
          sponsors[index] = { ...sponsors[index], ...sponsorData };
        } else {
          // 新規追加
          sponsorData.id = getNextId();
          sponsors.push(sponsorData);
        }

        saveData();
        renderSponsorList();
        updateStats();
        bootstrap.Modal.getInstance(document.getElementById('sponsorModal')).hide();
        
        alert('協賛店情報を保存しました。');
      }

      // 協賛店削除
      function deleteSponsor(id) {
        if (confirm('この協賛店を削除しますか？')) {
          sponsors = sponsors.filter(s => s.id !== id);
          saveData();
          renderSponsorList();
          updateStats();
          alert('協賛店を削除しました。');
        }
      }

      // 詳細表示
      function viewDetail(id) {
        window.open(`sponsor-detail.html?id=${id}`, '_blank');
      }

      // おすすめポイント管理
      function addHighlight() {
        const container = document.getElementById('highlights-container');
        const div = document.createElement('div');
        div.className = 'input-group mb-2';
        div.innerHTML = `
          <input type="text" class="form-control highlight-input" placeholder="おすすめポイントを入力" />
          <button type="button" class="btn btn-outline-danger" onclick="removeHighlight(this)">
            <i class="bi bi-trash"></i>
          </button>
        `;
        container.appendChild(div);
      }

      function removeHighlight(button) {
        button.parentElement.remove();
      }

      function resetHighlights() {
        document.getElementById('highlights-container').innerHTML = `
          <div class="input-group mb-2">
            <input type="text" class="form-control highlight-input" placeholder="おすすめポイントを入力" />
            <button type="button" class="btn btn-outline-danger" onclick="removeHighlight(this)">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        `;
      }

      // スライダープレビュー
      function previewSlider() {
        const activeSponsors = sponsors.filter(s => s.status === 'active');
        const container = document.getElementById('preview-slider-container');
        
        container.innerHTML = `
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
          <style>
            .preview-sponsor-card {
              cursor: pointer;
              transition: all 0.3s ease;
            }
            .preview-sponsor-card:hover {
              transform: translateY(-8px);
              box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
            }
          </style>
          <div class="swiper preview-swiper">
            <div class="swiper-wrapper">
              ${activeSponsors.map(sponsor => `
                <div class="swiper-slide">
                  <div class="preview-sponsor-card p-4 bg-light rounded-3 shadow-sm text-center h-100">
                    <img src="${sponsor.logo}" alt="${sponsor.name}" class="mx-auto mb-3 rounded-circle" style="width: 80px; height: 80px; object-fit: cover;" />
                    <h6 class="fw-bold mb-2">${sponsor.name}</h6>
                    <p class="text-muted small mb-0">${sponsor.benefit}</p>
                  </div>
                </div>
              `).join('')}
            </div>
            <div class="swiper-pagination mt-4"></div>
          </div>
        `;

        // Swiperを初期化
        setTimeout(() => {
          new Swiper('.preview-swiper', {
            slidesPerView: 1,
            spaceBetween: 16,
            breakpoints: {
              640: { slidesPerView: 2 },
              1024: { slidesPerView: 3 }
            },
            autoplay: { 
              delay: 3000, 
              disableOnInteraction: false 
            },
            loop: true,
            pagination: { 
              el: '.swiper-pagination', 
              clickable: true 
            }
          });
        }, 100);

        new bootstrap.Modal(document.getElementById('previewModal')).show();
      }

      // ページ読み込み時の初期化
      document.addEventListener('DOMContentLoaded', function() {
        renderSponsorList();
        updateStats();
        updateIndexPage();
      });
    </script>
  </body>
</html>