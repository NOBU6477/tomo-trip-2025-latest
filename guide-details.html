<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¬ã‚¤ãƒ‰è©³ç´° - TomoTrip</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <style>
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .navbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .guide-hero {
      background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('attached_assets/image_1750354393748.png');
      background-size: cover;
      background-position: center;
      height: 400px;
      position: relative;
      color: white;
    }
    
    .guide-details-card {
      margin-top: -100px;
      z-index: 10;
      position: relative;
    }
    
    .guide-avatar {
      width: 150px;
      height: 150px;
      border: 5px solid white;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .language-badge {
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    .booking-card {
      position: sticky;
      top: 20px;
    }
    
    .review-card {
      border-left: 4px solid #007bff;
    }
    
    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.9);
      border: none;
      color: #333;
    }
    
    .back-btn:hover {
      background: white;
      color: #007bff;
    }
  </style>
</head>

<body>
  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
      <a class="navbar-brand fw-bold text-primary" href="index.html">
        <img src="attached_assets/image_1750354393748.png" alt="TomoTrip" height="40" class="me-2">
        TomoTrip
      </a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" href="index.html">ãƒ›ãƒ¼ãƒ </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="guides.html">ã‚¬ã‚¤ãƒ‰ã‚’æ¢ã™</a>
          </li>
        </ul>
        
        <ul class="navbar-nav">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-bs-toggle="dropdown">
              æ—¥æœ¬èª
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="#" data-lang="ja">æ—¥æœ¬èª</a></li>
              <li><a class="dropdown-item" href="#" data-lang="en">English</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#loginModal">ãƒ­ã‚°ã‚¤ãƒ³</button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
  <section class="guide-hero d-flex align-items-end">
    <button class="btn back-btn" onclick="history.back()">
      <i class="bi bi-arrow-left me-2"></i>æˆ»ã‚‹
    </button>
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="d-flex align-items-end pb-4">
            <img id="guide-avatar" src="attached_assets/image_1750354393748.png" alt="ã‚¬ã‚¤ãƒ‰å†™çœŸ" class="guide-avatar rounded-circle me-4">
            <div>
              <h1 id="guide-name" class="mb-2">ã‚¬ã‚¤ãƒ‰å</h1>
              <p id="guide-location" class="mb-1"><i class="bi bi-geo-alt-fill me-2"></i>æ‰€åœ¨åœ°</p>
              <div class="d-flex align-items-center">
                <div id="guide-rating" class="text-warning me-3">
                  <i class="bi bi-star-fill"></i>
                  <span id="rating-value">0.0</span>
                </div>
                <span id="guide-price" class="badge bg-primary fs-6">Â¥0/ã‚»ãƒƒã‚·ãƒ§ãƒ³</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div class="container">
    <div class="row">
      <!-- ã‚¬ã‚¤ãƒ‰è©³ç´°æƒ…å ± -->
      <div class="col-lg-8">
        <div class="card guide-details-card shadow-lg">
          <div class="card-body p-4">
            <!-- æ¦‚è¦ -->
            <section class="mb-5">
              <h3 class="mb-3">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h3>
              <p id="guide-description" class="text-muted">ã‚¬ã‚¤ãƒ‰ã®è©³ç´°èª¬æ˜ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
            </section>

            <!-- å¯¾å¿œè¨€èª -->
            <section class="mb-5">
              <h4 class="mb-3">å¯¾å¿œè¨€èª</h4>
              <div id="guide-languages">
                <!-- è¨€èªãƒãƒƒã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
              </div>
            </section>

            <!-- å°‚é–€åˆ†é‡ -->
            <section class="mb-5">
              <h4 class="mb-3">å°‚é–€åˆ†é‡ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</h4>
              <div id="guide-keywords">
                <!-- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
              </div>
            </section>

            <!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <section class="mb-5">
              <h4 class="mb-3">ãƒ¬ãƒ“ãƒ¥ãƒ¼</h4>
              <div id="reviews-container">
                <!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                <div class="review-card card mb-3">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <div>
                        <strong>ç”°ä¸­ã•ã‚“</strong>
                        <div class="text-warning">
                          <i class="bi bi-star-fill"></i>
                          <i class="bi bi-star-fill"></i>
                          <i class="bi bi-star-fill"></i>
                          <i class="bi bi-star-fill"></i>
                          <i class="bi bi-star-fill"></i>
                        </div>
                      </div>
                      <small class="text-muted">2024å¹´6æœˆ</small>
                    </div>
                    <p class="mb-0">ã¨ã¦ã‚‚è¦ªåˆ‡ã§çŸ¥è­˜è±Šå¯Œãªã‚¬ã‚¤ãƒ‰ã§ã—ãŸã€‚åœ°å…ƒã®éš ã‚ŒãŸåæ‰€ã‚’æ¡ˆå†…ã—ã¦ã„ãŸã ãã€ç´ æ™´ã‚‰ã—ã„ä½“é¨“ãŒã§ãã¾ã—ãŸã€‚</p>
                  </div>
                </div>

                <div class="review-card card mb-3">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                      <div>
                        <strong>ä½è—¤ã•ã‚“</strong>
                        <div class="text-warning">
                          <i class="bi bi-star-fill"></i>
                          <i class="bi bi-star-fill"></i>
                          <i class="bi bi-star-fill"></i>
                          <i class="bi bi-star-fill"></i>
                          <i class="bi bi-star"></i>
                        </div>
                      </div>
                      <small class="text-muted">2024å¹´5æœˆ</small>
                    </div>
                    <p class="mb-0">è‹±èªã§ã®èª¬æ˜ã‚‚ä¸Šæ‰‹ã§ã€å¤–å›½äººã®å‹äººã‚‚å¤§æº€è¶³ã§ã—ãŸã€‚ã¾ãŸåˆ©ç”¨ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚</p>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
      </div>

      <!-- äºˆç´„ã‚«ãƒ¼ãƒ‰ -->
      <div class="col-lg-4">
        <div class="card booking-card shadow-lg">
          <div class="card-body p-4">
            <h4 class="mb-3">äºˆç´„ã™ã‚‹</h4>
            
            <div class="mb-3">
              <label for="booking-date" class="form-label">å¸Œæœ›æ—¥æ™‚</label>
              <input type="datetime-local" class="form-control" id="booking-date" required>
            </div>
            
            <div class="mb-3">
              <label for="booking-duration" class="form-label">æ™‚é–“</label>
              <select class="form-select" id="booking-duration" required>
                <option value="">æ™‚é–“ã‚’é¸æŠ</option>
                <option value="2">2æ™‚é–“</option>
                <option value="3">3æ™‚é–“</option>
                <option value="4">4æ™‚é–“</option>
                <option value="6">6æ™‚é–“</option>
                <option value="8">8æ™‚é–“ï¼ˆ1æ—¥ï¼‰</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="booking-participants" class="form-label">å‚åŠ äººæ•°</label>
              <select class="form-select" id="booking-participants" required>
                <option value="">äººæ•°ã‚’é¸æŠ</option>
                <option value="1">1å</option>
                <option value="2">2å</option>
                <option value="3">3å</option>
                <option value="4">4å</option>
                <option value="5">5å</option>
                <option value="6">6åä»¥ä¸Š</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="booking-message" class="form-label">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰</label>
              <textarea class="form-control" id="booking-message" rows="3" placeholder="ç‰¹åˆ¥ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã‚Œã°ãŠèã‹ã›ãã ã•ã„"></textarea>
            </div>
            
            <div class="border-top pt-3 mb-3">
              <div class="d-flex justify-content-between">
                <span>åŸºæœ¬æ–™é‡‘</span>
                <span id="base-price">Â¥0</span>
              </div>
              <div class="d-flex justify-content-between">
                <span>ã‚µãƒ¼ãƒ“ã‚¹æ–™</span>
                <span>Â¥500</span>
              </div>
              <hr>
              <div class="d-flex justify-content-between fw-bold">
                <span>åˆè¨ˆ</span>
                <span id="total-price">Â¥500</span>
              </div>
            </div>
            
            <button class="btn btn-primary w-100" id="booking-submit">äºˆç´„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡</button>
            
            <div class="text-center mt-3">
              <small class="text-muted">â€»ã‚¬ã‚¤ãƒ‰ãŒæ‰¿èªå¾Œã«äºˆç´„ç¢ºå®š</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="py-5"></div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ã‚¬ã‚¤ãƒ‰IDã‚’å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const guideId = urlParams.get('id');
    
    if (!guideId) {
      alert('ã‚¬ã‚¤ãƒ‰IDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
      window.location.href = 'index.html';
      return;
    }

    // è¦³å…‰å®¢ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
    const touristData = localStorage.getItem('touristData');
    if (!touristData) {
      // æœªãƒ­ã‚°ã‚¤ãƒ³ã®å ´åˆã¯å³åº§ã«ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      // ãƒšãƒ¼ã‚¸ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦é€²è¡Œã‚’åœæ­¢
      document.body.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #f8f9fa;"><div style="text-align: center;"><div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ”’</div><h3>ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™</h3><p>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã«æˆ»ã£ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</p></div></div>';
      
      sessionStorage.setItem('pendingGuideId', guideId);
      sessionStorage.setItem('showLoginOnLoad', 'true');
      sessionStorage.setItem('accessAttemptMessage', 'ã‚¬ã‚¤ãƒ‰ã®è©³ç´°ã‚’è¦‹ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
      
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 1500);
      return;
    }

    // ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
    function loadGuideDetails() {
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const guideData = localStorage.getItem(`guide_${guideId}`);
      
      if (guideData) {
        const guide = JSON.parse(guideData);
        displayGuideDetails(guide);
      } else {
        // ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ç”Ÿæˆã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ¤œç´¢
        if (typeof generateGuides === 'function') {
          const guides = generateGuides();
          const guide = guides.find(g => g.id == guideId);
          if (guide) {
            displayGuideDetails(guide);
          } else {
            alert('ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            window.location.href = 'index.html';
          }
        } else {
          alert('ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          window.location.href = 'index.html';
        }
      }
    }

    // ã‚¬ã‚¤ãƒ‰è©³ç´°ã‚’è¡¨ç¤º
    function displayGuideDetails(guide) {
      document.getElementById('guide-name').textContent = guide.name;
      document.getElementById('guide-location').innerHTML = `<i class="bi bi-geo-alt-fill me-2"></i>${guide.region}`;
      document.getElementById('guide-description').textContent = guide.description;
      document.getElementById('rating-value').textContent = guide.rating.toFixed(1);
      document.getElementById('guide-price').textContent = `Â¥${guide.fee.toLocaleString()}/ã‚»ãƒƒã‚·ãƒ§ãƒ³`;
      document.getElementById('base-price').textContent = `Â¥${guide.fee.toLocaleString()}`;
      document.getElementById('total-price').textContent = `Â¥${(guide.fee + 500).toLocaleString()}`;
      
      // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ
      if (guide.imageUrl) {
        document.getElementById('guide-avatar').src = guide.imageUrl;
      }
      
      // è¨€èªãƒãƒƒã‚¸
      const languagesContainer = document.getElementById('guide-languages');
      languagesContainer.innerHTML = guide.languages.map(lang => 
        `<span class="badge bg-secondary language-badge">${lang}</span>`
      ).join('');
      
      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚¸
      const keywordsContainer = document.getElementById('guide-keywords');
      keywordsContainer.innerHTML = guide.keywords.map(keyword => 
        `<span class="badge bg-outline-primary language-badge">${keyword}</span>`
      ).join('');
      
      // ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ˜Ÿè¡¨ç¤º
      const ratingContainer = document.getElementById('guide-rating');
      const stars = Math.floor(guide.rating);
      const halfStar = guide.rating % 1 >= 0.5;
      let starsHTML = '';
      
      for (let i = 0; i < stars; i++) {
        starsHTML += '<i class="bi bi-star-fill"></i>';
      }
      if (halfStar) {
        starsHTML += '<i class="bi bi-star-half"></i>';
      }
      for (let i = stars + (halfStar ? 1 : 0); i < 5; i++) {
        starsHTML += '<i class="bi bi-star"></i>';
      }
      starsHTML += ` <span>${guide.rating.toFixed(1)}</span>`;
      
      ratingContainer.innerHTML = starsHTML;
      
      // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
      document.title = `${guide.name} - ã‚¬ã‚¤ãƒ‰è©³ç´° | TomoTrip`;
    }

    // äºˆç´„å‡¦ç†
    document.getElementById('booking-submit').addEventListener('click', function() {
      const date = document.getElementById('booking-date').value;
      const duration = document.getElementById('booking-duration').value;
      const participants = document.getElementById('booking-participants').value;
      const message = document.getElementById('booking-message').value;
      
      if (!date || !duration || !participants) {
        alert('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      
      // äºˆç´„ãƒ‡ãƒ¼ã‚¿
      const bookingData = {
        guideId: guideId,
        date: date,
        duration: duration,
        participants: participants,
        message: message,
        status: 'pending',
        timestamp: new Date().toISOString()
      };
      
      // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ï¼‰
      const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
      bookings.push(bookingData);
      localStorage.setItem('bookings', JSON.stringify(bookings));
      
      alert('äºˆç´„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã—ãŸï¼ã‚¬ã‚¤ãƒ‰ã‹ã‚‰ã®è¿”ç­”ã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚');
      
      // äºˆç´„ç¢ºèªãƒšãƒ¼ã‚¸ã«é·ç§»
      window.location.href = `booking-confirmation.html?id=${bookings.length - 1}`;
    });

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      loadGuideDetails();
    });
  </script>
  
  <!-- è¨€èªåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ -->
  <script src="minimal-language.js"></script>
  
  <!-- ãƒ†ã‚¹ãƒˆç”¨ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ -->
  <script src="test-login.js"></script>
  
  <!-- ã‚¬ã‚¤ãƒ‰ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ -->
  <script src="generate-guide-data.js"></script>
</body>
</html>