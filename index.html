<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' *; script-src 'self' 'unsafe-inline' 'unsafe-eval' *; style-src 'self' 'unsafe-inline' *;">
  <title>Local Guide - 特別な旅の体験を</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    /* Language Switcher */
    .language-switcher {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 25px;
      padding: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .lang-btn {
      border: none;
      background: transparent;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 500;
      transition: all 0.3s ease;
      text-decoration: none;
      color: #666;
    }
    
    .lang-btn.active {
      background: #4287f5;
      color: white;
    }
    
    .lang-btn:hover {
      background: #f0f7ff;
      color: #4287f5;
    }
    
    .lang-btn.active:hover {
      background: #4287f5;
      color: white;
    }
    
    @media (max-width: 768px) {
      .language-switcher {
        position: relative;
        top: auto;
        right: auto;
        margin: 1rem auto;
        display: flex;
        justify-content: center;
      }
    }
  </style>

  <!-- 新しいスクロール実装CSS -->
  <style id="new-scroll-css">
    html {
      overflow: visible !important;
      overflow-y: auto !important;
      height: auto !important;
      min-height: 100vh !important;
    }
    
    body {
      overflow-y: auto !important;
      height: auto !important;
      min-height: 100vh !important;
      position: static !important;
      padding-bottom: 50px;
    }
    
    body.modal-open {
      overflow: visible !important;
      overflow-y: auto !important;
      padding-right: 0 !important;
      position: static !important;
    }
    
    .modal-backdrop {
      display: none !important;
    }
  </style>

  <style>
    body {
      background-color: #f8f9fa;
    }
    .navbar-brand {
      font-weight: bold;
    }
    .modal-content {
      border-radius: 0.5rem;
    }
    .section-title {
      border-bottom: 2px solid #0d6efd;
      padding-bottom: 0.5rem;
      margin-bottom: 1rem;
    }
    
    /* 新規登録ドロップダウンのスタイル */
    .register-dropdown {
      width: 100%;
      max-width: 320px;
      padding: 0.5rem;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      animation: fadeInDown 0.3s ease;
      left: auto !important;
      right: 0 !important;
    }
    
    .dropdown-item {
      border-radius: 8px;
      padding: 12px 15px;
      transition: all 0.2s ease;
    }
    
    .dropdown-item:hover {
      background-color: #f0f7ff;
      transform: translateY(-2px);
    }
    
    .register-dropdown {
      min-width: 320px;
      border: 1px solid rgba(0,0,0,0.05);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      border-radius: 8px;
      padding: 8px 0;
      margin-top: 10px;
      background: white;
    }
    
    .register-dropdown .dropdown-item {
      padding: 12px 16px;
      border: none;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      text-decoration: none;
    }
    
    .register-dropdown .dropdown-item:hover {
      background-color: #f8f9fa;
      border-radius: 0;
    }
    
    .register-dropdown .dropdown-item:focus {
      background-color: #f8f9fa;
      box-shadow: none;
    }
    
    .register-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      font-size: 1.2rem;
      margin-right: 12px;
      flex-shrink: 0;
    }
    
    .tourist-icon {
      background-color: #e3f2fd;
      color: #1976d2;
    }
    
    .guide-icon {
      background-color: #e8f5e8;
      color: #388e3c;
    }
    
    .dropdown-divider {
      margin: 8px 16px;
      border-color: #e9ecef;
    }
    
    .register-dropdown .fw-bold {
      font-weight: 600;
      color: #212529;
      margin-bottom: 2px;
      font-size: 14px;
    }
    
    .register-dropdown .text-muted {
      font-size: 12px;
      color: #6c757d !important;
      line-height: 1.3;
      margin: 0;
    }
    
    .register-dropdown > li > .dropdown-item > div:last-child {
      flex: 1;
    }
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* デバッグ情報の黒枠を非表示にする */
    .debug-info, 
    [style*="position: fixed"][style*="bottom"],
    [style*="position: fixed"][style*="right"],
    [style*="background-color: rgba(0,0,0,0.8)"],
    [style*="background: rgba(0,0,0,0.8)"],
    .replit-debug,
    .debug-overlay,
    div[style*="position: fixed"][style*="z-index"][style*="background"],
    .replit-info {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
    }
    .phone-section {
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 0.375rem;
      padding: 1.5rem;
      margin: 1rem 0;
    }
    .hero-section {
      background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://source.unsplash.com/random/1200x800/?japan,travel');
      background-size: cover;
      background-position: center;
      color: white;
      padding: 5rem 0;
      margin-bottom: 2rem;
    }
    .guide-card {
      transition: transform 0.3s;
      margin-bottom: 1.5rem;
      border-radius: 10px;
      overflow: visible;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .guide-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .guide-image {
      height: 250px;
      object-fit: cover;
      object-position: center;
      border-bottom: 1px solid #eee;
      transition: transform 0.5s ease;
      filter: brightness(0.95);
    }
    .guide-card:hover .guide-image {
      transform: scale(1.05);
      filter: brightness(1.05);
    }
    .badge-verified {
      background-color: #28a745;
      color: white;
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      margin-left: 0.5rem;
    }
    /* 認証ボタンのパルスアニメーション */
    .btn-pulse {
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
      }
    }
    /* 認証ボタンのスタイル */
    #tourist-verify-code-btn,
    #guide-verify-code-btn {
      width: 100%;
      margin-top: 0.5rem;
      transition: all 0.3s ease;
    }
    /* 身分証明書プレビュー */
    .document-preview-container {
      min-height: 50px;
    }
    .document-preview img {
      max-height: 200px;
      width: auto;
      border: 1px solid #dee2e6;
    }
    /* 非表示ガイド用のスタイル */
    .hidden-guide {
      display: none;
    }
    
    /* フィルター関連のスタイル */
    /* 検索結果カウンターの強化スタイル */
    #search-results-counter {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 1.2rem;
      font-weight: 700;
      padding: 1rem 2rem;
      border-radius: 50px;
      text-align: center;
      margin: 1.5rem auto;
      max-width: 400px;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: visible;
      animation: counterPulse 2s ease-in-out infinite alternate;
    }
    
    #search-results-counter::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s ease-in-out infinite;
    }
    
    #search-results-counter::after {
      content: '🔍';
      position: absolute;
      left: 1.2rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem;
      opacity: 0.7;
      z-index: 1;
    }
    
    #search-results-counter {
      padding-left: 3rem !important;
      z-index: 2;
      position: relative;
    }
    
    @keyframes counterPulse {
      0% {
        transform: scale(1);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }
      100% {
        transform: scale(1.02);
        box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
      }
    }
    
    @keyframes shimmer {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }
      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }
    
    /* モバイル対応 */
    @media (max-width: 768px) {
      #search-results-counter {
        font-size: 1rem;
        padding: 0.8rem 1.5rem;
        margin: 1rem auto;
      }
      
      #search-results-counter::after {
        font-size: 1.2rem;
        left: 0.8rem;
      }
    }
    
    /* 強化されたガイドカードデザイン */
    .guide-card {
      transition: all 0.3s ease;
      border: 2px solid transparent;
      border-radius: 15px !important;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      overflow: visible;
      position: relative;
    }
    
    .guide-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      z-index: 1;
    }
    
    .guide-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      border-color: #667eea;
    }
    
    .guide-card .card-img-top {
      height: 220px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    
    .guide-card:hover .card-img-top {
      transform: scale(1.05);
    }
    
    .guide-card .card-body {
      padding: 1.5rem;
      position: relative;
      z-index: 2;
    }
    
    .guide-card .card-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 0.8rem;
    }
    
    .guide-card .badge.bg-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      font-size: 0.9rem;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .guide-card .guide-location {
      font-size: 1rem;
      color: #6c757d;
      font-weight: 500;
    }
    
    .guide-card .guide-location i {
      color: #667eea;
      font-size: 1.1rem;
    }
    
    .guide-card .card-text {
      font-size: 0.95rem;
      line-height: 1.6;
      color: #495057;
    }
    
    .guide-card .badge.bg-light {
      background: #e3f2fd !important;
      color: #1976d2 !important;
      font-weight: 500;
      border: 1px solid #bbdefb;
    }
    
    .guide-card .text-warning i {
      color: #ffc107 !important;
      text-shadow: 0 1px 3px rgba(255, 193, 7, 0.3);
    }
    
    .guide-card .btn-outline-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 25px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .guide-card .btn-outline-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      background: linear-gradient(135deg, #5a6fd8 0%, #6a42a6 100%);
    }
    
    /* ガイドセクション全体の強化 */
    #guides {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 20px;
      padding: 3rem 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      margin: 2rem 0;
    }
    
    #guides h2 {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }
    
    .guide-item {
      margin-bottom: 2rem;
      animation: slideInUp 0.6s ease-out forwards;
      opacity: 0;
      transform: translateY(30px);
    }
    
    .guide-item:nth-child(1) { animation-delay: 0.1s; }
    .guide-item:nth-child(2) { animation-delay: 0.2s; }
    .guide-item:nth-child(3) { animation-delay: 0.3s; }
    .guide-item:nth-child(4) { animation-delay: 0.4s; }
    .guide-item:nth-child(5) { animation-delay: 0.5s; }
    .guide-item:nth-child(6) { animation-delay: 0.6s; }

    @keyframes slideInUp {
      0% {
        opacity: 0;
        transform: translateY(30px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .guide-filter-fadeIn {
      animation: fadeIn 0.4s ease-out forwards;
    }
    
    /* 「もっと見る」ボタンの強化 */
    #load-more-guides {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      color: white;
      font-weight: 600;
      padding: 1rem 2.5rem;
      border-radius: 30px;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
      margin: 2rem auto;
      display: block;
    }
    
    #load-more-guides:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      background: linear-gradient(135deg, #5a6fd8 0%, #6a42a6 100%);
    }
    
    /* プロフィール写真スタイル */
    .profile-photo-container {
      position: relative;
      width: 150px;
      height: 150px;
      overflow: visible;
      cursor: pointer;
    }
    
    .profile-photo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: all 0.3s ease;
    }
    
    .profile-photo-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.3);
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      border-radius: 50%;
    }
    
    .profile-photo-overlay i {
      color: white;
      font-size: 2rem;
    }
    
    .profile-photo-container:hover .profile-photo-overlay {
      opacity: 1;
    }
    
    .profile-photo-container:hover .profile-photo {
      transform: scale(1.05);
    }
    
    /* モバイル端末のみカメラ機能表示 */
    @media (min-width: 768px) {
      .mobile-only {
        display: none !important;
      }
    }

    /* 協賛店広告バナー - 右から左へのスクロール */
    .sponsor-banner {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 15px 0;
      overflow: visible;
      position: relative;
      white-space: nowrap;
      border-bottom: 3px solid #4f46e5;
    }

    .sponsor-scroll {
      display: inline-block;
      animation: scrollRight 30s linear infinite;
      white-space: nowrap;
    }

    .sponsor-item {
      display: inline-block;
      background: rgba(255, 255, 255, 0.95);
      margin: 0 20px;
      padding: 8px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      vertical-align: middle;
    }

    .sponsor-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
    }

    .sponsor-logo {
      height: 30px;
      width: auto;
      margin-right: 10px;
      vertical-align: middle;
    }

    .sponsor-text {
      color: #333;
      font-weight: 600;
      font-size: 14px;
      vertical-align: middle;
    }

    .sponsor-offer {
      background: #ff6b6b;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      margin-left: 8px;
      font-weight: bold;
    }

    @keyframes scrollRight {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }
    
    /* スポンサーバナーの強制表示 */
    .sponsor-banner {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      height: auto !important;
      min-height: 60px !important;
    }

    /* モバイル対応 */
    @media (max-width: 768px) {
      .sponsor-banner {
        padding: 10px 0;
      }
      
      .sponsor-item {
        margin: 0 15px;
        padding: 6px 15px;
      }
      
      .sponsor-text {
        font-size: 12px;
      }
      
      .sponsor-logo {
        height: 25px;
      }
      
      .sponsor-offer {
        font-size: 10px;
        padding: 1px 6px;
      }
    }

    /* アニメーション一時停止（ホバー時） */
    .sponsor-banner:hover .sponsor-scroll {
      animation-play-state: paused;
    }
  </style>
</head>
<body>
  <!-- アラートコンテナ -->
  <div id="alert-container" style="position: fixed; top: 20px; right: 20px; max-width: 400px; z-index: 9999;"></div>
  
  <!-- ナビゲーションバー -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <!-- ナビゲーションバー ロゴ -->
      <a class="navbar-brand d-flex align-items-center" href="/">
        <img src="TomoTripロゴ.png" alt="TomoTrip ロゴ" style="height: 60px; width: auto; border-radius: 15px;" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link active" href="#top">ホーム</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#guides">ガイドを探す</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#how-it-works">使い方</a>
          </li>
        </ul>
        
        <!-- 言語切り替えボタン -->
        <div class="language-switcher me-3">
          <button class="btn btn-outline-light btn-sm lang-btn active">
            🇯🇵 日本語
          </button>
          <button class="btn btn-outline-light btn-sm lang-btn" onclick="window.location.href='index-en.html'">
            🇺🇸 English
          </button>
        </div>
        
        <!-- ログイン・新規登録ボタン -->
        <div id="navbar-user-area">
          <button class="btn btn-outline-light me-2" data-bs-toggle="modal" data-bs-target="#loginModal">ログイン</button>
          <button class="btn btn-light" onclick="showRegisterOptions()">新規登録</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- ヒーローセクション -->
  <section id="top" class="hero-section text-center text-white py-5" style="
    background: linear-gradient(rgba(66, 135, 245, 0.4), rgba(224, 79, 158, 0.4)), 
                url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1200&h=800&fit=crop') center/cover;
    position: relative; 
    min-height: 60vh;
  ">
    <!-- 装飾要素 -->
    <div style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0.3;">
      <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="position: absolute; width: 300px; height: 300px; top: -50px; left: -50px;">
        <path fill="#FFFFFF" d="M44.7,-76.4C58.8,-69.2,71.8,-59.1,79.6,-45.5C87.4,-31.9,90.2,-15.9,88.1,-1.2C86,13.5,79.1,27,70.8,39.4C62.5,51.8,52.7,63.1,40.4,70.4C28.1,77.8,14.1,81.1,-0.3,81.6C-14.7,82.1,-29.3,79.9,-41,72.5C-52.6,65.2,-61.3,52.8,-68.9,39.7C-76.6,26.6,-83.3,13.3,-84.7,-0.8C-86,-14.9,-82,-29.9,-73.6,-41.5C-65.2,-53.1,-52.5,-61.4,-39.3,-68.7C-26.1,-76,-13.1,-82.3,1.1,-84.1C15.2,-85.8,30.5,-83.7,44.7,-76.4Z" transform="translate(100 100)" />
      </svg>
      <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="position: absolute; width: 400px; height: 400px; bottom: -150px; right: -100px;">
        <path fill="#FFFFFF" d="M34.6,-59.1C43.5,-53.8,48.7,-41.8,55.8,-30.2C62.8,-18.6,71.7,-7.3,73,5.1C74.4,17.6,68.3,31.2,58.5,40.1C48.7,48.9,35.3,52.9,22.7,56.7C10.2,60.5,-1.5,63.9,-14.6,63.8C-27.8,63.7,-42.4,60,-50.9,50.7C-59.4,41.3,-61.7,26.3,-65.6,11.3C-69.4,-3.7,-74.7,-18.6,-71.1,-31C-67.5,-43.3,-55,-53,-41.7,-57.8C-28.4,-62.5,-14.2,-62.3,-0.6,-61.3C13,-60.3,25.9,-58.3,34.6,-59.1Z" transform="translate(100 100)" />
      </svg>
    </div>

    <!-- TomoTrip Logo -->
    <div style="position: absolute; top: 2%; left: 2%; z-index: 20;">
      <div style="
        width: 140px;
        height: 140px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(10px);
        border: 4px solid rgba(255, 255, 255, 0.3);
      ">
        <img src="TomoTripロゴ.png" alt="TomoTrip" style="
          width: 130px;
          height: 130px;
          object-fit: cover;
          border-radius: 10px;
        ">
      </div>
    </div>
    
    <div class="container position-relative">
      <h1 class="display-4 fw-bold mb-3">あなただけの特別な旅を</h1>
      <p class="lead mb-4">地元ガイドと一緒に、観光では見つけられない隠れた魅力を体験しましょう</p>
      <div class="position-relative">
        <a href="#guides" class="btn btn-light btn-lg">ガイドを探す</a>
        <button class="btn btn-outline-light btn-lg ms-2" data-bs-toggle="modal" data-bs-target="#contactModal">お問い合わせ</button>
        
        <!-- 協賛店専用ボタンエリア（右下小さめ） -->
        <div class="sponsor-mini-buttons">
          <div class="sponsor-mini-wrapper">
            <button class="sponsor-mini-btn sponsor-register" id="sponsorRegisterBtn" title="協賛店登録">
              <i class="bi bi-shop"></i>
              <span>協賛店登録 🚀</span>
            </button>
            <button class="sponsor-mini-btn sponsor-login" id="sponsorLoginBtn" title="協賛店ログイン">
              <i class="bi bi-box-arrow-in-right"></i>
              <span>ログイン ✨</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 協賛店広告バナー -->
  <div class="sponsor-banner" id="main-sponsor-banner">
    <div class="sponsor-scroll" id="main-sponsor-scroll">
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=100&h=60&fit=crop" alt="海の家レストラン" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">海の家レストラン</span>
        <span class="sponsor-offer">20%OFF</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?w=100&h=60&fit=crop" alt="山田温泉ホテル" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">山田温泉ホテル</span>
        <span class="sponsor-offer">特別価格</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=100&h=60&fit=crop" alt="サクラ観光バス" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">サクラ観光バス</span>
        <span class="sponsor-offer">送迎無料</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=100&h=60&fit=crop" alt="伝統工芸体験館" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">伝統工芸体験館</span>
        <span class="sponsor-offer">体験割引</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1543083115-638c32cd3d58?w=100&h=60&fit=crop" alt="地元特産品店" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">地元特産品店</span>
        <span class="sponsor-offer">お土産10%OFF</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=100&h=60&fit=crop" alt="カフェ桜" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">カフェ桜</span>
        <span class="sponsor-offer">ドリンク1杯無料</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=100&h=60&fit=crop" alt="釣り船太郎" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">釣り船太郎</span>
        <span class="sponsor-offer">初回半額</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=100&h=60&fit=crop" alt="レンタル自転車" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">レンタル自転車</span>
        <span class="sponsor-offer">1日レンタル</span>
      </div>
      <!-- 繰り返し表示でシームレスなループを作成 -->
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=100&h=60&fit=crop" alt="海の家レストラン" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">海の家レストラン</span>
        <span class="sponsor-offer">20%OFF</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?w=100&h=60&fit=crop" alt="山田温泉ホテル" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">山田温泉ホテル</span>
        <span class="sponsor-offer">特別価格</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=100&h=60&fit=crop" alt="サクラ観光バス" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">サクラ観光バス</span>
        <span class="sponsor-offer">送迎無料</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=100&h=60&fit=crop" alt="伝統工芸体験館" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">伝統工芸体験館</span>
        <span class="sponsor-offer">体験割引</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1543083115-638c32cd3d58?w=100&h=60&fit=crop" alt="地元特産品店" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">地元特産品店</span>
        <span class="sponsor-offer">お土産10%OFF</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=100&h=60&fit=crop" alt="カフェ桜" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">カフェ桜</span>
        <span class="sponsor-offer">ドリンク1杯無料</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=100&h=60&fit=crop" alt="釣り船太郎" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">釣り船太郎</span>
        <span class="sponsor-offer">初回半額</span>
      </div>
      <div class="sponsor-item">
        <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=100&h=60&fit=crop" alt="レンタル自転車" class="sponsor-logo" onerror="this.style.display='none'">
        <span class="sponsor-text">レンタル自転車</span>
        <span class="sponsor-offer">1日レンタル</span>
      </div>
    </div>
  </div>



  <!-- メインコンテンツ -->
  <div class="container py-5">
    <!-- 人気のガイド -->
    <section id="guides" class="mb-5">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="position-relative">
          <button type="button" class="btn btn-sm btn-outline-info me-3" id="filter-tutorial-btn" style="border-radius: 20px;">
            <i class="bi bi-question-circle me-1"></i>フィルターの使い方
          </button>
        </div>
        <h2 class="mb-0 flex-grow-1 text-center">人気のガイド</h2>
        <div style="width: 140px;"></div> <!-- スペーサー -->
      </div>
      <div class="mb-4">
        <div id="search-results-counter">70人のガイドが見つかりました</div>
        <div id="no-results-message" class="alert alert-info text-center my-4 d-none">検索条件に一致するガイドが見つかりませんでした。条件を変更してお試しください。</div>
        
        <!-- フィルター切り替えボタン -->
        <div class="text-center mb-3">
          <button type="button" class="btn btn-outline-primary" id="toggle-filter-button">
            <i class="bi bi-funnel"></i> ガイドを絞り込み
          </button>
        </div>
        
        <div class="row justify-content-center">
          <div class="col-md-10 col-lg-8">
            <div class="card shadow-sm d-none" id="filter-card">
              <div class="card-body">
                <h5 class="card-title mb-3">ガイドを絞り込む</h5>
                <form id="guide-filter-form">
                  <!-- リアルタイム検索フィルターフォーム -->
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label for="location-filter" class="form-label">地域</label>
                      <select class="form-select" id="location-filter">
                        <option value="">すべて</option>
                        <optgroup label="都道府県">
                          <option value="北海道">北海道</option>
                          <option value="青森県">青森県</option>
                          <option value="岩手県">岩手県</option>
                          <option value="宮城県">宮城県</option>
                          <option value="秋田県">秋田県</option>
                          <option value="山形県">山形県</option>
                          <option value="福島県">福島県</option>
                          <option value="茨城県">茨城県</option>
                          <option value="栃木県">栃木県</option>
                          <option value="群馬県">群馬県</option>
                          <option value="埼玉県">埼玉県</option>
                          <option value="千葉県">千葉県</option>
                          <option value="東京都">東京都</option>
                          <option value="神奈川県">神奈川県</option>
                          <option value="新潟県">新潟県</option>
                          <option value="富山県">富山県</option>
                          <option value="石川県">石川県</option>
                          <option value="福井県">福井県</option>
                          <option value="山梨県">山梨県</option>
                          <option value="長野県">長野県</option>
                          <option value="岐阜県">岐阜県</option>
                          <option value="静岡県">静岡県</option>
                          <option value="愛知県">愛知県</option>
                          <option value="三重県">三重県</option>
                          <option value="滋賀県">滋賀県</option>
                          <option value="京都府">京都府</option>
                          <option value="大阪府">大阪府</option>
                          <option value="兵庫県">兵庫県</option>
                          <option value="奈良県">奈良県</option>
                          <option value="和歌山県">和歌山県</option>
                          <option value="鳥取県">鳥取県</option>
                          <option value="島根県">島根県</option>
                          <option value="岡山県">岡山県</option>
                          <option value="広島県">広島県</option>
                          <option value="山口県">山口県</option>
                          <option value="徳島県">徳島県</option>
                          <option value="香川県">香川県</option>
                          <option value="愛媛県">愛媛県</option>
                          <option value="高知県">高知県</option>
                          <option value="福岡県">福岡県</option>
                          <option value="佐賀県">佐賀県</option>
                          <option value="長崎県">長崎県</option>
                          <option value="熊本県">熊本県</option>
                          <option value="大分県">大分県</option>
                          <option value="宮崎県">宮崎県</option>
                          <option value="鹿児島県">鹿児島県</option>
                          <option value="沖縄県">沖縄県</option>
                        </optgroup>
                        <optgroup label="離島">
                          <option value="屋久島">屋久島</option>
                          <option value="種子島">種子島</option>
                          <option value="奄美大島">奄美大島</option>
                          <option value="宮古島">宮古島</option>
                          <option value="石垣島">石垣島</option>
                          <option value="竹富島">竹富島</option>
                          <option value="西表島">西表島</option>
                          <option value="与那国島">与那国島</option>
                          <option value="佐渡島">佐渡島</option>
                          <option value="隠岐諸島">隠岐諸島</option>
                          <option value="壱岐">壱岐</option>
                          <option value="対馬">対馬</option>
                          <option value="五島列島">五島列島</option>
                          <option value="小笠原諸島">小笠原諸島</option>
                        </optgroup>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label for="language-filter" class="form-label">言語</label>
                      <select class="form-select" id="language-filter">
                        <option value="">すべて</option>
                        <option value="日本語">日本語</option>
                        <option value="英語">英語</option>
                        <option value="中国語">中国語</option>
                        <option value="韓国語">韓国語</option>
                        <option value="フランス語">フランス語</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label for="fee-filter" class="form-label">料金</label>
                      <select class="form-select" id="fee-filter">
                        <option value="">すべて</option>
                        <option value="6000">¥6,000~/回</option>
                        <option value="10000">¥10,000以下/回</option>
                        <option value="15000">¥15,000以下/回</option>
                        <option value="20000">¥20,000以下/回</option>
                      </select>
                    </div>
                    <div class="col-12">
                      <label class="form-label">キーワード</label>
                      <div class="d-flex flex-wrap" id="keyword-filter-group">
                        <div class="form-check me-3 mb-2">
                          <input class="form-check-input keyword-checkbox" type="checkbox" value="ナイトツアー" id="keyword-night">
                          <label class="form-check-label" for="keyword-night">ナイトツアー</label>
                        </div>
                        <div class="form-check me-3 mb-2">
                          <input class="form-check-input keyword-checkbox" type="checkbox" value="グルメ" id="keyword-food">
                          <label class="form-check-label" for="keyword-food">グルメ</label>
                        </div>
                        <div class="form-check me-3 mb-2">
                          <input class="form-check-input keyword-checkbox" type="checkbox" value="写真スポット" id="keyword-photo">
                          <label class="form-check-label" for="keyword-photo">写真スポット</label>
                        </div>
                        <div class="form-check me-3 mb-2">
                          <input class="form-check-input keyword-checkbox" type="checkbox" value="料理" id="keyword-cooking">
                          <label class="form-check-label" for="keyword-cooking">料理</label>
                        </div>
                        <div class="form-check me-3 mb-2">
                          <input class="form-check-input keyword-checkbox" type="checkbox" value="アクティビティ" id="keyword-activity">
                          <label class="form-check-label" for="keyword-activity">アクティビティ</label>
                        </div>
                      </div>
                      <input type="text" class="form-control mt-2" id="keyword-filter-custom" placeholder="その他のキーワードを入力（コンマ区切りで複数入力可）">
                      <small class="text-muted mt-1 d-block">
                        <i class="bi bi-info-circle"></i> 上記のチェックボックスまたはこの入力欄でキーワードを指定できます。複数のキーワードを入力する場合は、カンマ（,）で区切ってください。例: 「温泉,登山,ハイキング」
                      </small>
                    </div>
                    <div class="col-12 d-flex justify-content-end">
                      <button type="reset" class="btn btn-secondary me-2" id="reset-filters">リセット</button>
                      <button type="button" class="btn btn-primary" id="apply-filters">
                        <i class="bi bi-search"></i> 検索
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="row guides-container" id="guide-cards-container">
        <!-- 初期表示されるガイド -->
        <!-- ガイド1 -->
        <div class="col-md-4 guide-item">
          <div class="card guide-card shadow-sm" data-guide-id="1" data-location="東京都 渋谷区" data-languages="日本語,英語" data-fee="6000" data-keywords="グルメ,写真スポット">
            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop&crop=face" class="card-img-top guide-image" alt="ガイド写真">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">桃太郎</h5>
                <span class="badge bg-primary">¥6,000/セッション</span>
              </div>
              <p class="card-text text-muted mb-2 guide-location">
                <i class="bi bi-geo-alt-fill me-1"></i>東京都 渋谷区
              </p>
              <p class="card-text mb-3">東京の隠れた名所を案内します。グルメや写真スポットが得意です。</p>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-light text-dark guide-lang me-1">日本語</span>
                  <span class="badge bg-light text-dark">英語</span>
                </div>
                <div class="text-warning">
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-half"></i>
                  <span class="text-dark ms-1">4.5</span>
                </div>
              </div>
            </div>
            <div class="card-footer bg-white border-0 pt-0">
              <a href="#" class="btn btn-outline-primary w-100 guide-details-link" data-guide-id="1">詳細を見る</a>
            </div>
          </div>
        </div>
        
        <!-- ガイド2 -->
        <div class="col-md-4 guide-item">
          <div class="card guide-card shadow-sm" data-guide-id="2" data-location="京都府 京都市" data-languages="日本語,英語,中国語" data-fee="8000" data-keywords="歴史,文化,寺院,写真スポット">
            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop&crop=face" class="card-img-top guide-image" alt="ガイド写真">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">花子</h5>
                <span class="badge bg-primary">¥5,500/セッション</span>
              </div>
              <p class="card-text text-muted mb-2 guide-location">
                <i class="bi bi-geo-alt-fill me-1"></i>京都府 京都市
              </p>
              <p class="card-text mb-3">歴史と伝統が息づく京都の魅力をご案内。寺社巡りや伝統文化体験が得意です。</p>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-light text-dark guide-lang me-1">日本語</span>
                  <span class="badge bg-light text-dark">英語</span>
                </div>
                <div class="text-warning">
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star"></i>
                  <span class="text-dark ms-1">4.0</span>
                </div>
              </div>
            </div>
            <div class="card-footer bg-white border-0 pt-0">
              <a href="#" class="btn btn-outline-primary w-100 guide-details-link" data-guide-id="2">詳細を見る</a>
            </div>
          </div>
        </div>
        
        <!-- ガイド3 -->
        <div class="col-md-4 guide-item">
          <div class="card guide-card shadow-sm" data-guide-id="3" data-location="大阪府 大阪市" data-languages="日本語,英語" data-fee="7000" data-keywords="グルメ,ナイトツアー,ローカル">
            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop&crop=face" class="card-img-top guide-image" alt="ガイド写真">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">一郎</h5>
                <span class="badge bg-primary">¥5,000/セッション</span>
              </div>
              <p class="card-text text-muted mb-2 guide-location">
                <i class="bi bi-geo-alt-fill me-1"></i>大阪府 大阪市
              </p>
              <p class="card-text mb-3">大阪ならではの食べ歩きと街歩きが専門。地元の人だけが知る名店にご案内します。</p>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-light text-dark guide-lang me-1">日本語</span>
                  <span class="badge bg-light text-dark">英語(基礎)</span>
                </div>
                <div class="text-warning">
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-half"></i>
                  <i class="bi bi-star"></i>
                  <span class="text-dark ms-1">3.5</span>
                </div>
              </div>
            </div>
            <div class="card-footer bg-white border-0 pt-0">
              <a href="#" class="btn btn-outline-primary w-100 guide-details-link" data-guide-id="3">詳細を見る</a>
            </div>
          </div>
        </div>
        
        <!-- 追加のガイド（初期状態では非表示） -->
        <!-- ガイド4 -->
        <div class="col-md-4 guide-item hidden-guide">
          <div class="card guide-card shadow-sm" data-guide-id="4">
            <img src="https://placehold.co/400x300?text=北海道ガイド" class="card-img-top guide-image" alt="ガイド写真">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">雪</h5>
                <span class="badge bg-primary">¥8,000/セッション</span>
              </div>
              <p class="card-text text-muted mb-2">
                <i class="bi bi-geo-alt-fill me-1"></i>北海道 札幌市
              </p>
              <p class="card-text mb-3">北海道・札幌のローカルガイド。四季折々の自然と新鮮な海の幸、絶景スポットをご案内します。</p>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-light text-dark me-1">日本語</span>
                  <span class="badge bg-light text-dark me-1">英語</span>
                  <span class="badge bg-light text-dark">ロシア語</span>
                </div>
                <div class="text-warning">
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star"></i>
                  <span class="text-dark ms-1">4.0</span>
                </div>
              </div>
            </div>
            <div class="card-footer bg-white border-0 pt-0">
              <a href="#" class="btn btn-outline-primary w-100 guide-details-link" data-guide-id="4">詳細を見る</a>
            </div>
          </div>
        </div>
        
        <!-- ガイド5 -->
        <div class="col-md-4 guide-item hidden-guide">
          <div class="card guide-card shadow-sm" data-guide-id="5">
            <img src="https://placehold.co/400x300?text=沖縄ガイド" class="card-img-top guide-image" alt="ガイド写真">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">海</h5>
                <span class="badge bg-primary">¥12,000/セッション</span>
              </div>
              <p class="card-text text-muted mb-2">
                <i class="bi bi-geo-alt-fill me-1"></i>沖縄県 那覇市
              </p>
              <p class="card-text mb-3">沖縄在住15年のダイビングインストラクター。美しい海と独自の文化が残る島々を案内します。</p>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-light text-dark me-1">日本語</span>
                  <span class="badge bg-light text-dark">英語</span>
                </div>
                <div class="text-warning">
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-half"></i>
                  <span class="text-dark ms-1">4.5</span>
                </div>
              </div>
            </div>
            <div class="card-footer bg-white border-0 pt-0">
              <a href="#" class="btn btn-outline-primary w-100 guide-details-link" data-guide-id="5">詳細を見る</a>
            </div>
          </div>
        </div>
        
        <!-- ガイド6 -->
        <div class="col-md-4 guide-item hidden-guide">
          <div class="card guide-card shadow-sm" data-guide-id="6">
            <img src="https://placehold.co/400x300?text=広島ガイド" class="card-img-top guide-image" alt="ガイド写真">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">平和</h5>
                <span class="badge bg-primary">¥6,500/セッション</span>
              </div>
              <p class="card-text text-muted mb-2">
                <i class="bi bi-geo-alt-fill me-1"></i>広島県 広島市
              </p>
              <p class="card-text mb-3">広島の歴史と文化に精通したガイド。平和記念公園から宮島まで、心に残る旅をご提供します。</p>
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <span class="badge bg-light text-dark me-1">日本語</span>
                  <span class="badge bg-light text-dark me-1">英語</span>
                  <span class="badge bg-light text-dark">フランス語</span>
                </div>
                <div class="text-warning">
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star-fill"></i>
                  <i class="bi bi-star"></i>
                  <span class="text-dark ms-1">4.0</span>
                </div>
              </div>
            </div>
            <div class="card-footer bg-white border-0 pt-0">
              <a href="#" class="btn btn-outline-primary w-100 guide-details-link" data-guide-id="6">詳細を見る</a>
            </div>
          </div>
        </div>
      </div>
      
      <div class="text-center mt-4">
        <button class="btn btn-primary" id="load-more-guides">もっと見る</button>
      </div>
    </section>
    
    <!-- 使い方 -->
    <section id="how-it-works" class="mb-5">
      <h2 class="text-center mb-4">使い方</h2>
      <div class="row text-center">
        <div class="col-md-4 mb-3">
          <div class="p-3">
            <div class="bg-primary text-white rounded-circle d-inline-flex justify-content-center align-items-center mb-3" style="width: 80px; height: 80px;">
              <h3 class="m-0">1</h3>
            </div>
            <h4>アカウント登録</h4>
            <p>簡単な情報入力と電話番号認証で登録完了</p>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="p-3">
            <div class="bg-primary text-white rounded-circle d-inline-flex justify-content-center align-items-center mb-3" style="width: 80px; height: 80px;">
              <h3 class="m-0">2</h3>
            </div>
            <h4>ガイドを探す</h4>
            <p>場所、言語、専門性などで理想のガイドを検索</p>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="p-3">
            <div class="bg-primary text-white rounded-circle d-inline-flex justify-content-center align-items-center mb-3" style="width: 80px; height: 80px;">
              <h3 class="m-0">3</h3>
            </div>
            <h4>予約して楽しむ</h4>
            <p>希望の日時で予約し、特別な体験を楽しむ</p>
          </div>
        </div>
      </div>
    </section>
    
    <!-- ガイドのメリット -->
    <section id="guide-benefits" class="mb-5 py-5 bg-light">
      <div class="container">
        <h2 class="text-center mb-4">ガイドとして活躍するメリット</h2>
        <p class="text-center lead mb-5">あなたの知識と経験を活かして、世界中の旅行者に特別な体験を提供しましょう</p>
        
        <div class="row">
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>あなたの日常が観光資源になる</h5>
                  <p class="text-muted mb-0">地元の方だけが知る特別な場所や体験を共有することで、日常がかけがえのない旅の思い出に変わります。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>観光客の方を友達としてお迎えするだけです</h5>
                  <p class="text-muted mb-0">形式ばったガイドツアーではなく、友人との交流のように自然な形で地元の魅力を伝えられます。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>隙間時間を使って効率よくお仕事をする</h5>
                  <p class="text-muted mb-0">自分の都合の良い時間にスケジュールを設定できるため、本業や学業と両立しながら収入を得られます。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>自分の好きなことを仕事にできる</h5>
                  <p class="text-muted mb-0">趣味や特技、専門知識を活かしたオリジナルのガイド体験を提供することで、情熱を収入に変えられます。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>世界中の人と新しい出会いが生まれる</h5>
                  <p class="text-muted mb-0">様々な国や文化から来た旅行者との交流を通じて、国際的な人脈を広げ、異文化理解を深められます。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>語学力を活かし、さらに向上させられる</h5>
                  <p class="text-muted mb-0">外国語を使う実践的な機会が得られ、コミュニケーション能力が自然と高まります。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>地元への愛着と誇りが深まる</h5>
                  <p class="text-muted mb-0">地元の魅力を発信することで、自分自身の住む地域への理解や愛着がさらに強くなります。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>安心のサポート体制</h5>
                  <p class="text-muted mb-0">予約管理、決済、保険など、ガイド活動に必要な基盤を当サービスが提供するので安心して活動できます。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>自分のペースで活動可能</h5>
                  <p class="text-muted mb-0">予約を受ける日時や頻度は完全に自分で決められるため、ライフスタイルに合わせた働き方ができます。</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="guide-benefit-card mb-4 p-4 bg-white rounded shadow-sm">
              <div class="d-flex">
                <div class="benefit-check me-3 text-primary">
                  <i class="bi bi-check-circle-fill fs-3"></i>
                </div>
                <div>
                  <h5>地域活性化に貢献できる</h5>
                  <p class="text-muted mb-0">観光客を地元のお店や施設に案内することで、地域経済の活性化とコミュニティの発展に貢献できます。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="text-center mt-4">
          <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#registerGuideModal">ガイドとして登録する</button>
        </div>
      </div>
    </section>
  </div>

  <!-- 観光客登録モーダル -->
  <div class="modal fade" id="registerTouristModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">旅行者として登録</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="tourist-register-form">
            <!-- 基本情報セクション -->
            <div class="border-bottom pb-3 mb-3">
              <h4 class="section-title">基本情報</h4>
              <div class="mb-3">
                <label for="tourist-name" class="form-label">氏名 <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="tourist-name" required>
              </div>
              <div class="mb-3">
                <label for="tourist-email" class="form-label">メールアドレス <span class="text-danger">*</span></label>
                <input type="email" class="form-control" id="tourist-email" required>
              </div>
              <div class="mb-3">
                <label for="tourist-password" class="form-label">パスワード <span class="text-danger">*</span></label>
                <input type="password" class="form-control" id="tourist-password" required>
                <div class="form-text">8文字以上で、英数字を含めてください</div>
              </div>
            </div>
            
            <!-- 電話番号認証セクション -->
            <div class="border-bottom pb-3 mb-3">
              <h4 class="section-title">電話番号認証</h4>
              <div class="mb-3">
                <label for="tourist-phone-number" class="form-label">電話番号 <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text">+81</span>
                  <input type="tel" class="form-control" id="tourist-phone-number" placeholder="9012345678（先頭の0は除く）" required>
                  <button type="button" class="btn btn-primary" id="tourist-send-code-btn">認証コード送信</button>
                </div>
                <div class="form-text">ハイフンなしで入力してください</div>
              </div>
              
              <div class="mb-4" id="tourist-verification-code-container">
                <label for="tourist-verification-code" class="form-label">認証コード <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="tourist-verification-code" maxlength="6" placeholder="SMSに送信された6桁のコード">
              </div>
              
              <div id="tourist-recaptcha-container" class="mb-3"></div>
              <div id="tourist-phone-verified" class="alert alert-success d-none">電話番号認証が完了しました ✓</div>
            </div>
            
            <!-- 身分証明書セクション -->
            <div class="border-bottom pb-3 mb-3">
              <h4 class="section-title">身分証明書の確認</h4>
              <div class="mb-3">
                <label for="tourist-id-type" class="form-label">身分証明書の種類 <span class="text-danger">*</span></label>
                <select class="form-select" id="tourist-id-type" required>
                  <option value="" selected disabled>選択してください</option>
                  <option value="passport">パスポート</option>
                  <option value="drivers_license">運転免許証</option>
                  <option value="my_number">マイナンバーカード</option>
                </select>
              </div>
              
              <div class="mb-3">
                <label for="tourist-id-front" class="form-label">身分証明書（表面） <span class="text-danger">*</span></label>
                <div class="input-group">
                  <input type="file" class="form-control" id="tourist-id-front" accept="image/*" required>
                  <button type="button" class="btn btn-outline-secondary document-camera mobile-only" data-target="tourist-id-front">
                    <i class="bi bi-camera"></i> カメラ
                  </button>
                </div>
                <div class="form-text">JPG、PNG形式のみ、5MB以下</div>
                <div class="mt-2 document-preview-container" id="tourist-id-front-preview-container">
                  <div class="document-preview">
                    <img id="tourist-id-front-preview" class="img-fluid img-thumbnail d-none" alt="身分証明書表面のプレビュー">
                    <button type="button" class="btn btn-danger btn-sm mt-2 d-none" id="tourist-id-front-delete">
                      <i class="bi bi-trash"></i> 削除
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="mb-3 d-none" id="tourist-id-back-container">
                <label for="tourist-id-back" class="form-label">身分証明書（裏面） <span class="text-danger">*</span></label>
                <div class="input-group">
                  <input type="file" class="form-control" id="tourist-id-back" accept="image/*">
                  <button type="button" class="btn btn-outline-secondary document-camera mobile-only" data-target="tourist-id-back">
                    <i class="bi bi-camera"></i> カメラ
                  </button>
                </div>
                <div class="form-text">JPG、PNG形式のみ、5MB以下</div>
                <div class="mt-2 document-preview-container" id="tourist-id-back-preview-container">
                  <div class="document-preview">
                    <img id="tourist-id-back-preview" class="img-fluid img-thumbnail d-none" alt="身分証明書裏面のプレビュー">
                    <button type="button" class="btn btn-danger btn-sm mt-2 d-none" id="tourist-id-back-delete">
                      <i class="bi bi-trash"></i> 削除
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 利用規約 -->
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="tourist-terms" required>
                <label class="form-check-label" for="tourist-terms">
                  <a href="#" target="_blank">利用規約</a>と<a href="#" target="_blank">プライバシーポリシー</a>に同意します
                </label>
              </div>
            </div>
            
            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg">登録する</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- お問い合わせモーダル -->
  <div class="modal fade" id="contactModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">お問い合わせ</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="contact-form">
            <div class="mb-3">
              <label for="contact-name" class="form-label">お名前 <span class="text-danger">*</span></label>
              <input type="text" class="form-control" id="contact-name" required>
            </div>
            
            <div class="mb-3">
              <label for="contact-email" class="form-label">メールアドレス <span class="text-danger">*</span></label>
              <input type="email" class="form-control" id="contact-email" required>
            </div>
            
            <div class="mb-3">
              <label for="contact-subject" class="form-label">件名 <span class="text-danger">*</span></label>
              <select class="form-select" id="contact-subject" required>
                <option value="" selected disabled>選択してください</option>
                <option value="general">一般的なお問い合わせ</option>
                <option value="service">サービスについて</option>
                <option value="support">サポートが必要</option>
                <option value="feedback">フィードバック・提案</option>
                <option value="other">その他</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="contact-message" class="form-label">メッセージ <span class="text-danger">*</span></label>
              <textarea class="form-control" id="contact-message" rows="5" required></textarea>
            </div>
            
            <div class="d-grid">
              <button type="submit" class="btn btn-primary">送信する</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 観光客ログインモーダル -->
  <div class="modal fade" id="loginTouristModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">旅行者ログイン</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="tourist-login-form">
            <div class="mb-3">
              <label for="tourist-login-email" class="form-label">メールアドレス</label>
              <input type="email" class="form-control" id="tourist-login-email" required>
            </div>
            <div class="mb-3">
              <label for="tourist-login-password" class="form-label">パスワード</label>
              <input type="password" class="form-control" id="tourist-login-password" required>
            </div>
            <div class="d-grid mb-3">
              <button type="submit" class="btn btn-primary">ログイン</button>
            </div>
            <div class="text-center">
              <p class="mb-0">アカウントをお持ちでない方は <a href="#" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#registerTouristModal">こちら</a> から登録できます</p>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- 登録促進モーダル -->
  <div class="modal fade" id="registerPromptModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">会員登録が必要です</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-4">
            <i class="bi bi-lock-fill text-primary" style="font-size: 3rem;"></i>
            <h4 class="mt-3">ガイドの詳細情報を見るには会員登録が必要です</h4>
            <p class="text-muted">登録はとても簡単で、多くの特典が得られます。</p>
          </div>
          
          <div class="row mb-4">
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title"><i class="bi bi-person me-2"></i>旅行者として登録</h5>
                  <p class="card-text">現地ガイドと一緒に特別な旅行体験を探しましょう。</p>
                  <button class="btn btn-primary w-100" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#registerTouristModal">
                    旅行者登録へ進む
                  </button>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title"><i class="bi bi-map me-2"></i>ガイドとして登録</h5>
                  <p class="card-text">あなたの知識と経験を共有し、収入を得ましょう。</p>
                  <button class="btn btn-outline-primary w-100" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#registerGuideModal">
                    ガイド登録へ進む
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="text-center">
            <p>すでにアカウントをお持ちの方は<a href="#" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#loginModal">こちらからログイン</a>してください。</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ガイド登録モーダル -->
  <div class="modal fade" id="registerGuideModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">ガイドとして登録</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="guide-register-form">
            <!-- 基本情報セクション -->
            <div class="border-bottom pb-3 mb-3">
              <h4 class="section-title">基本情報</h4>
              
              <!-- プロフィール写真 -->
              <div class="mb-4 text-center">
                <label for="guide-profile-photo" class="form-label d-block">プロフィール写真 <span class="text-danger">*</span></label>
                <div class="profile-photo-container mx-auto mb-3">
                  <img id="guide-profile-preview" src="https://placehold.co/150?text=写真" class="img-thumbnail rounded-circle profile-photo" alt="プロフィール写真">
                  <div class="profile-photo-overlay">
                    <i class="bi bi-camera-fill"></i>
                  </div>
                </div>
                <div class="d-flex justify-content-center">
                  <div class="w-50">
                    <input type="file" class="form-control" id="guide-profile-photo" accept="image/*" required>
                    <button type="button" class="btn btn-outline-secondary document-camera mobile-only mt-2 w-100" data-target="guide-profile-photo">
                      <i class="bi bi-camera"></i> カメラで撮影
                    </button>
                  </div>
                </div>
                <div class="form-text">JPG、PNG形式のみ、5MB以下</div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="guide-name" class="form-label">氏名 <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="guide-name" required>
                </div>
                <div class="col-md-6">
                  <label for="guide-username" class="form-label">ユーザー名 <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="guide-username" required>
                  <div class="form-text">プロフィールURLに使用されます</div>
                </div>
              </div>
              <div class="mb-3">
                <label for="guide-email" class="form-label">メールアドレス <span class="text-danger">*</span></label>
                <input type="email" class="form-control" id="guide-email" required>
              </div>
              <div class="mb-3">
                <label for="guide-password" class="form-label">パスワード <span class="text-danger">*</span></label>
                <input type="password" class="form-control" id="guide-password" required>
                <div class="form-text">8文字以上で、英数字を含めてください</div>
              </div>
              <div class="mb-3">
                <label for="guide-location" class="form-label">活動エリア <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="guide-location" placeholder="例：東京都新宿区" required>
              </div>
              <div class="mb-3">
                <label for="guide-languages" class="form-label">対応言語 <span class="text-danger">*</span></label>
                <select class="form-select" id="guide-languages" multiple required>
                  <option value="ja">日本語</option>
                  <option value="en">英語</option>
                  <option value="zh">中国語</option>
                  <option value="ko">韓国語</option>
                  <option value="fr">フランス語</option>
                  <option value="de">ドイツ語</option>
                  <option value="es">スペイン語</option>
                </select>
                <div class="form-text">Ctrlキーを押しながら複数選択できます</div>
              </div>
            </div>
            
            <!-- 電話番号認証セクション -->
            <div class="border-bottom pb-3 mb-3">
              <h4 class="section-title">電話番号認証</h4>
              <div class="mb-3">
                <label for="guide-phone-number" class="form-label">電話番号 <span class="text-danger">*</span></label>
                <div class="input-group">
                  <span class="input-group-text">+81</span>
                  <input type="tel" class="form-control" id="guide-phone-number" placeholder="9012345678（先頭の0は除く）" required>
                  <button type="button" class="btn btn-primary" id="guide-send-code-btn">認証コード送信</button>
                </div>
                <div class="form-text">ハイフンなしで入力してください</div>
              </div>
              
              <div class="mb-4" id="guide-verification-code-container">
                <label for="guide-verification-code" class="form-label">認証コード <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="guide-verification-code" maxlength="6" placeholder="SMSに送信された6桁のコード">
              </div>
              
              <div id="guide-recaptcha-container" class="mb-3"></div>
              <div id="guide-phone-verified" class="alert alert-success d-none">電話番号認証が完了しました ✓</div>
            </div>
            
            <!-- 身分証明書セクション -->
            <div class="border-bottom pb-3 mb-3">
              <h4 class="section-title">身分証明書の確認</h4>
              <div class="mb-3">
                <label for="guide-id-type" class="form-label">身分証明書の種類 <span class="text-danger">*</span></label>
                <select class="form-select" id="guide-id-type" required>
                  <option value="" selected disabled>選択してください</option>
                  <option value="passport">パスポート</option>
                  <option value="drivers_license">運転免許証</option>
                  <option value="my_number">マイナンバーカード</option>
                </select>
              </div>
              
              <div class="mb-3">
                <label for="guide-id-front" class="form-label">身分証明書（表面） <span class="text-danger">*</span></label>
                <div class="input-group">
                  <input type="file" class="form-control" id="guide-id-front" accept="image/*" required>
                  <button type="button" class="btn btn-outline-secondary document-camera mobile-only" data-target="guide-id-front">
                    <i class="bi bi-camera"></i> カメラ
                  </button>
                </div>
                <div class="form-text">JPG、PNG形式のみ、5MB以下</div>
                <div class="mt-2 document-preview-container" id="guide-id-front-preview-container">
                  <div class="document-preview">
                    <img id="guide-id-front-preview" class="img-fluid img-thumbnail d-none" alt="身分証明書表面のプレビュー">
                    <button type="button" class="btn btn-danger btn-sm mt-2 d-none" id="guide-id-front-delete">
                      <i class="bi bi-trash"></i> 削除
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="mb-3 d-none" id="guide-id-back-container">
                <label for="guide-id-back" class="form-label">身分証明書（裏面） <span class="text-danger">*</span></label>
                <div class="input-group">
                  <input type="file" class="form-control" id="guide-id-back" accept="image/*">
                  <button type="button" class="btn btn-outline-secondary document-camera mobile-only" data-target="guide-id-back">
                    <i class="bi bi-camera"></i> カメラ
                  </button>
                </div>
                <div class="form-text">JPG、PNG形式のみ、5MB以下</div>
                <div class="mt-2 document-preview-container" id="guide-id-back-preview-container">
                  <div class="document-preview">
                    <img id="guide-id-back-preview" class="img-fluid img-thumbnail d-none" alt="身分証明書裏面のプレビュー">
                    <button type="button" class="btn btn-danger btn-sm mt-2 d-none" id="guide-id-back-delete">
                      <i class="bi bi-trash"></i> 削除
                    </button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- 利用規約 -->
            <div class="mb-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="guide-terms" required>
                <label class="form-check-label" for="guide-terms">
                  <a href="#" target="_blank">利用規約</a>、<a href="#" target="_blank">プライバシーポリシー</a>、および<a href="#" target="_blank">ガイドラインポリシー</a>に同意します
                </label>
              </div>
            </div>
            
            <div class="d-grid">
              <button type="submit" class="btn btn-primary btn-lg">登録する</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- ログインモーダル -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">ログイン</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="login-form">
            <div class="mb-3">
              <label class="form-label">ユーザータイプ</label>
              <div class="user-type-selector">
                <div class="btn-group w-100" role="group" aria-label="ユーザータイプ選択">
                  <input type="radio" class="btn-check" name="login-user-type" id="login-user-tourist" value="tourist" autocomplete="off" checked>
                  <label class="btn btn-outline-primary" for="login-user-tourist">
                    <i class="bi bi-person me-1"></i> 観光客
                  </label>
                  
                  <input type="radio" class="btn-check" name="login-user-type" id="login-user-guide" value="guide" autocomplete="off">
                  <label class="btn btn-outline-primary" for="login-user-guide">
                    <i class="bi bi-map me-1"></i> ガイド
                  </label>
                </div>
              </div>
              <div class="user-type-helper text-center mt-1 mb-3">
                <small id="user-type-description" class="text-muted">
                  観光客としてログインすると、ガイドを探したり予約できます
                </small>
              </div>
            </div>
            <div class="mb-3">
              <label for="login-email" class="form-label">メールアドレス</label>
              <div class="input-group">
                <span class="input-group-text bg-white border-end-0">
                  <i class="bi bi-envelope text-muted"></i>
                </span>
                <input type="email" class="form-control border-start-0" id="login-email" placeholder="example@email.com" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="login-password" class="form-label">パスワード</label>
              <input type="password" class="form-control" id="login-password" placeholder="パスワードを入力" required>
              <div class="mt-2">
                <a href="#" class="password-reset-link">
                  <i class="bi bi-question-circle me-1"></i>パスワードをお忘れですか？
                </a>
              </div>
            </div>
            <div class="mb-3 form-check">
              <input type="checkbox" class="form-check-input" id="login-remember">
              <label class="form-check-label" for="login-remember">ログイン情報を保存する</label>
            </div>
            <div class="d-grid">
              <button type="submit" class="btn btn-primary login-button" id="main-login-btn">
                <i class="bi bi-box-arrow-in-right me-2"></i>ログイン
              </button>
            </div>
          </form>
          <hr>
          <div class="text-center">
            <div class="bg-light rounded p-3 mb-3">
              <h6 class="text-primary mb-2">デモアカウント（テスト用）</h6>
              <div class="small text-start">
                <div><strong>メール:</strong> test@example.com</div>
                <div><strong>パスワード:</strong> password</div>
                <hr class="my-2">
                <div><strong>メール:</strong> tourist@test.com</div>
                <div><strong>パスワード:</strong> test123</div>
              </div>
            </div>
            <p class="mb-2">アカウントをお持ちでない方</p>
            <button class="btn btn-outline-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#registerTouristModal">
              <i class="bi bi-person-plus me-1"></i>新規登録
            </button>
          </div>
          
          <!-- ソーシャルログイン（将来的な機能） -->
          <div class="social-login d-none">
            <div class="social-login-title">または</div>
            <div class="social-login-buttons">
              <button class="social-btn" title="Googleでログイン">
                <i class="bi bi-google"></i>
              </button>
              <button class="social-btn" title="Facebookでログイン">
                <i class="bi bi-facebook"></i>
              </button>
              <button class="social-btn" title="Twitterでログイン">
                <i class="bi bi-twitter"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 確実なナビゲーション機能 -->
  <script>
    // ページの目立つ場所にステータスを表示
    function showStatus(message) {
      const status = document.createElement('div');
      status.style.cssText = 'position:fixed;top:10px;right:10px;background:green;color:white;padding:10px;z-index:9999;border-radius:5px;';
      status.textContent = message;
      document.body.appendChild(status);
      setTimeout(() => status.remove(), 3000);
    }
    
    console.log('スクリプト開始');
    
    // 初期状態を日本語に強制設定
    function forceJapaneseInitialState() {
      // ローカルストレージの言語設定をクリア
      localStorage.removeItem('selectedLanguage');
      localStorage.removeItem('localGuideLanguage');

      
      // 言語ボタンシステムに置換済み - ドロップダウン削除
      
      console.log('初期状態を日本語に強制設定しました');
    }
    
    // DOMContentLoadedではなく、即座に実行
    function initializeButtons() {
      console.log('ボタン初期化開始');
      showStatus('ボタン初期化中...');
      // ホームボタン
      const homeBtn = document.getElementById('btn-home');
      if (homeBtn) {
        homeBtn.addEventListener('click', function(e) {
          e.preventDefault();
          document.getElementById('top').scrollIntoView({ behavior: 'smooth' });
        });
      }
      
      // ガイドボタン
      const guidesBtn = document.getElementById('btn-guides');
      if (guidesBtn) {
        guidesBtn.addEventListener('click', function(e) {
          e.preventDefault();
          document.getElementById('guides').scrollIntoView({ behavior: 'smooth' });
        });
      }
      
      // 使い方ボタン
      const howBtn = document.getElementById('btn-how-it-works');
      if (howBtn) {
        howBtn.addEventListener('click', function(e) {
          e.preventDefault();
          document.getElementById('how-it-works').scrollIntoView({ behavior: 'smooth' });
        });
      }
      
      // 協賛店登録ボタン
      const sponsorRegisterBtn = document.getElementById('sponsorRegisterBtn');
      if (sponsorRegisterBtn) {
        sponsorRegisterBtn.addEventListener('click', function(e) {
          e.preventDefault();
          window.location.href = 'sponsor-registration.html';
        });
      }
      
      // 言語切り替えボタン - 外部スクリプトに委託
      
      // 新規登録ドロップダウンボタン
      const registerDropdownBtn = document.getElementById('registerDropdown');
      if (registerDropdownBtn) {
        console.log('新規登録ドロップダウンボタンにイベントリスナーを設定');
        // Bootstrap のドロップダウン機能が正常に動作するようにdata-bs-toggle属性を確認
        if (!registerDropdownBtn.hasAttribute('data-bs-toggle')) {
          registerDropdownBtn.setAttribute('data-bs-toggle', 'dropdown');
        }
      }
      
      // 協賛店ログインボタン
      const sponsorLoginBtn = document.getElementById('sponsorLoginBtn');
      if (sponsorLoginBtn) {
        sponsorLoginBtn.addEventListener('click', function(e) {
          e.preventDefault();
          window.location.href = 'sponsor-login.html';
        });
      }
      
      // 言語ボタン - 外部スクリプトで処理
      
      console.log('全てのボタン機能が設定されました');
      showStatus('全ボタン設定完了！');
    }
    
    // 複数の方法で初期化を試行
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        forceJapaneseInitialState(); // 日本語強制設定
        initializeButtons();
        forceJapaneseButtonText(); // ガイドカードボタンを強制的に日本語化
      });
    } else {
      forceJapaneseInitialState();
      initializeButtons();
      forceJapaneseButtonText();
    }
    
    // さらに安全のため、少し遅延して再実行
    setTimeout(function() {
      forceJapaneseInitialState();
      initializeButtons();
      forceJapaneseButtonText();
      forceReplaceSeeDetails(); // See Detailsを強制置換
    }, 1000);
    
    // 2秒後にも実行
    setTimeout(function() {
      forceReplaceSeeDetails();
    }, 2000);
    
    // 「See Details」を強制的に「詳細を見る」に置換する関数
    function forceReplaceSeeDetails() {
      console.log('=== See Detailsボタンの強制置換を開始 ===');
      console.log('現在の言語設定:', localStorage.getItem('language'));
      
      let replacedCount = 0;
      
      // 全体をスキャンしてSee Detailsを探す
      document.querySelectorAll('*').forEach(element => {
        if (element.textContent && element.textContent.includes('See Details')) {
          console.log('See Details発見:', element.tagName, element.className, element.textContent);
          
          if (element.tagName === 'BUTTON' || element.tagName === 'A' || element.classList.contains('btn')) {
            // アイコンを保持しつつテキストを置換
            if (element.innerHTML.includes('<i class="bi bi-eye')) {
              element.innerHTML = '<i class="bi bi-eye me-1"></i>詳細を見る';
            } else {
              element.textContent = '詳細を見る';
            }
            element.setAttribute('data-force-japanese', 'true');
            replacedCount++;
            console.log('置換完了:', element);
          }
        }
      });
      
      console.log(`=== 置換完了: ${replacedCount}個のボタンを修正 ===`);
      return replacedCount;
    }
    
    // 強力なMutationObserverで動的なDOMの変更を監視
    const observer = new MutationObserver(function(mutations) {
      let shouldReplace = false;
      
      mutations.forEach(function(mutation) {
        // 新しいノードが追加された場合
        if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
          mutation.addedNodes.forEach(function(node) {
            if (node.nodeType === Node.ELEMENT_NODE) {
              // See Detailsを含むノードを即座に修正
              if (node.textContent && node.textContent.includes('See Details')) {
                console.log('新規追加ノードでSee Details検出:', node);
                shouldReplace = true;
              }
              
              // 子要素もチェック
              const seeDetailsElements = node.querySelectorAll && node.querySelectorAll('*');
              if (seeDetailsElements) {
                seeDetailsElements.forEach(child => {
                  if (child.textContent && child.textContent.includes('See Details')) {
                    console.log('子要素でSee Details検出:', child);
                    shouldReplace = true;
                  }
                });
              }
            }
          });
        }
        
        // テキストやHTML内容が変更された場合
        if (mutation.type === 'characterData') {
          if (mutation.target.textContent && mutation.target.textContent.includes('See Details')) {
            console.log('テキスト変更でSee Details検出:', mutation.target);
            shouldReplace = true;
          }
        }
        
        // 属性が変更された場合
        if (mutation.type === 'attributes') {
          const target = mutation.target;
          if (target.textContent && target.textContent.includes('See Details')) {
            console.log('属性変更でSee Details検出:', target);
            shouldReplace = true;
          }
        }
      });
      
      if (shouldReplace) {
        console.log('MutationObserverが変更を検出 - 強制置換実行');
        setTimeout(forceReplaceSeeDetails, 50);
      }
    });
    
    // DOM全体を包括的に監視
    observer.observe(document.body, {
      childList: true,
      subtree: true,
      characterData: true,
      attributes: true,
      attributeOldValue: true,
      characterDataOldValue: true
    });
    
    // 継続的な監視（1秒ごと）- より頻繁にチェック
    setInterval(function() {
      let replaced = 0;
      document.querySelectorAll('button, a, .btn').forEach(el => {
        if (el.textContent && el.textContent.includes('See Details')) {
          if (el.innerHTML.includes('<i class="bi bi-eye')) {
            el.innerHTML = '<i class="bi bi-eye me-1"></i>詳細を見る';
          } else {
            el.textContent = '詳細を見る';
          }
          el.setAttribute('data-forced-japanese', 'true');
          replaced++;
        }
      });
      if (replaced > 0) {
        console.log(`定期チェック: ${replaced}個のSee Detailsボタンを詳細を見るに修正`);
      }
    }, 1000);
    
    // より強力な保護 - DOM変更を即座にキャッチ
    const aggressiveObserver = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.type === 'characterData' || mutation.type === 'childList') {
          const target = mutation.target;
          if (target.textContent && target.textContent.includes('See Details')) {
            if (target.tagName === 'BUTTON' || target.tagName === 'A' || target.classList.contains('btn')) {
              target.textContent = '詳細を見る';
              console.log('即座に修正:', target);
            }
          }
        }
      });
    });
    
    aggressiveObserver.observe(document.body, {
      childList: true,
      subtree: true,
      characterData: true
    });
    
    // ガイドカードボタンを強制的に日本語化する関数
    function forceJapaneseButtonText() {
      console.log('ガイドカードボタンを強制的に日本語化開始');
      
      // 複数のセレクターでボタンを取得
      const buttonSelectors = [
        '.guide-details-link',
        '.btn[onclick*="showGuideDetails"]', 
        '.card-footer .btn',
        '.guide-card .btn-primary',
        'a[data-guide-id]',
        '.btn'
      ];
      
      buttonSelectors.forEach(selector => {
        const buttons = document.querySelectorAll(selector);
        buttons.forEach(btn => {
          if (btn.textContent.includes('See Details') || btn.textContent.includes('Details')) {
            btn.textContent = '詳細を見る';
            console.log(`ボタンを日本語化: ${btn.textContent}`);
          }
        });
      });
      
      // より包括的な検索
      document.querySelectorAll('*').forEach(element => {
        if (element.textContent === 'See Details' && (element.tagName === 'A' || element.tagName === 'BUTTON')) {
          element.textContent = '詳細を見る';
          console.log('See Detailsボタンを詳細を見るに変更');
        }
        
        // 「もっと見る」ボタンも確認
        if (element.textContent === 'Show More' && (element.tagName === 'A' || element.tagName === 'BUTTON')) {
          element.textContent = 'もっと見る';
          console.log('Show Moreボタンをもっと見るに変更');
        }
      });
      
      // 「もっと見る」ボタンも個別にチェック
      const moreButton = document.querySelector('#load-more-guides');
      if (moreButton && (moreButton.textContent.includes('Show More') || moreButton.textContent.includes('Load More'))) {
        moreButton.textContent = 'もっと見る';
        console.log('もっと見るボタンを強制的に日本語化');
      }
    }
  </script>
  
  <!-- Bootstrap JavaScript - 最後に読み込み -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- 追加のBootstrap初期化 -->
  <script>
    // Bootstrap要素を手動で初期化
    setTimeout(function() {
      // ドロップダウンを手動初期化
      const dropdowns = document.querySelectorAll('[data-bs-toggle="dropdown"]');
      dropdowns.forEach(function(dropdown) {
        dropdown.addEventListener('click', function(e) {
          e.preventDefault();
          const menu = this.nextElementSibling;
          if (menu && menu.classList.contains('dropdown-menu')) {
            menu.classList.toggle('show');
          }
        });
      });
      
      // 協賛店ログインボタンを強制設定
      const sponsorLoginBtn = document.getElementById('sponsorLoginBtn');
      if (sponsorLoginBtn) {
        sponsorLoginBtn.onclick = function() {
          window.location.href = 'sponsor-login.html';
        };
      }
      
      showStatus('手動初期化完了');
    }, 2000);
    
    // 旧言語切り替え機能（無効化）
    function switchToJapanese_DISABLED() {
      console.log('旧 switchToJapanese 関数は無効化されました');
      
      // メインコンテンツ
      const mainTitle = document.querySelector('h1');
      if (mainTitle) mainTitle.textContent = 'あなただけの特別な旅を';
      
      const subtitle = document.querySelector('.hero-section p');
      if (subtitle) subtitle.textContent = '地元ガイドと一緒に、観光では見つけられない隠れた魅力を体験しましょう';
      
      // ヒーローセクションのボタン
      const heroGuideBtn = document.querySelector('.btn-light.btn-lg');
      if (heroGuideBtn) heroGuideBtn.textContent = 'ガイドを探す';
      
      const heroContactBtn = document.querySelector('.btn-outline-light.btn-lg');
      if (heroContactBtn) heroContactBtn.textContent = 'お問い合わせ';
      
      // 右下のボタン
      const sponsorRegBtn = document.querySelector('#sponsorRegisterBtn span');
      if (sponsorRegBtn) sponsorRegBtn.textContent = '協賛店登録 🚀';
      
      const sponsorLoginBtn = document.querySelector('#sponsorLoginBtn span');
      if (sponsorLoginBtn) sponsorLoginBtn.textContent = 'ログイン ✨';
      
      // 使い方セクション
      const howItWorksH4s = document.querySelectorAll('#how-it-works h4');
      if (howItWorksH4s.length >= 3) {
        howItWorksH4s[0].textContent = '登録する';
        howItWorksH4s[1].textContent = 'ガイドを探す';
        howItWorksH4s[2].textContent = '特別な旅を体験';
      }
      
      // 人気のガイドセクション
      const popularGuidesTitle = document.querySelector('#guides h2');
      if (popularGuidesTitle) popularGuidesTitle.textContent = '人気のガイド';
      
      // ガイド一覧の要素（正しいセレクター）
      const filterButton = document.querySelector('#toggle-filter-button');
      if (filterButton) filterButton.innerHTML = '<i class="bi bi-funnel"></i> ガイドを絞り込み';
      
      const moreButton = document.querySelector('#load-more-guides');
      if (moreButton) moreButton.textContent = 'もっと見る';
      
      // 旧検索結果カウンター機能（無効化）
      console.log('旧カウンター更新機能は無効化されました');
      
      // 「フィルターの使い方」ボタン
      const filterTutorialBtn = document.querySelector('#filter-tutorial-btn');
      if (filterTutorialBtn) filterTutorialBtn.innerHTML = '<i class="bi bi-question-circle me-1"></i>フィルターの使い方';
      
      // ガイドカードの詳細ボタンを日本語に（複数回試行）
      const guideDetailsButtons = document.querySelectorAll('.guide-details-link');
      guideDetailsButtons.forEach(btn => {
        btn.textContent = '詳細を見る';
      });
      
      // より広範囲なボタン翻訳（See Detailsを含むすべてのボタン）
      document.querySelectorAll('a, button').forEach(element => {
        if (element.textContent.trim() === 'See Details') {
          element.textContent = '詳細を見る';
        }
      });
      
      // 遅延実行でボタンを再度チェック
      setTimeout(() => {
        document.querySelectorAll('.guide-details-link, .btn').forEach(btn => {
          if (btn.textContent.includes('See Details')) {
            btn.textContent = '詳細を見る';
          }
        });
      }, 500);
      
      // スクロール修復実行
      if (window.nuclearScrollFix) {
        setTimeout(() => {
          window.nuclearScrollFix();
          console.log('日本語切り替え後のスクロール修復実行');
        }, 100);
      }
      
      // 更に確実にするため、1秒後にも再実行
      setTimeout(() => {
        document.querySelectorAll('a[data-guide-id], .guide-details-link').forEach(link => {
          if (link.textContent.trim() === 'See Details') {
            link.textContent = '詳細を見る';
          }
        });
        
        // 動的生成されたガイドカードの翻訳も再実行
        const dynamicGuideCards = document.querySelectorAll('.guide-card');
        dynamicGuideCards.forEach((card, index) => {
          const description = card.querySelector('.card-text.mb-3');
          if (description && description.textContent.includes('guide you to') || description.textContent.includes('Specializing')) {
            const japaneseDescriptions = [
              '東京の隠れた名所を案内します。グルメや写真スポットが得意です。',
              '歴史と伝統が息づく京都の魅力をご案内。寺社巡りや伝統文化体験が得意です。',
              '大阪ならではの食べ歩きと街歩きが専門。地元の人だけが知る名店にご案内します。'
            ];
            if (japaneseDescriptions[index]) {
              description.textContent = japaneseDescriptions[index];
            }
          }
        });
        
        // メリットセクションの説明文も再翻訳（英語が残っている場合）
        const delayedBenefitDescriptions = document.querySelectorAll('#guide-benefits .text-muted, #guide-benefits .guide-benefit-card p');
        delayedBenefitDescriptions.forEach((desc, index) => {
          if (desc.textContent.includes('When and how often') || desc.textContent.includes('By introducing')) {
            const japaneseTexts = [
              '地元の方だけが知る特別な場所や体験を共有することで、日常がかけがえのない旅の思い出に変わります。',
              '形式ばったガイドツアーではなく、友人との交流のように自然な形で地元の魅力を伝えられます。',
              '自分の都合の良い時間にスケジュールを設定できるため、本業や学業と両立しながら収入を得られます。',
              '趣味や特技、専門知識を活かした独自のガイド体験を提供することで、やりがいを持って取り組めます。',
              '地元の魅力を発信することで、改めて故郷への愛着が深まり、誇りを持って紹介できるようになります。',
              '予約管理や決済、保険など、ガイド活動に必要なサポートを提供するため、安心して活動に集中できます。',
              '予約を受け入れるかどうかは完全に自分次第。ライフスタイルに合わせた活動が可能です。',
              '観光客を地元の店舗や施設に案内することで、地域経済の活性化と地域コミュニティの発展に貢献できます。'
            ];
            if (japaneseTexts[index]) {
              desc.textContent = japaneseTexts[index];
            }
          }
        });
        
        // メリットカードのタイトルを強制的にすべて日本語に統一（10個すべて対応）
        function translateBenefitTitlesToJapanese() {
          const selectors = [
            '#guide-benefits h5',
            '#guide-benefits .guide-benefit-card h5',
            '.guide-benefit-card h5',
            'section[id="guide-benefits"] h5',
            '.container .guide-benefit-card h5'
          ];
          
          const japaneseTitles = [
            'あなたの日常が観光資源になる',
            '観光客の方を友達としてお迎えするだけです',
            '隙間時間を使って効率よくお仕事をする',
            '自分の好きなことを仕事にできる',
            '世界中の人と新しい出会いが生まれる',
            '語学力を活かし、さらに向上させられる',
            '地元への愛着と誇りが深まる',
            '安心のサポート体制',
            '自分のペースで活動可能',
            '地域活性化に貢献できる'
          ];
          
          selectors.forEach(selector => {
            const titles = document.querySelectorAll(selector);
            console.log(`日本語翻訳 セレクター ${selector}: ${titles.length}個のタイトル見つかりました`);
            titles.forEach((title, index) => {
              if (japaneseTitles[index]) {
                const oldText = title.textContent;
                title.textContent = japaneseTitles[index];
                console.log(`日本語翻訳 ${index}: ${oldText} → ${japaneseTitles[index]}`);
              }
            });
          });
        }
        
        // 段階的実行で確実に翻訳
        translateBenefitTitlesToJapanese();
        setTimeout(translateBenefitTitlesToJapanese, 300);
        setTimeout(translateBenefitTitlesToJapanese, 800);
        setTimeout(translateBenefitTitlesToJapanese, 1500);
        setTimeout(translateBenefitTitlesToJapanese, 3000);
        
        // ガイドカード翻訳（すべてのカードを日本語に戻す・強化版）
        function translateAllGuideCardsToJapanese() {
          // より包括的なセレクターで隠しガイドを含む全てのカードをキャッチ
          const guideCardSelectors = [
            '.guide-card', 
            '.guide-item', 
            '.guide-item.hidden-guide',
            '.hidden-guide',
            '[data-guide-id]',
            '.col-md-4 .card',
            '.col-lg-4 .card',
            '#guide-cards-container .guide-item',
            '.guides-container .guide-item'
          ];
          
          let allGuideCards = [];
          guideCardSelectors.forEach(selector => {
            const cards = document.querySelectorAll(selector);
            cards.forEach(card => {
              if (!allGuideCards.includes(card)) {
                allGuideCards.push(card);
              }
            });
          });
          
          console.log(`日本語翻訳: ${allGuideCards.length}個のガイドカードを翻訳中`);
          
          allGuideCards.forEach((card, index) => {
            console.log(`ガイドカード ${index + 1} を日本語翻訳中...`);
            
            // 詳細を見るボタン（複数のセレクターで確実にキャッチ）
            const detailSelectors = [
              '.btn', 
              'a[href*="guide"]', 
              '.guide-details-link',
              'button[onclick*="showGuideDetails"]',
              '.card-footer a',
              '.btn-primary'
            ];
            
            detailSelectors.forEach(selector => {
              const detailBtn = card.querySelector(selector);
              if (detailBtn && (detailBtn.textContent.includes('See Details') || detailBtn.textContent.includes('詳細'))) {
                detailBtn.textContent = '詳細を見る';
                console.log(`詳細ボタン翻訳: 詳細を見る`);
              }
            });
            
            // 言語バッジ（包括的な翻訳）
            const langBadgeSelectors = [
              '.badge', 
              '.language-badge', 
              '.text-primary',
              '.badge.bg-light',
              '.badge.bg-primary',
              'span[class*="badge"]'
            ];
            
            langBadgeSelectors.forEach(selector => {
              const langBadges = card.querySelectorAll(selector);
              langBadges.forEach(badge => {
                const originalText = badge.textContent.trim();
                if (originalText === 'Japanese' || originalText === '日本語') {
                  badge.textContent = '日本語';
                  console.log(`言語バッジ翻訳: ${originalText} → 日本語`);
                } else if (originalText === 'English' || originalText === '英語') {
                  badge.textContent = '英語';
                  console.log(`言語バッジ翻訳: ${originalText} → 英語`);
                } else if (originalText === 'French' || originalText === 'フランス語') {
                  badge.textContent = 'フランス語';
                  console.log(`言語バッジ翻訳: ${originalText} → フランス語`);
                } else if (originalText === 'Chinese' || originalText === '中国語') {
                  badge.textContent = '中国語';
                  console.log(`言語バッジ翻訳: ${originalText} → 中国語`);
                } else if (originalText === 'Korean' || originalText === '韓国語') {
                  badge.textContent = '韓国語';
                  console.log(`言語バッジ翻訳: ${originalText} → 韓国語`);
                }
              });
            });
            
            // 場所の翻訳（英語から日本語に戻す）
            const locationSelectors = [
              '.guide-location', 
              '.text-muted',
              '.location',
              '.area',
              'small.text-muted',
              '.card-subtitle',
              'p.text-muted',
              '.card-text.text-muted'
            ];
            
            locationSelectors.forEach(selector => {
              const location = card.querySelector(selector);
              if (location) {
                const originalText = location.textContent;
                let text = originalText;
                
                // 英語から日本語への翻訳
                text = text.replace('Hokkaido', '北海道').replace('Sapporo City', '札幌市');
                text = text.replace('Tokyo', '東京都').replace('Shibuya', '渋谷区');
                text = text.replace('Okinawa', '沖縄県').replace('Naha City', '那覇市');
                text = text.replace('Hiroshima City', '広島市').replace('Hiroshima', '広島県');
                text = text.replace('Kyoto City', '京都市').replace('Kyoto', '京都府');
                text = text.replace('Osaka City', '大阪市').replace('Osaka', '大阪府');
                
                if (originalText !== text) {
                  location.textContent = text;
                  console.log(`場所翻訳: ${originalText} → ${text}`);
                }
              }
            });
          });
          
          console.log(`ガイドカード日本語翻訳完了: 合計 ${allGuideCards.length}件`);
        }
        
        // 即座に翻訳
        translateAllGuideCardsToJapanese();
        
        // 遅延実行で動的に追加されたカードも翻訳
        setTimeout(translateAllGuideCardsToJapanese, 500);
        setTimeout(translateAllGuideCardsToJapanese, 1500);
        setTimeout(translateAllGuideCardsToJapanese, 3000);
        
        // 「もっとみる」ボタンのクリック監視と翻訳適用（日本語版）
        const loadMoreBtn = document.getElementById('load-more-guides');
        if (loadMoreBtn) {
          loadMoreBtn.addEventListener('click', function() {
            // ボタンクリック後に新しく表示されるガイドカードに翻訳を適用
            setTimeout(() => {
              console.log('「もっとみる」ボタンクリック後の日本語翻訳適用');
              translateAllGuideCardsToJapanese();
            }, 100);
            
            setTimeout(translateAllGuideCardsToJapanese, 500);
            setTimeout(translateAllGuideCardsToJapanese, 1000);
          });
        }
        
        // MutationObserverでDOMの変更を監視（日本語版）
        const observer = new MutationObserver(function(mutations) {
          let shouldTranslate = false;
          mutations.forEach(function(mutation) {
            if (mutation.type === 'childList') {
              mutation.addedNodes.forEach(function(node) {
                if (node.nodeType === 1 && 
                    (node.classList.contains('guide-card') || 
                     node.classList.contains('guide-item') || 
                     node.classList.contains('hidden-guide') ||
                     node.querySelector('.guide-card'))) {
                  shouldTranslate = true;
                }
              });
            }
            
            // クラス変更も監視（hidden-guideクラスの削除など）
            if (mutation.type === 'attributes' && 
                mutation.attributeName === 'class' &&
                mutation.target.classList.contains('guide-item')) {
              shouldTranslate = true;
            }
          });
          
          if (shouldTranslate) {
            console.log('新しいガイドカードが追加されました - 日本語翻訳適用');
            setTimeout(translateAllGuideCardsToJapanese, 50);
            setTimeout(translateAllGuideCardsToJapanese, 200);
          }
        });
        
        // ガイドカードコンテナを監視（属性変更も含む）
        const guideContainer = document.getElementById('guide-cards-container');
        if (guideContainer) {
          observer.observe(guideContainer, { 
            childList: true, 
            subtree: true, 
            attributes: true, 
            attributeFilter: ['class'] 
          });
        }
        
        // 都道府県名を日本語に復元
        const locationElements = document.querySelectorAll('.guide-card .text-muted, .guide-location');
        locationElements.forEach(element => {
          const text = element.textContent;
          if (text.includes('Tokyo')) {
            element.textContent = text.replace('Tokyo', '東京都');
          } else if (text.includes('Kyoto City')) {
            element.textContent = text.replace('Kyoto City', '京都市');
          } else if (text.includes('Kyoto') && !text.includes('Kyoto City')) {
            element.textContent = text.replace('Kyoto', '京都府');
          } else if (text.includes('Osaka City')) {
            element.textContent = text.replace('Osaka City', '大阪市');
          } else if (text.includes('Osaka') && !text.includes('Osaka City')) {
            element.textContent = text.replace('Osaka', '大阪府');
          } else if (text.includes('Shibuya')) {
            element.textContent = text.replace('Shibuya', '渋谷区');
          }
        });
      }, 1000);
      
      // 使い方セクションのタイトルと説明文
      const howItWorksTitle = document.querySelector('#how-it-works h2');
      if (howItWorksTitle) howItWorksTitle.textContent = '使い方';
      
      const howItWorksPs = document.querySelectorAll('#how-it-works p');
      if (howItWorksPs.length >= 3) {
        howItWorksPs[0].textContent = '簡単な情報入力と電話番号認証で登録完了';
        howItWorksPs[1].textContent = '場所、言語、専門性などで理想のガイドを検索';
        howItWorksPs[2].textContent = '希望の日時で予約し、特別な体験を楽しむ';
      }
      
      // ガイドとして活躍するメリット（正しいセレクター）
      const benefitsTitle = document.querySelector('#guide-benefits h2');
      if (benefitsTitle) benefitsTitle.textContent = 'ガイドとして活躍するメリット';
      
      const benefitsSubtitle = document.querySelector('#guide-benefits .lead');
      if (benefitsSubtitle) benefitsSubtitle.textContent = 'あなたの知識と経験を活かして、世界中の旅行者に特別な体験を提供しましょう';
      
      // メリット項目のタイトル（正しいセレクター）
      const benefitTitles = document.querySelectorAll('#guide-benefits h5');
      if (benefitTitles.length >= 8) {
        benefitTitles[0].textContent = 'あなたの日常が観光資源になる';
        benefitTitles[1].textContent = '観光客の方を友達としてお迎えするだけです';
        benefitTitles[2].textContent = '隙間時間を使って効率よくお仕事をする';
        benefitTitles[3].textContent = '自分の好きなことを仕事にできる';
        benefitTitles[4].textContent = '地元への愛着と誇りが深まる';
        benefitTitles[5].textContent = '安心のサポート体制';
        benefitTitles[6].textContent = '自分のペースで活動可能';
        benefitTitles[7].textContent = '地域活性化に貢献できる';
      }
      
      // メリット項目の説明文（複数のセレクターで確実に翻訳）
      const benefitDescs = document.querySelectorAll('#guide-benefits .text-muted');
      if (benefitDescs.length >= 8) {
        benefitDescs[0].textContent = '地元の方だけが知る特別な場所や体験を共有することで、日常がかけがえのない旅の思い出に変わります。';
        benefitDescs[1].textContent = '形式ばったガイドツアーではなく、友人との交流のように自然な形で地元の魅力を伝えられます。';
        benefitDescs[2].textContent = '自分の都合の良い時間にスケジュールを設定できるため、本業や学業と両立しながら収入を得られます。';
        benefitDescs[3].textContent = '趣味や特技、専門知識を活かした独自のガイド体験を提供することで、やりがいを持って取り組めます。';
        benefitDescs[4].textContent = '地元の魅力を発信することで、改めて故郷への愛着が深まり、誇りを持って紹介できるようになります。';
        benefitDescs[5].textContent = '予約管理や決済、保険など、ガイド活動に必要なサポートを提供するため、安心して活動に集中できます。';
        benefitDescs[6].textContent = '予約を受け入れるかどうかは完全に自分次第。ライフスタイルに合わせた活動が可能です。';
        benefitDescs[7].textContent = '観光客を地元の店舗や施設に案内することで、地域経済の活性化と地域コミュニティの発展に貢献できます。';
      }
      
      // より具体的なセレクターでメリット説明文を確実に翻訳
      const benefitCardDescriptions = document.querySelectorAll('#guide-benefits .guide-benefit-card p.text-muted');
      benefitCardDescriptions.forEach((desc, index) => {
        const japaneseTexts = [
          '地元の方だけが知る特別な場所や体験を共有することで、日常がかけがえのない旅の思い出に変わります。',
          '形式ばったガイドツアーではなく、友人との交流のように自然な形で地元の魅力を伝えられます。',
          '自分の都合の良い時間にスケジュールを設定できるため、本業や学業と両立しながら収入を得られます。',
          '趣味や特技、専門知識を活かした独自のガイド体験を提供することで、やりがいを持って取り組めます。',
          '地元の魅力を発信することで、改めて故郷への愛着が深まり、誇りを持って紹介できるようになります。',
          '予約管理や決済、保険など、ガイド活動に必要なサポートを提供するため、安心して活動に集中できます。',
          '予約を受け入れるかどうかは完全に自分次第。ライフスタイルに合わせた活動が可能です。',
          '観光客を地元の店舗や施設に案内することで、地域経済の活性化と地域コミュニティの発展に貢献できます。'
        ];
        if (japaneseTexts[index]) {
          desc.textContent = japaneseTexts[index];
        }
      });
      
      // ガイドカードの紹介文を日本語に戻す
      const guideCards = document.querySelectorAll('.guide-card');
      guideCards.forEach((card, index) => {
        const description = card.querySelector('.card-text.mb-3');
        if (description) {
          const japaneseDescriptions = [
            '東京の隠れた名所を案内します。グルメや写真スポットが得意です。',
            '歴史と伝統が息づく京都の魅力をご案内。寺社巡りや伝統文化体験が得意です。',
            '大阪ならではの食べ歩きと街歩きが専門。地元の人だけが知る名店にご案内します。'
          ];
          if (japaneseDescriptions[index]) {
            description.textContent = japaneseDescriptions[index];
          }
        }
        
        // 言語バッジも日本語に
        const languageBadges = card.querySelectorAll('.badge.bg-light');
        languageBadges.forEach(badge => {
          if (badge.textContent.includes('English') || badge.textContent.includes('Basic English')) {
            badge.textContent = badge.textContent.includes('Basic') ? '英語(基礎)' : '英語';
          } else if (badge.textContent.includes('Japanese')) {
            badge.textContent = '日本語';
          } else if (badge.textContent.includes('Chinese')) {
            badge.textContent = '中国語';
          }
        });
      });
      
      // ガイド登録ボタン（複数のセレクターで確実に対応）
      const guideRegisterSelectors = [
        '.btn-register-guide',
        'a[href="#register-guide"]',
        'button[onclick*="register"]',
        'a.btn.btn-primary[href*="register"]',
        '.btn.btn-primary',
        'a.btn-primary'
      ];
      
      guideRegisterSelectors.forEach(selector => {
        const btn = document.querySelector(selector);
        if (btn && (btn.textContent.includes('Register') || btn.textContent.includes('登録'))) {
          btn.textContent = 'ガイドとして登録する';
        }
      });
      
      // より具体的にガイド登録ボタンを探す
      const allButtons = document.querySelectorAll('a.btn, button.btn');
      allButtons.forEach(btn => {
        if (btn.textContent.includes('Register as Guide') || btn.textContent.includes('ガイドとして登録')) {
          btn.textContent = 'ガイドとして登録する';
        }
      });
      
      showStatus('日本語に切り替えました');
    }
    




      
      const howItWorksPs = document.querySelectorAll('#how-it-works p');
      if (howItWorksPs.length >= 3) {
        howItWorksPs[0].textContent = 'Complete registration with simple info and phone verification';
        howItWorksPs[1].textContent = 'Search for ideal guides by location, language, and expertise';
        howItWorksPs[2].textContent = 'Book your preferred date and enjoy a special experience';
      }
      
      // 都道府県名を英語に翻訳
      const locationElements = document.querySelectorAll('.guide-card .text-muted, .guide-location');
      locationElements.forEach(element => {
        const text = element.textContent;
        if (text.includes('東京都')) {
          element.textContent = text.replace('東京都', 'Tokyo');
        } else if (text.includes('京都府')) {
          element.textContent = text.replace('京都府', 'Kyoto');
        } else if (text.includes('大阪府')) {
          element.textContent = text.replace('大阪府', 'Osaka');
        } else if (text.includes('渋谷区')) {
          element.textContent = text.replace('渋谷区', 'Shibuya');
        } else if (text.includes('京都市')) {
          element.textContent = text.replace('京都市', 'Kyoto City');
        } else if (text.includes('大阪市')) {
          element.textContent = text.replace('大阪市', 'Osaka City');
        }
      });
      
      // メリットカードのタイトルを強制的にすべて英語に統一（10個すべて対応）
      function translateBenefitTitlesToEnglish() {
        const selectors = [
          '#guide-benefits h5',
          '#guide-benefits .guide-benefit-card h5',
          '.guide-benefit-card h5',
          'section[id="guide-benefits"] h5',
          '.container .guide-benefit-card h5'
        ];
        
        const englishTitles = [
          'Your daily life becomes a tourism resource',
          'Welcome tourists as friends', 
          'Efficient work using spare time',
          'Turn your passion into work',
          'Meet people from around the world',
          'Improve and utilize language skills',
          'Deepen your love and pride for your hometown',
          'Reliable support system',
          'Work at your own pace',
          'Contribute to local revitalization'
        ];
        
        selectors.forEach(selector => {
          const titles = document.querySelectorAll(selector);
          console.log(`英語翻訳 セレクター ${selector}: ${titles.length}個のタイトル見つかりました`);
          titles.forEach((title, index) => {
            if (englishTitles[index]) {
              const oldText = title.textContent;
              title.textContent = englishTitles[index];
              console.log(`英語翻訳 ${index}: ${oldText} → ${englishTitles[index]}`);
            }
          });
        });
      }
      
      // 段階的実行で確実に翻訳
      translateBenefitTitlesToEnglish();
      setTimeout(translateBenefitTitlesToEnglish, 300);
      setTimeout(translateBenefitTitlesToEnglish, 800);
      setTimeout(translateBenefitTitlesToEnglish, 1500);
      setTimeout(translateBenefitTitlesToEnglish, 3000);
      
      // ガイドカード翻訳（すべてのカードを対象・強化版）
      function translateAllGuideCards() {
        // より包括的なセレクターで隠しガイドを含む全てのカードをキャッチ
        const guideCardSelectors = [
          '.guide-card', 
          '.guide-item', 
          '.guide-item.hidden-guide',
          '.hidden-guide',
          '[data-guide-id]',
          '.col-md-4 .card',
          '.col-lg-4 .card',
          '#guide-cards-container .guide-item',
          '.guides-container .guide-item'
        ];
        
        let allGuideCards = [];
        guideCardSelectors.forEach(selector => {
          const cards = document.querySelectorAll(selector);
          cards.forEach(card => {
            if (!allGuideCards.includes(card)) {
              allGuideCards.push(card);
            }
          });
        });
        
        console.log(`英語翻訳: ${allGuideCards.length}個のガイドカードを翻訳中`);
        console.log('対象ガイドカード:', allGuideCards.map(card => card.querySelector('.card-title')?.textContent || 'No Title'));
        
        allGuideCards.forEach((card, index) => {
          console.log(`ガイドカード ${index + 1} を英語翻訳中...`);
          
          // 詳細を見るボタン（複数のセレクターで確実にキャッチ）
          const detailSelectors = [
            '.btn', 
            'a[href*="guide"]', 
            '.guide-details-link',
            'button[onclick*="showGuideDetails"]',
            '.card-footer a',
            '.btn-primary'
          ];
          
          detailSelectors.forEach(selector => {
            const detailBtn = card.querySelector(selector);
            if (detailBtn && (detailBtn.textContent.includes('詳細') || detailBtn.textContent.includes('See Details'))) {
              detailBtn.textContent = 'See Details';
              console.log(`詳細ボタン翻訳: See Details`);
            }
          });
          
          // 言語バッジ（包括的な翻訳）
          const langBadgeSelectors = [
            '.badge', 
            '.language-badge', 
            '.text-primary',
            '.badge.bg-light',
            '.badge.bg-primary',
            'span[class*="badge"]'
          ];
          
          langBadgeSelectors.forEach(selector => {
            const langBadges = card.querySelectorAll(selector);
            langBadges.forEach(badge => {
              const originalText = badge.textContent.trim();
              if (originalText === '日本語' || originalText === 'Japanese') {
                badge.textContent = 'Japanese';
                console.log(`言語バッジ翻訳: ${originalText} → Japanese`);
              } else if (originalText === '英語' || originalText === 'English') {
                badge.textContent = 'English';
                console.log(`言語バッジ翻訳: ${originalText} → English`);
              } else if (originalText === 'フランス語' || originalText === 'French') {
                badge.textContent = 'French';
                console.log(`言語バッジ翻訳: ${originalText} → French`);
              } else if (originalText === '中国語' || originalText === 'Chinese') {
                badge.textContent = 'Chinese';
                console.log(`言語バッジ翻訳: ${originalText} → Chinese`);
              } else if (originalText === '韓国語' || originalText === 'Korean') {
                badge.textContent = 'Korean';
                console.log(`言語バッジ翻訳: ${originalText} → Korean`);
              }
            });
          });
          
          // 場所の翻訳（都道府県・市区町村完全対応）
          const locationSelectors = [
            '.guide-location', 
            '.text-muted',
            '.location',
            '.area',
            'small.text-muted',
            '.card-subtitle',
            'p.text-muted',
            '.card-text.text-muted'
          ];
          
          locationSelectors.forEach(selector => {
            const location = card.querySelector(selector);
            if (location) {
              const originalText = location.textContent;
              let text = originalText;
              
              // 都道府県と市区町村の翻訳
              text = text.replace('北海道', 'Hokkaido').replace('札幌市', 'Sapporo City');
              text = text.replace('東京都', 'Tokyo').replace('渋谷区', 'Shibuya');
              text = text.replace('沖縄県', 'Okinawa').replace('那覇市', 'Naha City');
              text = text.replace('広島県', 'Hiroshima').replace('広島市', 'Hiroshima City');
              text = text.replace('京都府', 'Kyoto').replace('京都市', 'Kyoto City');
              text = text.replace('大阪府', 'Osaka').replace('大阪市', 'Osaka City');
              
              if (originalText !== text) {
                location.textContent = text;
                console.log(`場所翻訳: ${originalText} → ${text}`);
              }
            }
          });
        });
        
        console.log(`ガイドカード英語翻訳完了: 合計 ${allGuideCards.length}件`);
      }
      
      // 即座に翻訳
      translateAllGuideCards();
      
      // 遅延実行で動的に追加されたカードも翻訳
      setTimeout(translateAllGuideCards, 500);
      setTimeout(translateAllGuideCards, 1500);
      setTimeout(translateAllGuideCards, 3000);
      
      // 「もっとみる」ボタンのクリック監視と翻訳適用
      const loadMoreBtn = document.getElementById('load-more-guides');
      if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', function() {
          // ボタンクリック後に新しく表示されるガイドカードに翻訳を適用
          setTimeout(() => {
            console.log('「もっとみる」ボタンクリック後の翻訳適用');
            translateAllGuideCards();
          }, 100);
          
          setTimeout(translateAllGuideCards, 500);
          setTimeout(translateAllGuideCards, 1000);
        });
      }
      
      // MutationObserverでDOMの変更を監視して新しいガイドカードに翻訳を適用
      const observer = new MutationObserver(function(mutations) {
        let shouldTranslate = false;
        mutations.forEach(function(mutation) {
          if (mutation.type === 'childList') {
            mutation.addedNodes.forEach(function(node) {
              if (node.nodeType === 1 && 
                  (node.classList.contains('guide-card') || 
                   node.classList.contains('guide-item') || 
                   node.classList.contains('hidden-guide') ||
                   node.querySelector('.guide-card'))) {
                shouldTranslate = true;
              }
            });
          }
          
          // クラス変更も監視（hidden-guideクラスの削除など）
          if (mutation.type === 'attributes' && 
              mutation.attributeName === 'class' &&
              mutation.target.classList.contains('guide-item')) {
            shouldTranslate = true;
          }
        });
        
        if (shouldTranslate) {
          console.log('新しいガイドカードが追加されました - 翻訳適用');
          setTimeout(translateAllGuideCards, 50);
          setTimeout(translateAllGuideCards, 200);
        }
      });
      
      // ガイドカードコンテナを監視（属性変更も含む）
      const guideContainer = document.getElementById('guide-cards-container');
      if (guideContainer) {
        observer.observe(guideContainer, { 
          childList: true, 
          subtree: true, 
          attributes: true, 
          attributeFilter: ['class'] 
        });
      }
      
      // ガイドカードコンテナを監視
      const guideContainer = document.getElementById('guide-cards-container');
      if (guideContainer) {
        observer.observe(guideContainer, { childList: true, subtree: true });
      }
      
      // ガイド登録ボタンの翻訳（英語版）
      function translateGuideRegisterButtonToEnglish() {
        const guideRegisterSelectors = [
          '.btn-register-guide',
          'a[href="#register-guide"]',
          'button[onclick*="register"]',
          'a.btn.btn-primary[href*="register"]',
          '.btn.btn-primary',
          'a.btn-primary'
        ];
        
        guideRegisterSelectors.forEach(selector => {
          const btn = document.querySelector(selector);
          if (btn && (btn.textContent.includes('ガイドとして登録') || btn.textContent.includes('Register as Guide'))) {
            btn.textContent = 'Register as Guide';
          }
        });
        
        // より具体的にガイド登録ボタンを探す
        const allButtons = document.querySelectorAll('a.btn, button.btn');
        allButtons.forEach(btn => {
          if (btn.textContent.includes('ガイドとして登録') || btn.textContent.includes('Register as Guide')) {
            btn.textContent = 'Register as Guide';
          }
        });
      }
      
      // ガイド登録ボタンの翻訳を実行
      translateGuideRegisterButtonToEnglish();
      
      // 遅延実行でボタン翻訳も確実に
      setTimeout(translateGuideRegisterButtonToEnglish, 300);
      setTimeout(translateGuideRegisterButtonToEnglish, 800);
      setTimeout(translateGuideRegisterButtonToEnglish, 1500);
      
      // ガイドとして活躍するメリット（正しいセレクター）
      const benefitsTitle = document.querySelector('#guide-benefits h2');
      if (benefitsTitle) benefitsTitle.textContent = 'Benefits of Being a Guide';
      
      const benefitsSubtitle = document.querySelector('#guide-benefits .lead');
      if (benefitsSubtitle) benefitsSubtitle.textContent = 'Utilize your knowledge and experience to provide special experiences for travelers worldwide';
      
      // メリット項目のタイトル（正しいセレクター）
      const benefitTitles = document.querySelectorAll('#guide-benefits h5');
      if (benefitTitles.length >= 8) {
        benefitTitles[0].textContent = 'Your daily life becomes a tourism resource';
        benefitTitles[1].textContent = 'Simply welcome tourists as friends';
        benefitTitles[2].textContent = 'Work efficiently during your free time';
        benefitTitles[3].textContent = 'Turn your passion into work';
        benefitTitles[4].textContent = 'Deepen your love and pride for your hometown';
        benefitTitles[5].textContent = 'Reliable support system';
        benefitTitles[6].textContent = 'Work at your own pace';
        benefitTitles[7].textContent = 'Contribute to local revitalization';
      }
      
      // メリット項目の説明文（複数のセレクターで確実に翻訳）
      const benefitDescs = document.querySelectorAll('#guide-benefits .text-muted');
      if (benefitDescs.length >= 8) {
        benefitDescs[0].textContent = 'By sharing special places that only locals know about, your everyday surroundings become valuable tourism resources.';
        benefitDescs[1].textContent = 'Rather than a formal guided tour, you can naturally convey the charm of your local area as if spending time with friends.';
        benefitDescs[2].textContent = 'You can set your schedule according to your convenience, allowing you to earn income while balancing with your main job or studies.';
        benefitDescs[3].textContent = 'By providing unique guided experiences that utilize your hobbies, skills, and specialized knowledge, you can turn your passion into income.';
        benefitDescs[4].textContent = 'By promoting the attractions of your local area, you will develop a deeper appreciation and attachment to your hometown.';
        benefitDescs[5].textContent = 'We provide the essential support for guide activities such as reservation management, payment, and insurance, so you can work with peace of mind.';
        benefitDescs[6].textContent = 'When and how often you accept bookings is completely up to you, allowing for a lifestyle that suits your needs.';
        benefitDescs[7].textContent = 'By introducing tourists to local shops and facilities, you contribute to the revitalization of the local economy and community development.';
      }
      
      // より具体的なセレクターでメリット説明文を確実に翻訳
      const benefitCardDescriptions = document.querySelectorAll('#guide-benefits .guide-benefit-card p.text-muted');
      benefitCardDescriptions.forEach((desc, index) => {
        const englishTexts = [
          'By sharing special places that only locals know about, your everyday surroundings become valuable tourism resources.',
          'Rather than a formal guided tour, you can naturally convey the charm of your local area as if spending time with friends.',
          'You can set your schedule according to your convenience, allowing you to earn income while balancing with your main job or studies.',
          'By providing unique guided experiences that utilize your hobbies, skills, and specialized knowledge, you can turn your passion into income.',
          'By promoting the attractions of your local area, you will develop a deeper appreciation and attachment to your hometown.',
          'We provide the essential support for guide activities such as reservation management, payment, and insurance, so you can work with peace of mind.',
          'When and how often you accept bookings is completely up to you, allowing for a lifestyle that suits your needs.',
          'By introducing tourists to local shops and facilities, you contribute to the revitalization of the local economy and community development.'
        ];
        if (englishTexts[index]) {
          desc.textContent = englishTexts[index];
        }
      });
      
      // ガイドカードの紹介文を英語に翻訳
      const guideCards = document.querySelectorAll('.guide-card');
      guideCards.forEach((card, index) => {
        const description = card.querySelector('.card-text.mb-3');
        if (description) {
          const englishDescriptions = [
            'I guide you to hidden gems in Tokyo. Specializing in gourmet food and photo spots.',
            'Introducing the charm of Kyoto where history and tradition live. Specializing in temple visits and traditional cultural experiences.',
            'Specializing in Osaka\'s unique food tours and city walks. I\'ll guide you to local restaurants only locals know about.'
          ];
          if (englishDescriptions[index]) {
            description.textContent = englishDescriptions[index];
          }
        }
        
        // 言語バッジも英語に
        const languageBadges = card.querySelectorAll('.badge.bg-light');
        languageBadges.forEach(badge => {
          if (badge.textContent.includes('日本語')) {
            badge.textContent = 'Japanese';
          } else if (badge.textContent.includes('英語(基礎)')) {
            badge.textContent = 'Basic English';
          } else if (badge.textContent.includes('英語')) {
            badge.textContent = 'English';
          } else if (badge.textContent.includes('中国語')) {
            badge.textContent = 'Chinese';
          }
        });
      });
      
      // ガイド登録ボタン
      const guideRegisterBtn = document.querySelector('.btn-register-guide');
      if (guideRegisterBtn) guideRegisterBtn.textContent = 'Register as Guide';
      
      // スクロール修復実行
      if (window.nuclearScrollFix) {
        setTimeout(() => {
          window.nuclearScrollFix();

        }, 100);
      }
      
      showStatus('Switched to English');
    }
  </script>
  
  <!-- スムーズスクロール用CSS -->
  <style>
    html {
      scroll-behavior: smooth;
    }
  </style>
  
  <!-- 協賛店ボタン機能とスクロール修正 -->
  <script>
    // スクロール修正システム
    function enableScrolling() {
      document.body.style.overflow = 'auto';
      document.documentElement.style.overflow = 'auto';
      document.body.style.position = 'static';
      document.body.style.height = 'auto';
      document.documentElement.style.height = 'auto';
      
      // modal-openクラスによるスクロール無効化を防止
      const modalObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.attributeName === 'class') {
            if (document.body.classList.contains('modal-open')) {
              document.body.style.overflow = 'auto';
              document.body.style.paddingRight = '0';
            }
          }
        });
      });
      
      modalObserver.observe(document.body, {
        attributes: true,
        attributeFilter: ['class']
      });
      
      // 定期的にスクロールを確認・修正
      setInterval(function() {
        if (document.body.style.overflow === 'hidden' || 
            document.documentElement.style.overflow === 'hidden') {
          document.body.style.overflow = 'auto';
          document.documentElement.style.overflow = 'auto';
        }
      }, 100);
    }

    // 協賛店ボタンのイベントリスナー設定
    document.addEventListener('DOMContentLoaded', function() {
      enableScrolling();
      
      // 協賛店登録ボタン
      const sponsorRegisterBtn = document.getElementById('sponsorRegisterBtn');
      if (sponsorRegisterBtn) {
        sponsorRegisterBtn.addEventListener('click', function() {
          alert('協賛店登録システムに移動します');
          // 実際の実装では sponsor-registration.html に移動
          // window.location.href = 'sponsor-registration.html';
        });
      }

      // 協賛店ログインボタン
      const sponsorLoginBtn = document.getElementById('sponsorLoginBtn');
      if (sponsorLoginBtn) {
        sponsorLoginBtn.addEventListener('click', function() {
          alert('協賛店ダッシュボードに移動します');
          // 実際の実装では sponsor-dashboard.html に移動
          // window.location.href = 'sponsor-dashboard.html';
        });
      }
    });

    // 即座にスクロール修正を実行
    enableScrolling();
  </script>
  
  <!-- 問題のあるスクリプトファイルを無効化 -->
  <!-- <script src="debug-redirect-tracker.js"></script> -->
  
  <!-- 複雑なスクリプトを全て無効化してクリーンな状態にする -->
  <!--
    // グローバル認証状態管理システム
    window.TouristAuthManager = (function() {
      let authData = null;
      let isProtected = false;
      
      // 認証データを複数の場所に分散保存
      function distributeAuthData(data) {
        if (!data) return;
        
        const dataString = JSON.stringify(data);
        authData = data;
        
        // メイン保存場所
        localStorage.setItem('touristData', dataString);
        sessionStorage.setItem('currentUser', dataString);
        
        // 分散バックアップ
        localStorage.setItem('auth_backup_1', dataString);
        localStorage.setItem('auth_backup_2', dataString);
        sessionStorage.setItem('auth_session_backup', dataString);
        
        // メモリバックアップ
        window.touristAuthData = data;
        window.protectTouristAuth = true;
        
        console.log('🔐 認証データ分散保存完了:', data.name);
      }
      
      // 認証データを復元
      function recoverAuthData() {
        // メモリから復元
        if (authData && authData.type === 'tourist' && authData.isAuthenticated) {
          console.log('🔄 メモリから認証データ復元:', authData.name);
          distributeAuthData(authData);
          return authData;
        }
        
        // バックアップから復元
        const backupKeys = ['touristData', 'currentUser', 'auth_backup_1', 'auth_backup_2', 'auth_session_backup'];
        
        for (const key of backupKeys) {
          try {
            const storage = key.includes('session') ? sessionStorage : localStorage;
            const data = storage.getItem(key);
            if (data) {
              const userData = JSON.parse(data);
              if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
                console.log('🔄 バックアップから認証データ復元:', userData.name, '(from:', key, ')');
                authData = userData;
                distributeAuthData(userData);
                return userData;
              }
            }
          } catch (e) {
            console.warn('バックアップ復元エラー:', key, e);
          }
        }
        
        return null;
      }
      
      // 認証状態をチェック
      function checkAuth() {
        const mainData = localStorage.getItem('touristData');
        if (mainData) {
          try {
            const userData = JSON.parse(mainData);
            if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
              authData = userData;
              return userData;
            }
          } catch (e) {
            console.warn('メイン認証データ破損 - 復元を試行');
          }
        }
        
        // メインデータがない場合は復元を試行
        return recoverAuthData();
      }
      
      // 初期化
      function init() {
        console.log('🚀 認証管理システム初期化');
        
        const existingData = checkAuth();
        if (existingData) {
          console.log('🛡️ 既存認証データ検出:', existingData.name);
          distributeAuthData(existingData);
          setupProtection();
        }
        
        // 定期的な健康チェック
        setInterval(() => {
          if (!localStorage.getItem('touristData') && authData) {
            console.log('🚨 認証データ消失検出 - 自動復旧');
            distributeAuthData(authData);
          }
        }, 1000);

        // ページナビゲーション時の保護
        window.addEventListener('beforeunload', () => {
          if (authData) {
            sessionStorage.setItem('nav_backup', JSON.stringify(authData));
          }
        });

        // ページ復帰時の復旧
        window.addEventListener('pageshow', () => {
          const navBackup = sessionStorage.getItem('nav_backup');
          if (navBackup && !localStorage.getItem('touristData')) {
            try {
              const backupData = JSON.parse(navBackup);
              distributeAuthData(backupData);
              console.log('ナビゲーション復旧完了');
            } catch (e) {
              console.warn('ナビゲーション復旧エラー:', e);
            }
          }
        });
      }
      
      // ストレージ保護
      function setupProtection() {
        if (isProtected) return;
        isProtected = true;
        
        const originalMethods = {
          localRemove: localStorage.removeItem,
          localClear: localStorage.clear,

          sessionClear: sessionStorage.clear
        };
        
        localStorage.removeItem = function(key) {
          if (key === 'touristData' || key.startsWith('auth_backup') || key.startsWith('touristBackup_')) {
            console.log('🚫 認証データ削除を阻止:', key);
            return;
          }
          return originalMethods.localRemove.call(this, key);
        };
        
        localStorage.clear = function() {
          console.log('🚫 localStorage全削除を阻止');
          const authKeys = ['touristData', 'auth_backup_1', 'auth_backup_2'];
          const backupData = {};
          authKeys.forEach(key => {
            const data = localStorage.getItem(key);
            if (data) backupData[key] = data;
          });
          
          originalMethods.localClear.call(this);
          
          Object.keys(backupData).forEach(key => {
            localStorage.setItem(key, backupData[key]);
          });
        };
        
        sessionStorage.removeItem = function(key) {
          if (key === 'currentUser' || key === 'auth_session_backup') {
            console.log('🚫 セッション認証データ削除を阻止:', key);
            return;
          }
          return originalMethods.sessionRemove.call(this, key);
        };
        
        sessionStorage.clear = function() {
          console.log('🚫 sessionStorage全削除を阻止');
          const authData = sessionStorage.getItem('currentUser');
          const backupData = sessionStorage.getItem('auth_session_backup');
          
          originalMethods.sessionClear.call(this);
          
          if (authData) sessionStorage.setItem('currentUser', authData);
          if (backupData) sessionStorage.setItem('auth_session_backup', backupData);
        };
      }
      
      return {
        init: init,
        save: distributeAuthData,
        recover: recoverAuthData,
        check: checkAuth,
        isAuthenticated: function() {
          const auth = checkAuth();
          return auth && auth.type === 'tourist' && auth.isAuthenticated;
        }
      };
    })();

    // 統一認証チェック関数を作成
    function isUserAuthenticated() {
      console.log('=== 認証チェック開始 ===');
      
      // 複数のソースから認証データを確認
      const sources = [
        { key: 'touristData', storage: localStorage },
        { key: 'currentUser', storage: sessionStorage },
        { key: 'auth_backup_1', storage: localStorage },
        { key: 'auth_backup_2', storage: localStorage }
      ];
      
      for (const source of sources) {
        try {
          const data = source.storage.getItem(source.key);
          console.log(`チェック中: ${source.key} = ${data ? '存在' : 'なし'}`);
          if (data) {
            const userData = JSON.parse(data);
            console.log(`パース結果:`, userData);
            if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
              console.log('認証成功:', userData.name, 'from', source.key);
              return true;
            }
          }
        } catch (e) {
          console.warn(`${source.key} パースエラー:`, e);
          continue;
        }
      }
      
      console.log('認証チェック失敗 - 有効なデータが見つかりません');
      return false;
    }
    
    // グローバル関数として設定
    window.isUserAuthenticated = isUserAuthenticated;

    // ストレージ監視システム
    let storageMonitor = setInterval(() => {
      const hasTouristData = localStorage.getItem('touristData');
      if (!hasTouristData) {
        console.log('警告: touristDataが消失しました');
        
        // バックアップから復旧を試行
        const backup1 = localStorage.getItem('auth_backup_1');
        const backup2 = localStorage.getItem('auth_backup_2');
        const sessionBackup = sessionStorage.getItem('currentUser');
        
        if (backup1 || backup2 || sessionBackup) {
          console.log('バックアップから自動復旧を実行');
          const recoveryData = backup1 || backup2 || sessionBackup;
          localStorage.setItem('touristData', recoveryData);
          sessionStorage.setItem('currentUser', recoveryData);
        }
      }
    }, 2000);
      
      function protectTouristStorageEarly(touristData) {
        const originalRemoveItem = localStorage.removeItem;
        const originalClear = localStorage.clear;
        const originalSessionRemove = sessionStorage.removeItem;
        const originalSessionClear = sessionStorage.clear;
        
        localStorage.removeItem = function(key) {
          if (window.protectTouristAuth && (key === 'touristData' || key.startsWith('touristBackup_'))) {
            console.log('🚫 早期保護: 観光客データ削除を阻止:', key);
            return;
          }
          return originalRemoveItem.call(this, key);
        };
        
        localStorage.clear = function() {
          if (window.protectTouristAuth) {
            console.log('🚫 早期保護: localStorage全削除を阻止');
            const keysToKeep = [];
            for (let i = 0; i < localStorage.length; i++) {
              const key = localStorage.key(i);
              if (key === 'touristData' || key.startsWith('touristBackup_')) {
                keysToKeep.push({ key, value: localStorage.getItem(key) });
              }
            }
            originalClear.call(this);
            keysToKeep.forEach(item => {
              localStorage.setItem(item.key, item.value);
            });
            return;
          }
          return originalClear.call(this);
        };
        
        sessionStorage.removeItem = function(key) {
          if (window.protectTouristAuth && key === 'currentUser') {
            console.log('🚫 早期保護: セッション認証データ削除を阻止:', key);
            return;
          }
          return originalSessionRemove.call(this, key);
        };
        
        sessionStorage.clear = function() {
          if (window.protectTouristAuth) {
            console.log('🚫 早期保護: セッションストレージ全削除を阻止');
            const userData = sessionStorage.getItem('currentUser');
            originalClear.call(this);
            if (userData) {
              sessionStorage.setItem('currentUser', userData);
            }
            return;
          }
          return originalSessionClear.call(this);
        };
      }
    })();

    document.addEventListener('DOMContentLoaded', function() {
      // 強力な認証状態復旧システム
      function forceAuthRecovery() {
        console.log('🔧 強制認証復旧システム開始');
        
        // 複数のバックアップソースから検索
        const backupSources = [
          { key: 'auth_backup_1', storage: localStorage },
          { key: 'auth_backup_2', storage: localStorage },
          { key: 'auth_session_backup', storage: sessionStorage },
          { key: 'currentUser', storage: sessionStorage }
        ];
        
        for (const source of backupSources) {
          try {
            const data = source.storage.getItem(source.key);
            if (data) {
              const userData = JSON.parse(data);
              if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
                console.log('✅ 認証データ復旧:', userData.name);
                
                // 全ての保存場所に復元
                localStorage.setItem('touristData', data);
                sessionStorage.setItem('currentUser', data);
                localStorage.setItem('auth_backup_1', data);
                localStorage.setItem('auth_backup_2', data);
                sessionStorage.setItem('auth_session_backup', data);
                
                window.touristAuthData = userData;
                window.protectTouristAuth = true;
                
                updateLoginStateUI();
                return true;
              }
            }
          } catch (e) {
            console.warn('復旧試行エラー:', source.key, e);
          }
        }
        
        return false;
      }
      
      // 競合スクリプト完全無効化
      window.disableAuthCleanup = true;
      window.preventLogout = true;
      window.blockAuthReset = true;
      
      // 有害な関数を無効化
      const dangerousFunctions = [
        'cleanupInvalidAuthData',
        'performCompleteLogout', 
        'clearAuthenticationData',
        'updateUIAfterLogout',
        'executeForceLogout',
        'handleLogout'
      ];
      
      dangerousFunctions.forEach(funcName => {
        const originalFunction = window[funcName];
        Object.defineProperty(window, funcName, {
          value: function() {
            // 登録中または認証データが存在しない場合は元の関数を実行
            if (window.isRegistering || !localStorage.getItem('touristData')) {
              console.log(`🛡️ ${funcName} allowed (registering or not authenticated)`);
              return originalFunction ? originalFunction.apply(this, arguments) : false;
            }
            console.log(`🛡️ ${funcName} blocked`);
            return false;
          },
          writable: false,
          configurable: false
        });
      });
      
      // 他のスクリプトの認証クリア機能を無効化
      const originalRemoveItem = localStorage.removeItem;
      localStorage.removeItem = function(key) {
        if (key === 'touristData' && window.protectTouristAuth) {
          console.log('🛡️ touristData削除をブロック:', key);
          return;
        }
        return originalRemoveItem.call(this, key);
      };
      
      const originalSessionRemove = sessionStorage.removeItem;
      sessionStorage.removeItem = function(key) {
        if ((key === 'currentUser' || key === 'auth_session_backup') && window.protectTouristAuth) {
          console.log('🛡️ セッションデータ削除をブロック:', key);
          return;
        }
        return originalSessionRemove.call(this, key);
      };

      // ページロード時の即座復旧
      forceAuthRecovery();
      
      // ページロード時のUI状態確認と更新を複数回実行
      function performAuthCheckAndUIUpdate() {
        const touristData = localStorage.getItem('touristData');
        if (touristData) {
          try {
            const userData = JSON.parse(touristData);
            if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
              console.log('ページロード時にログイン状態を検出 - UI更新');
              updateLoginStateUI();
              return true;
            }
          } catch (e) {
            console.warn('ページロード時認証チェックエラー:', e);
          }
        }
        return false;
      }
      
      // 即座に実行
      performAuthCheckAndUIUpdate();
      
      // 少し遅延して再実行
      setTimeout(() => {
        performAuthCheckAndUIUpdate();
      }, 100);
      
      // さらに遅延して再実行
      setTimeout(() => {
        performAuthCheckAndUIUpdate();
      }, 500);
      
      // 最終確認
      setTimeout(() => {
        performAuthCheckAndUIUpdate();
      }, 1000);

      // DOMContentLoaded時の確実な実行
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded - 認証UI確認実行');
        performAuthCheckAndUIUpdate();
      });

      // UI要素の監視とリアルタイム修正
      function setupUIMonitoring() {
        const targetNode = document.querySelector('#registerDropdown');
        if (!targetNode) {
          setTimeout(setupUIMonitoring, 100);
          return;
        }

        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'childList' || mutation.type === 'characterData') {
              const registerBtn = document.getElementById('registerDropdown');
              if (registerBtn && registerBtn.textContent.includes('新規登録')) {
                const touristData = localStorage.getItem('touristData');
                if (touristData) {
                  try {
                    const userData = JSON.parse(touristData);
                    if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
                      console.log('UI変更検出 - 認証状態を復元');
                      updateLoginStateUI();
                    }
                  } catch (e) {
                    console.warn('UI監視中の認証チェックエラー:', e);
                  }
                }
              }
            }
          });
        });

        observer.observe(targetNode, {
          childList: true,
          subtree: true,
          characterData: true
        });

        console.log('UI監視システム開始');
      }

      // UI監視を開始
      setTimeout(setupUIMonitoring, 200);

      // ページナビゲーション時の認証状態保持
      window.addEventListener('beforeunload', function() {
        const touristData = localStorage.getItem('touristData');
        if (touristData) {
          // 次回ページロード時のために確実に保存
          sessionStorage.setItem('auth_navigation_backup', touristData);
          console.log('ページ離脱前に認証状態をバックアップ');
        }
      });

      // ページフォーカス時の認証状態復元を強化
      window.addEventListener('focus', function() {
        console.log('ページフォーカス取得 - 認証状態確認');
        const navBackup = sessionStorage.getItem('auth_navigation_backup');
        if (navBackup && !localStorage.getItem('touristData')) {
          console.log('ナビゲーションバックアップから復元');
          localStorage.setItem('touristData', navBackup);
          updateLoginStateUI();
        }
      });

      // 最後の砦 - 定期的なUI状態監視と修正
      setInterval(() => {
        const touristData = localStorage.getItem('touristData');
        const registerBtn = document.getElementById('registerDropdown');
        
        if (touristData && registerBtn) {
          try {
            const userData = JSON.parse(touristData);
            if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
              // 認証済みなのにボタンが「新規登録」のままの場合は修正
              if (registerBtn.textContent.includes('新規登録')) {
                console.log('UI不整合検出 - 強制修正実行');
                updateLoginStateUI();
              }
            }
          } catch (e) {
            console.warn('定期UI監視エラー:', e);
          }
        }
      }, 3000);
      
      // 定期的な認証状態チェックと復旧
      setInterval(() => {
        const mainData = localStorage.getItem('touristData');
        if (!mainData && window.touristAuthData) {
          console.log('🚨 認証データ消失検出 - 復旧実行');
          forceAuthRecovery();
          // UI状態も確認して更新
          setTimeout(() => {
            const registerBtn = document.getElementById('registerDropdown');
            if (registerBtn && registerBtn.textContent.includes('新規登録')) {
              console.log('UI状態が不正 - 強制更新');
              updateLoginStateUI();
            }
          }, 100);
        }
      }, 1000);

      // 他のスクリプトからの干渉をブロック
      const protectedKeys = ['touristData', 'currentUser', 'auth_backup_1', 'auth_backup_2', 'auth_session_backup'];
      
      // グローバル関数の上書きを防止
      Object.defineProperty(window, 'performCompleteLogout', {
        value: function() {
          if (window.protectTouristAuth) {
            console.log('🛡️ 外部ログアウト試行をブロック');
            return false;
          }
        },
        writable: false
      });
      
      Object.defineProperty(window, 'clearAuthenticationData', {
        value: function() {
          if (window.protectTouristAuth) {
            console.log('🛡️ 外部認証クリア試行をブロック');
            return false;
          }
        },
        writable: false
      });
      
      // ガイド詳細ページからのリダイレクトでログインモーダルを表示
      if (sessionStorage.getItem('showLoginOnLoad') === 'true') {
        sessionStorage.removeItem('showLoginOnLoad');
        const accessMessage = sessionStorage.getItem('accessAttemptMessage');
        if (accessMessage) {
          sessionStorage.removeItem('accessAttemptMessage');
        }
        setTimeout(() => {
          const pendingGuideId = sessionStorage.getItem('pendingGuideId');
          if (pendingGuideId) {
            showTouristLoginPrompt(pendingGuideId);
          } else {
            // フォールバック：通常のログインモーダルを表示
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
          }
        }, 800);
      }
      
      // URLパラメータで直接ガイド詳細アクセスを試みた場合の処理
      const urlParams = new URLSearchParams(window.location.search);
      const requireLogin = urlParams.get('requireLogin');
      const directGuideId = urlParams.get('guide');
      
      if (requireLogin === 'true') {
        // サーバーサイドからのリダイレクトでログインが必要な場合
        if (directGuideId) {
          sessionStorage.setItem('pendingGuideId', directGuideId);
        }
        setTimeout(() => {
          if (directGuideId) {
            showTouristLoginPrompt(directGuideId);
          } else {
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
          }
        }, 1000);
        // URLからパラメータを削除
        window.history.replaceState({}, document.title, window.location.pathname);
      } else if (directGuideId && !localStorage.getItem('touristData')) {
        // 未ログインで直接ガイドページアクセスを試みた場合
        sessionStorage.setItem('pendingGuideId', directGuideId);
        setTimeout(() => {
          showTouristLoginPrompt(directGuideId);
        }, 1000);
        // URLからパラメータを削除
        window.history.replaceState({}, document.title, window.location.pathname);
      }
      
      // ログインモーダル内のユーザータイプ切り替え機能
      const touristRadio = document.getElementById('login-user-tourist');
      const guideRadio = document.getElementById('login-user-guide');
      const userTypeDescription = document.getElementById('user-type-description');
      
      function updateUserTypeDescription() {
        if (touristRadio && guideRadio && userTypeDescription) {
          if (touristRadio.checked) {
            userTypeDescription.textContent = '観光客としてログインすると、ガイドを探したり予約できます';
          } else if (guideRadio.checked) {
            userTypeDescription.textContent = 'ガイドとしてログインすると、プロフィールの編集や予約の管理ができます';
          }
          console.log('ユーザータイプが変更されました:', touristRadio.checked ? 'tourist' : 'guide');
        }
      }
      
      // 初期状態で説明テキストを設定
      updateUserTypeDescription();
      
      // ラジオボタンの変更を監視
      if (touristRadio) touristRadio.addEventListener('change', updateUserTypeDescription);
      if (guideRadio) guideRadio.addEventListener('change', updateUserTypeDescription);
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 身分証明書タイプによる表示切替（ガイド）
      const guideIdTypeSelect = document.getElementById('guide-id-type');
      const guideIdBackContainer = document.getElementById('guide-id-back-container');
      
      if (guideIdTypeSelect && guideIdBackContainer) {
        guideIdTypeSelect.addEventListener('change', function() {
          if (this.value === 'drivers_license' || this.value === 'my_number') {
            guideIdBackContainer.classList.remove('d-none');
          } else {
            guideIdBackContainer.classList.add('d-none');
          }
        });
      }
      
      // 身分証明書タイプによる表示切替（旅行者）
      const touristIdTypeSelect = document.getElementById('tourist-id-type');
      const touristIdBackContainer = document.getElementById('tourist-id-back-container');
      
      if (touristIdTypeSelect && touristIdBackContainer) {
        touristIdTypeSelect.addEventListener('change', function() {
          if (this.value === 'drivers_license' || this.value === 'my_number') {
            touristIdBackContainer.classList.remove('d-none');
          } else {
            touristIdBackContainer.classList.add('d-none');
          }
        });
      }

      // 身分証明書プレビューと削除機能の設定
      setupDocumentPreview('guide-id-front');
      setupDocumentPreview('guide-id-back');
      setupDocumentPreview('tourist-id-front');
      setupDocumentPreview('tourist-id-back');
      
      function setupDocumentPreview(inputId) {
        const fileInput = document.getElementById(inputId);
        const previewImg = document.getElementById(`${inputId}-preview`);
        const deleteBtn = document.getElementById(`${inputId}-delete`);
        
        if (fileInput && previewImg && deleteBtn) {
          // ファイル選択時のプレビュー
          fileInput.addEventListener('change', function(e) {
            if (this.files && this.files[0]) {
              const reader = new FileReader();
              
              reader.onload = function(e) {
                previewImg.src = e.target.result;
                previewImg.classList.remove('d-none');
                deleteBtn.classList.remove('d-none');
              };
              
              reader.readAsDataURL(this.files[0]);
            }
          });
          
          // 削除ボタンのイベント
          deleteBtn.addEventListener('click', function() {
            fileInput.value = '';
            previewImg.src = '';
            previewImg.classList.add('d-none');
            deleteBtn.classList.add('d-none');
          });
        }
      }
      
      // デバイス検出とカメラボタンの表示/非表示
      function isMobile() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      }
      
      // PCの場合はカメラボタンを非表示
      if (!isMobile()) {
        document.querySelectorAll('.mobile-only').forEach(elem => {
          elem.style.display = 'none';
        });
      }
      
      // 電話番号認証シミュレーション
      setupPhoneVerification('tourist');
      setupPhoneVerification('guide');
      
      function setupPhoneVerification(prefix) {
        const sendCodeBtn = document.getElementById(`${prefix}-send-code-btn`);
        const codeInput = document.getElementById(`${prefix}-verification-code`);
        const verifiedDiv = document.getElementById(`${prefix}-phone-verified`);
        const phoneInput = document.getElementById(`${prefix}-phone-number`);
        
        if (sendCodeBtn && codeInput && verifiedDiv && phoneInput) {
          sendCodeBtn.addEventListener('click', function() {
            const phone = phoneInput.value.trim();
            if (!phone) {
              alert('電話番号を入力してください');
              return;
            }
            
            // 送信中状態を表示
            const originalBtnText = sendCodeBtn.textContent;
            sendCodeBtn.disabled = true;
            sendCodeBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 送信中...';
            
            // 送信シミュレーション（1秒後）
            setTimeout(() => {
              sendCodeBtn.disabled = false;
              sendCodeBtn.textContent = originalBtnText;
              alert('テスト用認証コード: 123456');
              codeInput.value = '123456';
            }, 1000);
          });
          
          // 認証ボタンを追加
          const verifyContainer = document.createElement('div');
          verifyContainer.className = 'mt-3';
          const verifyButton = document.createElement('button');
          verifyButton.type = 'button';
          verifyButton.className = 'btn btn-success';
          verifyButton.textContent = '認証する';
          verifyButton.id = `${prefix}-verify-code-btn`;
          verifyContainer.appendChild(verifyButton);
          
          const codeContainer = document.getElementById(`${prefix}-verification-code-container`);
          if (codeContainer && !document.getElementById(`${prefix}-verify-code-btn`)) {
            codeContainer.appendChild(verifyContainer);
          }
          
          // 認証ボタンのイベントリスナー
          verifyButton.addEventListener('click', function() {
            const code = codeInput.value.trim();
            if (!code) {
              alert('認証コードを入力してください');
              return;
            }
            
            // 認証中状態を表示
            const originalBtnText = verifyButton.textContent;
            verifyButton.disabled = true;
            verifyButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> 認証中...';
            
            // 認証シミュレーション（1秒後）
            setTimeout(() => {
              if (code === '123456') {
                verifiedDiv.classList.remove('d-none');
                phoneInput.readOnly = true;
                sendCodeBtn.disabled = true;
                verifyButton.disabled = true;
                
                // 認証成功メッセージ
                alert('電話番号が認証されました');
                
                // 認証コード入力欄を非表示に
                setTimeout(() => {
                  if (codeContainer) {
                    codeContainer.style.display = 'none';
                  }
                }, 1500);
              } else {
                verifyButton.disabled = false;
                verifyButton.textContent = originalBtnText;
                alert('認証コードが正しくありません');
              }
            }, 1000);
          });
          
          // 入力時の自動検証（オプション）
          codeInput.addEventListener('input', function() {
            // 6桁の認証コードが入力されたら認証ボタンをハイライト
            if (this.value.length === 6) {
              verifyButton.classList.add('btn-pulse');
            } else {
              verifyButton.classList.remove('btn-pulse');
            }
          });
        }
      }
      
      // フォーム送信のシミュレーション
      const touristForm = document.getElementById('tourist-register-form');
      const guideForm = document.getElementById('guide-register-form');
      const loginForm = document.getElementById('login-form');
      
      if (touristForm) {
        touristForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // 電話番号認証チェック（デモ用に簡略化）
          const phoneVerified = document.getElementById('tourist-phone-verified');
          if (phoneVerified.classList.contains('d-none')) {
            // デモ用：電話番号が入力されていれば自動認証
            const phoneNumber = document.getElementById('tourist-phone-number').value;
            if (phoneNumber && phoneNumber.length >= 10) {
              phoneVerified.classList.remove('d-none');
            } else {
              alert('電話番号を入力してください');
              return;
            }
          }
          
          // 身分証明書アップロードチェック（デモ用に簡略化）
          const touristIdType = document.getElementById('tourist-id-type').value;
          if (!touristIdType) {
            alert('身分証明書の種類を選択してください');
            return;
          }
          
          const touristIdFront = document.getElementById('tourist-id-front');
          if (!touristIdFront.files || touristIdFront.files.length === 0) {
            alert('身分証明書（表面）をアップロードしてください');
            return;
          }
          
          // 裏面が必要な場合は確認（運転免許証とマイナンバーカードのみ）
          const touristIdBack = document.getElementById('tourist-id-back');
          if ((touristIdType === 'drivers_license' || touristIdType === 'my_number') && 
              (!touristIdBack.files || touristIdBack.files.length === 0)) {
            alert('身分証明書（裏面）をアップロードしてください');
            return;
          }
          
          // 観光客データを作成・保存
          const touristData = {
            id: 'tourist_' + Date.now(),
            name: document.getElementById('tourist-name').value,
            email: document.getElementById('tourist-email').value,
            phone: document.getElementById('tourist-phone-number').value,
            idType: document.getElementById('tourist-id-type').value,
            registrationDate: new Date().toISOString(),
            isVerified: true
          };
          
          // ローカルストレージに保存
          localStorage.setItem('touristData', JSON.stringify(touristData));
          sessionStorage.setItem('currentUser', JSON.stringify(touristData));
          
          // 登録完了と機能アンロック通知を表示
          showTouristRegistrationSuccess(touristData);
          
          // モーダルを閉じる
          const modal = bootstrap.Modal.getInstance(document.getElementById('registerTouristModal'));
          modal.hide();
          
          // 保存されていたガイドIDを取得
          const pendingGuideId = sessionStorage.getItem('pendingGuideId');
          
          // 登録完了後はメインページでガイド詳細表示
          setTimeout(() => {
            if (pendingGuideId) {
              sessionStorage.removeItem('pendingGuideId');
              console.log('観光客登録完了 - ガイド詳細表示:', pendingGuideId);
              // リダイレクトせずにメインページでガイド情報を表示
              updateLoginStateUI();
              showGuideDetailsAfterLogin(pendingGuideId);
            } else {
              // ガイドIDが見つからない場合はホームの人気ガイドセクションにスクロール
              document.getElementById('guides').scrollIntoView({ behavior: 'smooth' });
            }
          }, 500);
        });
      }
      
      if (guideForm) {
        guideForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          // 電話番号認証チェック
          if (document.getElementById('guide-phone-verified').classList.contains('d-none')) {
            alert('電話番号認証を完了してください');
            return;
          }
          
          // 身分証明書アップロードチェック
          const guideIdFront = document.getElementById('guide-id-front');
          if (!guideIdFront.files || guideIdFront.files.length === 0) {
            alert('身分証明書（表面）をアップロードしてください');
            return;
          }
          
          // 裏面が必要な場合は確認
          const guideIdType = document.getElementById('guide-id-type').value;
          const guideIdBack = document.getElementById('guide-id-back');
          if ((guideIdType === 'drivers_license' || guideIdType === 'my_number') && 
              (!guideIdBack.files || guideIdBack.files.length === 0)) {
            alert('身分証明書（裏面）をアップロードしてください');
            return;
          }
          
          // ガイド登録データの保存は専用スクリプト（guide_registration_handler.js）で行います
          
          // すべての検証に通過した場合
          alert('登録リクエストを受け付けました。身分証明書の確認後に承認されます。');
          const modal = bootstrap.Modal.getInstance(document.getElementById('registerGuideModal'));
          modal.hide();
        });
      }
      
      // ログインフォームの処理
      if (loginForm) {
        loginForm.addEventListener('submit', function(e) {
          e.preventDefault();
          
          const userType = document.querySelector('input[name="login-user-type"]:checked').value;
          const email = document.getElementById('login-email').value;
          const password = document.getElementById('login-password').value;
          
          if (!email || !password) {
            alert('メールアドレスとパスワードを入力してください');
            return;
          }
          
          // 観光客としてログイン
          if (userType === 'tourist') {
            handleTouristLogin(email, password);
          } else {
            // ガイドログインは別途実装
            alert('ガイドログイン機能は準備中です');
          }
        });
      }
      
      // ガイド詳細ボタンクリック処理
      window.handleGuideDetailsClick = function(guideId) {
        // 認証状態をチェック
        const touristData = localStorage.getItem('touristData');
        
        if (touristData) {
          // ログイン済みの場合は詳細ページに遷移（無効化）
          console.log('ログイン済みユーザー - ガイド詳細表示:', guideId);
          // window.location.replace(`guide-details.html?id=${guideId}`);
          return;
        }
        
        // 未ログインの場合は登録促進モーダルを表示
        sessionStorage.setItem('pendingGuideId', guideId);
        showTouristLoginPrompt(guideId);
      };

      // ガイド詳細閲覧にログインが必要であることを明示（旧関数、互換性のため）
      function showLoginRequirement(guideId) {
        handleGuideDetailsClick(guideId);
      }

      // 観光客ログイン促進モーダルを表示（無効化）
      function showTouristLoginPrompt(guideId) {
        // この機能は無効化されています - 新しい認証フローを使用
        console.log('showTouristLoginPrompt は無効化されています');
        return;
      }

      // 観光客ログイン促進モーダルを動的作成
      function createTouristLoginPromptModal() {
        const modalHTML = `
          <div class="modal fade" id="touristLoginPromptModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                  <h5 class="modal-title">
                    <i class="bi bi-shield-lock me-2"></i>ガイド詳細の閲覧にはログインが必要です
                  </h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                  <div class="mb-4">
                    <i class="bi bi-person-check-fill text-primary" style="font-size: 3rem;"></i>
                  </div>
                  <h4 class="mb-3">安全で信頼できるサービスのために</h4>
                  <p class="lead mb-4">
                    ガイドの詳細情報や予約機能をご利用いただくには、観光客としてのアカウント登録・ログインが必要です。
                  </p>
                  <div class="alert alert-info">
                    <strong>なぜログインが必要なのか？</strong><br>
                    • お客様とガイドの安全確保<br>
                    • 信頼性の高いマッチング<br>
                    • 予約履歴の管理<br>
                    • 品質向上のためのフィードバック
                  </div>
                  <p id="selectedGuideInfo" class="text-muted small"></p>
                </div>
                <div class="modal-footer justify-content-center">
                  <button type="button" class="btn btn-primary btn-lg me-3" onclick="showTouristRegistration()">
                    <i class="bi bi-person-plus me-1"></i>新規登録（推奨）
                  </button>
                  <button type="button" class="btn btn-outline-primary btn-lg" onclick="showExistingLogin()">
                    <i class="bi bi-box-arrow-in-right me-1"></i>既存アカウントでログイン
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
        document.body.insertAdjacentHTML('beforeend', modalHTML);
      }

      // 新規登録フォームを表示
      function showTouristRegistration() {
        // 促進モーダルを閉じる
        const promptModal = bootstrap.Modal.getInstance(document.getElementById('touristLoginPromptModal'));
        if (promptModal) {
          promptModal.hide();
        }
        
        // 観光客登録モーダルを表示
        setTimeout(() => {
          const registerModal = new bootstrap.Modal(document.getElementById('registerTouristModal'));
          registerModal.show();
        }, 300);
      }

      // 既存ログインフォームを表示
      function showExistingLogin() {
        // 促進モーダルを閉じる
        const promptModal = bootstrap.Modal.getInstance(document.getElementById('touristLoginPromptModal'));
        if (promptModal) {
          promptModal.hide();
        }
        
        // ログインモーダルを表示
        setTimeout(() => {
          const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
          // 観光客ラジオボタンを選択
          document.getElementById('login-user-tourist').checked = true;
          loginModal.show();
        }, 300);
      }

      // 観光客ログイン処理（統一認証システムに移管済み）
      function handleTouristLogin(email, password) {
        console.log('旧ログイン関数は無効化されています - 統一認証システムを使用');
        return;
      }
      
      // 観光客認証情報の検証（統一認証システムに移管済み）
      function isValidTouristCredentials(email, password) {
        console.log('旧認証関数は無効化されています - 統一認証システムを使用');
        return false;
      }
      
      // メールアドレスから名前を抽出
      function extractNameFromEmail(email) {
        const localPart = email.split('@')[0];
        return localPart.charAt(0).toUpperCase() + localPart.slice(1);
      }
      
      /**
       * 観光客登録成功時の包括的な通知システム
       * アンロックされた機能を詳細に説明
       */
      function showTouristRegistrationSuccess(userData) {
        // 既存のモーダルを閉じる
        const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerTouristModal'));
        if (registerModal) {
          registerModal.hide();
        }
        
        // 成功通知モーダルのHTML
        const successModalHTML = `
          <div class="modal fade show" id="touristSuccessModal" tabindex="-1" style="display: block; background: rgba(0,0,0,0.5);">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-header border-0 pb-0" style="background: linear-gradient(135deg, #28a745, #20c997); border-radius: 20px 20px 0 0;">
                  <div class="w-100 text-center text-white">
                    <div class="mb-3">
                      <i class="bi bi-check-circle-fill" style="font-size: 4rem;"></i>
                    </div>
                    <h3 class="modal-title fw-bold mb-2">登録完了おめでとうございます！</h3>
                    <p class="mb-0">${userData.name}様、TomoTripへようこそ</p>
                  </div>
                </div>
                <div class="modal-body px-4 py-4">
                  <div class="alert alert-success border-0 mb-4" style="background: linear-gradient(135deg, #d4edda, #c3e6cb);">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-shield-check text-success me-2" style="font-size: 1.5rem;"></i>
                      <div>
                        <strong>認証完了</strong><br>
                        <small>電話番号と身分証明書の認証が完了し、すべての機能がご利用いただけます</small>
                      </div>
                    </div>
                  </div>
                  
                  <h5 class="mb-3 text-primary">
                    <i class="bi bi-unlock-fill me-2"></i>アンロックされた機能
                  </h5>
                  
                  <div class="row">
                    <div class="col-md-6">
                      <div class="feature-card p-3 mb-3 border rounded" style="background: #f8f9fa;">
                        <div class="d-flex align-items-start">
                          <div class="feature-icon me-3 text-primary">
                            <i class="bi bi-person-lines-fill" style="font-size: 1.5rem;"></i>
                          </div>
                          <div>
                            <h6 class="fw-bold mb-1">ガイド詳細の閲覧</h6>
                            <p class="small text-muted mb-0">すべてのガイドのプロフィール、経歴、料金詳細を確認できます</p>
                          </div>
                        </div>
                      </div>
                      
                      <div class="feature-card p-3 mb-3 border rounded" style="background: #f8f9fa;">
                        <div class="d-flex align-items-start">
                          <div class="feature-icon me-3 text-primary">
                            <i class="bi bi-calendar-plus" style="font-size: 1.5rem;"></i>
                          </div>
                          <div>
                            <h6 class="fw-bold mb-1">ガイド予約機能</h6>
                            <p class="small text-muted mb-0">希望の日時でガイドを予約し、特別な体験を楽しめます</p>
                          </div>
                        </div>
                      </div>
                      
                      <div class="feature-card p-3 mb-3 border rounded" style="background: #f8f9fa;">
                        <div class="d-flex align-items-start">
                          <div class="feature-icon me-3 text-primary">
                            <i class="bi bi-chat-dots" style="font-size: 1.5rem;"></i>
                          </div>
                          <div>
                            <h6 class="fw-bold mb-1">メッセージ機能</h6>
                            <p class="small text-muted mb-0">ガイドと直接やり取りして詳細な相談ができます</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="col-md-6">
                      <div class="feature-card p-3 mb-3 border rounded" style="background: #f8f9fa;">
                        <div class="d-flex align-items-start">
                          <div class="feature-icon me-3 text-primary">
                            <i class="bi bi-heart" style="font-size: 1.5rem;"></i>
                          </div>
                          <div>
                            <h6 class="fw-bold mb-1">お気に入り機能</h6>
                            <p class="small text-muted mb-0">気になるガイドを保存して後から簡単にアクセスできます</p>
                          </div>
                        </div>
                      </div>
                      
                      <div class="feature-card p-3 mb-3 border rounded" style="background: #f8f9fa;">
                        <div class="d-flex align-items-start">
                          <div class="feature-icon me-3 text-primary">
                            <i class="bi bi-star" style="font-size: 1.5rem;"></i>
                          </div>
                          <div>
                            <h6 class="fw-bold mb-1">レビュー投稿</h6>
                            <p class="small text-muted mb-0">体験後にレビューを投稿して他の観光客をサポート</p>
                          </div>
                        </div>
                      </div>
                      
                      <div class="feature-card p-3 mb-3 border rounded" style="background: #f8f9fa;">
                        <div class="d-flex align-items-start">
                          <div class="feature-icon me-3 text-primary">
                            <i class="bi bi-credit-card" style="font-size: 1.5rem;"></i>
                          </div>
                          <div>
                            <h6 class="fw-bold mb-1">安全な決済</h6>
                            <p class="small text-muted mb-0">セキュアな決済システムで安心してお支払いできます</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div class="alert alert-info border-0 mt-4" style="background: linear-gradient(135deg, #d1ecf1, #bee5eb);">
                    <div class="d-flex">
                      <i class="bi bi-info-circle text-info me-2 flex-shrink-0"></i>
                      <div>
                        <strong>次のステップ</strong><br>
                        <small>今すぐお好みのガイドを見つけて、日本での素晴らしい体験を始めましょう！</small>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer border-0 pt-0">
                  <div class="w-100 d-flex justify-content-center gap-3">
                    <button type="button" class="btn btn-success btn-lg px-4" onclick="exploreGuides()">
                      <i class="bi bi-search me-2"></i>ガイドを探す
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-lg" onclick="closeSuccessModal()">
                      後で見る
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // 既存の成功モーダルを削除
        const existingModal = document.getElementById('touristSuccessModal');
        if (existingModal) {
          existingModal.remove();
        }
        
        // 新しいモーダルを追加
        document.body.insertAdjacentHTML('beforeend', successModalHTML);
        
        // 5秒後に自動でガイド探索を促すアニメーション
        setTimeout(() => {
          const exploreBtn = document.querySelector('#touristSuccessModal .btn-success');
          if (exploreBtn) {
            exploreBtn.classList.add('animate__animated', 'animate__pulse');
          }
        }, 5000);
      }
      
      /**
       * ガイド探索に移動（削除済み - 下の包括的なexploreGuides関数を使用）
       */
      // window.exploreGuides = function() {
      //   closeSuccessModal();
      //   // ページトップのガイドセクションにスクロール
      //   document.getElementById('guides').scrollIntoView({ behavior: 'smooth' });
      //   
      //   // 少し遅延してフィルターのヒントを表示
      //   setTimeout(() => {
      //     if (typeof window.showFilterHint === 'function') {
      //       window.showFilterHint();
      //     }
      //   }, 1000);
      // }
      
      /**
       * 成功モーダルを閉じる
       */
      window.closeSuccessModal = function() {
        console.log('🧹 closeSuccessModal開始');
        
        // グローバルクリーンアップを実行
        if (typeof forceCleanupAllModals === 'function') {
          forceCleanupAllModals();
        }
        
        // 追加の強制クリーンアップ
        document.querySelectorAll('.modal, .modal-backdrop, .fade.show').forEach(el => el.remove());
        document.body.className = document.body.className.replace(/modal-[^\s]*/g, '');
        document.body.removeAttribute('style');
        document.documentElement.removeAttribute('style');
        
        console.log('✅ closeSuccessModal完了');
      }
      
      // お問い合わせフォームの送信処理
      const contactForm = document.getElementById('contact-form');
      if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
          e.preventDefault();
          alert('お問い合わせを受け付けました。担当者からの返信をお待ちください。');
          const modal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
          modal.hide();
        });
      }
      
      // もっと見るボタンの機能追加
      const loadMoreButton = document.getElementById('load-more-guides');
      if (loadMoreButton) {
        loadMoreButton.addEventListener('click', function() {
          // 非表示のガイドカードを表示する
          const hiddenGuides = document.querySelectorAll('.hidden-guide');
          hiddenGuides.forEach(guide => {
            guide.classList.remove('hidden-guide');
            // フェードインアニメーション
            guide.style.opacity = 0;
            guide.style.transition = 'opacity 0.5s ease';
            setTimeout(() => {
              guide.style.opacity = 1;
            }, 50);
          });
          
          // すべて表示したらボタンを非表示にする
          if (hiddenGuides.length > 0) {
            this.textContent = 'すべて表示しました';
            this.disabled = true;
            setTimeout(() => {
              this.style.display = 'none';
            }, 2000);
          }
        });
      }
      
      // プロフィール写真のプレビュー機能
      const guideProfilePhoto = document.getElementById('guide-profile-photo');
      const guideProfilePreview = document.getElementById('guide-profile-preview');
      const profilePhotoContainer = document.querySelector('.profile-photo-container');
      
      if (guideProfilePhoto && guideProfilePreview) {
        // ファイル選択時のプレビュー表示
        guideProfilePhoto.addEventListener('change', function(e) {
          if (this.files && this.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
              guideProfilePreview.src = e.target.result;
            }
            
            reader.readAsDataURL(this.files[0]);
          }
        });
        
        // プロフィール写真コンテナをクリックしたらファイル選択を開く
        if (profilePhotoContainer) {
          profilePhotoContainer.addEventListener('click', function() {
            guideProfilePhoto.click();
          });
        }
      }
      
      // 詳細を見るボタンのイベントハンドラ
      document.addEventListener('click', function(e) {
        // 詳細を見るボタンがクリックされた場合（複数の条件をチェック）
        const isDetailsButton = e.target.classList.contains('guide-details-link') ||
                               (e.target.classList.contains('btn-outline-primary') && 
                                (e.target.textContent.includes('詳細を見る') || e.target.textContent.includes('See Details'))) ||
                               e.target.hasAttribute('data-guide-id');
        
        if (isDetailsButton) {
          e.preventDefault();
          
          // タイムスタンプ付きデバッグ
          const timestamp = new Date().toISOString();
          console.log(`[${timestamp}] ガイド詳細ボタンクリック検出`);
          
          // ガイドIDを取得
          let guideId = e.target.getAttribute('data-guide-id');
          if (!guideId) {
            const guideCard = e.target.closest('.guide-card');
            if (guideCard) {
              guideId = guideCard.getAttribute('data-guide-id');
            }
          }
          
          if (!guideId) {
            alert('ガイドIDが見つかりません');
            return;
          }
          
          console.log(`[${timestamp}] 対象ガイドID: ${guideId}`);
          
          // 詳細デバッグ付き認証チェック
          console.log('🔍 ガイド詳細アクセス開始 - ガイドID:', guideId);
          console.log('🔍 ブラウザストレージ全体確認:');
          console.log('localStorage keys:', Object.keys(localStorage));
          console.log('sessionStorage keys:', Object.keys(sessionStorage));
          
          let isAuthenticated = false;
          let userData = null;
          
          // 全てのストレージキーを詳細チェック
          console.log('=== 認証データ詳細チェック ===');
          
          const touristData = localStorage.getItem('touristData');
          console.log('localStorage.touristData:', touristData);
          
          const sessionData = sessionStorage.getItem('currentUser');
          console.log('sessionStorage.currentUser:', sessionData);
          
          const backup1 = localStorage.getItem('auth_backup_1');
          console.log('localStorage.auth_backup_1:', backup1);
          
          const backup2 = localStorage.getItem('auth_backup_2');
          console.log('localStorage.auth_backup_2:', backup2);
          
          // メイン認証チェック
          if (touristData) {
            try {
              userData = JSON.parse(touristData);
              console.log('パース済みuserData:', userData);
              console.log('userData.type:', userData?.type);
              console.log('userData.isAuthenticated:', userData?.isAuthenticated);
              
              if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
                isAuthenticated = true;
                console.log('✅ 認証成功 - ユーザー:', userData.name);
              } else {
                console.log('❌ 認証失敗 - 条件不一致');
              }
            } catch (e) {
              console.error('❌ JSONパースエラー:', e);
            }
          } else {
            console.log('❌ touristDataが存在しません');
          }
          

          
          console.log('🔍 認証管理システム結果:');
          console.log('  - isAuthenticated:', isAuthenticated);
          console.log('  - userData:', userData);
          
          if (isAuthenticated && userData) {
            console.log('🎉 認証済みユーザー - ガイド詳細モーダル表示:', guideId);
            console.log('📊 認証データ詳細:', {
              name: userData.name,
              type: userData.type,
              isAuthenticated: userData.isAuthenticated,
              id: userData.id
            });
            showGuideDetailModal(guideId);
            return;
          }
          
          // 認証が見つからない場合 - バックアップから復旧を試行
          console.log('認証データが見つからないため復旧を試行');
          
          const backupKeys = ['auth_backup_1', 'auth_backup_2', 'currentUser'];
          let recovered = false;
          
          for (const key of backupKeys) {
            try {
              const storage = key === 'currentUser' ? sessionStorage : localStorage;
              const backupData = storage.getItem(key);
              if (backupData) {
                const backupUserData = JSON.parse(backupData);
                if (backupUserData && backupUserData.type === 'tourist' && backupUserData.isAuthenticated) {
                  console.log('バックアップから復旧成功:', backupUserData.name);
                  localStorage.setItem('touristData', backupData);
                  sessionStorage.setItem('currentUser', backupData);
                  userData = backupUserData;
                  isAuthenticated = true;
                  recovered = true;
                  break;
                }
              }
            } catch (e) {
              continue;
            }
          }
          
          if (recovered) {
            console.log('復旧成功 - ガイド詳細を表示');
            showGuideDetailModal(guideId);
            return;
          }
          
          console.log('認証データが見つからない - ログインプロンプト表示');
          sessionStorage.setItem('pendingGuideId', guideId);
          showTouristLoginPrompt(guideId);
        }
      });
      
      // 観光客ログインを促すモーダル表示
      function showTouristLoginPrompt(guideId) {
        console.log('観光客登録促進モーダルを表示:', guideId);
        
        // カスタムモーダルを作成
        const modalHTML = `
          <div class="modal fade" id="loginPromptModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header border-0 text-center pb-0">
                  <div class="w-100">
                    <i class="bi bi-lock-fill text-warning" style="font-size: 3rem;"></i>
                    <h4 class="modal-title mt-3">ログインが必要です</h4>
                  </div>
                </div>
                <div class="modal-body text-center">
                  <p class="mb-4">選択されたガイドの詳細情報を見るには、観光客アカウントが必要です。</p>
                  
                  <div class="alert alert-info mb-4">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>初回ご利用の方へ：</strong><br>
                    まだアカウントをお持ちでない場合は、新規登録（無料）をお願いします。登録後、すぐにガイド詳細をご覧いただけます。
                  </div>
                  
                  <div class="bg-light rounded p-3 mb-4">
                    <h6 class="mb-2">ログイン後にできること</h6>
                    <div class="text-start small">
                      <div class="mb-1"><i class="bi bi-check-circle-fill text-success me-2"></i>ガイドの詳細プロフィール閲覧</div>
                      <div class="mb-1"><i class="bi bi-check-circle-fill text-success me-2"></i>ガイドとの直接予約・メッセージ</div>
                      <div class="mb-1"><i class="bi bi-check-circle-fill text-success me-2"></i>レビューの閲覧・投稿</div>
                      <div><i class="bi bi-check-circle-fill text-success me-2"></i>お気に入りガイドの保存</div>
                    </div>
                  </div>
                  
                  <div class="d-grid gap-2">
                    <button type="button" class="btn btn-success btn-lg" onclick="showTouristRegistration()">
                      <i class="bi bi-person-plus me-2"></i>新規登録（無料・1分で完了）
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="showTouristLogin()">
                      <i class="bi bi-box-arrow-in-right me-2"></i>既存アカウントでログイン
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                      後で利用する
                    </button>
                  </div>
                  
                  <div class="mt-3 border-top pt-3">
                    <div class="d-flex align-items-center justify-content-center">
                      <i class="bi bi-shield-check text-success me-2"></i>
                      <small class="text-muted">安全で簡単な登録プロセス</small>
                    </div>
                    <div class="small text-muted mt-1">
                      新規登録は完全無料です。メール認証のみで、すぐにご利用いただけます。
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        
        // 既存のモーダルを削除
        const existingModal = document.getElementById('loginPromptModal');
        if (existingModal) {
          existingModal.remove();
        }
        
        // 新しいモーダルを追加
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // モーダルを表示
        const modal = new bootstrap.Modal(document.getElementById('loginPromptModal'));
        modal.show();
      }
      
      // 観光客ログインを表示
      window.showTouristLogin = function() {
        // ログイン促進モーダルを閉じる
        const promptModal = bootstrap.Modal.getInstance(document.getElementById('loginPromptModal'));
        if (promptModal) {
          promptModal.hide();
        }
        
        // 観光客ログインモーダルを表示
        setTimeout(() => {
          const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
          loginModal.show();
        }, 300);
      };
      
      // 観光客新規登録を表示
      window.showTouristRegistration = function() {
        // ログイン促進モーダルを閉じる
        const promptModal = bootstrap.Modal.getInstance(document.getElementById('loginPromptModal'));
        if (promptModal) {
          promptModal.hide();
        }
        
        // 観光客登録モーダルを表示
        setTimeout(() => {
          const registerModal = new bootstrap.Modal(document.getElementById('registerTouristModal'));
          registerModal.show();
        }, 300);
      };

      // ログイン必須ページから戻ってきた場合の処理
      const shouldOpenLogin = sessionStorage.getItem('openLoginAfterReturn');
      if (shouldOpenLogin === 'true') {
        sessionStorage.removeItem('openLoginAfterReturn');
        
        // 少し遅延してからログインモーダルを開く
        setTimeout(() => {
          const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
          loginModal.show();
        }, 500);
      }
    });
  </script>
  
  <!-- 包括的フィルターシステム削除済み -->
  
  <!-- フィルターチュートリアルシステム -->
  <script src="filter-tutorial.js"></script>
  
  <!-- 登録ボタン修正システム - 一時無効化 -->
  <!-- <script src="registration-fix.js"></script> -->
  
  <!-- 言語切り替え機能 - 一時無効化 -->
  <!-- <script src="minimal-language.js"></script> -->
  
  <!-- 改良された言語切り替え機能 - 一時無効化 -->
  <!-- <script src="improved-language-switcher.js"></script> -->
  
  <!-- シンプル動作修正スクリプト - 一時無効化 -->
  <!-- <script src="simple-working-fix.js"></script> -->
  
  <!-- 直接翻訳システム削除済み -->
  
  <!-- 70人ガイド表示システム - 削除済み -->
  
  <!-- 他のスクリプトは一時無効化（競合防止） -->
  <!-- <script src="bootstrap-disable-fix.js"></script> -->
  <!-- <script src="nuclear-scroll-fix.js"></script> -->
  <!-- <script src="direct-scroll-force.js"></script> -->
  
  <!-- コンソールデバッグヘルパー削除済み -->
  
  <!-- スクロール問題修正システム - 削除済み -->
  
  <!-- 深層スクロール調査システム - 削除済み -->
  
  <!-- Bootstrap Modal スクロール修正削除済み -->
  
  <!-- 究極スクロール復元システム - 削除済み -->
  
  <!-- 完全独立言語システム削除済み -->
  
  <!-- 専用ボタン翻訳機能 - 一時無効化 -->
  <!-- <script src="button-translator.js"></script> -->
  
  <!-- 統一認証システム -->
  <script src="unified-auth-system.js"></script>
  
  <!-- 認証テストヘルパー -->
  <script src="auth-test-helper.js"></script>
  
  <!-- セクション別の専用翻訳スクリプト - 一時無効化 -->
  <!-- <script src="benefits-translator.js"></script> -->
  <!-- <script src="dropdown-translator.js"></script> -->
  <!-- <script src="direct-benefit-card-translator.js"></script> -->
  <!-- <script src="benefit-html-inspector.js"></script> -->
  <!-- <script src="guide-cards-translator.js"></script> -->
  
  <!-- ガイド登録処理 -->
  <script src="guide_registration_handler.js"></script>
  
  <!-- ガイドログイン機能 -->
  <!-- テストガイドデータ生成・表示スクリプト - 一時無効化 -->
  <!-- <script src="generate-guide-data.js"></script> -->
  <!-- <script src="add-guide-data.js"></script> -->
  <script src="guide-login.js"></script>
  
  <!-- ガイドログインデバッグツール削除済み -->
  
  <!-- 観光客ログイン機能 -->

  
  <!-- セッションデバッグ機能 -->
  <!-- セッションデバッガー削除済み -->
  
  <!-- アクセス制御機能 -->

  
  <!-- デバイス別の最適化スクリプト - 各環境でのみ実行 -->

  <!-- desktop-fixes.js 削除済み -->
  
  <!-- 共有言語ユーティリティ - 言語設定の保存と復元 -->
  <script src="shared-language-utils.js"></script>
  
  <!-- ナビゲーションボタン -->
  <script src="navigation-buttons.js"></script>
  
  <!-- ガイドタグ表示 -->
  <script src="guide-tags-display.js"></script>
  
  <!-- ガイドデータAPI (新機能) -->
  <script src="guide-data-storage-api.js"></script>
  
  <!-- ガイドデータ初期化 (新機能) -->
  <script src="initialize-guide-data.js"></script>
  
  <!-- ガイドカードデータ抽出器 (修正版) -->
  <script src="guide-card-extractor.js"></script>
  
  <!-- ガイド詳細データ管理 -->

  <script src="data-reset.js"></script>
  <script src="password-toggle.js"></script>
  
  <!-- モーダルの読み込み -->
  <div id="modals-container"></div>
  <!-- 問題のある追加スクリプトも無効化 -->
  <!-- 削除済みスクリプト: auto-fill-system.js, load-70-guides.js, filter-toggle.js -->
  
  <script>
    // モーダルHTMLを読み込む
    fetch('modals.html')
      .then(response => response.text())
      .then(html => {
        document.getElementById('modals-container').innerHTML = html;
        initializeRegistrationModals();
      })
      .catch(error => console.error('モーダル読み込みエラー:', error));

    // 登録モーダル初期化
    function initializeRegistrationModals() {
      // 新規登録ドロップダウンからの遷移
      const guideRegisterLinks = document.querySelectorAll('[data-bs-target="#registerGuideModal"]');
      const touristRegisterLinks = document.querySelectorAll('[data-bs-target="#registerTouristModal"]');
      
      guideRegisterLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const modal = new bootstrap.Modal(document.getElementById('registerGuideModal'));
          modal.show();
        });
      });
      
      touristRegisterLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const modal = new bootstrap.Modal(document.getElementById('registerTouristModal'));
          modal.show();
        });
      });

      // ガイド登録フォーム送信
      const submitGuideBtn = document.getElementById('submitGuideRegistration');
      if (submitGuideBtn) {
        submitGuideBtn.addEventListener('click', function() {
          handleGuideRegistration();
        });
      }

      // 観光客登録フォーム送信
      const submitTouristBtn = document.getElementById('submitTouristRegistration');
      if (submitTouristBtn) {
        submitTouristBtn.addEventListener('click', function() {
          handleTouristRegistration();
        });
      }
    }

    // ガイド登録処理
    function handleGuideRegistration() {
      const form = document.getElementById('guideRegistrationForm');
      const formData = new FormData(form);
      
      const name = formData.get('name');
      const email = formData.get('email');
      const sessionFee = formData.get('sessionFee');
      
      if (!name || !email) {
        showNotification('必須項目を入力してください', 'error');
        return;
      }
      
      if (sessionFee < 6000) {
        showNotification('セッション料金は最低¥6,000以上に設定してください', 'error');
        return;
      }

      const languages = Array.from(form.querySelectorAll('input[name="languages"]:checked')).map(cb => cb.value);
      if (languages.length === 0) {
        showNotification('対応言語を少なくとも1つ選択してください', 'error');
        return;
      }

      const verifyStatus = document.getElementById('verifyStatus');
      if (verifyStatus && verifyStatus.textContent !== '認証済み') {
        showNotification('電話番号認証を完了してください', 'error');
        return;
      }

      showNotification('ガイド登録を受け付けました。審査完了までお待ちください。', 'success');
      
      setTimeout(() => {
        const modal = bootstrap.Modal.getInstance(document.getElementById('registerGuideModal'));
        if (modal) {
          modal.hide();
        }
      }, 2000);
    }

    // 観光客認証データ保護システム
    function protectTouristStorage(touristData) {
      console.log('🛡️ 観光客認証データ保護を開始');
      
      // オリジナルのストレージメソッドを保存
      const originalRemoveItem = localStorage.removeItem;
      const originalClear = localStorage.clear;
      const originalSessionRemove = sessionStorage.removeItem;
      const originalSessionClear = sessionStorage.clear;
      
      // localStorage.removeItem を保護
      localStorage.removeItem = function(key) {
        if (window.protectTouristAuth && (key === 'touristData' || key.startsWith('touristBackup_'))) {
          console.log('🚫 観光客データの削除を阻止:', key);
          return;
        }
        return originalRemoveItem.call(this, key);
      };
      
      // localStorage.clear を保護
      localStorage.clear = function() {
        if (window.protectTouristAuth) {
          console.log('🚫 localStorage全削除を阻止 - 観光客データを保護');
          // 観光客データ以外のみクリア
          const keysToKeep = [];
          for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key === 'touristData' || key.startsWith('touristBackup_')) {
              keysToKeep.push({ key, value: localStorage.getItem(key) });
            }
          }
          originalClear.call(this);
          keysToKeep.forEach(item => {
            localStorage.setItem(item.key, item.value);
          });
          return;
        }
        return originalClear.call(this);
      };
      
      // sessionStorage.removeItem を保護
      sessionStorage.removeItem = function(key) {
        if (window.protectTouristAuth && key === 'currentUser') {
          console.log('🚫 セッション認証データの削除を阻止:', key);
          return;
        }
        return originalSessionRemove.call(this, key);
      };
      
      // sessionStorage.clear を保護
      sessionStorage.clear = function() {
        if (window.protectTouristAuth) {
          console.log('🚫 セッションストレージ全削除を阻止 - 観光客データを保護');
          const userData = sessionStorage.getItem('currentUser');
          originalClear.call(this);
          if (userData) {
            sessionStorage.setItem('currentUser', userData);
          }
          return;
        }
        return originalClear.call(this);
      };
      
      // 定期的なデータ復旧チェック
      const protectionInterval = setInterval(() => {
        if (!window.protectTouristAuth) {
          clearInterval(protectionInterval);
          return;
        }
        
        const currentData = localStorage.getItem('touristData');
        if (!currentData && window.touristAuthData) {
          console.log('🔄 観光客データが消失 - 自動復旧');
          localStorage.setItem('touristData', JSON.stringify(window.touristAuthData));
          sessionStorage.setItem('currentUser', JSON.stringify(window.touristAuthData));
        }
      }, 2000);
    }

    // 観光客登録処理
    function handleTouristRegistration() {
      const form = document.getElementById('touristRegistrationForm');
      const formData = new FormData(form);
      
      const name = formData.get('name');
      const email = formData.get('email');
      const password = formData.get('password');
      
      if (!name || !email || !password) {
        showNotification('必須項目を入力してください', 'error');
        return;
      }
      
      // 観光客データを作成してログイン状態にする
      const touristData = {
        id: 'tourist_' + Date.now(),
        name: name,
        email: email,
        type: 'tourist',
        loginTime: new Date().toISOString(),
        isAuthenticated: true,
        registrationDate: new Date().toISOString()
      };
      
      // 直接保存 - 確実な方法で実装
      console.log('💾 観光客データ保存開始:', touristData);
      
      try {
        const dataString = JSON.stringify(touristData);
        
        // 複数の場所に保存
        localStorage.setItem('touristData', dataString);
        sessionStorage.setItem('currentUser', dataString);
        localStorage.setItem('auth_backup_1', dataString);
        localStorage.setItem('auth_backup_2', dataString);
        sessionStorage.setItem('auth_session_backup', dataString);
        
        console.log('✅ 全ての保存場所にデータ保存完了');
        console.log('localStorage確認:', localStorage.getItem('touristData'));
        console.log('sessionStorage確認:', sessionStorage.getItem('currentUser'));
        
        // メモリにも保存
        window.touristAuthData = touristData;
        window.protectTouristAuth = true;
        
        // TouristAuthManagerに登録
        if (window.TouristAuthManager) {
          window.TouristAuthManager.save(touristData);
        }
        
        // 即座にUI更新を強制実行
        console.log('登録直後のUI更新を実行');
        updateLoginStateUI();
        
        // 少し遅延してもう一度確実に実行
        setTimeout(() => {
          updateLoginStateUI();
        }, 500);
        
        // さらに遅延して最終確認
        setTimeout(() => {
          updateLoginStateUI();
          // 登録完了フラグをクリア
          window.isRegistering = false;
        }, 1000);
        
      } catch (e) {
        console.error('❌ データ保存エラー:', e);
      }
      
      // 登録直後の認証確認
      setTimeout(() => {
        console.log('=== 登録直後認証確認 ===');
        console.log('localStorage keys:', Object.keys(localStorage));
        console.log('localStorage.touristData:', localStorage.getItem('touristData'));
        console.log('sessionStorage.currentUser:', sessionStorage.getItem('currentUser'));
        
        // 直接的な認証チェック
        const savedData = localStorage.getItem('touristData');
        if (savedData) {
          try {
            const parsed = JSON.parse(savedData);
            console.log('認証データ正常:', parsed.name, parsed.isAuthenticated);
          } catch (e) {
            console.error('認証データ破損:', e);
          }
        } else {
          console.error('認証データが保存されていません');
        }
      }, 100);
      
      showNotification('観光客登録が完了しました。ログインしました！', 'success');
      
      // モーダルを閉じる
      setTimeout(() => {
        const modal = bootstrap.Modal.getInstance(document.getElementById('registerTouristModal'));
        if (modal) {
          modal.hide();
        }
        
        // ペンディング中のガイドIDがあれば詳細情報を表示
        const pendingGuideId = sessionStorage.getItem('pendingGuideId');
        if (pendingGuideId) {
          sessionStorage.removeItem('pendingGuideId');
          showNotification('ガイド詳細を表示します...', 'success');
          
          // 登録完了後はメインページでガイド詳細を表示
          setTimeout(() => {
            // ナビゲーションを更新してログイン状態を反映
            updateLoginStateUI();
            
            // ガイド詳細モーダルまたは情報を表示
            showGuideDetailsAfterLogin(pendingGuideId);
          }, 1000);
        } else {
          // 登録完了後のUI更新を強制実行
          console.log('登録完了 - UI更新開始');
          
          // 即座にUI更新
          updateLoginStateUI();
          
          // 少し遅延させてもう一度UI更新を確実に実行
          setTimeout(() => {
            console.log('遅延UI更新実行');
            updateLoginStateUI();
          }, 100);
          
          // さらに確実にするため500ms後にも実行
          setTimeout(() => {
            console.log('最終UI更新確認');
            const touristData = localStorage.getItem('touristData');
            if (touristData) {
              console.log('認証データ確認済み - UI最終更新');
              updateLoginStateUI();
            }
          }, 500);
        }
      }, 2000);
    }

    // ログイン状態UIを更新する関数
    function updateLoginStateUI() {
      console.log('🔄 ログイン状態UI更新開始');
      
      // 認証データを取得
      const touristData = localStorage.getItem('touristData');
      if (!touristData) {
        console.log('認証データなし - ゲストUI維持');
        return;
      }
      
      try {
        const userData = JSON.parse(touristData);
        if (userData && userData.type === 'tourist' && userData.isAuthenticated) {
          console.log('✅ ログイン済みユーザー:', userData.name);
          
          // ログインボタンを隠す
          const loginBtn = document.querySelector('button[data-bs-target="#loginModal"]');
          if (loginBtn) {
            loginBtn.style.display = 'none';
            console.log('ログインボタン非表示');
          }
          
          // 新規登録ドロップダウンを正確に特定
          const registerDropdown = document.getElementById('registerDropdown');
          console.log('登録ドロップダウン要素:', registerDropdown);
          
          if (registerDropdown) {
            console.log('現在のボタンテキスト:', registerDropdown.textContent);
            
            // 新規登録ボタンをユーザー名表示に変更
            registerDropdown.innerHTML = `
              <i class="bi bi-person-circle me-1"></i>
              ${userData.name}さん
              <i class="bi bi-chevron-down ms-1"></i>
            `;
            // ドロップダウン無効化 - 直接ボタンシステムを維持
            
            console.log('ボタンテキストを更新:', userData.name);
            
            // ドロップダウンメニューを更新
            const dropdownMenu = registerDropdown.nextElementSibling;
            if (dropdownMenu && dropdownMenu.classList.contains('dropdown-menu')) {
              dropdownMenu.innerHTML = `
                <li><a class="dropdown-item" href="#" onclick="showUserProfile()">
                  <i class="bi bi-person me-2"></i>プロフィール
                </a></li>
                <li><a class="dropdown-item" href="#" onclick="showBookingHistory()">
                  <i class="bi bi-calendar-check me-2"></i>予約履歴
                </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="#" onclick="logout()">
                  <i class="bi bi-box-arrow-right me-2"></i>ログアウト
                </a></li>
              `;
              console.log('ドロップダウンメニュー更新完了');
            }
          } else {
            console.warn('登録ドロップダウン要素が見つかりません');
          }
          
          // ページ属性を設定
          document.body.setAttribute('data-user-authenticated', 'true');
          document.body.setAttribute('data-user-type', 'tourist');
          
          console.log('✅ UI更新完了 - ユーザー名表示中');
        }
      } catch (e) {
        console.error('UI更新エラー:', e);
      }
    }
    
    // ログアウト関数
    function logout() {
      console.log('ログアウト処理開始');
      
      // 認証データを削除
      localStorage.removeItem('touristData');
      sessionStorage.removeItem('currentUser');
      localStorage.removeItem('auth_backup_1');
      localStorage.removeItem('auth_backup_2');
      sessionStorage.removeItem('auth_session_backup');
      
      // メモリクリア
      window.touristAuthData = null;
      window.protectTouristAuth = false;
      
      // UIをリセット
      location.reload();
    }
    
    // ユーザープロフィール表示
    function showUserProfile() {
      alert('プロフィール機能は開発中です');
    }
    
    // 予約履歴表示
    function showBookingHistory() {
      alert('予約履歴機能は開発中です');
    }

    // ナビゲーション機能
    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }
    
    function scrollToSection(sectionId) {
      const element = document.getElementById(sectionId);
      if (element) {
        element.scrollIntoView({
          behavior: 'smooth',
          block: 'start'
        });
      } else {
        console.log('セクションが見つかりません:', sectionId);
      }
    }
    
    // 言語選択ドロップダウンの設定
    function setupLanguageDropdown() {
      const languageItems = document.querySelectorAll('[data-lang]');
      // 言語ドロップダウンは削除済み - 直接ボタンシステムに移行
          
          // 言語変更処理
          if (typeof changeLanguage === 'function') {
            changeLanguage(lang);
          } else {
            console.log('言語を変更:', langText);
            showNotification(`言語を${langText}に変更しました`, 'success');
          }
        });
      });
    }
    
    // 言語変更処理（直接実行版）
    function changeLanguageDirectly(lang) {
      // 言語ドロップダウンは削除済み - 直接ボタンシステムに移行
      
      console.log('言語を変更:', langText);
      showNotification(`言語を${langText}に変更しました`, 'success');
      
      // 実際の翻訳処理があればここで実行
      if (typeof changeLanguage === 'function') {
        changeLanguage(lang);
      }
    }
    
    // 新規登録ドロップダウンの設定
    function setupRegisterDropdown() {
      const registerDropdown = document.getElementById('registerDropdown');
      
      if (registerDropdown) {
        console.log('新規登録ドロップダウンを初期化');
        
        // ドロップダウンアイテムのクリックイベント
        const dropdownItems = document.querySelectorAll('.register-dropdown .dropdown-item');
        dropdownItems.forEach(item => {
          item.addEventListener('click', function(e) {
            console.log('新規登録ボタンがクリックされました');
            // Bootstrapモーダルの処理は既存のdata-bs-toggle属性で処理される
          });
        });
      }
    }

    // 通知表示関数
    function showNotification(message, type = 'info') {
      let alertContainer = document.getElementById('alert-container');
      if (!alertContainer) {
        alertContainer = document.createElement('div');
        alertContainer.id = 'alert-container';
        alertContainer.style.cssText = 'position: fixed; top: 20px; right: 20px; max-width: 400px; z-index: 9999;';
        document.body.appendChild(alertContainer);
      }
      
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} alert-dismissible fade show`;
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      
      alertContainer.appendChild(alertDiv);
      
      setTimeout(() => {
        if (alertDiv.parentNode) {
          alertDiv.remove();
        }
      }, 5000);
    }

    // ログイン状態UIの更新 - 強化版
    function updateLoginStateUI() {
      console.log('🎨 ログイン状態UIを更新中...');
      
      // 認証状態を再確認
      const isAuth = isUserAuthenticated();
      const touristData = localStorage.getItem('touristData') || sessionStorage.getItem('currentUser');
      
      if (isAuth && touristData) {
        try {
          const userData = JSON.parse(touristData);
          console.log('✅ 認証済みユーザーUIを設定:', userData.name);
          
          // ナビゲーションバーのログインボタンを非表示
          const loginBtn = document.querySelector('a[data-bs-target="#loginModal"]');
          if (loginBtn) {
            loginBtn.style.display = 'none';
          }
          
          // 新規登録ボタンを非表示
          // ドロップダウン要素は削除済み - 直接ボタンシステムを維持
          
          // 既存のユーザーステータスを削除
          const existingStatus = document.getElementById('user-status');
          if (existingStatus) {
            existingStatus.remove();
          }
          
          // 新しいユーザーステータスを追加
          const navbar = document.querySelector('.navbar-nav');
          if (navbar) {
            const userStatus = document.createElement('li');
            userStatus.className = 'nav-item';
            userStatus.id = 'user-status';
            userStatus.innerHTML = `
              <div class="nav-link text-success d-flex align-items-center">
                <i class="bi bi-person-check-fill me-2"></i>
                <span>${userData.name}さん</span>
                <small class="ms-2 badge bg-success">観光客</small>
              </div>
            `;
            navbar.appendChild(userStatus);
          }
          
          // ページ全体にログイン状態を反映
          document.body.setAttribute('data-user-authenticated', 'true');
          document.body.setAttribute('data-user-type', 'tourist');
          
        } catch (e) {
          console.error('❌ ログイン状態UI更新エラー:', e);
          resetToGuestUI();
        }
      } else {
        console.log('❌ 未認証状態 - ゲストUIに設定');
        resetToGuestUI();
      }
    }

    // ゲスト状態UIにリセット
    function resetToGuestUI() {
      console.log('🔄 ゲストUIにリセット');
      
      // ログインボタンを表示
      const loginBtn = document.querySelector('a[data-bs-target="#loginModal"]');
      if (loginBtn) {
        loginBtn.style.display = '';
      }
      
      // 新規登録ボタンを表示
      // ドロップダウン要素は削除済み - 直接ボタンシステムを維持
      
      // ユーザーステータスを削除
      const userStatus = document.getElementById('user-status');
      if (userStatus) {
        userStatus.remove();
      }
      
      // ページ属性をリセット
      document.body.removeAttribute('data-user-authenticated');
      document.body.removeAttribute('data-user-type');
    }

    // 登録完了後のガイド詳細表示
    function showGuideDetailsAfterLogin(guideId) {
      showNotification(`ガイド詳細が閲覧可能になりました。ガイド${guideId}をクリックしてください。`, 'success');
      
      // ガイドカードにスクロール
      const guideCard = document.querySelector(`[data-guide-id="${guideId}"]`);
      if (guideCard) {
        guideCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        // カードを一時的にハイライト
        guideCard.style.boxShadow = '0 0 15px rgba(0, 123, 255, 0.5)';
        guideCard.style.border = '2px solid #007bff';
        
        setTimeout(() => {
          guideCard.style.boxShadow = '';
          guideCard.style.border = '';
        }, 3000);
      }
    }

    // 「ガイドを探す」ボタンの処理
    function exploreGuides() {
      console.log('🚀 exploreGuides関数が開始されました');
      
      // グローバルクリーンアップを即座に実行
      forceCleanupAllModals();
      
      // 追加の即座の強制クリーンアップ
      document.querySelectorAll('.modal, .modal-backdrop, .fade.show').forEach(el => el.remove());
      document.body.className = document.body.className.replace(/modal-[^\s]*/g, '');
      document.body.removeAttribute('style');
      document.documentElement.removeAttribute('style');
      
      // ガイドセクションに即座にスクロール
      console.log('📍 ガイドセクションにスクロール開始');
      const guidesSection = document.getElementById('guides');
      if (guidesSection) {
        guidesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // ガイドカードを強調表示
        setTimeout(() => {
          const guideCards = document.querySelectorAll('.guide-card');
          console.log(`🎨 ${guideCards.length}個のガイドカードを強調表示`);
          guideCards.forEach((card, index) => {
            setTimeout(() => {
              card.style.transform = 'scale(1.02)';
              card.style.boxShadow = '0 8px 25px rgba(0, 123, 255, 0.15)';
              
              setTimeout(() => {
                card.style.transform = '';
                card.style.boxShadow = '';
              }, 1000);
            }, index * 200);
          });
        }, 100);
      } else {
        console.error('❌ ガイドセクションが見つかりません');
      }
      
      showNotification('ガイド一覧をご覧ください。お気に入りのガイドをクリックして詳細を確認できます。', 'success');
      console.log('✅ exploreGuides処理完了');
    }

    // グローバルにexploreGuides関数を設定
    window.exploreGuides = exploreGuides;

    // 「後で見る」ボタンの処理
    function closeSuccessModal() {
      const successModal = bootstrap.Modal.getInstance(document.getElementById('touristSuccessModal'));
      if (successModal) {
        successModal.hide();
      }
      
      // モーダル要素とバックドロップを強制削除
      setTimeout(() => {
        const modalElement = document.getElementById('touristSuccessModal');
        if (modalElement) {
          modalElement.remove();
        }
        
        // バックドロップを強制削除
        const backdrops = document.querySelectorAll('.modal-backdrop');
        backdrops.forEach(backdrop => backdrop.remove());
        
        // body要素からモーダル関連のクラスを削除
        document.body.classList.remove('modal-open');
        document.body.style.overflow = '';
        document.body.style.paddingRight = '';
        
        // ホームページの上部にスクロール
        window.scrollTo({ top: 0, behavior: 'smooth' });
        
        showNotification('いつでもガイド一覧からお選びいただけます。', 'info');
      }, 100);
    }

    // ガイド詳細モーダルを表示（認証済みユーザー向け）
    function showGuideDetailModal(guideId) {
      const guideData = getGuideDataById(guideId);
      if (!guideData) {
        showNotification('ガイド情報が見つかりません。', 'error');
        return;
      }

      const modalHTML = `
        <div class="modal fade" id="guideDetailModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header border-0 bg-primary text-white">
                <h5 class="modal-title">
                  <i class="bi bi-person-circle me-2"></i>${guideData.name}さんのプロフィール
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="row">
                  <div class="col-md-4 text-center">
                    <img src="${guideData.image}" class="rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;" alt="${guideData.name}">
                    <div class="mb-3">
                      <span class="badge bg-primary fs-6">${guideData.fee}/セッション</span>
                    </div>
                    <div class="text-warning mb-3">
                      ${'★'.repeat(Math.floor(guideData.rating))}${'☆'.repeat(5 - Math.floor(guideData.rating))}
                      <span class="text-dark ms-1">${guideData.rating}</span>
                    </div>
                  </div>
                  <div class="col-md-8">
                    <h6><i class="bi bi-geo-alt-fill text-primary me-2"></i>活動エリア</h6>
                    <p class="mb-3">${guideData.location}</p>
                    
                    <h6><i class="bi bi-translate text-primary me-2"></i>対応言語</h6>
                    <p class="mb-3">
                      ${guideData.languages.map(lang => `<span class="badge bg-light text-dark me-1">${lang}</span>`).join('')}
                    </p>
                    
                    <h6><i class="bi bi-person-lines-fill text-primary me-2"></i>ガイド紹介</h6>
                    <p class="mb-3">${guideData.description}</p>
                    
                    <h6><i class="bi bi-star-fill text-primary me-2"></i>得意な分野</h6>
                    <p class="mb-3">
                      ${guideData.keywords.map(keyword => `<span class="badge bg-secondary me-1">${keyword}</span>`).join('')}
                    </p>
                  </div>
                </div>
                
                <div class="alert alert-success mt-4">
                  <i class="bi bi-check-circle-fill me-2"></i>
                  <strong>認証済み観光客</strong> - このガイドに予約リクエストを送ることができます
                </div>
              </div>
              <div class="modal-footer border-0">
                <button type="button" class="btn btn-success btn-lg flex-fill" onclick="requestBooking('${guideId}')">
                  <i class="bi bi-calendar-plus me-2"></i>予約リクエストを送る
                </button>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">閉じる</button>
              </div>
            </div>
          </div>
        </div>
      `;

      // 既存のモーダルを削除
      const existingModal = document.getElementById('guideDetailModal');
      if (existingModal) {
        existingModal.remove();
      }

      // 新しいモーダルを追加
      document.body.insertAdjacentHTML('beforeend', modalHTML);

      // モーダルを表示
      const modal = new bootstrap.Modal(document.getElementById('guideDetailModal'));
      modal.show();
    }

    // ガイドIDからガイドデータを取得
    function getGuideDataById(guideId) {
      const guides = {
        '1': {
          name: '清水 宏美',
          image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop&crop=face',
          fee: '¥6,000',
          rating: 4.5,
          location: '石川県 金沢市',
          languages: ['日本語', '英語'],
          description: '金沢の伝統文化と歴史に精通したガイドです。兼六園、金沢城、ひがし茶屋街などの名所から、地元の人だけが知る隠れた魅力スポットまでご案内します。',
          keywords: ['歴史', '文化', '伝統工芸', 'グルメ']
        },
        '2': {
          name: '藤井 直美',
          image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop&crop=face',
          fee: '¥10,000',
          rating: 4.0,
          location: '千葉県 千葉市',
          languages: ['日本語', '英語', '中国語'],
          description: '千葉県を拠点に活動しているガイドです。成田山新勝寺や九十九里浜などの観光地から、地元グルメまで幅広くご案内できます。',
          keywords: ['自然', '寺社仏閣', '海', 'グルメ']
        },
        '3': {
          name: '小川 博文',
          image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop&crop=face',
          fee: '¥20,000',
          rating: 3.5,
          location: '奈良県 奈良市',
          description: '奈良の鹿と歴史的建造物を愛するガイドです。東大寺、春日大社、奈良公園での特別な体験をお約束します。',
          languages: ['日本語', '英語(基礎)'],
          keywords: ['歴史', '動物', '寺社仏閣', '写真スポット']
        }
      };
      
      return guides[guideId] || null;
    }

    // 予約リクエスト機能
    function requestBooking(guideId) {
      const modal = bootstrap.Modal.getInstance(document.getElementById('guideDetailModal'));
      if (modal) {
        modal.hide();
      }
      
      setTimeout(() => {
        showNotification(`ガイド${guideId}への予約リクエスト機能は開発中です。現在はガイド詳細の閲覧のみ可能です。`, 'info');
      }, 300);
    }

    // グローバルモーダルクリーンアップ関数
    function forceCleanupAllModals() {
      console.log('🧹 グローバルモーダルクリーンアップ開始');
      
      // すべてのBootstrapモーダルインスタンスを閉じる
      const allModalElements = document.querySelectorAll('.modal');
      allModalElements.forEach(modalEl => {
        const modalInstance = bootstrap.Modal.getInstance(modalEl);
        if (modalInstance) {
          console.log('🔒 モーダルインスタンスを閉じる:', modalEl.id);
          modalInstance.hide();
        }
      });
      
      // 物理的にすべてのモーダル要素を削除
      setTimeout(() => {
        // すべてのモーダル要素
        document.querySelectorAll('.modal').forEach(el => el.remove());
        
        // すべてのバックドロップ
        document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
        
        // すべてのfade要素（モーダル関連の可能性）
        document.querySelectorAll('.fade.show').forEach(el => {
          if (el.classList.contains('modal') || el.getAttribute('id')?.includes('modal')) {
            el.remove();
          }
        });
        
        // body要素の完全リセット
        document.body.classList.remove('modal-open');
        document.body.style.cssText = '';
        document.documentElement.style.cssText = '';
        
        // イベントリスナーのクリーンアップ
        const events = ['hidden.bs.modal', 'hide.bs.modal', 'show.bs.modal', 'shown.bs.modal'];
        events.forEach(eventType => {
          document.removeEventListener(eventType, arguments.callee);
        });
        
        console.log('✅ グローバルモーダルクリーンアップ完了');
      }, 100);
    }

    // 認証状態の永続化と検証
    function validateAndRestoreAuthState() {
      console.log('🔐 認証状態の検証と復元を開始');
      
      const touristData = localStorage.getItem('touristData');
      const sessionData = sessionStorage.getItem('currentUser');
      
      let validAuthData = null;
      
      // localStorage優先でチェック
      if (touristData) {
        try {
          const userData = JSON.parse(touristData);
          if (userData && userData.type === 'tourist' && userData.isAuthenticated && userData.id) {
            validAuthData = userData;
            console.log('✅ localStorage認証データ有効:', userData.name);
            
            // sessionStorageにも同期
            sessionStorage.setItem('currentUser', touristData);
          }
        } catch (e) {
          console.warn('⚠️ localStorage認証データ破損:', e);
          localStorage.removeItem('touristData');
        }
      }
      
      // sessionStorageからの復元
      if (!validAuthData && sessionData) {
        try {
          const userData = JSON.parse(sessionData);
          if (userData && userData.type === 'tourist' && userData.isAuthenticated && userData.id) {
            validAuthData = userData;
            console.log('✅ sessionStorage認証データ有効:', userData.name);
            
            // localStorageにも保存
            localStorage.setItem('touristData', sessionData);
          }
        } catch (e) {
          console.warn('⚠️ sessionStorage認証データ破損:', e);
          sessionStorage.removeItem('currentUser');
        }
      }
      
      // バックアップストレージからの復元
      if (!validAuthData) {
        console.log('🔍 バックアップストレージから復元を試行');
        const allKeys = Object.keys(localStorage);
        const backupKeys = allKeys.filter(key => key.startsWith('touristBackup_'));
        
        for (const backupKey of backupKeys) {
          try {
            const backupData = localStorage.getItem(backupKey);
            const userData = JSON.parse(backupData);
            if (userData && userData.type === 'tourist' && userData.isAuthenticated && userData.id) {
              validAuthData = userData;
              console.log('✅ バックアップから認証データ復元:', userData.name);
              
              // メインストレージに復元
              localStorage.setItem('touristData', backupData);
              sessionStorage.setItem('currentUser', backupData);
              break;
            }
          } catch (e) {
            console.warn('⚠️ バックアップデータ破損:', backupKey);
            localStorage.removeItem(backupKey);
          }
        }
      }
      
      if (validAuthData) {
        console.log('🎉 認証状態復元完了:', validAuthData.name);
        updateLoginStateUI();
        return true;
      } else {
        console.log('❌ 有効な認証データなし - ゲスト状態');
        // 無効なデータをクリーンアップ
        localStorage.removeItem('touristData');
        sessionStorage.removeItem('currentUser');
        return false;
      }
    }

    // グローバル認証チェッカー
    function isUserAuthenticated() {
      const touristData = localStorage.getItem('touristData');
      const sessionData = sessionStorage.getItem('currentUser');
      
      // 高速チェック
      if (touristData) {
        try {
          const userData = JSON.parse(touristData);
          return userData && userData.type === 'tourist' && userData.isAuthenticated;
        } catch (e) {
          return false;
        }
      }
      
      if (sessionData) {
        try {
          const userData = JSON.parse(sessionData);
          return userData && userData.type === 'tourist' && userData.isAuthenticated;
        } catch (e) {
          return false;
        }
      }
      
      return false;
    }

    // 注意：ボタン初期化は header-buttons-debug.js で処理されます

    // ページ読み込み時の処理
    document.addEventListener('DOMContentLoaded', function() {
      // 認証状態を検証・復元
      validateAndRestoreAuthState();
      
      // 注意：ボタン初期化は header-buttons-debug.js で処理されます
      console.log('🔧 メインDOMContentLoaded実行 - ボタン初期化はheader-buttons-debug.jsで処理');
      
      // 新規登録ドロップダウンのイベントリスナー設定
      setupRegisterDropdown();
      
      // 任意のキーボードショートカットでモーダルクリーンアップ（デバッグ用）
      document.addEventListener('keydown', function(e) {
        // Ctrl+Shift+C でモーダルクリーンアップ
        if (e.ctrlKey && e.shiftKey && e.key === 'C') {
          e.preventDefault();
          forceCleanupAllModals();
          console.log('🔧 手動モーダルクリーンアップが実行されました');
        }
        
        // Ctrl+Shift+A で認証状態デバッグ
        if (e.ctrlKey && e.shiftKey && e.key === 'A') {
          e.preventDefault();
          console.log('🔍 認証状態デバッグ:');
          console.log('isAuthenticated:', isUserAuthenticated());
          console.log('localStorage:', localStorage.getItem('touristData'));
          console.log('sessionStorage:', sessionStorage.getItem('currentUser'));
        }
      });
      
      // ページ可視性変更時の認証状態チェック
      document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
          console.log('🔄 ページ再表示 - 認証状態を再確認');
          validateAndRestoreAuthState();
        }
      });
      
      // 定期的な認証状態チェック（30秒ごと）
      setInterval(function() {
        const currentAuth = isUserAuthenticated();
        const bodyAuth = document.body.getAttribute('data-user-authenticated') === 'true';
        
        if (currentAuth !== bodyAuth) {
          console.log('🔧 認証状態の不整合を検出 - UI同期');
          updateLoginStateUI();
        }
      }, 30000);
      
      // ストレージ変更の監視
      window.addEventListener('storage', function(e) {
        if (e.key === 'touristData' || e.key === 'currentUser') {
          console.log('🔄 ストレージ変更検出 - 認証状態を更新');
          validateAndRestoreAuthState();
        }
      });
    });
  -->
  </script>

  <!-- フィルターチュートリアルモーダル -->
  <div class="modal fade" id="filterTutorialModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header border-0 pb-0">
          <h5 class="modal-title">
            <i class="bi bi-funnel text-primary me-2"></i>フィルター機能の使い方
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="tutorial-content">
            <!-- ステップ1 -->
            <div class="tutorial-step mb-4" data-step="1">
              <div class="d-flex align-items-start">
                <div class="step-number bg-primary text-white rounded-circle d-flex justify-content-center align-items-center me-3" style="width: 30px; height: 30px; font-size: 14px; font-weight: bold;">1</div>
                <div class="flex-grow-1">
                  <h6 class="fw-bold mb-2">フィルターを開く</h6>
                  <p class="text-muted mb-2">「ガイドを絞り込み」ボタンをクリックしてフィルター画面を表示します。</p>
                  <div class="tutorial-visual p-3 bg-light rounded">
                    <button class="btn btn-outline-primary" disabled>
                      <i class="bi bi-funnel"></i> ガイドを絞り込み
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- ステップ2 -->
            <div class="tutorial-step mb-4" data-step="2">
              <div class="d-flex align-items-start">
                <div class="step-number bg-primary text-white rounded-circle d-flex justify-content-center align-items-center me-3" style="width: 30px; height: 30px; font-size: 14px; font-weight: bold;">2</div>
                <div class="flex-grow-1">
                  <h6 class="fw-bold mb-2">条件を選択</h6>
                  <p class="text-muted mb-2">地域、言語、料金、キーワードなど、お好みの条件を選択できます。</p>
                  <div class="tutorial-visual p-3 bg-light rounded">
                    <div class="row g-2">
                      <div class="col-6">
                        <select class="form-select form-select-sm" disabled>
                          <option>地域を選択</option>
                        </select>
                      </div>
                      <div class="col-6">
                        <select class="form-select form-select-sm" disabled>
                          <option>言語を選択</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ステップ3 -->
            <div class="tutorial-step mb-4" data-step="3">
              <div class="d-flex align-items-start">
                <div class="step-number bg-primary text-white rounded-circle d-flex justify-content-center align-items-center me-3" style="width: 30px; height: 30px; font-size: 14px; font-weight: bold;">3</div>
                <div class="flex-grow-1">
                  <h6 class="fw-bold mb-2">フィルターを適用</h6>
                  <p class="text-muted mb-2">「フィルターを適用」ボタンで検索結果が更新されます。</p>
                  <div class="tutorial-visual p-3 bg-light rounded">
                    <button class="btn btn-primary btn-sm" disabled>
                      <i class="bi bi-search"></i> フィルターを適用
                    </button>
                    <button class="btn btn-outline-secondary btn-sm ms-2" disabled>
                      <i class="bi bi-arrow-clockwise"></i> リセット
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- ステップ4 -->
            <div class="tutorial-step mb-4" data-step="4">
              <div class="d-flex align-items-start">
                <div class="step-number bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center me-3" style="width: 30px; height: 30px; font-size: 14px; font-weight: bold;">4</div>
                <div class="flex-grow-1">
                  <h6 class="fw-bold mb-2">もっと見るボタンについて</h6>
                  <p class="text-muted mb-2">フィルターをリセットした後は、最初の3名のガイドのみ表示されます。</p>
                  <div class="tutorial-visual p-3 bg-light rounded">
                    <button class="btn btn-primary btn-sm" disabled>もっと見る</button>
                    <div class="small text-muted mt-2">
                      ↑ このボタンで残りのガイドを表示できます
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ヒント -->
            <div class="alert alert-info border-0" style="background: linear-gradient(135deg, #e3f2fd, #f0f9ff);">
              <div class="d-flex">
                <i class="bi bi-lightbulb text-info me-2 flex-shrink-0" style="font-size: 1.2em;"></i>
                <div>
                  <h6 class="fw-bold mb-1 text-info">便利なヒント</h6>
                  <ul class="mb-0 ps-3">
                    <li class="text-muted">複数の条件を組み合わせて絞り込みができます</li>
                    <li class="text-muted">リセットボタンでいつでも初期状態に戻せます</li>
                    <li class="text-muted">キーワード検索では趣味や得意分野で探せます</li>
                    <li class="text-muted"><strong>リセット後は「もっと見る」ボタンで全ガイドを表示</strong></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer border-0 pt-0">
          <button type="button" class="btn btn-success" id="try-filter-btn">
            <i class="bi bi-play-circle me-1"></i>実際に試してみる
          </button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="sponsor-buttons-redesign.css">
  <!-- 基本的なBootstrapのみ有効にする -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Filter Toggle Functionality -->
  <script src="filter-toggle.js"></script>
  <!-- 削除済み: guide-filter-fix.js -->
  
  <!-- 削除済み: japanese-counter-fix.js -->
  
  <!-- 削除済み: enhanced-filter-fix-ja.js -->
  
  <!-- Back to Top Button -->
  <button id="backToTopBtn" class="btn btn-primary back-to-top-btn" title="トップに戻る">
    <i class="bi bi-arrow-up"></i>
  </button>

  <style>
    .back-to-top-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 1000;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }
    
    .back-to-top-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    
    .back-to-top-btn.show {
      display: block;
      animation: fadeInUp 0.3s ease;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>

  <!-- Back to Top Script -->
  <script>
    // Back to Top functionality
    const backToTopBtn = document.getElementById('backToTopBtn');
    
    window.addEventListener('scroll', function() {
      if (window.pageYOffset > 300) {
        backToTopBtn.classList.add('show');
      } else {
        backToTopBtn.classList.remove('show');
      }
    });
    
    backToTopBtn.addEventListener('click', function() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    // Filter functions for Japanese version
    function resetFilters() {
      const locationFilter = document.getElementById('filter-location');
      const languageFilter = document.getElementById('filter-language');
      const specialtyFilter = document.getElementById('filter-specialties');
      const searchInput = document.getElementById('search-guides');
      
      if (locationFilter) locationFilter.value = '';
      if (languageFilter) languageFilter.value = '';
      if (specialtyFilter) specialtyFilter.value = '';
      if (searchInput) searchInput.value = '';
      
      // Reset all guide cards to visible
      const cards = document.querySelectorAll('.guide-item');
      cards.forEach(card => {
        card.style.display = 'block';
      });
      
      // Update counter
      const counter = document.getElementById('search-results-counter');
      const visibleCards = document.querySelectorAll('.guide-item:not(.d-none)');
      if (counter) {
        counter.textContent = `${visibleCards.length}人のガイドが見つかりました`;
      }
    }
    
    function applyFiltersManual() {
      // This will be handled by the automatic filter system in load-70-guides.js
      console.log('Manual filter apply triggered (Japanese)');
    }
  </script>

  <!-- 統合サイト修正システム - 無効化 -->
  <!-- <script src="unified-site-fix.js"></script> -->
  
  <!-- 日本語ボタン専用修正 - 無効化 -->
  <!-- <script src="japanese-button-fix.js"></script> -->
  
  <!-- リアルタイムガイド登録システム -->
  <script src="realtime-guide-registration.js"></script>
  
  <!-- 静的サイト切り替えシステム -->
  <script src="static-site-system.js"></script>
  
  <!-- 最優先: 最終ヘッダー修正システム -->
  <script src="final-header-fix.js"></script>
  
  <!-- 翻訳ブロッカーシステム -->
  <script src="translation-blocker.js"></script>
  
  <!-- 究極のヘッダーオーバーライドシステム -->
  <script src="ultimate-header-override.js"></script>
  
  <!-- 核兵器級ヘッダー修正システム -->
  <script src="nuclear-header-fix.js"></script>
  
  <!-- 日本語サイト専用スクリプト -->
  <script src="japanese-site-only.js"></script>
  <script src="japanese-header-fix.js"></script>
  <script src="unified-filter-fix.js"></script>
  
  <!-- 新規登録ボタン機能 -->
  <script>
    function showRegisterOptions() {
      const modal = document.getElementById('registerOptionsModal');
      if (modal && window.bootstrap) {
        new bootstrap.Modal(modal).show();
      }
    }
  </script>
  
  <!-- 登録オプション選択モーダル -->
  <div class="modal fade" id="registerOptionsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">登録方法を選択してください</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <button class="btn btn-primary btn-lg w-100" data-bs-toggle="modal" data-bs-target="#registerTouristModal" data-bs-dismiss="modal">
                <i class="bi bi-person me-2"></i>旅行者として登録
                <br><small class="text-light">ローカルガイドと一緒に特別な旅を体験</small>
              </button>
            </div>
            <div class="col-12">
              <button class="btn btn-success btn-lg w-100" data-bs-toggle="modal" data-bs-target="#registerGuideModal" data-bs-dismiss="modal">
                <i class="bi bi-map me-2"></i>ガイドとして登録
                <br><small class="text-light">あなたの知識と経験を共有しましょう</small>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 問題のあるスクリプトファイルを全て無効化 -->
  <!-- 
  <script src="auth-debug-tracer.js"></script>
  <script src="auth-persistence-fix.js"></script>
  <script src="auth-protection-override.js"></script>
  <script src="registration-button-fix.js"></script>
  <script src="client-app.js"></script>
  -->
  
  <!-- 根本的スクロール解決 - 核兵器級システムが処理 -->
  
  <!-- タイマー干渉ファイル削除済み -->
  
  <!-- スクロール問題は simple-scroll-fix.js で解決済み -->
</body>
</html>