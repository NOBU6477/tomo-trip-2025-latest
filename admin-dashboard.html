<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>管理者ダッシュボード - Local Guide</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }
      .dashboard-header {
        background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
        color: white;
        padding: 2rem 0;
      }
      .admin-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        overflow: hidden;
      }
      .admin-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      }
      .icon-wrapper {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        margin-bottom: 1rem;
      }
      .icon-sponsors { background: linear-gradient(135deg, #4CAF50, #45a049); }
      .icon-guides { background: linear-gradient(135deg, #2196F3, #1976D2); }
      .icon-users { background: linear-gradient(135deg, #FF9800, #F57C00); }
      .icon-analytics { background: linear-gradient(135deg, #9C27B0, #7B1FA2); }
      .icon-settings { background: linear-gradient(135deg, #607D8B, #455A64); }
      .icon-logs { background: linear-gradient(135deg, #795548, #5D4037); }
      
      .quick-action-btn {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 1.5rem;
        text-decoration: none;
        color: #333;
        transition: all 0.3s ease;
        display: block;
        height: 100%;
      }
      .quick-action-btn:hover {
        border-color: #1976d2;
        color: #1976d2;
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(25, 118, 210, 0.15);
      }
      .stats-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      }
      .stats-number {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      .logout-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        border-radius: 25px;
        padding: 8px 20px;
        transition: all 0.3s ease;
      }
      .logout-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        color: white;
        transform: translateY(-2px);
      }
    </style>
  </head>

  <body>
    <!-- セッションチェック -->
    <script>
      function checkAdminSession() {
        const adminSession = localStorage.getItem('adminSession');
        if (!adminSession) {
          window.location.href = 'admin-login.html';
          return;
        }
        
        const session = JSON.parse(adminSession);
        const now = new Date().getTime();
        
        if (now - session.timestamp > 24 * 60 * 60 * 1000) {
          localStorage.removeItem('adminSession');
          window.location.href = 'admin-login.html';
          return;
        }
        
        return session;
      }
      
      const session = checkAdminSession();
    </script>

    <!-- ダッシュボードヘッダー -->
    <div class="dashboard-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col">
            <h1 class="mb-1">
              <i class="bi bi-speedometer2 me-2"></i>管理者ダッシュボード
            </h1>
            <p class="mb-0 opacity-75" id="welcome-message">Local Guide 管理システム</p>
          </div>
          <div class="col-auto">
            <button class="btn logout-btn me-3" onclick="logout()">
              <i class="bi bi-box-arrow-right me-2"></i>ログアウト
            </button>
            <a href="index.html" class="btn btn-outline-light">
              <i class="bi bi-house-fill me-2"></i>メイン画面
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="container py-4">
      <!-- 統計概要 -->
      <div class="row mb-4">
        <div class="col-md-3 mb-3">
          <div class="stats-card">
            <div class="stats-number text-primary" id="total-sponsors">5</div>
            <div class="text-muted">協賛店</div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stats-card">
            <div class="stats-number text-success" id="total-guides">36</div>
            <div class="text-muted">登録ガイド</div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stats-card">
            <div class="stats-number text-warning" id="total-tourists">12</div>
            <div class="text-muted">観光客</div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="stats-card">
            <div class="stats-number text-info" id="monthly-bookings">8</div>
            <div class="text-muted">今月の予約</div>
          </div>
        </div>
      </div>

      <!-- クイックアクション -->
      <div class="row">
        <div class="col-lg-8">
          <h4 class="mb-3">管理メニュー</h4>
          <div class="row">
            <!-- 協賛店管理 -->
            <div class="col-md-6 mb-4">
              <a href="sponsor-admin.html" class="quick-action-btn">
                <div class="d-flex align-items-center">
                  <div class="icon-wrapper icon-sponsors">
                    <i class="bi bi-shop"></i>
                  </div>
                  <div class="ms-3">
                    <h6 class="mb-1">協賛店管理</h6>
                    <small class="text-muted">特典店舗の追加・編集・管理</small>
                  </div>
                </div>
              </a>
            </div>

            <!-- ガイド管理 -->
            <div class="col-md-6 mb-4">
              <a href="guides.html" class="quick-action-btn">
                <div class="d-flex align-items-center">
                  <div class="icon-wrapper icon-guides">
                    <i class="bi bi-person-badge"></i>
                  </div>
                  <div class="ms-3">
                    <h6 class="mb-1">ガイド管理</h6>
                    <small class="text-muted">ガイド一覧と承認管理</small>
                  </div>
                </div>
              </a>
            </div>

            <!-- ユーザー管理 -->
            <div class="col-md-6 mb-4">
              <div class="quick-action-btn">
                <div class="d-flex align-items-center">
                  <div class="icon-wrapper icon-users">
                    <i class="bi bi-people"></i>
                  </div>
                  <div class="ms-3">
                    <h6 class="mb-1">ユーザー管理</h6>
                    <small class="text-muted">観光客とガイドの管理</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- スポンサー企業 -->
            <div class="col-md-6 mb-4">
              <a href="test-sponsor.html" class="quick-action-btn">
                <div class="d-flex align-items-center">
                  <div class="icon-wrapper icon-analytics">
                    <i class="bi bi-building"></i>
                  </div>
                  <div class="ms-3">
                    <h6 class="mb-1">スポンサー企業</h6>
                    <small class="text-muted">支援企業の紹介ページ</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- システム設定 -->
            <div class="col-md-6 mb-4">
              <div class="quick-action-btn">
                <div class="d-flex align-items-center">
                  <div class="icon-wrapper icon-settings">
                    <i class="bi bi-gear"></i>
                  </div>
                  <div class="ms-3">
                    <h6 class="mb-1">システム設定</h6>
                    <small class="text-muted">アプリケーション設定</small>
                  </div>
                </div>
              </div>
            </div>

            <!-- ログ確認 -->
            <div class="col-md-6 mb-4">
              <div class="quick-action-btn">
                <div class="d-flex align-items-center">
                  <div class="icon-wrapper icon-logs">
                    <i class="bi bi-file-text"></i>
                  </div>
                  <div class="ms-3">
                    <h6 class="mb-1">ログ確認</h6>
                    <small class="text-muted">システムログの確認</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- サイドバー情報 -->
        <div class="col-lg-4">
          <h4 class="mb-3">システム情報</h4>
          
          <!-- システム状態 -->
          <div class="admin-card mb-3">
            <div class="card-body">
              <h6 class="card-title">
                <i class="bi bi-check-circle-fill text-success me-2"></i>システム状態
              </h6>
              <div class="small">
                <div class="d-flex justify-content-between mb-2">
                  <span>サーバー:</span>
                  <span class="text-success">正常</span>
                </div>
                <div class="d-flex justify-content-between mb-2">
                  <span>データベース:</span>
                  <span class="text-success">接続中</span>
                </div>
                <div class="d-flex justify-content-between">
                  <span>ストレージ:</span>
                  <span class="text-warning">78% 使用</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 最近のアクティビティ -->
          <div class="admin-card mb-3">
            <div class="card-body">
              <h6 class="card-title">
                <i class="bi bi-clock-history me-2"></i>最近のアクティビティ
              </h6>
              <div class="small">
                <div class="mb-2">
                  <div class="text-muted">2時間前</div>
                  <div>新しい協賛店が追加されました</div>
                </div>
                <div class="mb-2">
                  <div class="text-muted">1日前</div>
                  <div>ガイド登録の承認処理</div>
                </div>
                <div>
                  <div class="text-muted">3日前</div>
                  <div>システムメンテナンス完了</div>
                </div>
              </div>
            </div>
          </div>

          <!-- アクセス情報 -->
          <div class="admin-card">
            <div class="card-body">
              <h6 class="card-title">
                <i class="bi bi-person-circle me-2"></i>アクセス情報
              </h6>
              <div class="small">
                <div class="mb-2">
                  <strong>ログインユーザー:</strong>
                  <span id="current-user">admin</span>
                </div>
                <div class="mb-2">
                  <strong>最終ログイン:</strong>
                  <span id="last-login">今日</span>
                </div>
                <div>
                  <strong>権限レベル:</strong>
                  <span class="badge bg-primary" id="user-role">管理者</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      // ページ読み込み時の初期化
      document.addEventListener('DOMContentLoaded', function() {
        if (session) {
          // ユーザー情報を表示
          document.getElementById('welcome-message').textContent = `ようこそ、${session.username}さん`;
          document.getElementById('current-user').textContent = session.username;
          
          const roleText = session.role === 'super_admin' ? 'スーパー管理者' : '管理者';
          document.getElementById('user-role').textContent = roleText;
          
          // 最終ログイン時刻を表示
          const loginTime = new Date(session.timestamp);
          document.getElementById('last-login').textContent = loginTime.toLocaleString('ja-JP');
          
          // 統計情報を更新
          updateStats();
        }
      });

      // 統計情報の更新
      function updateStats() {
        // LocalStorageから協賛店データを取得
        const sponsorData = JSON.parse(localStorage.getItem('sponsorData')) || [];
        document.getElementById('total-sponsors').textContent = sponsorData.length;
        
        // その他の統計は実際のデータソースから取得
        // 現在はサンプルデータを使用
      }

      // ログアウト処理
      function logout() {
        if (confirm('ログアウトしますか？')) {
          localStorage.removeItem('adminSession');
          window.location.href = 'admin-login.html';
        }
      }

      // セッション自動延長
      setInterval(() => {
        const adminSession = localStorage.getItem('adminSession');
        if (adminSession) {
          const session = JSON.parse(adminSession);
          session.timestamp = new Date().getTime();
          localStorage.setItem('adminSession', JSON.stringify(session));
        }
      }, 30 * 60 * 1000); // 30分ごと
    </script>
  </body>
</html>