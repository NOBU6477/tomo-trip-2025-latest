// Ê†∏„É¨„Éô„É´ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†‰øÆÊ≠£ - ÂÖ®Á´∂Âêà„ÇíÊéíÈô§

(function() {
    'use strict';
    
    console.log('üöÄ Ê†∏„É¨„Éô„É´ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†‰øÆÊ≠£ÈñãÂßã');
    
    // 1. ÂÖ®Á´∂ÂêàË¶ÅÁ¥†„ÅÆÂÆåÂÖ®ÂâäÈô§
    function destroyCompetingElements() {
        console.log('Á´∂ÂêàË¶ÅÁ¥†ÂâäÈô§ÈñãÂßã');
        
        // Êó¢Â≠ò„ÅÆÁÆ°ÁêÜË¶ÅÁ¥†„Çí„Åô„Åπ„Å¶ÂâäÈô§
        const existingManagement = document.querySelectorAll('[id*="management"], [class*="management"], [id*="trigger"], [class*="trigger"]');
        existingManagement.forEach(el => {
            if (!el.closest('script')) {
                el.remove();
                console.log('Á´∂ÂêàÁÆ°ÁêÜË¶ÅÁ¥†ÂâäÈô§:', el.id || el.className);
            }
        });
        
        // ÁôΩ„ÅÑË¶ÅÁ¥†„ÅÆÂº∑Âà∂ÂâäÈô§
        const whiteElements = document.querySelectorAll('*');
        let removedCount = 0;
        whiteElements.forEach(element => {
            const styles = window.getComputedStyle(element);
            const rect = element.getBoundingClientRect();
            
            if ((styles.backgroundColor === 'rgb(255, 255, 255)' || 
                 styles.backgroundColor === 'white' ||
                 styles.backgroundColor === '#ffffff') &&
                rect.width > 0 && rect.width < 200 && 
                rect.height > 0 && rect.height < 200 &&
                !element.textContent.trim() &&
                !element.querySelector('img, button, input, select, textarea, canvas, svg') &&
                !element.closest('.modal') &&
                !element.closest('.navbar') &&
                !element.closest('.card') &&
                !element.closest('.hero-section') &&
                element.tagName !== 'HTML' &&
                element.tagName !== 'BODY' &&
                element.tagName !== 'HEAD') {
                
                element.remove();
                removedCount++;
            }
        });
        
        // ÂÜÜÂΩ¢„Çπ„Çø„É≥„Éó„ÅÆÂâäÈô§
        const circularElements = document.querySelectorAll('*');
        circularElements.forEach(element => {
            const styles = window.getComputedStyle(element);
            
            if ((styles.borderRadius === '50%' || 
                 styles.borderRadius.includes('50%') ||
                 (element.style.borderRadius && element.style.borderRadius.includes('50%'))) &&
                element.getBoundingClientRect().width < 60 &&
                element.getBoundingClientRect().height < 60 &&
                !element.textContent.includes('üèÜ') &&
                !element.querySelector('img') &&
                element.closest('#filter-card, .filter-container, .filter-area')) {
                
                element.remove();
                removedCount++;
                console.log('ÂÜÜÂΩ¢„Çπ„Çø„É≥„ÉóÂâäÈô§');
            }
        });
        
        console.log(`‚úÖ Á´∂ÂêàË¶ÅÁ¥†ÂâäÈô§ÂÆå‰∫Ü: ${removedCount}ÂÄãÂâäÈô§`);
    }
    
    // 2. Ê†∏„É¨„Éô„É´ÁÆ°ÁêÜ„Éú„Çø„É≥‰ΩúÊàê
    function createNuclearManagementButton() {
        console.log('Ê†∏„É¨„Éô„É´ÁÆ°ÁêÜ„Éú„Çø„É≥‰ΩúÊàêÈñãÂßã');
        
        // Êó¢Â≠òÂâäÈô§
        const existing = document.getElementById('nuclear-management-trigger');
        if (existing) existing.remove();
        
        // „Ç≥„É≥„ÉÜ„Éä‰ΩúÊàê
        const container = document.createElement('div');
        container.id = 'nuclear-management-trigger';
        container.style.cssText = `
            position: fixed !important;
            bottom: 30px !important;
            right: 30px !important;
            z-index: 999999 !important;
            width: 70px !important;
            height: 70px !important;
        `;
        
        // „Éú„Çø„É≥‰ΩúÊàê
        const button = document.createElement('button');
        button.textContent = 'üèÜ';
        button.id = 'nuclear-trigger-btn';
        button.style.cssText = `
            width: 100% !important;
            height: 100% !important;
            border-radius: 50% !important;
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            border: 3px solid rgba(255, 255, 255, 0.3) !important;
            color: white !important;
            font-size: 28px !important;
            cursor: pointer !important;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4) !important;
            transition: all 0.3s ease !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            outline: none !important;
        `;
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            toggleNuclearPanel();
        });
        
        button.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.15)';
            this.style.boxShadow = '0 12px 35px rgba(76, 175, 80, 0.6)';
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
            this.style.boxShadow = '0 8px 25px rgba(76, 175, 80, 0.4)';
        });
        
        container.appendChild(button);
        document.body.appendChild(container);
        
        console.log('‚úÖ Ê†∏„É¨„Éô„É´ÁÆ°ÁêÜ„Éú„Çø„É≥‰ΩúÊàêÂÆå‰∫Ü');
        return container;
    }
    
    // 3. Ê†∏„É¨„Éô„É´ÁÆ°ÁêÜ„Éë„Éç„É´‰ΩúÊàê
    function createNuclearManagementPanel() {
        console.log('Ê†∏„É¨„Éô„É´ÁÆ°ÁêÜ„Éë„Éç„É´‰ΩúÊàêÈñãÂßã');
        
        const existing = document.getElementById('nuclear-management-panel');
        if (existing) existing.remove();
        
        const panel = document.createElement('div');
        panel.id = 'nuclear-management-panel';
        panel.style.cssText = `
            display: none !important;
            position: fixed !important;
            bottom: 120px !important;
            right: 20px !important;
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white !important;
            padding: 25px !important;
            border-radius: 20px !important;
            z-index: 999998 !important;
            min-width: 320px !important;
            text-align: center !important;
            box-shadow: 0 20px 50px rgba(0,0,0,0.4) !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
        `;
        
        // „Éò„ÉÉ„ÉÄ„Éº
        const header = document.createElement('h5');
        header.textContent = 'üìã ÁÆ°ÁêÜ„Çª„É≥„Çø„Éº';
        header.style.cssText = 'margin: 0 0 20px 0 !important; font-size: 18px !important;';
        panel.appendChild(header);
        
        // „Ç´„Ç¶„É≥„Çø„ÉºË°®Á§∫„Ç®„É™„Ç¢
        const counterArea = document.createElement('div');
        counterArea.style.cssText = 'margin: 15px 0 20px 0 !important; padding: 15px !important; background: rgba(255,255,255,0.1) !important; border-radius: 10px !important;';
        
        const comparisonInfo = document.createElement('div');
        comparisonInfo.style.cssText = 'margin-bottom: 8px !important; font-size: 14px !important;';
        comparisonInfo.innerHTML = 'ÊØîËºÉ‰∏≠: <span id="nuclear-comparison-count" style="font-weight: bold; color: #ffeb3b;">0</span>/3‰∫∫';
        
        const bookmarkInfo = document.createElement('div');
        bookmarkInfo.style.cssText = 'font-size: 14px !important;';
        bookmarkInfo.innerHTML = '„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ: <span id="nuclear-bookmark-count" style="font-weight: bold; color: #ffeb3b;">0</span>‰∫∫';
        
        counterArea.appendChild(comparisonInfo);
        counterArea.appendChild(bookmarkInfo);
        panel.appendChild(counterArea);
        
        // „Éú„Çø„É≥„Ç®„É™„Ç¢
        const buttonArea = document.createElement('div');
        buttonArea.style.cssText = 'display: flex !important; flex-direction: column !important; gap: 12px !important;';
        
        const createActionButton = (text, action, bgColor = 'rgba(255,255,255,0.2)') => {
            const btn = document.createElement('button');
            btn.textContent = text;
            btn.style.cssText = `
                background: ${bgColor} !important;
                border: none !important;
                color: white !important;
                padding: 12px 20px !important;
                border-radius: 10px !important;
                cursor: pointer !important;
                font-size: 14px !important;
                font-weight: 600 !important;
                transition: all 0.3s ease !important;
            `;
            btn.addEventListener('click', action);
            btn.addEventListener('mouseenter', function() {
                this.style.background = 'rgba(255,255,255,0.3)';
                this.style.transform = 'translateY(-2px)';
            });
            btn.addEventListener('mouseleave', function() {
                this.style.background = bgColor;
                this.style.transform = 'translateY(0)';
            });
            return btn;
        };
        
        buttonArea.appendChild(createActionButton('ÊØîËºÉË°®Á§∫', showNuclearComparison));
        buttonArea.appendChild(createActionButton('„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØË°®Á§∫', showNuclearBookmarks));
        buttonArea.appendChild(createActionButton('ÂÖ®„Å¶ÂâäÈô§', clearNuclearAll, 'rgba(255,0,0,0.4)'));
        
        panel.appendChild(buttonArea);
        
        // Èñâ„Åò„Çã„Éú„Çø„É≥
        const closeBtn = document.createElement('button');
        closeBtn.textContent = '√ó';
        closeBtn.style.cssText = `
            position: absolute !important;
            top: 8px !important;
            right: 12px !important;
            background: none !important;
            border: none !important;
            color: white !important;
            font-size: 20px !important;
            cursor: pointer !important;
            width: 30px !important;
            height: 30px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        `;
        closeBtn.addEventListener('click', toggleNuclearPanel);
        panel.appendChild(closeBtn);
        
        document.body.appendChild(panel);
        console.log('‚úÖ Ê†∏„É¨„Éô„É´ÁÆ°ÁêÜ„Éë„Éç„É´‰ΩúÊàêÂÆå‰∫Ü');
        return panel;
    }
    
    // 4. „Éï„Ç£„É´„Çø„ÉºÊ©üËÉΩ„ÅÆÊ†∏„É¨„Éô„É´‰øÆÂæ©
    function fixNuclearFilter() {
        console.log('Ê†∏„É¨„Éô„É´„Éï„Ç£„É´„Çø„Éº‰øÆÂæ©ÈñãÂßã');
        
        const filterBtn = document.getElementById('filterToggleBtn');
        if (filterBtn) {
            // ÂÖ®„Ç§„Éô„É≥„Éà„ÇíÂâäÈô§„Åó„Å¶Êñ∞„Åó„ÅèË®≠ÂÆö
            const newBtn = filterBtn.cloneNode(true);
            filterBtn.parentNode.replaceChild(newBtn, filterBtn);
            
            newBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const filterCard = document.getElementById('filter-card');
                if (filterCard) {
                    const isHidden = filterCard.style.display === 'none' || filterCard.classList.contains('d-none');
                    
                    if (isHidden) {
                        filterCard.style.display = 'block';
                        filterCard.classList.remove('d-none');
                        newBtn.innerHTML = '<i class="bi bi-funnel-fill"></i> „Éï„Ç£„É´„Çø„Éº„ÇíÈñâ„Åò„Çã';
                        console.log('„Éï„Ç£„É´„Çø„ÉºË°®Á§∫');
                    } else {
                        filterCard.style.display = 'none';
                        filterCard.classList.add('d-none');
                        newBtn.innerHTML = '<i class="bi bi-funnel"></i> „Ç¨„Ç§„Éâ„ÇíÁµû„ÇäËæº„ÇÄ';
                        console.log('„Éï„Ç£„É´„Çø„ÉºÈùûË°®Á§∫');
                    }
                }
            });
            
            console.log('‚úÖ Ê†∏„É¨„Éô„É´„Éï„Ç£„É´„Çø„Éº‰øÆÂæ©ÂÆå‰∫Ü');
        }
    }
    
    // 5. „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞ÂÆöÁæ©
    function defineNuclearFunctions() {
        window.toggleNuclearPanel = function() {
            const panel = document.getElementById('nuclear-management-panel');
            if (panel) {
                if (panel.style.display === 'none') {
                    panel.style.display = 'block';
                    updateNuclearCounters();
                } else {
                    panel.style.display = 'none';
                }
            }
        };
        
        window.showNuclearComparison = function() {
            const comparisonList = JSON.parse(localStorage.getItem('comparisonList') || '[]');
            if (comparisonList.length === 0) {
                alert('ÊØîËºÉ„Åô„Çã„Ç¨„Ç§„Éâ„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\n\n„Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„ÅÆ‚úì„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÊØîËºÉÂØæË±°„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            let message = '„ÄêÊØîËºÉ‰∏≠„ÅÆ„Ç¨„Ç§„Éâ„Äë\n\n';
            comparisonList.forEach((guide, index) => {
                message += `${index + 1}. ${guide.name}\n`;
                message += `   üìç ${guide.location}\n`;
                message += `   üí∞ ¬•${guide.price}/„Çª„ÉÉ„Ç∑„Éß„É≥\n`;
                message += `   ‚≠ê ${guide.rating || '4.5'}‚òÖ\n\n`;
            });
            alert(message);
        };
        
        window.showNuclearBookmarks = function() {
            const bookmarkList = JSON.parse(localStorage.getItem('bookmarkList') || '[]');
            if (bookmarkList.length === 0) {
                alert('„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Åï„Çå„Åü„Ç¨„Ç§„Éâ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ\n\n„Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„ÅÆ‚≠ê„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Å´ËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            let message = '„Äê„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØÊ∏à„Åø„Ç¨„Ç§„Éâ„Äë\n\n';
            bookmarkList.forEach((guide, index) => {
                message += `${index + 1}. ${guide.name}\n`;
                message += `   üìç ${guide.location}\n`;
                message += `   üí∞ ¬•${guide.price}/„Çª„ÉÉ„Ç∑„Éß„É≥\n`;
                message += `   ‚≠ê ${guide.rating || '4.5'}‚òÖ\n\n`;
            });
            alert(message);
        };
        
        window.clearNuclearAll = function() {
            if (confirm('ÂÖ®„Å¶„ÅÆÈÅ∏ÊäûÔºà„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„ÉªÊØîËºÉÔºâ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü\n\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                localStorage.removeItem('bookmarkList');
                localStorage.removeItem('comparisonList');
                updateNuclearCounters();
                
                // „Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„ÅÆÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
                const allButtons = document.querySelectorAll('.bookmark-btn, .compare-btn');
                allButtons.forEach(btn => {
                    btn.style.background = 'rgba(255, 255, 255, 0.9)';
                    btn.style.color = '#666';
                });
                
                alert('‚úÖ ÂÖ®„Å¶„ÅÆÈÅ∏Êäû„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            }
        };
        
        console.log('‚úÖ Ê†∏„É¨„Éô„É´„Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞ÂÆöÁæ©ÂÆå‰∫Ü');
    }
    
    function updateNuclearCounters() {
        const bookmarkList = JSON.parse(localStorage.getItem('bookmarkList') || '[]');
        const comparisonList = JSON.parse(localStorage.getItem('comparisonList') || '[]');
        
        const bookmarkCounter = document.getElementById('nuclear-bookmark-count');
        const comparisonCounter = document.getElementById('nuclear-comparison-count');
        
        if (bookmarkCounter) bookmarkCounter.textContent = bookmarkList.length;
        if (comparisonCounter) comparisonCounter.textContent = comparisonList.length;
    }
    
    // 6. ÂàùÊúüÂåñ„Ç∑„Çπ„ÉÜ„É†
    function nuclearInitialize() {
        console.log('üöÄ Ê†∏„É¨„Éô„É´ÂàùÊúüÂåñÈñãÂßã');
        
        // È†ÜÊ¨°ÂÆüË°å
        setTimeout(() => {
            destroyCompetingElements();
        }, 100);
        
        setTimeout(() => {
            createNuclearManagementButton();
        }, 200);
        
        setTimeout(() => {
            createNuclearManagementPanel();
        }, 300);
        
        setTimeout(() => {
            fixNuclearFilter();
        }, 400);
        
        setTimeout(() => {
            defineNuclearFunctions();
        }, 500);
        
        setTimeout(() => {
            updateNuclearCounters();
            console.log('‚úÖ Ê†∏„É¨„Éô„É´ÂàùÊúüÂåñÂÆå‰∫Ü');
        }, 600);
        
        // Á∂ôÁ∂öÁõ£Ë¶ñ„Ç∑„Çπ„ÉÜ„É†Ôºà10ÁßíÈñìÈöîÔºâ
        setInterval(() => {
            if (!document.getElementById('nuclear-management-trigger')) {
                console.log('ÁÆ°ÁêÜ„Éú„Çø„É≥ÂÜç‰ΩúÊàê');
                createNuclearManagementButton();
            }
            
            if (!document.getElementById('nuclear-management-panel')) {
                console.log('ÁÆ°ÁêÜ„Éë„Éç„É´ÂÜç‰ΩúÊàê');
                createNuclearManagementPanel();
            }
            
            destroyCompetingElements();
        }, 10000);
    }
    
    // ÂÆüË°å
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', nuclearInitialize);
    } else {
        nuclearInitialize();
    }
    
    // Âç≥Â∫ß„Å´„ÇÇÂÆüË°å
    setTimeout(nuclearInitialize, 50);
    
})();