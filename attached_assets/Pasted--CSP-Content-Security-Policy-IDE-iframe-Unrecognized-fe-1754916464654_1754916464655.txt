了解。いま残っている“実害のある”エラーは主に **CSP（Content-Security-Policy）違反** です。
IDE 内 iframe 由来の黄色い “Unrecognized feature … / WebGL … / stallwart …” は **Replit ワークスペースが出している警告**で、実アプリには無関係です（.replit.dev を別タブで開くとほぼ消えます）。

下の手順を **そのまま Replit のエージェントにコピペ**して指示してください。

---

# 指示書（コピペ用）

**目的**: コンソールの CSP エラー（外部 CSS/JS ブロック・`frame-ancestors` 無効エラー）を解消し、UI 崩れを直す。

## 1) CSP メタタグの見直し

`index.html`（または共通レイアウト）の `<meta http-equiv="Content-Security-Policy">` を **置き換え**てください。
※`frame-ancestors` は **meta では無視される**ため **記述しない**でください（現状の赤エラーの原因）。

```html
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net;
  style-src  'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com;
  img-src    'self' data: blob: https://images.unsplash.com;
  font-src   'self' data: https://fonts.gstatic.com;
  connect-src 'self';
  object-src 'none';
  base-uri 'self';
">
```

ポイント

* **`frame-ancestors` は入れない**（meta だと無効＆エラー表示）。必要なら本番でサーバーヘッダで出す。
* jsDelivr / Google Fonts / Unsplash を **明示的に許可**。
* 既に使っていないドメインがあれば後で削ってOK。

## 2) 外部 CDN の読み込み先を整理

CSP と一致するよう、以下を確認・修正してください。

* Bootstrap / Swiper などの読み込みが **jsDelivr** 指定になっているか確認。例:

  ```html
  <!-- CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js" defer></script>
  ```
* もし **別 CDN（unpkg / cdnjs など）** を使っていれば **jsDelivr に統一**するか、CSP にそのドメインを追加。
* もしくは **ローカルに同梱**する方式でもOK（`/vendor/bootstrap.min.css/js`, `/vendor/swiper-bundle.min.css/js` を配置し、リンクをローカルへ差し替え）。この場合は CSP の外部許可をさらに減らせます。

## 3) Google Fonts の最適化（必須ではないが推奨）

フォントの読み込みで FOUT を減らすため、`<head>` 冒頭にプリコネクトを追加：

```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
```

## 4) Replit のビーコン（`replit.com/public/js/beacon.js`）について

* これは **Replit ワークスペース iframe が注入**するスクリプトで、**CSP に許可していないため IDE 内でのみ赤エラー**になります。
* `.replit.dev` を **別タブ**で開いた実アプリでは読み込まれない（＝エラーにならない）はずです。
* もし本番でも消させたい場合は、アプリ側ではなく **Replit 側の注入**なので **無視**でOK。アプリの CSP に `https://replit.com` を追加することは推奨しません。

## 5) キャッシュ/Service Worker のリセット

* 変更後はブラウザで **ハードリロード（Ctrl+F5）**。
* もし Service Worker を使っていれば、**一度 unregister** → 再読み込みして最新 CSP/アセットが配信されることを確認。

## 6) 期待される結果

* `Refused to load the stylesheet ... bootstrap.min.css / swiper-bundle.min.css` が解消。
* `The CSP directive 'frame-ancestors' is ignored when delivered via a meta element.` が消える。
* IDE 内の `beacon.js` は引き続き出る場合あり（ワークスペース由来）。**別タブ .replit.dev では出ない**ことを確認。

---

うまくいかなければ、今使っている **CDN の URL 一覧**（CSS/JS）を貼ってください。CSP に入れるべきドメインをこちらで最小限に整理します。
