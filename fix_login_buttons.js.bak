/**
 * ログインボタンと新規登録ボタンを強制的に表示するスクリプト
 */
(function() {
  console.log('ログインボタン修正スクリプトを実行します');
  
  // DOMContentLoadedイベント
  document.addEventListener('DOMContentLoaded', function() {
    updateLoginButtons();
  });
  
  // ウィンドウロードイベント（確実に実行するため）
  window.addEventListener('load', function() {
    updateLoginButtons();
  });
  
  function updateLoginButtons() {
    // 新規登録ボタン
    const registerBtn = document.querySelector('a.btn.btn-warning');
    if (registerBtn) {
      console.log('新規登録ボタンを見つけました（ボタン修正）');
      
      // 既存のイベントを削除
      const newRegisterBtn = registerBtn.cloneNode(true);
      registerBtn.parentNode.replaceChild(newRegisterBtn, registerBtn);
      
      // 新しいイベントを設定
      newRegisterBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('新規登録ボタンがクリックされました（ボタン修正）');
        
        // ユーザータイプモーダルを表示
        const userTypeModal = document.getElementById('userTypeModal');
        if (userTypeModal) {
          // 現在のモーダルを閉じる
          document.querySelectorAll('.modal.show').forEach(function(modal) {
            modal.classList.remove('show');
            modal.style.display = 'none';
          });
          
          // バックドロップを削除
          document.querySelectorAll('.modal-backdrop').forEach(function(backdrop) {
            backdrop.parentNode.removeChild(backdrop);
          });
          
          // 新しいバックドロップを追加
          const backdrop = document.createElement('div');
          backdrop.className = 'modal-backdrop fade show';
          backdrop.style.opacity = '0.25';
          document.body.appendChild(backdrop);
          
          // モーダルを表示
          userTypeModal.classList.add('show');
          userTypeModal.style.display = 'block';
          userTypeModal.setAttribute('aria-modal', 'true');
          userTypeModal.removeAttribute('aria-hidden');
          
          document.body.classList.add('modal-open');
        }
      });
    }
    
    // ログインボタン
    const loginBtn = document.querySelector('a.nav-link[href="#"][data-bs-toggle="modal"][data-bs-target="#loginModal"]');
    if (loginBtn) {
      console.log('ログインボタンを見つけました（ボタン修正）');
      
      // 既存のイベントを削除
      const newLoginBtn = loginBtn.cloneNode(true);
      loginBtn.parentNode.replaceChild(newLoginBtn, loginBtn);
      
      // 新しいイベントを設定
      newLoginBtn.addEventListener('click', function(e) {
        e.preventDefault();
        console.log('ログインボタンがクリックされました（ボタン修正）');
        
        // ログインモーダルを表示
        const loginModal = document.getElementById('loginModal');
        if (loginModal) {
          // 現在のモーダルを閉じる
          document.querySelectorAll('.modal.show').forEach(function(modal) {
            modal.classList.remove('show');
            modal.style.display = 'none';
          });
          
          // バックドロップを削除
          document.querySelectorAll('.modal-backdrop').forEach(function(backdrop) {
            backdrop.parentNode.removeChild(backdrop);
          });
          
          // 新しいバックドロップを追加
          const backdrop = document.createElement('div');
          backdrop.className = 'modal-backdrop fade show';
          backdrop.style.opacity = '0.25';
          document.body.appendChild(backdrop);
          
          // モーダルを表示
          loginModal.classList.add('show');
          loginModal.style.display = 'block';
          loginModal.setAttribute('aria-modal', 'true');
          loginModal.removeAttribute('aria-hidden');
          
          document.body.classList.add('modal-open');
        }
      });
    }
  }
  
  function getCurrentUser() {
    try {
      const userJson = localStorage.getItem('currentUser');
      return userJson ? JSON.parse(userJson) : null;
    } catch (e) {
      console.error('ユーザー情報の取得に失敗しました:', e);
      return null;
    }
  }
})();
