<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>予約完了 - TomoTrip</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .confirmation-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .confirmation-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .success-header {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
        }
        
        .success-icon {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: #28a745;
            font-size: 2rem;
        }
        
        .booking-details {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
        }
        
        .next-steps {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .guide-contact {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .payment-info {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 2rem 0;
        }
        
        .btn-action {
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: bold;
            margin: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="confirmation-container">
        <div class="confirmation-card">
            <div class="success-header">
                <div class="success-icon">
                    <i class="bi bi-check2-circle"></i>
                </div>
                <h2 class="fw-bold">予約が完了しました！</h2>
                <p class="mb-0">決済が正常に処理され、ガイドに通知を送信しました</p>
            </div>
            
            <div class="p-4">
                <!-- 予約詳細 -->
                <div class="booking-details">
                    <h5 class="fw-bold mb-3"><i class="bi bi-calendar-check me-2"></i>予約詳細</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="d-flex align-items-center mb-3">
                                <img id="confirmGuideImage" src="" class="rounded-circle me-3" style="width: 80px; height: 80px; object-fit: cover;">
                                <div>
                                    <h6 class="mb-1 fw-bold" id="confirmGuideName">ガイド名</h6>
                                    <small class="text-muted">認定ガイド</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div id="confirmBookingDetails">
                                <!-- 予約詳細がここに表示 -->
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <strong>予約番号:</strong> <span id="confirmBookingId">#12345</span>
                        </div>
                        <div class="col-md-6 text-end">
                            <strong>お支払い金額:</strong> <span class="text-success fw-bold" id="confirmTotal">¥0</span>
                        </div>
                    </div>
                </div>
                
                <!-- 次のステップ -->
                <div class="next-steps">
                    <h6 class="fw-bold"><i class="bi bi-list-check me-2"></i>今後の流れ</h6>
                    <ol class="mb-0">
                        <li><strong>ガイド確認:</strong> ガイドが予約内容を確認し、24時間以内に連絡いたします</li>
                        <li><strong>待ち合わせ確認:</strong> 具体的な集合場所と時間を調整します</li>
                        <li><strong>当日のご案内:</strong> ガイドがお客様をご案内いたします</li>
                        <li><strong>サービス完了:</strong> ガイド終了後、自動的にガイドへお支払いが処理されます</li>
                    </ol>
                </div>
                
                <!-- ガイド連絡先 -->
                <div class="guide-contact">
                    <h6 class="fw-bold"><i class="bi bi-chat-dots me-2"></i>ガイドとの連絡</h6>
                    <p class="mb-2">予約が確定次第、ガイドから直接ご連絡いたします。緊急時は以下のボタンからお問い合わせください。</p>
                    <button class="btn btn-success btn-action" onclick="openChat()">
                        <i class="bi bi-chat me-2"></i>ガイドにメッセージ
                    </button>
                </div>
                
                <!-- 決済・手数料説明 -->
                <div class="payment-info">
                    <h6 class="fw-bold"><i class="bi bi-info-circle me-2"></i>決済について</h6>
                    <div class="row">
                        <div class="col-md-8">
                            <p class="mb-2"><strong>お客様のお支払い:</strong> 決済完了済み</p>
                            <p class="mb-2"><strong>ガイドへの支払い:</strong> サービス完了後に自動処理</p>
                            <p class="mb-0"><small class="text-muted">※ガイドには手数料（20%）を差し引いた金額をお支払いします</small></p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="badge bg-success fs-6">決済完了</div>
                        </div>
                    </div>
                </div>
                
                <!-- アクションボタン -->
                <div class="text-center mt-4">
                    <button class="btn btn-primary btn-action" onclick="viewBookings()">
                        <i class="bi bi-calendar3 me-2"></i>予約一覧を見る
                    </button>
                    <button class="btn btn-outline-secondary btn-action" onclick="goHome()">
                        <i class="bi bi-house me-2"></i>ホームに戻る
                    </button>
                </div>
                
                <!-- 緊急連絡先 -->
                <div class="text-center mt-4 pt-4 border-top">
                    <small class="text-muted">
                        <i class="bi bi-telephone me-1"></i>緊急時連絡先: 
                        <a href="tel:+81-3-1234-5678" class="text-decoration-none">03-1234-5678</a>
                        （24時間対応）
                    </small>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let bookingData = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            loadBookingData();
        });
        
        function loadBookingData() {
            const urlParams = new URLSearchParams(window.location.search);
            const bookingId = urlParams.get('id');
            
            if (bookingId) {
                // LocalStorageから予約データを取得
                const bookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
                bookingData = bookings.find(b => b.id == bookingId);
                
                if (bookingData) {
                    displayBookingData();
                } else {
                    alert('予約データが見つかりません。');
                    window.location.href = 'index.html';
                }
            } else {
                // 最新の予約を表示
                const bookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
                if (bookings.length > 0) {
                    bookingData = bookings[bookings.length - 1];
                    displayBookingData();
                } else {
                    alert('予約データが見つかりません。');
                    window.location.href = 'index.html';
                }
            }
        }
        
        function displayBookingData() {
            document.getElementById('confirmGuideName').textContent = bookingData.guideName;
            document.getElementById('confirmGuideImage').src = bookingData.guideImage || '';
            document.getElementById('confirmTotal').textContent = bookingData.totalPrice;
            document.getElementById('confirmBookingId').textContent = `#${bookingData.id}`;
            
            const detailsHTML = `
                <div class="mb-2"><strong>日付:</strong> ${bookingData.date}</div>
                <div class="mb-2"><strong>時間:</strong> ${bookingData.time}</div>
                <div class="mb-2"><strong>時間:</strong> ${bookingData.duration}時間</div>
                <div class="mb-2"><strong>参加者:</strong> ${bookingData.participants}名</div>
                ${bookingData.specialRequests ? `<div class="mb-2"><strong>特別リクエスト:</strong> ${bookingData.specialRequests}</div>` : ''}
            `;
            document.getElementById('confirmBookingDetails').innerHTML = detailsHTML;
        }
        
        function openChat() {
            if (bookingData) {
                // ガイドIDがない場合はガイド名から生成
                const guideId = bookingData.guideId || bookingData.guideName.replace(/\s+/g, '');
                console.log(`Opening chat for guide: ${bookingData.guideName} (ID: ${guideId})`);
                
                // 専用チャットページにリダイレクト
                const chatUrl = `chat.html?guideId=${guideId}&guideName=${encodeURIComponent(bookingData.guideName)}&bookingId=${bookingData.id}`;
                window.location.href = chatUrl;
            } else {
                alert('予約データが見つかりません。');
            }
        }
        
        function viewBookings() {
            // 予約一覧ページ（今後実装）
            alert('予約一覧ページを表示します');
            // window.location.href = 'my-bookings.html';
        }
        
        function goHome() {
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>