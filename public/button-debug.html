<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Button Debug Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Button Debug Test Page</h1>
        
        <div class="row">
            <div class="col-12">
                <h3>Hero Buttons Test</h3>
                <button class="btn btn-primary me-3" id="findGuideBtn">ガイドを探す</button>
                <button class="btn btn-outline-primary me-3" id="contactBtn">お問い合わせ</button>
                <button class="btn btn-success" onclick="testAlert('Direct onclick works!')">Direct Test</button>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>Guide Detail Button Test</h3>
                <button class="btn btn-info" data-action="view-details" data-guide-id="1">詳しく見る (data-action)</button>
                <button class="btn btn-warning" onclick="window.showGuideDetailModalById && window.showGuideDetailModalById(1)">詳しく見る (direct call)</button>
            </div>
        </div>
        
        <div class="row mt-4" id="guides-section">
            <div class="col-12">
                <h3>Guides Section (Scroll Target)</h3>
                <p>This is where the scroll should land when 'ガイドを探す' is clicked.</p>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>Debug Log</h3>
                <div id="debug-log" class="bg-light p-3" style="height: 300px; overflow-y: auto; font-family: monospace;"></div>
            </div>
        </div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('debug-log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function testAlert(message) {
            alert(message);
            log('Direct onclick alert: ' + message);
        }
        
        log('🔍 Debug page loaded');
        
        document.addEventListener('DOMContentLoaded', function() {
            log('✅ DOM Content Loaded');
            
            // Test element existence
            const findGuideBtn = document.getElementById('findGuideBtn');
            const contactBtn = document.getElementById('contactBtn');
            const guidesSection = document.getElementById('guides-section');
            
            log('Elements found:');
            log('- findGuideBtn: ' + (findGuideBtn ? 'YES' : 'NO'));
            log('- contactBtn: ' + (contactBtn ? 'YES' : 'NO'));
            log('- guidesSection: ' + (guidesSection ? 'YES' : 'NO'));
            
            // Test event listener setup
            if (findGuideBtn) {
                findGuideBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    log('🎯 Find Guide button CLICKED!');
                    if (guidesSection) {
                        guidesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        log('✅ Scroll triggered');
                    } else {
                        log('❌ Guides section not found for scroll');
                    }
                });
                log('✅ Find Guide event listener added');
            }
            
            if (contactBtn) {
                contactBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    log('🎯 Contact button CLICKED!');
                    try {
                        window.open('chat.html', '_blank');
                        log('✅ New tab opened for chat.html');
                    } catch (error) {
                        log('❌ Error opening new tab: ' + error.message);
                        alert('お問い合わせページを開こうとしました');
                    }
                });
                log('✅ Contact event listener added');
            }
            
            // Test data-action delegation
            document.addEventListener('click', function(e) {
                const element = e.target.closest('[data-action]');
                if (element) {
                    const action = element.getAttribute('data-action');
                    const guideId = element.getAttribute('data-guide-id');
                    log('🎯 Data-action clicked: ' + action + ' (guide: ' + guideId + ')');
                    
                    if (action === 'view-details') {
                        e.preventDefault();
                        if (window.showGuideDetailModalById) {
                            log('✅ Calling showGuideDetailModalById with ID: ' + guideId);
                            window.showGuideDetailModalById(parseInt(guideId));
                        } else {
                            log('❌ showGuideDetailModalById function not found');
                            alert('showGuideDetailModalById関数が見つかりません');
                        }
                    }
                }
            });
            log('✅ Data-action delegation setup');
            
            // Test if showGuideDetailModalById exists globally
            setTimeout(function() {
                log('=== Function Availability Test ===');
                log('window.showGuideDetailModalById: ' + (window.showGuideDetailModalById ? 'EXISTS' : 'NOT FOUND'));
                log('window.setupHeroButtons: ' + (window.setupHeroButtons ? 'EXISTS' : 'NOT FOUND'));
                log('bootstrap Modal: ' + (window.bootstrap && window.bootstrap.Modal ? 'EXISTS' : 'NOT FOUND'));
            }, 1000);
        });
        
        // Create a simple modal function for testing
        window.showGuideDetailModalById = function(guideId) {
            log('🎯 showGuideDetailModalById called with ID: ' + guideId);
            alert('ガイド詳細モーダル（ID: ' + guideId + '）を表示します。Bootstrap: ' + (window.bootstrap ? 'Available' : 'Not Available'));
        };
    </script>
</body>
</html>