<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://replit.com https://*.replit.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; img-src 'self' data: blob: https://images.unsplash.com https://*.unsplash.com; font-src 'self' data: https://fonts.gstatic.com https://cdn.jsdelivr.net; connect-src 'self' https://replit.com https://*.replit.com; object-src 'none'; base-uri 'self'; form-action 'self'; frame-src 'self' https://*.replit.dev https://replit.com; report-uri /csp-report;">
    <title>TomoTrip - 地元ガイドと特別な旅を発見</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- CSP compatibility fixes -->
    <script src="env/csp-fix.js"></script>
    <!-- Environment configuration - must be first -->
    <script type="module" src="env/app-config.mjs"></script>
    
    <!-- Build ID and cache cleanup for consistency - CSP compliant -->
    <script src="env/build-id.js"></script>
    <script src="sw-unregister.js"></script>
    
    <!-- Complete error suppression system -->
    <script src="env/csp-fix.js"></script>
    <script src="webgl-fix.js" defer></script>
    <script src="error_suppressor.js" defer></script>
    <script src="management.js" defer></script>
    
    <!-- CSS Load Order: Bootstrap CSS → Local Icons → Custom CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
    <link rel="stylesheet" href="ocean_background.css">
    <link rel="stylesheet" href="assets/css/footer.css">
    <link rel="stylesheet" href="assets/css/auth-modal.css">

    <style>
        .guide-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* Chat message styling */
        .max-width-70 {
            max-width: 70%;
        }
        
        #chatMessages {
            min-height: 300px;
        }
        
        #chatMessages::-webkit-scrollbar {
            width: 6px;
        }
        
        #chatMessages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        #chatMessages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        #chatMessages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'BIZ UDPGothic', 'Meiryo', sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: bold;
            font-size: 1.5rem;
            color: #333 !important;
            text-decoration: none;
        }

        .logo-container {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: white;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        
        .logo-container img {
            width: 52px;
            height: 52px;
            object-fit: contain;
            border-radius: 50%;
            background: white;
            display: block;
        }

        /* Hero Section - Bright Ocean Yacht Background */
        .hero-section {
            position: relative !important;
            height: 100vh !important;
            min-height: 100vh !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            overflow: hidden !important;
        }
        
        /* Background image layer with bright filters */
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('/assets/images/beach-yacht-tourists.jpg');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: scroll;
            /* Moderately bright, natural filters for ocean yacht scene */
            filter: brightness(1.2) contrast(1.05) saturate(1.1);
            z-index: -2;
        }
        
        /* Mobile background fix for English version */
        @media (max-width: 768px) {
            body, html {
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat scroll !important;
                min-height: 100vh !important;
                width: 100% !important;
            }
            
            .hero-section::before {
                background-attachment: scroll;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: -10;
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat !important;
            }
        }
        
        /* Extra narrow mobile screens */
        @media (max-width: 480px) {
            body, html, .hero-section {
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat scroll !important;
                min-height: 100vh !important;
                width: 100vw !important;
            }
        }
        
        /* Light overlay for text readability */
        .hero-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255,255,255,0.05), rgba(0,100,200,0.1));
            z-index: -1;
        }
        
        /* Ensure content is visible */
        .hero-section .container,
        .hero-section .row,
        .hero-section .col-12,
        .hero-section .text-center {
            position: relative !important;
            z-index: 20 !important;
        }

        /* Language Switcher - Center Position */
        .language-switcher-center {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 0;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border-radius: 25px;
            overflow: hidden;
        }

        .lang-btn-jp, .lang-btn-en {
            padding: 15px 30px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
            color: white;
        }

        /* レスポンシブデザイン - モバイル対応 */
        @media (max-width: 768px) {
            .language-switcher-center {
                top: 20%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 320px;
            }
            
            .lang-btn-jp, .lang-btn-en {
                padding: 12px 20px;
                font-size: 14px;
                min-width: 100px;
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            .language-switcher-center {
                top: 18%;
                width: 95%;
                max-width: 280px;
            }
            
            .lang-btn-jp, .lang-btn-en {
                padding: 10px 15px;
                font-size: 13px;
                min-width: 80px;
            }
        }

        .lang-btn-jp {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }

        .lang-btn-en {
            background: linear-gradient(135deg, #4287f5, #64a8ff);
        }

        .lang-btn-jp:hover {
            background: linear-gradient(135deg, #ff5252, #ff7979);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
        }

        .lang-btn-en:hover {
            background: linear-gradient(135deg, #3367d6, #5a9cff);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66,135,245,0.4);
        }

        /* Hero Content */
        .hero-content {
            text-align: center;
            color: white;
            z-index: 50;
            max-width: 800px;
            padding: 0 20px;
            margin-top: 150px;
        }

        .hero-title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 1.5rem;
        }

        .hero-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            padding: 8px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-logo img {
            width: 64px;
            height: 64px;
            object-fit: contain;
            border-radius: 50%;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-hero {
            padding: 15px 35px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 35px;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .btn-primary-hero {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-primary-hero:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,123,255,0.4);
        }

        .btn-outline-hero {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline-hero:hover {
            background: white;
            color: #333;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255,255,255,0.3);
        }

        /* Guide Cards */
        .guide-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            height: 100%;
        }

        .guide-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .guide-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .guide-card-body {
            padding: 1.5rem;
        }

        .guide-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .guide-location {
            color: #6c757d;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .guide-languages {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .language-badge {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1976d2;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .guide-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stars {
            color: #ffc107;
        }

        .guide-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 1rem;
        }

        .guide-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-guide {
            flex: 1;
            padding: 0.8rem;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-view {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-view:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-2px);
        }

        .btn-bookmark {
            background: linear-gradient(135deg, #ffc107, #ffb300);
            color: white;
        }

        .btn-bookmark:hover {
            background: linear-gradient(135deg, #ffb300, #ff8f00);
            transform: translateY(-2px);
        }

        /* Right Side Sponsor Buttons */
        .sponsor-buttons {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .sponsor-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            min-width: 140px;
            text-align: center;
        }

        .sponsor-btn:hover {
            background: linear-gradient(135deg, #218838, #1ea584);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .sponsor-btn.login-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .sponsor-btn.login-btn:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        /* Management Center Button */
        .management-center {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffc107, #ffb300);
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(255, 193, 7, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .management-center:hover {
            background: linear-gradient(135deg, #ffb300, #ff8f00);
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(255, 193, 7, 0.5);
        }

        /* Mobile Responsive - Complete Version */
        @media (max-width: 768px) {
            /* Basic structure adjustments */
            body {
                overflow-x: hidden;
            }
            
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            
            /* Navigation adjustments */
            .navbar {
                padding: 8px 0;
            }
            
            .navbar-brand {
                font-size: 1.1rem;
            }
            
            .navbar .d-flex {
                flex-direction: row;
                align-items: center;
                gap: 8px;
                width: auto;
            }
            
            .navbar .btn {
                font-size: 12px;
                padding: 6px 12px;
                white-space: nowrap;
            }
            
            .dropdown-menu {
                min-width: 140px !important;
                right: 0;
                left: auto;
            }
            
            /* Hero section adjustments */
            .hero-section {
                min-height: 100vh;
                padding: 20px 0;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
            
            .hero-content {
                text-align: center;
                padding: 0 20px;
                max-width: 100%;
            }
            
            .hero-content h1 {
                font-size: 2rem;
                margin-bottom: 1rem;
            }
            
            .hero-content p {
                font-size: 1rem;
                margin-bottom: 2rem;
                line-height: 1.6;
            }
            
            /* Language switcher */
            .language-switcher-center {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                margin: 0 auto 2rem auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                width: 100%;
                padding: 0 20px;
                box-sizing: border-box;
            }
            
            .lang-btn-jp, .lang-btn-en {
                width: 100%;
                max-width: 280px;
                font-size: 14px;
                padding: 10px 16px;
                box-sizing: border-box;
                border-radius: 25px;
            }
            
            /* Hero buttons */
            .hero-buttons {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 12px;
                margin: 0 auto;
                padding: 0 20px;
                width: 100%;
                max-width: 280px;
            }
            
            .btn-hero {
                width: 100%;
                font-size: 14px;
                padding: 12px 20px;
                box-sizing: border-box;
                border-radius: 25px;
            }
            
            /* Sponsor buttons */
            .sponsor-buttons {
                position: relative;
                right: auto;
                top: auto;
                transform: none;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                margin: 20px auto;
                padding: 0 20px;
                gap: 10px;
                max-width: 280px;
                width: 100%;
            }
            
            .sponsor-btn {
                width: 100%;
                font-size: 14px;
                padding: 10px 16px;
                box-sizing: border-box;
                border-radius: 20px;
            }
            
            /* Main content */
            .main-content {
                padding: 40px 0 !important;
            }
            
            .filter-section {
                padding: 20px !important;
                margin: 0 10px;
            }
            
            .filter-section .d-flex {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .filter-section .form-select,
            .filter-section .form-control {
                width: 100% !important;
                min-width: auto !important;
                font-size: 14px;
                padding: 10px;
                box-sizing: border-box;
            }
            
            /* Guide cards */
            .guide-card {
                margin-bottom: 15px;
            }
            
            .guide-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn-guide {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            /* Management center button */
            .management-center {
                position: fixed;
                bottom: 15px;
                right: 15px;
                transform: none;
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            /* Modals */
            .modal-dialog {
                margin: 5px;
                max-width: calc(100vw - 10px);
                height: calc(100vh - 10px);
            }
            
            .modal-content {
                height: 100%;
                border-radius: 10px;
            }
            
            .modal-body {
                padding: 15px;
                overflow-y: auto;
            }
            
            .modal-body .form-control,
            .modal-body .form-select {
                font-size: 14px;
                padding: 10px;
            }
            
            .modal-body .btn {
                font-size: 14px;
                padding: 10px 16px;
            }
            
            /* Footer adjustments */
            .footer {
                padding: 20px 0;
            }
            
            .footer .row > .col-md-2,
            .footer .row > .col-md-3 {
                margin-bottom: 15px;
            }
            
            /* Tables */
            .table-responsive {
                font-size: 12px;
            }
            
            /* Search results */
            .search-results {
                padding: 10px;
            }
            
            /* Pagination */
            .pagination {
                justify-content: center;
            }
            
            .page-link {
                font-size: 12px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body class="theme-ocean">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <div class="logo-container">
                    <img src="assets/images/tomotrip-logo.png" alt="TomoTrip Logo" onload="console.log('✅ Logo loaded successfully from:', this.src)" onerror="console.error('❌ Logo load failed:', this.src); this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;font-size: 24px; color: white;&quot;>T</span>';" />
                </div>
                TomoTrip
            </a>
            
            <div class="d-flex">
                <button class="btn btn-success me-2" id="dashboardBtn" title="Sponsor Management Dashboard" style="opacity: 0.6; cursor: not-allowed;">
                    <i class="bi bi-shop"></i> <span class="d-none d-md-inline">Dashboard</span>
                </button>
                <div class="dropdown me-2" style="position: relative;">
                    <button class="btn btn-outline-primary dropdown-toggle" type="button" id="loginDropdown" aria-expanded="false">
                        ログイン
                    </button>
                    <div id="customLoginDropdown" class="dropdown-menu" style="display: none; position: absolute; top: 100%; left: 0; z-index: 9999; background: white; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); min-width: 160px;">
                        <button class="dropdown-item" id="directTouristLoginBtn" type="button" style="display: block; width: 100%; padding: 8px 16px; border: none; background: none; text-align: left; cursor: pointer; color: #333;">観光客ログイン</button>
                        <button class="dropdown-item" id="directGuideLoginBtn" type="button" style="display: block; width: 100%; padding: 8px 16px; border: none; background: none; text-align: left; cursor: pointer; color: #333;">ガイドログイン</button>
                        <button class="dropdown-item" id="sponsorLoginBtn" type="button" style="display: block; width: 100%; padding: 8px 16px; border: none; background: none; text-align: left; cursor: pointer; color: #333;">スポンサーログイン</button>
                    </div>
                </div>
                <button class="btn btn-primary" id="registerBtn">新規登録</button>
            </div>
        </div>
    </nav>

    <!-- Registration Form Container (right below the nav) -->
    <div id="registrationFormContainer" style="display: none;">
        <!-- Form will be inserted here dynamically -->
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
                    <!-- Language Switcher - Center -->
                    <div class="language-switcher-center text-center mb-4" style="display: flex !important; justify-content: center !important; align-items: center !important;">
                        <div class="d-flex flex-column flex-sm-row justify-content-center gap-3" style="justify-content: center !important; align-items: center !important; margin: 0 auto !important;">
                            <button class="lang-btn-jp btn" id="jpBtn" style="background: linear-gradient(135deg, #ff6b9d, #ff6b35); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3); transition: all 0.3s ease; min-width: 150px; margin: 0 auto !important; text-align: center !important;">🇯🇵 日本語</button>
                            <button class="lang-btn-en btn" id="enBtn" style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3); transition: all 0.3s ease; min-width: 150px; margin: 0 auto !important; text-align: center !important;">🇺🇸 English</button>
                        </div>
                    </div>

                    <!-- Hero Content -->
                    <div class="hero-content text-center">
                        <div class="hero-title-container mb-4">
                            <div class="hero-logo mb-3">
                                <img src="assets/images/tomotrip-logo.png" alt="TomoTrip Logo" class="modal-logo" />
                            </div>
                            <h1 class="display-4 fw-bold text-white">特別な旅の体験を</h1>
                        </div>
                        <p class="lead text-white mb-5">地元ガイドと一緒に観光客が知らない隠れた名所を発見しよう</p>
                        <div class="hero-buttons">
                            <div class="d-flex flex-column flex-sm-row justify-content-center gap-3">
                                <button class="btn-hero btn-primary-hero btn" id="findGuideBtn" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; padding: 15px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease; min-width: 150px; color: white;">ガイドを探す</button>
                                <button class="btn-hero btn-outline-hero btn" id="contactBtn" style="background: linear-gradient(135deg, #f093fb, #f5576c); border: none; padding: 15px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3); transition: all 0.3s ease; min-width: 150px; color: white;">お問い合わせ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Management Center Button - Desktop -->
    <button class="management-center d-none d-lg-block" id="managementBtn" title="Management Center" style="position: fixed; bottom: 30px; right: 30px; z-index: 1000; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #ffd700, #ffed4e); border: none; font-size: 24px; box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4); transition: all 0.3s ease; cursor: pointer;">🏆</button>
    
    <!-- Management Center Button - Mobile -->
    <button class="management-center-mobile d-lg-none position-fixed" id="managementBtnMobile" title="Management Center" style="bottom: 80px; right: 20px; z-index: 1000; width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #ffd700, #ffed4e); border: none; font-size: 20px; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4); transition: all 0.3s ease; cursor: pointer;">🏆</button>

    <!-- Main Content Section -->
    <section class="main-content" style="padding: 80px 0; background: #f8f9fa;">
        <div class="container">
            <!-- Filter Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="filter-section" style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <div class="d-flex flex-wrap gap-3 align-items-center justify-content-between">
                            <div class="d-flex flex-wrap gap-3">
                                <select class="form-select" style="width: auto; min-width: 180px;" id="locationFilter">
                                    <option value="">すべての地域</option>
                                    <optgroup label="北海道・東北">
                                        <option value="hokkaido">北海道</option>
                                        <option value="aomori">青森</option>
                                        <option value="iwate">岩手</option>
                                        <option value="miyagi">宮城</option>
                                        <option value="akita">秋田</option>
                                        <option value="yamagata">山形</option>
                                        <option value="fukushima">福島</option>
                                    </optgroup>
                                    <optgroup label="関東">
                                        <option value="ibaraki">茨城</option>
                                        <option value="tochigi">栃木</option>
                                        <option value="gunma">群馬</option>
                                        <option value="saitama">埼玉</option>
                                        <option value="chiba">千葉</option>
                                        <option value="tokyo">東京</option>
                                        <option value="kanagawa">神奈川</option>
                                    </optgroup>
                                    <optgroup label="中部">
                                        <option value="niigata">新潟</option>
                                        <option value="toyama">富山</option>
                                        <option value="ishikawa">石川</option>
                                        <option value="fukui">福井</option>
                                        <option value="yamanashi">山梨</option>
                                        <option value="nagano">長野</option>
                                        <option value="gifu">岐阜</option>
                                        <option value="shizuoka">静岡</option>
                                        <option value="aichi">愛知</option>
                                    </optgroup>
                                    <optgroup label="Kinki">
                                        <option value="mie">三重</option>
                                        <option value="shiga">滋賀</option>
                                        <option value="kyoto">京都</option>
                                        <option value="osaka">大阪</option>
                                        <option value="hyogo">兵庫</option>
                                        <option value="nara">奈良</option>
                                        <option value="wakayama">和歌山</option>
                                    </optgroup>
                                    <optgroup label="中国・四国">
                                        <option value="tottori">鳥取</option>
                                        <option value="shimane">島根</option>
                                        <option value="okayama">岡山</option>
                                        <option value="hiroshima">広島</option>
                                        <option value="yamaguchi">山口</option>
                                        <option value="tokushima">徳島</option>
                                        <option value="kagawa">香川</option>
                                        <option value="ehime">愛媛</option>
                                        <option value="kochi">高知</option>
                                    </optgroup>
                                    <optgroup label="九州・沖縄">
                                        <option value="fukuoka">福岡</option>
                                        <option value="saga">佐賀</option>
                                        <option value="nagasaki">長崎</option>
                                        <option value="kumamoto">熊本</option>
                                        <option value="oita">大分</option>
                                        <option value="miyazaki">宮崎</option>
                                        <option value="kagoshima">鹿児島</option>
                                        <option value="okinawa">沖縄</option>
                                    </optgroup>
                                </select>

                                <select class="form-select" style="width: auto; min-width: 160px;" id="languageFilter">
                                    <option value="">すべての言語</option>
                                    <optgroup label="Asian Languages">
                                        <option value="japanese">日本語</option>
                                        <option value="english">英語</option>
                                        <option value="chinese">中国語（簡体）</option>
                                        <option value="chinese_traditional">中国語（繁体）</option>
                                        <option value="korean">韓国語</option>
                                        <option value="thai">タイ語</option>
                                        <option value="vietnamese">ベトナム語</option>
                                        <option value="indonesian">インドネシア語</option>
                                        <option value="tagalog">タガログ語（フィリピン）</option>
                                        <option value="hindi">ヒンディー語</option>
                                    </optgroup>
                                    <optgroup label="ヨーロッパ言語">
                                        <option value="spanish">スペイン語</option>
                                        <option value="french">フランス語</option>
                                        <option value="german">ドイツ語</option>
                                        <option value="italian">イタリア語</option>
                                        <option value="portuguese">ポルトガル語</option>
                                        <option value="russian">ロシア語</option>
                                        <option value="dutch">オランダ語</option>
                                        <option value="swedish">スウェーデン語</option>
                                    </optgroup>
                                    <optgroup label="その他の言語">
                                        <option value="arabic">アラビア語</option>
                                        <option value="hebrew">ヘブライ語</option>
                                        <option value="turkish">トルコ語</option>
                                        <option value="swahili">スワヒリ語</option>
                                    </optgroup>
                                </select>
                                
                                <select class="form-select" style="width: auto; min-width: 160px;" id="priceFilter">
                                    <option value="">すべての価格</option>
                                    <option value="budget">¥6,000～¥10,000</option>
                                    <option value="premium">¥10,001～¥20,000</option>
                                    <option value="luxury">¥20,001+</option>
                                </select>
                                
                                <input type="text" class="form-control" style="width: auto; min-width: 200px;" id="keywordInput" placeholder="キーワード検索...">
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary" id="searchBtn" onclick="filterGuides()">検索</button>
                                <button class="btn btn-outline-secondary" id="resetBtn" onclick="resetFilters()">リセット</button>
                            </div>
                        </div>
                        
                        <div class="mt-3 d-flex justify-content-between align-items-center">
                            <small class="text-muted" id="guideCounter">読み込み中...</small>
                            <small class="text-info" id="totalGuideCounter">全体: 読み込み中...</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guide Cards Section -->
            <div class="row" id="guidesContainer">
                <!-- Guide cards will be populated here -->
            </div>
            
            <!-- Pagination Controls -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-outline-secondary" id="prevPageBtn" disabled>← 前のページ</button>
                        <div class="pagination-info">
                            <span id="pageInfo" class="fw-bold">ページ 1</span>
                            <small class="text-muted ms-2">(<span id="displayRange">1-12</span> 件表示中)</small>
                        </div>
                        <button class="btn btn-outline-primary" id="nextPageBtn">次のページ →</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Detailed Guide Registration Form (Hidden by default) -->
    <div id="detailedGuideRegistrationForm" style="display: none; margin-top: 2rem;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="guide-container" style="background: white; border-radius: 20px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15); margin: 2rem 0;">
                        <div class="guide-header" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 2rem; border-radius: 20px 20px 0 0; text-align: center;">
                            <h1><i class="bi bi-person-plus-fill me-2"></i>新規ガイド登録</h1>
                            <p class="mb-0">浅草観光案内所 - ガイドスタッフ募集</p>
                        </div>
                        
                        <div class="p-4">
                            <form id="detailedGuideForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="detailedGuideName" required>
                                            <label for="detailedGuideName"><i class="bi bi-person me-1"></i>ガイド名</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="email" class="form-control" id="detailedGuideEmail" required>
                                            <label for="detailedGuideEmail"><i class="bi bi-envelope me-1"></i>メールアドレス</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 電話認証セクション -->
                                <h5 class="mb-3 text-success"><i class="bi bi-telephone-fill me-2"></i>電話認証</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="tel" class="form-control" id="detailedGuidePhone" required>
                                            <label for="detailedGuidePhone"><i class="bi bi-telephone me-1"></i>電話番号</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="button" class="btn btn-outline-success w-100" id="sendVerificationCode" style="height: 58px;">
                                            <i class="bi bi-send me-1"></i>認証コード送信
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="verificationCode" placeholder="認証コード" maxlength="6">
                                            <label for="verificationCode"><i class="bi bi-shield-check me-1"></i>認証コード</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <button type="button" class="btn btn-success" id="verifyPhoneCode" disabled>
                                            <i class="bi bi-check-circle me-1"></i>電話番号を認証する
                                        </button>
                                        <span id="phoneVerificationStatus" class="text-muted ms-3"></span>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideGender" required>
                                                <option value="">選択してください</option>
                                                <option value="male">男性</option>
                                                <option value="female">女性</option>
                                                <option value="other">その他</option>
                                            </select>
                                            <label for="detailedGuideGender"><i class="bi bi-people me-1"></i>性別</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="detailedGuideAge" min="18" max="80" required>
                                            <label for="detailedGuideAge"><i class="bi bi-calendar me-1"></i>年齢</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideExperience" required>
                                                <option value="">選択してください</option>
                                                <option value="beginner">初心者（1年未満）</option>
                                                <option value="intermediate">中級者（1-3年）</option>
                                                <option value="advanced">上級者（3年以上）</option>
                                            </select>
                                            <label for="detailedGuideExperience"><i class="bi bi-award me-1"></i>経験レベル</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 身分証明書アップロード -->
                                <h5 class="mb-3 text-success"><i class="bi bi-card-checklist me-2"></i>身分証明書</h5>
                                
                                <!-- 証明書タイプ選択 -->
                                <div class="form-floating mb-3">
                                    <select class="form-control" id="documentType" required onchange="updateDocumentUpload()">
                                        <option value="">選択してください</option>
                                        <option value="drivers_license">運転免許証（表面・裏面の2枚必須）</option>
                                        <option value="passport">パスポート（写真ページ1枚）</option>
                                        <option value="residence_card">住民票（1枚）</option>
                                        <option value="insurance_card">健康保険証（表面・裏面の2枚必須）</option>
                                        <option value="mynumber_card">マイナンバーカード（表面のみ1枚）</option>
                                    </select>
                                    <label for="documentType"><i class="bi bi-card-list me-1"></i>提出する証明書タイプ</label>
                                </div>
                                
                                <!-- 動的証明書アップロード欄 -->
                                <div id="documentUploadArea" style="display: none;">
                                    <div class="alert alert-info" id="documentInstructions"></div>
                                    <div class="row mb-3" id="documentUploadCards"></div>
                                </div>
                                
                                <!-- プロフィール写真アップロード -->
                                <h5 class="mb-3 text-info"><i class="bi bi-person-square me-2"></i>プロフィール写真</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="card border-2 border-dashed border-info" style="min-height: 150px;">
                                            <div class="card-body text-center">
                                                <i class="bi bi-camera fs-1 text-info mb-2"></i>
                                                <p class="text-muted">ガイドカードに表示される写真</p>
                                                <input type="file" class="form-control" id="profilePhoto" accept="image/*" required onchange="previewProfilePhoto(this)">
                                                <small class="text-muted">風景・人物・任意の写真OK<br>（JPG、PNG対応）</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" id="profilePhotoPreviewCard" style="display: none;">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">プロフィール写真プレビュー</h6>
                                                <img id="profilePhotoPreview" class="img-fluid" style="max-height: 120px; border-radius: 10px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 画像プレビューエリア -->
                                <div class="row mb-3" id="imagePreviewArea" style="display: none;">
                                    <div id="documentPreviewCards"></div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">プロフィール写真プレビュー</h6>
                                                <img id="profilePreview" class="img-fluid" style="max-height: 200px; border-radius: 10px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <select class="form-control" id="detailedGuideLanguages" multiple required style="min-height: 120px;">
                                        <option value="japanese">日本語</option>
                                        <option value="english">英語</option>
                                        <option value="chinese">中国語</option>
                                        <option value="korean">韓国語</option>
                                        <option value="spanish">スペイン語</option>
                                        <option value="french">フランス語</option>
                                        <option value="german">ドイツ語</option>
                                        <option value="italian">イタリア語</option>
                                    </select>
                                    <label for="detailedGuideLanguages"><i class="bi bi-translate me-1"></i>対応言語（複数選択可）</label>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="detailedGuideIntroduction" style="height: 120px;" required></textarea>
                                    <label for="detailedGuideIntroduction"><i class="bi bi-chat-text me-1"></i>自己紹介・アピールポイント</label>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="detailedGuideSpecialties" style="height: 100px;" required></textarea>
                                    <label for="detailedGuideSpecialties"><i class="bi bi-star me-1"></i>得意分野・専門エリア</label>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="detailedGuideSessionRate" min="6000" max="25000" step="500" required>
                                            <label for="detailedGuideSessionRate"><i class="bi bi-currency-yen me-1"></i>希望セッション料金（円）</label>
                                            <small class="text-muted">1セッション（2〜3時間程度）の料金を設定してください（￥6,000〜）</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideAvailability" required>
                                                <option value="">選択してください</option>
                                                <option value="weekdays">平日のみ</option>
                                                <option value="weekends">週末のみ</option>
                                                <option value="both">平日・週末両方</option>
                                            </select>
                                            <label for="detailedGuideAvailability"><i class="bi bi-calendar-week me-1"></i>稼働可能日</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="detailedAgreeTerms" required>
                                    <label class="form-check-label" for="detailedAgreeTerms">
                                        ガイド規約及び利用規約に同意します
                                    </label>
                                </div>
                                
                                <!-- ガイドカードプレビューエリア -->
                                <div id="guideCardPreviewArea" style="display: none;" class="mb-4">
                                    <h5 class="mb-3 text-primary"><i class="bi bi-eye me-2"></i>ガイドカードプレビュー</h5>
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>これがあなたのガイドカードです。観光客に表示される情報を確認してください。
                                    </div>
                                    <div class="row justify-content-center">
                                        <div class="col-md-8">
                                            <div id="guideCardPreview" class="card shadow-lg border-0" style="border-radius: 15px; overflow: hidden;">
                                                <!-- Dynamic guide card content will be inserted here -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button type="button" class="btn btn-outline-primary" onclick="updateGuideCardPreview()">
                                            <i class="bi bi-arrow-clockwise me-2"></i>プレビュー更新
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-info mb-3" onclick="showGuideCardPreview()" style="border-radius: 10px;">
                                        <i class="bi bi-eye me-2"></i>ガイドカードプレビューを表示
                                    </button>
                                    <button type="submit" class="btn btn-guide" style="background: linear-gradient(135deg, #28a745, #20c997); border: none; padding: 12px; border-radius: 10px; color: white; font-weight: 600;">
                                        <i class="bi bi-check-circle me-2"></i>ガイド登録申請
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" id="guideRegistrationCancelBtn">
                                        <i class="bi bi-x-circle me-2"></i>キャンセル
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tourist Registration Modal - Completely Japanese with Verification -->
    <div class="modal fade" id="registrationModal" tabindex="-1" aria-labelledby="registrationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: none;">
                <div class="modal-header border-0 position-relative" 
                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%); 
                            color: white; border-radius: 20px 20px 0 0; padding: 25px 30px;">
                    <h5 class="modal-title fw-bold d-flex align-items-center" id="registrationModalLabel">
                        <div class="me-3" style="width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-person-plus-fill" style="font-size: 22px;"></i>
                        </div>
                        <div>
                            <div style="font-size: 1.3rem;">観光客登録</div>
                            <small style="opacity: 0.9; font-weight: normal;">電話認証と身分証明書の提出が必要です</small>
                        </div>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="閉じる" 
                            style="font-size: 1.2rem; padding: 10px;"></button>
                </div>
                
                <div class="modal-body p-0" style="max-height: 70vh; overflow-y: auto;">
                    <!-- Step Indicator -->
                    <div class="text-center mb-4 px-4 py-3" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-bottom: 1px solid #dee2e6;">
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="step-item active" id="step1-indicator">
                                <span class="badge bg-primary rounded-circle me-2">1</span>
                                基本情報
                            </div>
                            <div class="mx-3">→</div>
                            <div class="step-item" id="step2-indicator">
                                <span class="badge bg-secondary rounded-circle me-2">2</span>
                                電話認証
                            </div>
                            <div class="mx-3">→</div>
                            <div class="step-item" id="step3-indicator">
                                <span class="badge bg-secondary rounded-circle me-2">3</span>
                                身分証明書
                            </div>
                        </div>
                    </div>

                    <form id="touristRegistrationForm">
                        <!-- Step 1: Basic Information -->
                        <div class="step-content active" id="step1Content">
                            <div class="p-4">
                                <div class="alert alert-info border-0 mb-4" 
                                     style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 15px;">
                                    <div class="d-flex align-items-start">
                                        <i class="bi bi-info-circle-fill text-primary me-3" style="font-size: 1.5rem; margin-top: 2px;"></i>
                                        <div>
                                            <h6 class="fw-bold mb-2 text-primary">観光客登録について</h6>
                                            <small class="text-dark">
                                                TomoTripでは、信頼できる地元ガイドとの安全な出会いをサポートしています。
                                                ガイドの詳細情報閲覧やお問い合わせをご利用いただくため、観光客としての登録をお願いいたします。
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <h4 class="mb-3">基本情報を入力してください</h4>

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="touristFirstName" class="form-label">名</label>
                                        <input type="text" class="form-control" id="touristFirstName" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="touristLastName" class="form-label">姓</label>
                                        <input type="text" class="form-control" id="touristLastName" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristEmail" class="form-label">メールアドレス</label>
                                    <input type="email" class="form-control" id="touristEmail" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristPhone" class="form-label">電話番号</label>
                                    <input type="tel" class="form-control" id="touristPhone" placeholder="090-1234-5678" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    <div class="form-text">SMS認証コードを受信する電話番号を入力してください</div>
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristCountry" class="form-label">国籍</label>
                                    <select class="form-control" id="touristCountry" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                        <option value="">選択してください</option>
                                        <option value="japan">日本</option>
                                        <option value="usa">アメリカ合衆国</option>
                                        <option value="china">中国</option>
                                        <option value="korea">韓国</option>
                                        <option value="taiwan">台湾</option>
                                        <option value="other">その他</option>
                                    </select>
                                </div>
                                
                                <div class="d-flex justify-content-end gap-3 mt-4">
                                    <button type="button" class="btn btn-outline-secondary" onclick="clearRegistrationModal(); bootstrap.Modal.getInstance(document.getElementById('registrationModal')).hide();" style="border-radius: 25px; padding: 12px 30px;">キャンセル</button>
                                    <button type="button" class="btn btn-primary" onclick="goToStep2Modal()" style="border-radius: 25px; padding: 12px 30px;">次へ</button>
                                </div>
                                
                                <div class="row g-3 mt-1">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <select class="form-select" id="touristVisitDuration" 
                                                    style="border-radius: 12px; border: 2px solid #e9ecef; height: 58px;">
                                                <option value="">滞在期間を選択してください</option>
                                                <option value="1-3days">1〜3日間</option>
                                                <option value="4-7days">4〜7日間</option>
                                                <option value="1-2weeks">1〜2週間</option>
                                                <option value="3-4weeks">3〜4週間</option>
                                                <option value="1month+">1ヶ月以上</option>
                                            </select>
                                            <label for="touristVisitDuration">
                                                <i class="bi bi-calendar me-2 text-primary"></i>滞在予定期間
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <select class="form-select" id="touristPreferredLanguage" 
                                                    style="border-radius: 12px; border: 2px solid #e9ecef; height: 58px;">
                                                <option value="">希望ガイド言語を選択</option>
                                                <option value="japanese">日本語</option>
                                                <option value="english">英語</option>
                                                <option value="chinese">中国語</option>
                                                <option value="korean">韓国語</option>
                                                <option value="other">その他</option>
                                            </select>
                                            <label for="touristPreferredLanguage">
                                                <i class="bi bi-translate me-2 text-primary"></i>希望ガイド言語
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="touristInterests" 
                                                  placeholder="興味・希望について詳しく教えてください" 
                                                  style="border-radius: 12px; border: 2px solid #e9ecef; min-height: 100px; resize: vertical;"></textarea>
                                        <label for="touristInterests">
                                            <i class="bi bi-heart me-2 text-primary"></i>興味・希望（観光地、アクティビティなど）
                                        </label>
                                    </div>
                                    <div class="form-text">行きたい場所、体験したいこと、特別なご要望があれば詳しくお書きください</div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Phone Verification -->
                        <div class="step-content" id="step2Content" style="display: none;">
                            <div class="p-4">
                                <h4 class="mb-3">電話番号認証</h4>
                                <div class="verification-box p-4 mb-3" style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border-radius: 15px; border: 2px solid #2196f3;">
                                    <div class="text-center mb-3">
                                        <i class="bi bi-phone text-primary" style="font-size: 2.5rem;"></i>
                                        <h5 class="text-primary mt-2">📱 電話番号認証</h5>
                                    </div>
                                    <div class="alert alert-info" role="alert">
                                        <i class="bi bi-info-circle me-2"></i>
                                        <strong>簡単3ステップ!</strong> SMS認証コードで本人確認を行います
                                    </div>
                                    <p class="fw-bold mb-1" id="phoneDisplayModal"></p>
                                    
                                    <div class="mb-3" id="sendCodeSectionModal">
                                        <div class="d-grid gap-2">
                                            <button type="button" class="btn btn-primary btn-lg" id="sendCodeBtnModal" style="border-radius: 15px; padding: 15px;">
                                                <i class="bi bi-send-fill me-2"></i>📲 認証コードを送信
                                            </button>
                                        </div>
                                        <div class="text-center mt-2">
                                            <small class="text-muted">
                                                <i class="bi bi-shield-check me-1"></i>安全な認証システムで個人情報を保護
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3" id="verifyCodeSectionModal" style="display: none;">
                                        <label for="verificationCodeModal" class="form-label">認証コード（6桁）</label>
                                        <input type="text" class="form-control" id="verificationCodeModal" maxlength="6" placeholder="123456" style="border-radius: 15px; padding: 12px 20px; font-size: 1.5rem; text-align: center; letter-spacing: 0.5rem;">
                                        <div class="form-text">デモ用認証コード: 123456</div>
                                        <button type="button" class="btn btn-primary w-100 mt-2" id="verifyCodeBtnModal" style="border-radius: 15px; padding: 12px;">認証する</button>
                                    </div>
                                    
                                    <div class="text-success" id="verificationSuccessModal" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> 電話番号認証が完了しました
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" onclick="goToStep1Modal()" style="border-radius: 25px; padding: 12px 30px;">戻る</button>
                                    <button type="button" class="btn btn-primary" id="step2NextBtnModal" onclick="goToStep3Modal()" style="border-radius: 25px; padding: 12px 30px;">次へ</button>
                                </div>

                                <!-- Phone Verification -->
                                <div class="verification-section mb-4">
                                    <h6 class="fw-bold mb-3 text-primary">
                                        <i class="bi bi-telephone-fill me-2"></i>電話番号認証
                                    </h6>
                                    <div class="card border-0 shadow-sm" style="border-radius: 15px;">
                                        <div class="card-body p-4">
                                            <div class="row g-3">
                                                <div class="col-md-8">
                                                    <div class="form-floating">
                                                        <input type="tel" class="form-control" id="verificationPhone" 
                                                               placeholder="電話番号" readonly 
                                                               style="border-radius: 10px; background-color: #f8f9fa;">
                                                        <label for="verificationPhone">認証用電話番号</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <button type="button" class="btn btn-outline-primary w-100 h-100" 
                                                            id="sendSmsBtn" style="border-radius: 10px; min-height: 58px;">
                                                        <i class="bi bi-send me-2"></i>SMS送信
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3" id="smsVerificationArea" style="display: none;">
                                                <div class="row g-3">
                                                    <div class="col-md-8">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" id="smsCode" 
                                                                   placeholder="認証コード" maxlength="6" 
                                                                   style="border-radius: 10px; font-family: monospace; font-size: 1.2rem; letter-spacing: 0.1em;">
                                                            <label for="smsCode">6桁の認証コード</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <button type="button" class="btn btn-success w-100 h-100" 
                                                                id="verifySmsBtn" style="border-radius: 10px; min-height: 58px;">
                                                            <i class="bi bi-check-circle me-2"></i>認証
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="form-text text-center mt-2">
                                                    <i class="bi bi-clock me-1"></i>認証コードの有効期限: <span id="smsTimer">5:00</span>
                                                </div>
                                            </div>
                                            
                                            <div class="verification-status mt-3" id="phoneVerificationStatus">
                                                <div class="text-muted">
                                                    <i class="bi bi-info-circle me-2"></i>電話番号認証が必要です
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Document Upload -->
                                <div class="verification-section">
                                    <h6 class="fw-bold mb-3 text-primary">
                                        <i class="bi bi-file-earmark-person me-2"></i>身分証明書アップロード
                                    </h6>
                                    <div class="card border-0 shadow-sm" style="border-radius: 15px;">
                                        <div class="card-body p-4">
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">身分証明書の種類を選択してください <span class="text-success">(外国人の方もOK)</span></label>
                                                <div class="row g-2">
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="passport" value="passport">
                                                        <label class="btn btn-outline-primary w-100" for="passport" style="border-radius: 10px;">
                                                            <i class="bi bi-bookmark-star me-2"></i>パスポート
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="license" value="license">
                                                        <label class="btn btn-outline-primary w-100" for="license" style="border-radius: 10px;">
                                                            <i class="bi bi-credit-card me-2"></i>運転免許証
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="residence_card" value="residence_card">
                                                        <label class="btn btn-outline-success w-100" for="residence_card" style="border-radius: 10px;">
                                                            <i class="bi bi-person-badge me-2"></i>在留カード
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="special_resident" value="special_resident">
                                                        <label class="btn btn-outline-success w-100" for="special_resident" style="border-radius: 10px;">
                                                            <i class="bi bi-award me-2"></i>特別永住者証明書
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="insurance_card" value="insurance_card">
                                                        <label class="btn btn-outline-info w-100" for="insurance_card" style="border-radius: 10px;">
                                                            <i class="bi bi-heart me-2"></i>健康保険証
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="student_id" value="student_id">
                                                        <label class="btn btn-outline-warning w-100" for="student_id" style="border-radius: 10px;">
                                                            <i class="bi bi-mortarboard me-2"></i>学生証
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="mt-2">
                                                    <small class="text-muted">
                                                        <i class="bi bi-info-circle me-1"></i>
                                                        外国の方: パスポート、在留カード、特別永住者証明書が利用可能
                                                    </small>
                                                </div>
                                            </div>
                                            
                                            <div class="upload-area" id="documentUploadArea">
                                                <div class="alert alert-warning mb-3">
                                                    <i class="bi bi-lightbulb me-2"></i>
                                                    <strong>提出方法:</strong> 上で選択した証明書の種類に応じて、必要な面を撮影してアップロードしてください
                                                </div>
                                                
                                                <div class="row g-3 mb-3" id="uploadStepsGuide">
                                                    <div class="col-md-4">
                                                        <div class="card border-success h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-1-circle-fill text-success" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">証明書を準備</h6>
                                                                <p class="small text-muted">選択した身分証明書を手元に用意</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="card border-warning h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-2-circle-fill text-warning" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">撮影・スキャン</h6>
                                                                <p class="small text-muted">鮮明に撮影、文字が読めるように</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="card border-primary h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-3-circle-fill text-primary" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">アップロード</h6>
                                                                <p class="small text-muted">下のボタンでファイルを選択</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="border border-2 border-dashed border-primary rounded p-4 text-center" 
                                                     style="border-radius: 15px !important; background: linear-gradient(135deg, #f8f9ff, #f0f4ff);">
                                                    <i class="bi bi-cloud-upload text-primary mb-3" style="font-size: 3rem;"></i>
                                                    <h6 class="fw-bold text-primary">📄 身分証明書をアップロード</h6>
                                                    <p class="text-muted mb-3">ファイルをドラッグ&ドロップまたは下のボタンをクリック</p>
                                                    <input type="file" class="form-control d-none" id="touristDocumentUpload" 
                                                           accept="image/*,.pdf" multiple>
                                                    <button type="button" class="btn btn-primary btn-lg" onclick="document.getElementById('touristDocumentUpload').click()" 
                                                            style="border-radius: 25px; padding: 12px 30px;">
                                                        <i class="bi bi-camera me-2"></i>📱 写真を選択・撮影
                                                    </button>
                                                    <div class="form-text mt-3">
                                                        <i class="bi bi-check-circle me-1 text-success"></i>
                                                        <strong>対応形式:</strong> JPG, PNG, PDF（最大5MB）
                                                        <br>
                                                        <i class="bi bi-shield-check me-1 text-primary"></i>
                                                        <strong>セキュリティ:</strong> アップロードされた画像は暗号化されて安全に保存されます
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="uploaded-documents mt-3" id="uploadedDocuments" style="max-height: 200px; overflow-y: auto;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Document Upload -->
                        <div class="step-content" id="step3Content" style="display: none;">
                            <div class="p-4">
                                <h4 class="mb-3">身分証明書の提出</h4>
                                <div class="verification-box p-3 mb-3" style="background: #f8f9fa; border-radius: 15px; border-left: 4px solid #0984e3;">
                                    <p class="mb-3">以下のいずれかの身分証明書をアップロードしてください：</p>
                                    <ul class="mb-3">
                                        <li>パスポート</li>
                                        <li>運転免許証</li>
                                        <li>マイナンバーカード</li>
                                        <li>在留カード（外国人の方）</li>
                                    </ul>
                                    
                                    <div class="document-upload-area p-4 text-center" id="uploadAreaModal" style="border: 2px dashed #0984e3; border-radius: 15px; background: #f8f9fa; cursor: pointer;">
                                        <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #0984e3;"></i>
                                        <h5 class="mt-3">ファイルをドラッグ&ドロップ</h5>
                                        <p class="text-muted">または</p>
                                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('fileInputModal').click()" style="border-radius: 15px;">
                                            ファイルを選択
                                        </button>
                                        <input type="file" id="fileInputModal" accept="image/*,.pdf" style="display: none;">
                                        <div class="form-text mt-2">
                                            対応形式: JPG, PNG, PDF（最大5MB）
                                        </div>
                                    </div>
                                    
                                    <div id="uploadPreviewModal" style="display: none;">
                                        <img id="previewImageModal" class="upload-preview" style="max-width: 100%; max-height: 200px; border-radius: 10px; margin-top: 1rem;" alt="プレビュー">
                                        <div class="mt-2">
                                            <span id="fileNameModal" class="fw-bold"></span>
                                            <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="removeFileModal()">削除</button>
                                        </div>
                                    </div>
                                    
                                    <div class="text-success mt-3" id="uploadSuccessModal" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> 身分証明書のアップロードが完了しました
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" onclick="goToStep2FromStep3()" style="border-radius: 25px; padding: 12px 30px;">戻る</button>
                                    <button type="button" class="btn btn-primary" id="completeBtnModal" onclick="completeRegistrationModal()" disabled style="border-radius: 25px; padding: 12px 30px;">登録完了</button>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Marketing -->
                        <div class="border-top bg-light p-4" id="termsSection">
                            <div class="form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="touristAgreeTerms" required>
                                <label class="form-check-label" for="touristAgreeTerms">
                                    <a href="#" class="text-primary fw-semibold">利用規約</a>、
                                    <a href="#" class="text-primary fw-semibold">プライバシーポリシー</a>、
                                    <a href="#" class="text-primary fw-semibold">個人情報保護方針</a>に同意します 
                                    <span class="text-danger">*</span>
                                </label>
                            </div>
                            
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="touristReceiveUpdates">
                                <label class="form-check-label" for="touristReceiveUpdates">
                                    新しいガイドや特別オファーに関する情報を受け取る
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="modal-footer border-0 p-4 bg-light" style="border-radius: 0 0 20px 20px;">
                    <div class="w-100">
                        <div class="row g-2">
                            <div class="col-6">
                                <button type="button" class="btn btn-outline-secondary w-100" data-bs-dismiss="modal" 
                                        style="border-radius: 15px; padding: 12px; font-weight: 600;">
                                    <i class="bi bi-x-circle me-2"></i>キャンセル
                                </button>
                            </div>
                            <div class="col-6">
                                <button type="button" class="btn btn-primary w-100" id="nextStepBtn" 
                                        style="border-radius: 15px; padding: 12px; 
                                               background: linear-gradient(135deg, #667eea, #764ba2); 
                                               border: none; font-weight: 600;">
                                    <i class="bi bi-arrow-right me-2"></i>次へ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #6f42c1, #5a32a3); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="loginModalLabel">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Login
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="login-type-indicator" id="loginTypeIndicator">
                            <span class="badge bg-primary fs-6" id="loginTypeBadge">Tourist Login</span>
                        </div>
                    </div>
                    
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label fw-bold">
                                <i class="bi bi-envelope me-2"></i>Email Address
                            </label>
                            <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label fw-bold">
                                <i class="bi bi-lock me-2"></i>Password
                            </label>
                            <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">
                                Remember me
                            </label>
                        </div>
                    </form>
                    
                    <div class="alert alert-info" style="border-radius: 10px;">
                        <small><i class="bi bi-info-circle me-2"></i>For first-time users, please register as a tourist first to access guide details and booking features.</small>
                    </div>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="loginSubmitBtn" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #6f42c1, #5a32a3); border: none;">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Login
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #20c997, #17a2b8); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="contactModalLabel">
                        <i class="bi bi-envelope me-2"></i>Contact Us
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label fw-bold">
                                <i class="bi bi-person me-2"></i>Name
                            </label>
                            <input type="text" class="form-control" id="contactName" placeholder="Your name" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label fw-bold">
                                <i class="bi bi-envelope me-2"></i>Email
                            </label>
                            <input type="email" class="form-control" id="contactEmail" placeholder="your.email@example.com" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="contactSubject" class="form-label fw-bold">
                                <i class="bi bi-chat-dots me-2"></i>Subject
                            </label>
                            <select class="form-select" id="contactSubject" required style="border-radius: 10px; padding: 12px;">
                                <option value="">Select a subject</option>
                                <option value="general">General Inquiry</option>
                                <option value="guide">Guide Registration</option>
                                <option value="sponsor">Sponsor Partnership</option>
                                <option value="technical">Technical Support</option>
                                <option value="feedback">Feedback</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label fw-bold">
                                <i class="bi bi-chat-text me-2"></i>Message
                            </label>
                            <textarea class="form-control" id="contactMessage" rows="4" placeholder="Please describe your inquiry or feedback..." required style="border-radius: 10px; padding: 12px;"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="contactSubmitBtn" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #20c997, #17a2b8); border: none;">
                        <i class="bi bi-send me-2"></i>Send Message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Complete English version with all Japanese functionality

        // Location mappings in English
        const locationNames = {
            'tokyo': 'Tokyo', 'kyoto': 'Kyoto', 'osaka': 'Osaka', 'hiroshima': 'Hiroshima',
            'hokkaido': 'Hokkaido', 'okinawa': 'Okinawa', 'nagano': 'Nagano',
            'aomori': 'Aomori', 'iwate': 'Iwate', 'miyagi': 'Miyagi', 'akita': 'Akita',
            'yamagata': 'Yamagata', 'fukushima': 'Fukushima', 'ibaraki': 'Ibaraki',
            'tochigi': 'Tochigi', 'gunma': 'Gunma', 'saitama': 'Saitama', 'chiba': 'Chiba',
            'kanagawa': 'Kanagawa', 'niigata': 'Niigata', 'toyama': 'Toyama',
            'ishikawa': 'Ishikawa', 'fukui': 'Fukui', 'yamanashi': 'Yamanashi',
            'gifu': 'Gifu', 'shizuoka': 'Shizuoka', 'aichi': 'Aichi', 'mie': 'Mie',
            'shiga': 'Shiga', 'hyogo': 'Hyogo', 'nara': 'Nara', 'wakayama': 'Wakayama',
            'tottori': 'Tottori', 'shimane': 'Shimane', 'okayama': 'Okayama',
            'yamaguchi': 'Yamaguchi', 'tokushima': 'Tokushima', 'kagawa': 'Kagawa',
            'ehime': 'Ehime', 'kochi': 'Kochi', 'fukuoka': 'Fukuoka', 'saga': 'Saga',
            'nagasaki': 'Nagasaki', 'kumamoto': 'Kumamoto', 'oita': 'Oita',
            'miyazaki': 'Miyazaki', 'kagoshima': 'Kagoshima'
        };

        // Default guides data (English version)
        const defaultGuides = [
            {
                id: 1, name: "Hiroshi Tanaka", location: "tokyo", languages: ["japanese", "english"], 
                price: 8000, rating: 4.8, specialty: "文化ツアー", image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=300&h=300&fit=crop&crop=face",
                description: "観光客が知らない本物の東京を体験しよう"
            },
            {
                id: 2, name: "Yuki Sato", location: "kyoto", languages: ["japanese", "english", "chinese"], 
                price: 9500, rating: 4.9, specialty: "寺院・庭園", image: "https://images.unsplash.com/photo-1494790108755-2616c9a84d84?w=300&h=300&fit=crop&crop=face",
                description: "京都の美しい寺院と庭園を発見しよう"
            },
            {
                id: 3, name: "Kenji Yamamoto", location: "osaka", languages: ["japanese", "korean"], 
                price: 7000, rating: 4.7, specialty: "Food Culture", image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=300&h=300&fit=crop&crop=face",
                description: "大阪の素晴らしい食文化を探索しよう"
            },
            {
                id: 4, name: "Hanako Yamada", location: "hiroshima", languages: ["japanese", "english"], 
                price: 8500, rating: 4.6, specialty: "Peace History", image: "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=300&h=300&fit=crop&crop=face",
                description: "平和と武島の歴史を学ぼう"
            },
            {
                id: 5, name: "Shota Takahashi", location: "tokyo", languages: ["japanese", "english"], 
                price: 12000, rating: 4.8, specialty: "Modern Culture", image: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=300&h=300&fit=crop&crop=face",
                description: "最先端の東京文化を体験しよう"
            },
            {
                id: 6, name: "Ai Nakamura", location: "kyoto", languages: ["japanese", "chinese"], 
                price: 10500, rating: 4.9, specialty: "Traditional Crafts", image: "https://images.unsplash.com/photo-1607746882042-944635dfe10e?w=300&h=300&fit=crop&crop=face",
                description: "京都の伝統工芸を体験しよう"
            },
            {
                id: 7, name: "Yuichi Watanabe", location: "osaka", languages: ["japanese", "english", "korean"], 
                price: 6500, rating: 4.5, specialty: "Nightlife", image: "https://images.unsplash.com/photo-1463453091185-61582044d556?w=300&h=300&fit=crop&crop=face",
                description: "大阪の活気あるナイトライフを楽しもう"
            },
            {
                id: 8, name: "Ayaka Hayashi", location: "hiroshima", languages: ["japanese", "english", "chinese"], 
                price: 9000, rating: 4.7, specialty: "自然・景観", image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=300&h=300&fit=crop&crop=face",
                description: "広島の美しい自然を探索しよう"
            },
            {
                id: 9, name: "Makoto Kobayashi", location: "tokyo", languages: ["japanese", "english"], 
                price: 25000, rating: 4.9, specialty: "Luxury Experience", image: "https://images.unsplash.com/photo-1507591064344-4c6ce005b128?w=300&h=300&fit=crop&crop=face",
                description: "プレミアムな東京体験を楽しもう"
            },
            {
                id: 10, name: "Mai Inoue", location: "kyoto", languages: ["japanese", "english"], 
                price: 9800, rating: 4.8, specialty: "Kimono Culture", image: "https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=300&h=300&fit=crop&crop=face",
                description: "着物で京都文化を体験しよう"
            },
            {
                id: 11, name: "Ken Morita", location: "osaka", languages: ["japanese", "korean"], 
                price: 7500, rating: 4.6, specialty: "Local Markets", image: "https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=300&h=300&fit=crop&crop=face",
                description: "地元の市場や街を発見しよう"
            },
            {
                id: 12, name: "Yui Shimizu", location: "hiroshima", languages: ["japanese", "english", "chinese"], 
                price: 11000, rating: 4.8, specialty: "Island Hopping", image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=300&h=300&fit=crop&crop=face",
                description: "美しい瀬戸内海の島々を探索しよう"
            },
            {
                id: 13, name: "Taro Aoki", location: "hokkaido", languages: ["japanese", "english", "russian"], 
                price: 15000, rating: 4.7, specialty: "Snow Festival & Winter", image: "https://images.unsplash.com/photo-1559190394-90dfc4e2e3a8?w=300&h=300&fit=crop&crop=face",
                description: "北海道の自然と冬の魅力を体験しよう"
            },
            {
                id: 14, name: "Miyuki Ishikawa", location: "okinawa", languages: ["japanese", "english", "chinese"], 
                price: 13500, rating: 4.9, specialty: "Marine Activities", image: "https://images.unsplash.com/photo-1554693166-fcc388b4bb45?w=300&h=300&fit=crop&crop=face",
                description: "沖縄の美しい海と文化を楽しもう"
            },
            {
                id: 15, name: "Kengo Matsumoto", location: "nagano", languages: ["japanese", "english", "german"], 
                price: 11500, rating: 4.6, specialty: "Mountains & Hot Springs", image: "https://images.unsplash.com/photo-1506277886164-e25aa3f4ef7f?w=300&h=300&fit=crop&crop=face",
                description: "長野の山の美しさと温泉を発見しよう"
            }
        ];

        // Initialize guides with registered guides included
        let guideData = loadAllGuides();
        let currentGuides = guideData;
        let displayedGuides = [];
        let currentPage = 1;
        const guidesPerPage = 12;

        // Load all guides function
        function loadAllGuides() {
            try {
                const registeredGuides = JSON.parse(localStorage.getItem('registeredGuides') || '[]');
                const newRegisteredGuides = JSON.parse(localStorage.getItem('newRegisteredGuides') || '[]');
                
                // Check for individually stored guides (from new registration system)
                const individualGuides = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('guide_')) {
                        try {
                            const guide = JSON.parse(localStorage.getItem(key));
                            if (guide && guide.id) {
                                individualGuides.push(guide);
                            }
                        } catch (e) {
                            console.warn('Error parsing individual guide:', key);
                        }
                    }
                }
                
                console.log(`📊 Loaded ${registeredGuides.length} registered guides + ${newRegisteredGuides.length} new guides + ${individualGuides.length} individual guides`);
                
                const allGuides = [...defaultGuides, ...registeredGuides, ...newRegisteredGuides, ...individualGuides];
                
                // Remove duplicates based on ID
                const uniqueGuides = allGuides.filter((guide, index, self) => 
                    index === self.findIndex(g => g.id === guide.id)
                );
                
                console.log(`📊 Total unique guides: ${uniqueGuides.length} (${defaultGuides.length} default + ${uniqueGuides.length - defaultGuides.length} dynamic)`);
                
                return uniqueGuides;
            } catch (error) {
                console.error('Error loading guides:', error);
                return defaultGuides;
            }
        }

        // Generate guide card HTML
        function createGuideCard(guide) {
            return `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100 guide-card" style="border-radius: 15px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.1); transition: transform 0.3s ease;">
                        <img src="${guide.image}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="${guide.name}">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-1">${guide.name}</h5>
                                <div class="d-flex gap-1">
                                    <button class="btn btn-sm btn-outline-warning bookmark-btn" data-guide-id="${guide.id}" title="Bookmark">⭐</button>
                                    <button class="btn btn-sm btn-outline-success compare-btn" data-guide-id="${guide.id}" title="Add to compare">✓</button>
                                </div>
                            </div>
                            <div class="mb-2">
                                <span class="badge bg-primary me-1">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown')}</span>
                                <span class="badge bg-secondary">${guide.specialty}</span>
                            </div>
                            <p class="card-text text-muted small mb-2">${guide.description}</p>
                            <div class="d-flex justify-content-between align-items-center mt-auto">
                                <div>
                                    <span class="text-warning">★</span>
                                    <span class="fw-bold">${guide.rating}</span>
                                </div>
                                <div class="text-end">
                                    <div class="fw-bold text-primary">¥${Number(guide?.price || 0).toLocaleString()}</div>
                                    <small class="text-muted">${getLocalizedText('perDay')}</small>
                                </div>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-primary w-100 view-detail-btn" data-guide-id="${guide.id}" style="border-radius: 25px;">
                                    ${getLocalizedText('viewDetails')}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Display guides with pagination
        // Language detection for dynamic content
        function getCurrentPageLanguage() {
            const path = window.location.pathname;
            const filename = window.location.pathname.split('/').pop();
            return filename === 'index-en.html' ? 'en' : 'ja';
        }
        
        // Get localized text based on current page
        function getLocalizedText(key) {
            const lang = getCurrentPageLanguage();
            const translations = {
                ja: {
                    viewDetails: '詳細を見る',
                    perDay: '一日あたり',
                    showMore: 'もっと見る',
                    loading: '読み込み中...',
                    culturalTours: '文化ツアー',
                    foodTours: 'フードツアー',
                    natureTours: '自然ツアー',
                    historicalTours: '歴史ツアー',
                    templesTours: '寺院・庭園'
                },
                en: {
                    viewDetails: 'View Details',
                    perDay: 'per day',
                    showMore: 'Show More',
                    loading: '読み込み中...',
                    culturalTours: 'Cultural Tours',
                    foodTours: 'Food Tours',
                    natureTours: 'Nature Tours',
                    historicalTours: 'Historical Tours',
                    templesTours: 'Temples & Gardens'
                }
            };
            return translations[lang][key] || key;
        }

        function displayGuides(allGuides, page = 1) {
            currentPage = page;
            const startIndex = (page - 1) * guidesPerPage;
            const endIndex = startIndex + guidesPerPage;
            const pageGuides = allGuides.slice(startIndex, endIndex);
            
            displayedGuides = pageGuides;
            const container = document.getElementById('guidesContainer');
            container.innerHTML = pageGuides.map(guide => createGuideCard(guide)).join('');
            
            updateCounter();
            updatePaginationControls(allGuides.length);
            
            // Critical: Re-add event listeners after DOM update
            console.log('🔧 Re-adding card event listeners after guide display');
            setTimeout(() => {
                addCardEventListeners();
                console.log('✅ Card event listeners added');
            }, 100);
        }
        
        // Update pagination controls
        function updatePaginationControls(totalGuides) {
            const totalPages = Math.ceil(totalGuides / guidesPerPage);
            const startIndex = (currentPage - 1) * guidesPerPage + 1;
            const endIndex = Math.min(currentPage * guidesPerPage, totalGuides);
            
            document.getElementById('pageInfo').textContent = `Page ${currentPage} / ${totalPages}`;
            document.getElementById('displayRange').textContent = `${startIndex}-${endIndex}`;
            
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            
            prevBtn.style.opacity = currentPage === 1 ? '0.5' : '1';
            nextBtn.style.opacity = currentPage === totalPages ? '0.5' : '1';
        }

        // Update guide counter
        function updateCounter() {
            const totalElement = document.getElementById('totalGuides');
            if (totalElement) {
                totalElement.textContent = currentGuides.length;
            }
            
            // 検索数表示システム - 全体のガイド数と検索結果数
            updateSearchCounters();
        }
        
        // 検索数表示カウンターシステム
        function updateSearchCounters() {
            const guideCounterElement = document.getElementById('guideCounter');
            const totalGuideCounterElement = document.getElementById('totalGuideCounter');
            
            // 全登録ガイド数（デフォルト15 + 新規登録）
            const totalRegisteredGuides = (typeof allGuides !== 'undefined') ? allGuides.length : (currentGuides?.length || 15);
            
            // 現在表示されている（フィルター後の）ガイド数
            const filteredGuides = currentGuides.length;
            
            // 現在のページで表示されているガイド数
            const displayedCount = Math.min(guidesPerPage, filteredGuides - (currentPage - 1) * guidesPerPage);
            const startIndex = (currentPage - 1) * guidesPerPage + 1;
            const endIndex = Math.min(currentPage * guidesPerPage, filteredGuides);
            
            if (guideCounterElement && totalGuideCounterElement) {
                // 言語に応じたカウンター表示
                const lang = getCurrentPageLanguage();
                if (lang === 'ja') {
                    guideCounterElement.textContent = `${startIndex}-${endIndex}件表示中 (${filteredGuides}件中)`;
                    totalGuideCounterElement.textContent = `全体: ${totalRegisteredGuides}名のガイドが登録済み`;
                } else {
                    guideCounterElement.textContent = `${startIndex}-${endIndex} shown (${filteredGuides} total)`;
                    totalGuideCounterElement.textContent = `Total: ${totalRegisteredGuides} guides registered`;
                }
            }
        }

        // Add event listeners to cards
        function addCardEventListeners() {
            console.log('🔧 Adding event listeners to View Details buttons...');
            const viewDetailButtons = document.querySelectorAll('.view-detail-btn');
            console.log(`Found ${viewDetailButtons.length} View Details buttons`);
            
            viewDetailButtons.forEach((btn, index) => {
                const guideId = btn.getAttribute('data-guide-id');
                console.log(`Setting up button ${index + 1} for guide ID: ${guideId}`);
                
                // Remove existing listeners
                btn.replaceWith(btn.cloneNode(true));
                const newBtn = document.querySelectorAll('.view-detail-btn')[index];
                
                newBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('🔥 View Details button clicked for guide:', guideId);
                    viewGuideDetail(guideId);
                });
            });

            document.querySelectorAll('.bookmark-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const guideId = this.getAttribute('data-guide-id');
                    toggleBookmark(guideId);
                });
            });

            document.querySelectorAll('.compare-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const guideId = this.getAttribute('data-guide-id');
                    toggleComparison(guideId);
                });
            });
        }

        // Removed empty viewGuideDetail function - full implementation exists later

        // Add to bookmarks
        function addToBookmarks(guideId) {
            console.log('Add to bookmarks:', guideId);
        }

        // Add to comparison
        function addToComparison(guideId) {
            console.log('Add to comparison:', guideId);
        }

        // Filter functions moved to app-init.mjs to prevent conflicts

        // Reset function moved to app-init.mjs to prevent conflicts

        // Tourist Registration functions moved to app-init.mjs to prevent conflicts
        
        function goToStep1Modal() {
            document.getElementById('step2Content').style.display = 'none';
            document.getElementById('step1Content').style.display = 'block';
            
            // Reset indicators
            document.getElementById('step1-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-secondary rounded-circle me-2';
        }
        
        function goToStep3Modal() {
            document.getElementById('step2Content').style.display = 'none';
            document.getElementById('step3Content').style.display = 'block';
            
            // Update indicators
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-success rounded-circle me-2';
            document.getElementById('step3-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
        }
        
        function goToStep2FromStep3() {
            document.getElementById('step3Content').style.display = 'none';
            document.getElementById('step2Content').style.display = 'block';
            
            // Reset indicators
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
            document.getElementById('step3-indicator').querySelector('.badge').className = 'badge bg-secondary rounded-circle me-2';
        }
        
        function completeRegistrationModal() {
            alert('登録が完了しました！');
            const modal = bootstrap.Modal.getInstance(document.getElementById('registrationModal'));
            modal.hide();
        }
        
        function removeFileModal() {
            document.getElementById('uploadPreviewModal').style.display = 'none';
            document.getElementById('fileInputModal').value = '';
            document.getElementById('completeBtnModal').disabled = true;
            document.getElementById('uploadSuccessModal').style.display = 'none';
        }

        // Price conversion function
        function getPriceFromRange(rangeValue) {
            const priceRanges = {
                '¥6,000~¥10,000': '¥8,000',
                '¥10,000~¥15,000': '¥12,500',
                '¥15,000~¥20,000': '¥17,500',
                '¥20,000~¥30,000': '¥25,000',
                '¥30,000~¥50,000': '¥40,000',
                '¥50,000+': '¥60,000'
            };
            return priceRanges[rangeValue] || '';
        }



        // Language switching functions
        function switchToJapanese() {
            console.log('🇯🇵 日本語選択 - 既に日本語版です');
            alert('既に日本語版を表示しています');
        }

        function switchToEnglish() {
            console.log('🇺🇸 English selected - switching to English page');
            window.location.href = 'index-en.html';
        }

        // Login dropdown toggle
        function toggleLoginDropdown() {
            const dropdown = document.getElementById('customLoginDropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('customLoginDropdown');
            const button = document.getElementById('loginDropdown');
            
            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });



        // View guide detail with access control - redirect to detail page
        function viewGuideDetail(guideId) {
            console.log('Opening guide detail page for guide:', guideId);
            
            // Check if user is registered
            const touristData = localStorage.getItem('touristData');
            console.log('Tourist registration status:', touristData ? 'REGISTERED' : 'NOT REGISTERED');
            
            if (!touristData) {
                // Show registration modal for unregistered users
                console.log('Showing registration modal for unregistered user');
                const registrationModal = new bootstrap.Modal(document.getElementById('registrationModal'));
                registrationModal.show();
                return;
            }

            // Store all guides data for the detail page
            const allGuides = loadAllGuides();
            localStorage.setItem('allGuides', JSON.stringify(allGuides));
            
            // Redirect to guide detail page
            console.log('Redirecting to guide detail page for registered user');
            window.location.href = `/guide-detail.html?id=${guideId}`;
        }

        // Show guide detail modal
        function showGuideDetailModal(guide) {
            console.log('🔧 Creating guide detail modal for:', guide.name);
            try {
                const detailModal = document.createElement('div');
                detailModal.className = 'modal fade';
                detailModal.innerHTML = `
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content" style="border-radius: 15px; box-shadow: 0 15px 50px rgba(0,0,0,0.2);">
                        <div class="modal-header border-0" style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border-radius: 15px 15px 0 0;">
                            <h5 class="modal-title fw-bold">
                                <i class="bi bi-person-circle me-2"></i>Guide Details
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="${guide.image}" class="img-fluid rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                                    <div class="text-center">
                                        <span class="text-warning">★</span>
                                        <span class="fw-bold">${guide.rating}</span>
                                    </div>
                                    <div class="fw-bold text-primary fs-4">¥${Number(guide?.price || 0).toLocaleString()}</div>
                                    <small class="text-muted">${getLocalizedText('perDay')}</small>
                                </div>
                                <div class="col-md-8">
                                    <h6 class="text-primary mb-3">Basic Information</h6>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Location:</strong></div>
                                        <div class="col-sm-8">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Specialty:</strong></div>
                                        <div class="col-sm-8">${guide.specialty}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Languages:</strong></div>
                                        <div class="col-sm-8">
                                            ${guide.languages.map(lang => {
                                                const langMap = {
                                                    'ja': '日本語', 'japanese': '日本語',
                                                    'en': '英語', 'english': '英語', 
                                                    'zh': '中国語', 'chinese': '中国語',
                                                    'ko': '韓国語', 'korean': '韓国語',
                                                    'es': 'スペイン語', 'spanish': 'スペイン語',
                                                    'fr': 'フランス語', 'french': 'フランス語',
                                                    'de': 'ドイツ語', 'german': 'ドイツ語',
                                                    'it': 'イタリア語', 'italian': 'イタリア語'
                                                };
                                                return langMap[lang.toLowerCase()] || lang;
                                            }).join(', ')}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="text-primary">Guide Introduction</h6>
                                        <p class="text-muted">${guide.description}</p>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="text-primary">Service Details</h6>
                                        <ul class="text-muted">
                                            <li>Professional guide service</li>
                                            <li>Safe local support</li>
                                            <li>Photography service</li>
                                            <li>Recommended spot guidance</li>
                                            <li>Cultural and historical explanations</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-success" onclick="bookGuide(${guide.id})">
                                <i class="bi bi-calendar-check me-2"></i>Book Now
                            </button>
                            <button type="button" class="btn btn-outline-primary" onclick="contactGuide(${guide.id})">
                                <i class="bi bi-chat-dots me-2"></i>Message
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            console.log('📱 Appending modal to DOM...');
            document.body.appendChild(detailModal);
            
            console.log('🔧 Creating Bootstrap modal instance...');
            const modal = new bootstrap.Modal(detailModal);
            
            console.log('🚀 Showing modal...');
            modal.show();
            
            console.log('✅ Modal shown successfully');
            
            // Clean up modal after hiding
            detailModal.addEventListener('hidden.bs.modal', function() {
                console.log('🗑️ Cleaning up modal...');
                detailModal.remove();
            });
            
            } catch (error) {
                console.error('❌ Error creating guide detail modal:', error);
                alert('Error showing guide details: ' + error.message);
            }
        }

        // Booking and contact functions
        window.bookGuide = function(guideId) {
            // Close the guide detail modal first
            const openModal = document.querySelector('.modal.show');
            if (openModal) {
                const modalInstance = bootstrap.Modal.getInstance(openModal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            }
            
            // Wait a moment for the modal to close, then open booking
            setTimeout(() => {
                showBookingModal(guideId);
            }, 300);
        }

        window.contactGuide = function(guideId) {
            // Close the guide detail modal first
            const openModal = document.querySelector('.modal.show');
            if (openModal) {
                const modalInstance = bootstrap.Modal.getInstance(openModal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            }
            
            // Wait a moment for the modal to close, then open chat
            setTimeout(() => {
                showChatModal(guideId);
            }, 300);
        }

        // Login functionality
        function showLoginModal(loginType) {
            return new Promise((resolve) => {
                try {
                    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                    loginModal.show();
                    document.getElementById('loginModal').setAttribute('data-login-type', loginType);
                    
                    // Update modal content based on login type
                    const badge = document.getElementById('loginTypeBadge');
                    if (loginType === 'tourist') {
                        badge.textContent = 'Tourist Login';
                        badge.className = 'badge bg-primary fs-6';
                    } else if (loginType === 'guide') {
                        badge.textContent = 'Guide Login';
                        badge.className = 'badge bg-success fs-6';
                    }
                    
                    resolve(true);
                } catch (error) {
                    const modalElement = document.getElementById('loginModal');
                    if (modalElement) {
                        modalElement.style.display = 'block';
                        modalElement.classList.add('show');
                        modalElement.style.backgroundColor = 'rgba(0,0,0,0.5)';
                    }
                    resolve(false);
                }
            });
        }

        // Registration choice modal is now handled by event-handlers.mjs

        // Tourist registration is now handled by event-handlers.mjs

        // All registration functionality is now handled by event-handlers.mjs
        
        // Guide registration is now handled by event-handlers.mjs - function removed to prevent conflicts

        // Setup dropdown listeners
        function setupCustomDropdownListeners() {
            const touristBtn = document.getElementById('directTouristLoginBtn');
            const guideBtn = document.getElementById('directGuideLoginBtn');
            
            if (touristBtn) {
                touristBtn.onclick = function() {
                    showLoginModal('tourist').catch(() => {});
                    document.getElementById('customLoginDropdown').style.display = 'none';
                    return false;
                };
            }
            
            if (guideBtn) {
                guideBtn.onclick = function() {
                    showLoginModal('guide').catch(() => {});
                    document.getElementById('customLoginDropdown').style.display = 'none';
                    return false;
                };
            }
        }

        // Get price from range selection
        function getPriceFromRange(rangeValue) {
            if (!rangeValue) return null;
            
            const rangeMap = {
                '6000-10000': 8000,
                '10000-15000': 12500,
                '15000-20000': 17500,
                '20000-25000': 22500,
                '25000-30000': 27500,
                '30000+': 35000
            };
            
            return rangeMap[rangeValue] || null;
        }

        // Update guide display with registered guides
        function updateGuideDisplay() {
            const registeredGuides = JSON.parse(localStorage.getItem('registeredGuides') || '[]');
            
            // Combine default guides with registered guides
            currentGuides = [...defaultGuides, ...registeredGuides];
            guideData = currentGuides;
            
            // Re-display guides
            displayGuides(currentGuides);
            
            console.log(`📊 Updated guide display: ${defaultGuides.length} default + ${registeredGuides.length} registered = ${currentGuides.length} total`);
        }

        // Global functions now handled by app-init.mjs to prevent conflicts

        // Initialize page - manual event listeners (app-init.mjs handles main initialization)
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners for search and filter functionality
            const searchBtn = document.getElementById('searchBtn');
            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    if (window.filterGuides) {
                        window.filterGuides();
                    } else {
                        alert('検索機能を準備中です');
                    }
                });
            }
            
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    if (window.resetFilters) {
                        window.resetFilters();
                    } else {
                        location.reload();
                    }
                });
            }
            
            // Tourist registration modal event listeners
            const sendCodeBtn = document.getElementById('sendCodeBtnModal');
            if (sendCodeBtn) {
                sendCodeBtn.addEventListener('click', function() {
                    document.getElementById('sendCodeSectionModal').style.display = 'none';
                    document.getElementById('verifyCodeSectionModal').style.display = 'block';
                });
            }
            
            const verifyCodeBtn = document.getElementById('verifyCodeBtnModal');
            if (verifyCodeBtn) {
                verifyCodeBtn.addEventListener('click', function() {
                    const code = document.getElementById('verificationCodeModal').value;
                    if (code === '123456') {
                        document.getElementById('verifyCodeSectionModal').style.display = 'none';
                        document.getElementById('verificationSuccessModal').style.display = 'block';
                        document.getElementById('step2NextBtnModal').disabled = false;
                    } else {
                        alert('認証コードが正しくありません。');
                    }
                });
            }
            
            const fileInput = document.getElementById('fileInputModal');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        document.getElementById('fileNameModal').textContent = file.name;
                        document.getElementById('uploadPreviewModal').style.display = 'block';
                        document.getElementById('uploadSuccessModal').style.display = 'block';
                        document.getElementById('completeBtnModal').disabled = false;
                        
                        // Show preview for images
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                document.getElementById('previewImageModal').src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                });
            }
            
            // Add change event listeners for filters to enable real-time filtering
            const locationFilter = document.getElementById('locationFilter');
            const languageFilter = document.getElementById('languageFilter');
            const priceFilter = document.getElementById('priceFilter');
            const keywordInput = document.getElementById('keywordInput');
            
            if (locationFilter) locationFilter.addEventListener('change', filterGuides);
            if (languageFilter) languageFilter.addEventListener('change', filterGuides);
            if (priceFilter) priceFilter.addEventListener('change', filterGuides);
            if (keywordInput) keywordInput.addEventListener('input', filterGuides);
            
            // Registration button event - show choice modal (handled by app-init.mjs)
            // const regBtn = document.getElementById('registerBtn');
            // if (regBtn) {
            //     regBtn.addEventListener('click', function(e) {
            //         e.preventDefault();
            //         console.log('Registration button clicked!');
            //         showRegistrationChoice();
            //     });
            // }
            
            // Initialize chat listeners
            // initializeChatListeners(); // Handled by app-init.mjs
            
            // Registration form submission
            document.getElementById('registerSubmitBtn').addEventListener('click', function() {
                const form = document.getElementById('registrationForm');
                const formData = {
                    realName: {
                        first: document.getElementById('realFirstName').value.trim(),
                        last: document.getElementById('realLastName').value.trim()
                    },
                    email: document.getElementById('email').value.trim(),
                    country: document.getElementById('country').value,
                    phone: document.getElementById('phone').value.trim(),
                    visitPurpose: document.getElementById('visitPurpose').value,
                    visitDuration: document.getElementById('visitDuration').value,
                    preferredLanguage: document.getElementById('preferredLanguage').value,
                    interests: document.getElementById('interests').value.trim(),
                    agreeTerms: document.getElementById('agreeTerms').checked,
                    receiveUpdates: document.getElementById('receiveUpdates').checked
                };

                // Validate required fields
                if (!formData.realName.first || !formData.realName.last || !formData.email || !formData.country) {
                    alert('Please fill in all required fields (marked with *)');
                    return;
                }

                if (!formData.agreeTerms) {
                    alert('Please agree to the Terms of Service and Privacy Policy');
                    return;
                }

                // Save tourist data
                try {
                    const touristData = {
                        ...formData,
                        registrationDate: new Date().toISOString(),
                        id: Date.now()
                    };
                    
                    localStorage.setItem('touristData', JSON.stringify(touristData));
                    
                    // Close modal
                    const registrationModal = bootstrap.Modal.getInstance(document.getElementById('registrationModal'));
                    registrationModal.hide();
                    
                    // Show success message
                    setTimeout(() => {
                        alert('Registration completed successfully!\n\nYou can now view guide details and book tours.');
                    }, 500);
                    
                } catch (error) {
                    console.error('Registration error:', error);
                    alert('An error occurred during registration. Please try again.');
                }
            });

            // Login form submission
            document.getElementById('loginSubmitBtn').addEventListener('click', function() {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                
                if (!email || !password) {
                    alert('Please enter both email and password.');
                    return;
                }
                
                // For development - simulate successful login
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                loginModal.hide();
                
                setTimeout(() => {
                    alert('Login successful!\n\nNote: Login functionality is currently under development. Actual authentication will be implemented soon.');
                }, 500);
            });

            // Contact form submission
            document.getElementById('contactSubmitBtn').addEventListener('click', function() {
                const name = document.getElementById('contactName').value.trim();
                const email = document.getElementById('contactEmail').value.trim();
                const subject = document.getElementById('contactSubject').value;
                const message = document.getElementById('contactMessage').value.trim();
                
                if (!name || !email || !subject || !message) {
                    alert('Please fill in all fields.');
                    return;
                }
                
                // Close modal
                const contactModal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
                contactModal.hide();
                
                setTimeout(() => {
                    alert('Thank you for your message!\n\nWe will respond to your inquiry within 24 hours.');
                }, 500);
            });

            // Guide Registration Functions
            let isGuidePhoneVerified = false;

            // Profile photo preview for guide
            document.getElementById('guideProfilePhoto').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const preview = document.getElementById('guideProfilePreview');
                const placeholder = document.getElementById('guidePhotoPlaceholder');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        placeholder.style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Guide phone verification
            document.getElementById('guideSendVerificationBtn').addEventListener('click', function() {
                const phone = document.getElementById('guidePhone').value;
                if (phone.match(/^[0-9+\-()]+$/)) {
                    document.getElementById('guideVerificationCodeSection').style.display = 'block';
                    this.disabled = true;
                    this.textContent = 'Sent';
                    
                    // Simulate SMS sending
                    alert('Verification code sent! (Demo: enter "123456")');
                } else {
                    alert('Please enter a valid phone number');
                }
            });

            document.getElementById('guideVerifyCodeBtn').addEventListener('click', function() {
                const code = document.getElementById('guideVerificationCode').value;
                if (code === '123456') {
                    isGuidePhoneVerified = true;
                    this.textContent = 'Verified';
                    this.disabled = true;
                    this.classList.remove('btn-success');
                    this.classList.add('btn-outline-success');
                    document.getElementById('guideVerificationCode').disabled = true;
                    alert('Phone verification completed!');
                } else {
                    alert('Invalid verification code');
                }
            });

            // Guide price handling
            document.getElementById('guidePriceRange').addEventListener('change', function() {
                const priceInput = document.getElementById('guidePriceInput');
                if (this.value) {
                    priceInput.value = '';
                    priceInput.disabled = true;
                } else {
                    priceInput.disabled = false;
                }
            });

            document.getElementById('guidePriceInput').addEventListener('input', function() {
                const priceRange = document.getElementById('guidePriceRange');
                if (this.value) {
                    priceRange.value = '';
                    priceRange.disabled = true;
                } else {
                    priceRange.disabled = false;
                }
            });

            // Detailed guide registration form submission
            const detailedGuideForm = document.getElementById('detailedGuideForm');
            if (detailedGuideForm) {
                detailedGuideForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        guideName: document.getElementById('detailedGuideName').value.trim(),
                        email: document.getElementById('detailedGuideEmail').value.trim(),
                        phone: document.getElementById('detailedGuidePhone').value.trim(),
                        gender: document.getElementById('detailedGuideGender').value,
                        age: parseInt(document.getElementById('detailedGuideAge').value),
                        experience: document.getElementById('detailedGuideExperience').value,
                        languages: Array.from(document.getElementById('detailedGuideLanguages').selectedOptions).map(option => option.value),
                        introduction: document.getElementById('detailedGuideIntroduction').value.trim(),
                        specialties: document.getElementById('detailedGuideSpecialties').value.trim(),
                        hourlyRate: parseFloat(document.getElementById('detailedGuideHourlyRate').value),
                        availability: document.getElementById('detailedGuideAvailability').value,
                        agreeTerms: document.getElementById('detailedAgreeTerms').checked
                    };
                    
                    console.log('Detailed guide registration:', formData);
                    
                    // Basic validation
                    if (!formData.agreeTerms) {
                        alert('利用規約に同意してください。');
                        return;
                    }
                    
                    if (formData.languages.length === 0) {
                        alert('対応言語を最低1つ選択してください。');
                        return;
                    }
                    
                    // Simulate API call - replace with actual endpoint
                    alert(`ガイド登録申請を受け付けました。\n申請者: ${formData.guideName}\n対応言語: ${formData.languages.join(', ')}\n審査後、メールでご連絡いたします。`);
                    
                    // Hide form after successful submission
                    document.getElementById('detailedGuideRegistrationForm').style.display = 'none';
                    
                    // Reset form
                    detailedGuideForm.reset();
                });
            }

            // Guide registration form submission (legacy)
            const guideRegistrationSubmitBtn = document.getElementById('guideRegistrationSubmitBtn');
            if (guideRegistrationSubmitBtn) {
                guideRegistrationSubmitBtn.addEventListener('click', function() {
                const formData = {
                    firstName: document.getElementById('guideFirstName').value.trim(),
                    lastName: document.getElementById('guideLastName').value.trim(),
                    displayFirstName: document.getElementById('guideDisplayFirstName').value.trim(),
                    displayLastName: document.getElementById('guideDisplayLastName').value.trim(),
                    email: document.getElementById('guideEmail').value.trim(),
                    phone: document.getElementById('guidePhone').value.trim(),
                    location: document.getElementById('guideLocation').value,
                    languages: Array.from(document.getElementById('guideLanguages').selectedOptions).map(option => option.value),
                    specialty: document.getElementById('guideSpecialty').value.trim(),
                    price: document.getElementById('guidePriceInput').value || getPriceFromRange(document.getElementById('guidePriceRange').value),
                    description: document.getElementById('guideDescription').value.trim(),
                    agreeTerms: document.getElementById('guideAgreeTerms').checked,
                    profilePhoto: document.getElementById('guideProfilePreview').src
                };

                // Validate required fields
                if (!formData.firstName || !formData.lastName || !formData.email || !formData.phone || 
                    !formData.location || formData.languages.length === 0 || !formData.price) {
                    alert('Please fill in all required fields (marked with *)');
                    return;
                }

                if (!formData.agreeTerms) {
                    alert('Please agree to the Terms of Service and Privacy Policy');
                    return;
                }

                if (!isGuidePhoneVerified) {
                    alert('Please verify your phone number before registering');
                    return;
                }

                // Save guide data
                try {
                    const guideData = {
                        ...formData,
                        id: Date.now(),
                        registrationDate: new Date().toISOString(),
                        type: 'guide',
                        rating: 4.5 + (Math.random() * 0.5), // Random rating between 4.5-5.0
                        name: `${formData.displayFirstName || formData.firstName} ${formData.displayLastName || formData.lastName}`,
                        image: formData.profilePhoto || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=300&h=300&fit=crop&crop=face"
                    };

                    // Get existing registered guides
                    let registeredGuides = JSON.parse(localStorage.getItem('registeredGuides') || '[]');
                    registeredGuides.push(guideData);
                    localStorage.setItem('registeredGuides', JSON.stringify(registeredGuides));

                    // Update guide data for display
                    try {
                        updateGuideDisplay();
                    } catch (error) {
                        console.error('Error updating guide display after registration:', error);
                        // Continue anyway as the registration was successful
                    }

                    // Close modal
                    const guideModal = bootstrap.Modal.getInstance(document.getElementById('guideRegistrationModal'));
                    guideModal.hide();

                    // Show success message
                    setTimeout(() => {
                        alert('Guide registration completed successfully!\n\nYour profile will be reviewed and activated within 24 hours.');
                    }, 500);

                } catch (error) {
                    console.error('Guide registration error:', error);
                    alert('An error occurred during registration. Please try again.');
                }
            });

            // Setup dropdown listeners
            setupCustomDropdownListeners();
            
            document.getElementById('prevPageBtn').addEventListener('click', () => {
                if (currentPage > 1) {
                    displayGuides(currentGuides, currentPage - 1);
                }
            });
            
            document.getElementById('nextPageBtn').addEventListener('click', () => {
                const totalPages = Math.ceil(currentGuides.length / guidesPerPage);
                if (currentPage < totalPages) {
                    displayGuides(currentGuides, currentPage + 1);
                }
            });

            console.log('✅ TomoTrip English Version Loaded Successfully - All Features Active');
        });

        // Sponsor Registration and Login Functions
        function handleSponsorRegistration() {
            console.log('🏪 Sponsor registration clicked');
            try {
                // Direct navigation to sponsor registration page
                window.location.href = './sponsor-registration.html';
            } catch (error) {
                console.error('❌ Sponsor registration navigation error:', error);
                // Fallback to direct URL
                window.location.href = '/sponsor-registration.html';
            }
        }

        function handleSponsorLogin() {
            console.log('Sponsor login clicked');
            showSponsorLoginModal();
        }

        // Show sponsor login modal
        function showSponsorLoginModal() {
            const modalHtml = `
                <div class="modal fade" id="sponsorLoginModal" tabindex="-1" aria-labelledby="sponsorLoginModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">
                            <div class="modal-header border-0" style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border-radius: 15px 15px 0 0;">
                                <h5 class="modal-title fw-bold" id="sponsorLoginModalLabel">
                                    <i class="bi bi-shop me-2"></i>Store Login
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-4">
                                <form id="sponsorLoginForm">
                                    <div class="mb-3">
                                        <label for="sponsorStoreName" class="form-label fw-bold">
                                            <i class="bi bi-shop me-2"></i>Store Name
                                        </label>
                                        <input type="text" class="form-control" id="sponsorStoreName" placeholder="Enter your store name" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorEmail" class="form-label fw-bold">
                                            <i class="bi bi-envelope me-2"></i>Email Address
                                        </label>
                                        <input type="email" class="form-control" id="sponsorEmail" placeholder="Store contact email" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorPhone" class="form-label fw-bold">
                                            <i class="bi bi-telephone me-2"></i>Phone Number
                                        </label>
                                        <input type="tel" class="form-control" id="sponsorPhone" placeholder="Store phone number (e.g., 03-1234-5678)" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorPassword" class="form-label fw-bold">
                                            <i class="bi bi-lock me-2"></i>Password
                                        </label>
                                        <input type="password" class="form-control" id="sponsorPassword" placeholder="Enter management password" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberSponsor">
                                        <label class="form-check-label" for="rememberSponsor">
                                            Remember login status
                                        </label>
                                    </div>
                                </form>
                                <div class="alert alert-info" style="border-radius: 10px;">
                                    <small><i class="bi bi-info-circle me-2"></i>First time using as a sponsor store? Please register from "Store Registration".</small>
                                </div>
                            </div>
                            <div class="modal-footer border-0 p-4 pt-0">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-primary" onclick="processSponsorLogin()" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #4ecdc4, #44a08d); border: none;">
                                    <i class="bi bi-box-arrow-in-right me-2"></i>Login
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('sponsorLoginModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('sponsorLoginModal'));
            modal.show();
            
            // Clean up when modal is hidden
            document.getElementById('sponsorLoginModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }

        // Process sponsor login
        function processSponsorLogin() {
            const storeName = document.getElementById('sponsorStoreName').value.trim();
            const email = document.getElementById('sponsorEmail').value.trim();
            const phone = document.getElementById('sponsorPhone').value.trim();
            const password = document.getElementById('sponsorPassword').value.trim();
            
            if (!storeName || !email || !phone || !password) {
                alert('Please fill in all fields.');
                return;
            }

            // Check if sponsor exists in registered sponsors
            const registeredSponsors = JSON.parse(localStorage.getItem('registeredSponsors') || '[]');
            const sponsor = registeredSponsors.find(s => 
                s.storeName === storeName && 
                s.email === email && 
                s.phone === phone
            );

            if (!sponsor) {
                alert('Store information not found. Please check your registration details.');
                return;
            }
            
            // Store sponsor session for management access
            sessionStorage.setItem('currentSponsor', JSON.stringify({
                id: sponsor.id,
                storeName: storeName,
                email: email,
                loginTime: new Date().toISOString()
            }));
            
            console.log('Sponsor login successful:', storeName);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('sponsorLoginModal'));
            modal.hide();
            
            // Show success and redirect
            setTimeout(() => {
                const successModal = document.createElement('div');
                successModal.className = 'modal fade';
                successModal.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">
                            <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                                <h5 class="modal-title fw-bold">✅ Store Login Successful</h5>
                            </div>
                            <div class="modal-body p-4 text-center">
                                <div class="mb-4">
                                    <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                                </div>
                                <h6 class="fw-bold mb-3">Redirecting to Store Management Dashboard</h6>
                                <p class="text-muted mb-0">Store Name: ${storeName}</p>
                                <p class="text-muted mb-0">Email: ${email}</p>
                                <div class="alert alert-success mt-3" style="border-radius: 10px;">
                                    <small><i class="bi bi-check-circle me-2"></i>You can edit and manage your store information.</small>
                                </div>
                            </div>
                            <div class="modal-footer border-0 p-4 pt-0">
                                <button type="button" class="btn btn-success w-100" onclick="redirectToSponsorDashboard()" style="border-radius: 25px; padding: 12px;">
                                    Go to Management Dashboard
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(successModal);
                const modal = new bootstrap.Modal(successModal);
                modal.show();
                
                // Clean up
                successModal.addEventListener('hidden.bs.modal', function() {
                    successModal.remove();
                });
            }, 500);
        }

        // Redirect to sponsor dashboard
        function redirectToSponsorDashboard() {
            const storeName = document.getElementById('sponsorStoreName').value.trim();
            const email = document.getElementById('sponsorEmail').value.trim();
            
            // Find the sponsor's ID for editing
            const registeredSponsors = JSON.parse(localStorage.getItem('registeredSponsors') || '[]');
            const sponsor = registeredSponsors.find(s => s.storeName === storeName && s.email === email);
            
            if (sponsor) {
                console.log('Redirecting to sponsor edit page for:', sponsor.storeName);
                window.location.href = `sponsor-edit.html?id=${sponsor.id}`;
            } else {
                console.error('Sponsor not found for redirect');
                alert('Error: Store information not found for redirection.');
            }
        }

        // Chat functionality (English version)
        let currentChatGuide = null;

        function showChatModal(guideId) {
            console.log('Guide ID: ' + guideId + ' message feature is under development.');
            
            // Find guide data
            const guide = currentGuides.find(g => g.id == guideId);
            if (!guide) {
                console.error('Guide not found for chat:', guideId);
                return;
            }

            currentChatGuide = guide;
            
            // Update modal with guide info
            document.getElementById('chatGuideName').textContent = guide.name;
            document.getElementById('chatGuideImage').src = guide.image;
            
            // Load chat history
            loadChatHistory(guideId);
            
            // Show modal
            const chatModal = new bootstrap.Modal(document.getElementById('chatModal'));
            chatModal.show();
            
            // Show development notice
            setTimeout(() => {
                addSystemMessage('Chat functionality will be fully implemented soon.');
            }, 500);
            
            console.log('Chat modal opened for guide:', guide.name);
        }

        function loadChatHistory(guideId) {
            const chatMessages = document.getElementById('chatMessages');
            const chatKey = `chat_${guideId}`;
            const savedMessages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            // Clear current messages
            chatMessages.innerHTML = '';
            
            // Display saved messages
            savedMessages.forEach(message => {
                displayMessage(message.text, message.sender, message.timestamp, false);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('chatMessageInput');
            const messageText = messageInput.value.trim();
            
            if (!messageText || !currentChatGuide) return;
            
            // Display user message
            const timestamp = new Date();
            displayMessage(messageText, 'user', timestamp);
            
            // Save message
            saveChatMessage(currentChatGuide.id, messageText, 'user', timestamp);
            
            // Clear input
            messageInput.value = '';
            
            // Simulate guide response (for demonstration)
            setTimeout(() => {
                const responses = [
                    'Thank you! I\'m happy to help you.',
                    'I\'ll answer your questions. Feel free to ask for details.',
                    'I\'ll suggest plans that match your preferences.',
                    'I\'ll support you with your travel planning.'
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                const responseTime = new Date();
                displayMessage(response, 'guide', responseTime);
                saveChatMessage(currentChatGuide.id, response, 'guide', responseTime);
            }, 1000 + Math.random() * 2000);
        }

        function displayMessage(text, sender, timestamp, saveMessage = true) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            const isUser = sender === 'user';
            
            messageDiv.className = `mb-3 d-flex ${isUser ? 'justify-content-end' : 'justify-content-start'}`;
            
            const timeStr = timestamp.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="max-width-70 ${isUser ? 'text-end' : 'text-start'}">
                    <div class="p-3 rounded-3 ${isUser ? 'bg-primary text-white ms-5' : 'bg-white border me-5'}" 
                         style="border-radius: ${isUser ? '20px 20px 5px 20px' : '20px 20px 20px 5px'} !important;">
                        <p class="mb-1">${text}</p>
                        <small class="opacity-75">${timeStr}</small>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addSystemMessage(text) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = 'mb-3 text-center';
            messageDiv.innerHTML = `
                <div class="badge bg-secondary p-2">
                    <i class="bi bi-info-circle me-1"></i>${text}
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function saveChatMessage(guideId, text, sender, timestamp) {
            const chatKey = `chat_${guideId}`;
            const savedMessages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            savedMessages.push({
                text: text,
                sender: sender,
                timestamp: timestamp
            });
            
            // Keep only last 100 messages
            if (savedMessages.length > 100) {
                savedMessages.splice(0, savedMessages.length - 100);
            }
            
            localStorage.setItem(chatKey, JSON.stringify(savedMessages));
        }

        // Booking functionality (English version)
        let currentBookingGuide = null;

        function showBookingModal(guideId) {
            console.log('Starting booking process: Guide ID ' + guideId);
            
            // Find guide data
            const guide = currentGuides.find(g => g.id == guideId);
            if (!guide) {
                console.error('Guide not found for booking:', guideId);
                return;
            }

            currentBookingGuide = guide;
            
            // Update modal with guide info
            document.getElementById('bookingGuideName').textContent = guide.name;
            document.getElementById('bookingGuideImage').src = guide.image;
            document.getElementById('bookingGuidePrice').textContent = guide.price;
            
            // Reset form
            document.getElementById('bookingForm').reset();
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bookingDate').min = today;
            
            updateBookingSummary();
            
            // Show modal
            const bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
            bookingModal.show();
            
            console.log('Booking modal opened for guide:', guide.name);
        }

        function updateBookingSummary() {
            if (!currentBookingGuide) return;
            
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            const duration = document.getElementById('bookingDuration').value;
            const participants = document.getElementById('bookingParticipants').value;
            
            const summary = document.getElementById('bookingSummary');
            const totalElement = document.getElementById('bookingTotal');
            
            console.log('Booking calculation debug:', {
                guide: currentBookingGuide.name,
                price: currentBookingGuide.price,
                priceType: typeof currentBookingGuide.price,
                date, time, duration, participants
            });
            
            if (date && time && duration && participants) {
                // Extract price - handle multiple formats
                let basePrice = 5000; // default fallback
                
                if (currentBookingGuide.price) {
                    if (typeof currentBookingGuide.price === 'string') {
                        // Handle string formats like "¥7000/時間" or "7000"
                        const priceMatch = currentBookingGuide.price.match(/\d+/);
                        if (priceMatch) {
                            basePrice = parseInt(priceMatch[0]);
                        }
                    } else if (typeof currentBookingGuide.price === 'number') {
                        basePrice = currentBookingGuide.price;
                    }
                }
                
                console.log('Extracted base price:', basePrice);
                
                const durationMultiplier = duration === '2' ? 1.5 : duration === '4' ? 2.5 : duration === '8' ? 4 : 1;
                const total = Math.round(basePrice * durationMultiplier * parseInt(participants));
                
                summary.innerHTML = `
                    <div class="mb-2"><strong>Guide:</strong> ${currentBookingGuide.name}</div>
                    <div class="mb-2"><strong>Date & Time:</strong> ${date} ${time}</div>
                    <div class="mb-2"><strong>Duration:</strong> ${duration} hours</div>
                    <div class="mb-2"><strong>Participants:</strong> ${participants} people</div>
                    <div class="mb-2"><strong>Base Rate:</strong> ${currentBookingGuide.price}/hour</div>
                `;
                totalElement.textContent = `¥${Number(total || 0).toLocaleString()}`;
            } else {
                summary.innerHTML = '<p class="text-muted">Please fill in the details</p>';
                totalElement.textContent = '¥0';
            }
        }

        function submitBooking() {
            const form = document.getElementById('bookingForm');
            const formData = new FormData(form);
            
            // Validate form
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Create booking object
            const booking = {
                id: Date.now(),
                guideId: currentBookingGuide.id,
                guideName: currentBookingGuide.name,
                guideImage: currentBookingGuide.image,
                guideRate: currentBookingGuide.price,
                date: formData.get('date'),
                time: formData.get('time'),
                duration: formData.get('duration'),
                participants: formData.get('participants'),
                specialRequests: formData.get('specialRequests'),
                totalPrice: document.getElementById('bookingTotal').textContent,
                status: 'pending',
                bookingDate: new Date().toISOString()
            };
            
            // Save as temporary booking data for payment with language info
            booking.language = 'en'; // Mark as English booking
            localStorage.setItem('tempBookingData', JSON.stringify(booking));
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('bookingModal'));
            modal.hide();
            
            // Redirect to payment page with language parameter
            window.location.href = 'payment.html?lang=en';
        }

        function saveBooking(booking) {
            const bookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
            bookings.push(booking);
            localStorage.setItem('userBookings', JSON.stringify(bookings));
        }

        function showBookingConfirmation(booking) {
            // Show toast notification
            const toastContainer = document.querySelector('.toast-container') || (() => {
                const container = document.createElement('div');
                container.className = 'toast-container position-fixed top-0 end-0 p-3';
                document.body.appendChild(container);
                return container;
            })();
            
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.innerHTML = `
                <div class="toast-header bg-success text-white">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <strong class="me-auto">Booking Confirmed</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    Booking #${booking.id} has been confirmed!
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-remove toast after 5 seconds
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Initialize chat and booking listeners - called from main DOMContentLoaded
        function initializeChatListeners() {
            const sendBtn = document.getElementById('sendMessageBtn');
            const messageInput = document.getElementById('chatMessageInput');
            
            if (sendBtn) {
                sendBtn.addEventListener('click', sendMessage);
            }
            
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }

            // Booking form event listeners
            const bookingForm = document.getElementById('bookingForm');
            if (bookingForm) {
                const formInputs = bookingForm.querySelectorAll('input, select');
                formInputs.forEach(input => {
                    input.addEventListener('change', updateBookingSummary);
                });
            }

            const submitBookingBtn = document.getElementById('submitBookingBtn');
            if (submitBookingBtn) {
                submitBookingBtn.addEventListener('click', submitBooking);
            }

            // Management Center Button Event Listener
            const managementBtn = document.getElementById('managementBtn');
            if (managementBtn) {
                managementBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    try {
                        showManagementCenter();
                    } catch (error) {
                        console.error('Error opening management center:', error);
                    }
                });
            }

            // Initialize on page load
            updateBookmarkButtons();
            updateComparisonButtons();
        }
    </script>

    <!-- Chat Modal -->
    <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true" style="z-index: 2000;">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); height: 600px;">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #17a2b8, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="chatModalLabel">
                        <i class="bi bi-chat-dots me-2"></i>Chat with Guide
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0 d-flex flex-column" style="height: 500px;">
                    <!-- Guide info header -->
                    <div class="bg-light border-bottom p-3">
                        <div class="d-flex align-items-center">
                            <img id="chatGuideImage" src="" class="rounded-circle me-3" style="width: 50px; height: 50px; object-fit: cover;" alt="Guide Image">
                            <div>
                                <h6 class="mb-0 fw-bold" id="chatGuideName">Guide Name</h6>
                                <small class="text-muted">
                                    <i class="bi bi-circle-fill text-success me-1" style="font-size: 8px;"></i>Online
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat messages area -->
                    <div class="flex-grow-1 p-3 overflow-auto" id="chatMessages" style="background-color: #f8f9fa;">
                        <!-- Messages will be added here -->
                    </div>
                    
                    <!-- Message input area -->
                    <div class="border-top p-3 bg-white">
                        <div class="input-group">
                            <input type="text" class="form-control" id="chatMessageInput" 
                                   placeholder="Type your message..." 
                                   style="border-radius: 25px 0 0 25px; border: 2px solid #e9ecef;">
                            <button class="btn btn-primary" type="button" id="sendMessageBtn" 
                                    style="border-radius: 0 25px 25px 0; background: linear-gradient(135deg, #17a2b8, #20c997); border: none;">
                                <i class="bi bi-send"></i>
                            </button>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="bi bi-info-circle me-1"></i>Press Enter to send message
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true" style="z-index: 2100;">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="bookingModalLabel">
                        <i class="bi bi-calendar-check me-2"></i>Book Guide
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row">
                        <!-- Left Column: Guide Info -->
                        <div class="col-md-4 mb-4">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <img id="bookingGuideImage" src="" class="rounded-circle mb-3" style="width: 120px; height: 120px; object-fit: cover;" alt="Guide Image">
                                    <h5 id="bookingGuideName" class="fw-bold">Guide Name</h5>
                                    <p class="text-primary fw-bold mb-0">
                                        <i class="bi bi-currency-yen me-1"></i>
                                        <span id="bookingGuidePrice">¥0</span>/hour
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Middle Column: Booking Form -->
                        <div class="col-md-5 mb-4">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-calendar3 me-2"></i>Booking Details
                            </h6>
                            
                            <form id="bookingForm">
                                <div class="mb-3">
                                    <label for="bookingDate" class="form-label fw-bold">Date</label>
                                    <input type="date" class="form-control" id="bookingDate" name="date" required style="border-radius: 10px;">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingTime" class="form-label fw-bold">Start Time</label>
                                    <select class="form-select" id="bookingTime" name="time" required style="border-radius: 10px;">
                                        <option value="">Select time</option>
                                        <option value="09:00">09:00</option>
                                        <option value="10:00">10:00</option>
                                        <option value="11:00">11:00</option>
                                        <option value="12:00">12:00</option>
                                        <option value="13:00">13:00</option>
                                        <option value="14:00">14:00</option>
                                        <option value="15:00">15:00</option>
                                        <option value="16:00">16:00</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingDuration" class="form-label fw-bold">Duration</label>
                                    <select class="form-select" id="bookingDuration" name="duration" required style="border-radius: 10px;">
                                        <option value="">Select duration</option>
                                        <option value="1">1 hour</option>
                                        <option value="2">2 hours (1.5x rate)</option>
                                        <option value="4">4 hours (2.5x rate)</option>
                                        <option value="8">8 hours (4x rate)</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingParticipants" class="form-label fw-bold">Number of Participants</label>
                                    <select class="form-select" id="bookingParticipants" name="participants" required style="border-radius: 10px;">
                                        <option value="">Select participants</option>
                                        <option value="1">1 person</option>
                                        <option value="2">2 people</option>
                                        <option value="3">3 people</option>
                                        <option value="4">4 people</option>
                                        <option value="5">5 people</option>
                                        <option value="6">6+ people</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="specialRequests" class="form-label fw-bold">Special Requests</label>
                                    <textarea class="form-control" id="specialRequests" name="specialRequests" rows="3" 
                                              placeholder="Allergies, accessibility needs, special interests, etc." 
                                              style="border-radius: 10px;"></textarea>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Right Column: Booking Summary -->
                        <div class="col-md-3">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-receipt me-2"></i>Booking Summary
                            </h6>
                            
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <div id="bookingSummary" class="mb-3">
                                        <p class="text-muted">Please fill in the details</p>
                                    </div>
                                    
                                    <hr>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <strong>Total Amount:</strong>
                                        <span class="text-success fw-bold fs-5" id="bookingTotal">¥0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 bg-light" style="border-radius: 0 0 15px 15px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="submitBookingBtn" 
                            style="background: linear-gradient(135deg, #28a745, #20c997); border: none; border-radius: 25px; padding: 10px 30px;">
                        <i class="bi bi-calendar-check me-2"></i>Confirm Booking
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Management Center Modal -->
    <div class="modal fade" id="managementModal" tabindex="-1" aria-labelledby="managementModalLabel" aria-hidden="true" style="z-index: 2200;">
        <div class="modal-dialog modal-fullscreen-lg-down modal-xl">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #ffc107, #fd7e14); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="managementModalLabel">
                        <i class="bi bi-gear me-2"></i>Management Center
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <!-- Tab Navigation -->
                    <div class="bg-light border-bottom">
                        <ul class="nav nav-pills nav-fill" id="managementTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="bookmarks-tab" data-bs-toggle="pill" data-bs-target="#bookmarks" type="button" role="tab">
                                    <i class="bi bi-bookmark me-2"></i>Bookmarks
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="comparison-tab" data-bs-toggle="pill" data-bs-target="#comparison" type="button" role="tab">
                                    <i class="bi bi-graph-up me-2"></i>Compare List
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="bookings-tab" data-bs-toggle="pill" data-bs-target="#bookings" type="button" role="tab">
                                    <i class="bi bi-calendar-check me-2"></i>Booking History
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="settings-tab" data-bs-toggle="pill" data-bs-target="#settings" type="button" role="tab">
                                    <i class="bi bi-gear me-2"></i>Settings
                                </button>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="tab-content p-4" id="managementTabContent" style="min-height: 500px;">
                        <!-- Bookmarks Tab -->
                        <div class="tab-pane fade show active" id="bookmarks" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Saved Guides</h6>
                                <button class="btn btn-outline-danger btn-sm" id="clearBookmarksBtn">
                                    <i class="bi bi-trash me-1"></i>Clear All
                                </button>
                            </div>
                            <div id="bookmarksList" class="row">
                                <!-- Bookmarked guides will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Comparison Tab -->
                        <div class="tab-pane fade" id="comparison" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Comparing Guides</h6>
                                <button class="btn btn-outline-danger btn-sm" id="clearComparisonBtn">
                                    <i class="bi bi-trash me-1"></i>Clear All
                                </button>
                            </div>
                            <div id="comparisonList" class="row">
                                <!-- Comparison guides will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Bookings Tab -->
                        <div class="tab-pane fade" id="bookings" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Your Bookings</h6>
                                <button class="btn btn-outline-danger btn-sm" id="clearBookingsBtn">
                                    <i class="bi bi-trash me-1"></i>Clear All
                                </button>
                            </div>
                            <div id="bookingsList">
                                <!-- Booking history will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Settings Tab -->
                        <div class="tab-pane fade" id="settings" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-3">Preferences</h6>
                                    <div class="mb-3">
                                        <label for="defaultLanguageSetting" class="form-label">Default Language</label>
                                        <select class="form-select" id="defaultLanguageSetting">
                                            <option value="en">English</option>
                                            <option value="ja">Japanese</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Notifications</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="notificationsEnabled" checked>
                                            <label class="form-check-label" for="notificationsEnabled">
                                                Receive notifications for new guide registrations
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-3">Data Management</h6>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary" id="exportDataBtn">
                                            <i class="bi bi-download me-2"></i>Export Data
                                        </button>
                                        <button class="btn btn-outline-warning" id="clearAllDataBtn">
                                            <i class="bi bi-exclamation-triangle me-2"></i>Clear All Data
                                        </button>
                                        <button class="btn btn-outline-info" id="dataStatsBtn">
                                            <i class="bi bi-bar-chart me-2"></i>Storage Usage
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Management Center Functions
        function showManagementCenter() {
            console.log('Opening Management Center...');
            try {
                loadManagementData();
                const managementModal = new bootstrap.Modal(document.getElementById('managementModal'));
                managementModal.show();
                console.log('✅ Management Center opened successfully');
            } catch (error) {
                console.error('❌ Error showing management center:', error);
                alert('Error opening management center: ' + error.message);
            }
        }
        
        function loadManagementData() {
            console.log('📊 Loading management data...');
            try {
                loadBookmarksList();
                loadComparisonList();
                loadBookingsList();
                loadSettingsData();
                console.log('✅ Management data loaded successfully');
            } catch (error) {
                console.error('❌ Error loading management data:', error);
            }
        }
        
        function loadBookmarksList() {
            try {
                const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
                const bookmarksList = document.getElementById('bookmarksList');
                
                if (!bookmarksList) return;
                
                if (bookmarkedGuides.length === 0) {
                    bookmarksList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-bookmark text-muted" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">No saved guides</p>
                        </div>
                    `;
                    return;
                }
                
                const allGuides = loadAllGuides();
                bookmarksList.innerHTML = bookmarkedGuides.map(guideId => {
                    const guide = allGuides.find(g => g.id == guideId);
                    if (!guide) return '';
                    
                    return `
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="row g-0">
                                <div class="col-4">
                                    <img src="${guide.image}" class="img-fluid rounded-start h-100" style="object-fit: cover;" alt="${guide.name}">
                                </div>
                                <div class="col-8">
                                    <div class="card-body p-3">
                                        <h6 class="card-title mb-1">${guide.name}</h6>
                                        <p class="card-text small text-muted mb-2">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</p>
                                        <p class="card-text"><strong>¥${(guide.price || 0).toLocaleString()}</strong></p>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-outline-primary btn-sm" onclick="showGuideDetailModalById(${guide.id})">Details</button>
                                            <button class="btn btn-outline-danger btn-sm" onclick="removeBookmark(${guide.id})">Remove</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading bookmarks:', error);
                const bookmarksList = document.getElementById('bookmarksList');
                if (bookmarksList) {
                    bookmarksList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading bookmarks</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadComparisonList() {
            try {
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const comparisonList = document.getElementById('comparisonList');
                
                if (!comparisonList) return;
                
                if (comparisonGuides.length === 0) {
                    comparisonList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-graph-up text-muted" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">No guides in comparison</p>
                        </div>
                    `;
                    return;
                }
                
                const allGuides = loadAllGuides();
            comparisonList.innerHTML = comparisonGuides.map(guideId => {
                const guide = allGuides.find(g => g.id == guideId);
                if (!guide) return '';
                
                return `
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-success">
                            <img src="${guide.image}" class="card-img-top" style="height: 120px; object-fit: cover;" alt="${guide.name}">
                            <div class="card-body p-3 d-flex flex-column">
                                <h6 class="card-title mb-1">${guide.name}</h6>
                                <p class="card-text small text-muted mb-1">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</p>
                                <p class="card-text small mb-2"><span class="text-warning">★</span> ${guide.rating}</p>
                                <p class="card-text mb-3"><strong>¥${(guide.price || 0).toLocaleString()}</strong></p>
                                <div class="mt-auto">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="showGuideDetailModalById(${guide.id})">
                                            <i class="bi bi-info-circle me-1"></i>Details
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm" onclick="removeFromComparison(${guide.id})">
                                            <i class="bi bi-x me-1"></i>Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('Error loading comparison list:', error);
                const comparisonList = document.getElementById('comparisonList');
                if (comparisonList) {
                    comparisonList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading comparison list</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadBookingsList() {
            try {
                const userBookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
                const bookingsList = document.getElementById('bookingsList');
                
                if (!bookingsList) return;
            
            if (userBookings.length === 0) {
                bookingsList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-calendar-x text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3">No booking history</p>
                    </div>
                `;
                return;
            }
            
            const statusBadge = {
                'pending': '<span class="badge bg-warning">Pending</span>',
                'confirmed': '<span class="badge bg-success">Confirmed</span>',
                'completed': '<span class="badge bg-primary">Completed</span>',
                'cancelled': '<span class="badge bg-danger">Cancelled</span>'
            };
            
            bookingsList.innerHTML = userBookings.map(booking => {
                return `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <h6 class="mb-1">${booking.guideName}</h6>
                                    <small class="text-muted">${booking.date}</small>
                                </div>
                                <div class="col-md-3">
                                    <small class="text-muted">Duration</small>
                                    <div>${booking.duration}</div>
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>${booking.totalPrice}</strong>
                                </div>
                                <div class="col-md-2 text-center">
                                    ${statusBadge[booking.status] || statusBadge['pending']}
                                    <div class="mt-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="viewBookingDetails(${booking.id})">Details</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('Error loading bookings:', error);
                const bookingsList = document.getElementById('bookingsList');
                if (bookingsList) {
                    bookingsList.innerHTML = `
                        <div class="text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading booking history</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadSettingsData() {
            try {
                // Load saved language preference
                const savedLang = localStorage.getItem('preferredLanguage') || 'en';
                const langSetting = document.getElementById('defaultLanguageSetting');
                if (langSetting) langSetting.value = savedLang;
                
                    // Load notification setting
                const notificationsEnabled = localStorage.getItem('notificationsEnabled') !== 'false';
                const notificationSetting = document.getElementById('notificationsEnabled');
                if (notificationSetting) notificationSetting.checked = notificationsEnabled;
            } catch (error) {
                console.error('Error loading settings:', error);
            }
            
            // Add event listeners for management actions
            document.getElementById('clearBookmarksBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all bookmarks?')) {
                    localStorage.removeItem('bookmarkedGuides');
                    loadBookmarksList();
                    updateBookmarkButtons();
                }
            });
            
            document.getElementById('clearComparisonBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear the comparison list?')) {
                    localStorage.removeItem('comparisonGuides');
                    loadComparisonList();
                    updateComparisonButtons();
                }
            });
            
            document.getElementById('clearBookingsBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all booking history?')) {
                    localStorage.removeItem('userBookings');
                    loadBookingsList();
                }
            });
            
            document.getElementById('clearAllDataBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear ALL data? This action cannot be undone.')) {
                    localStorage.clear();
                    alert('All data has been cleared.');
                    loadManagementData();
                    updateBookmarkButtons();
                    updateComparisonButtons();
                }
            });
        }
        
        // Management functions
        function removeBookmark(guideId) {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            const updatedBookmarks = bookmarkedGuides.filter(id => id != guideId);
            localStorage.setItem('bookmarkedGuides', JSON.stringify(updatedBookmarks));
            loadBookmarksList();
            
            // Update bookmark buttons throughout the page
            updateBookmarkButtons();
            console.log('Removed bookmark for guide:', guideId);
        }
        
        function removeFromComparison(guideId) {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            const updatedComparison = comparisonGuides.filter(id => id != guideId);
            localStorage.setItem('comparisonGuides', JSON.stringify(updatedComparison));
            loadComparisonList();
            
            // Update comparison buttons throughout the page
            updateComparisonButtons();
            console.log('Removed from comparison:', guideId);
        }
        
        function viewBookingDetails(bookingId) {
            window.location.href = `booking-confirmation.html?id=${bookingId}`;
        }

        // Bookmark and comparison functionality
        function toggleBookmark(guideId) {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            // Convert to string for consistent comparison
            const guideIdStr = guideId.toString();
            const isBookmarked = bookmarkedGuides.includes(guideIdStr) || bookmarkedGuides.includes(parseInt(guideId));
            
            if (isBookmarked) {
                // Remove bookmark - handle both string and number formats
                const updatedBookmarks = bookmarkedGuides.filter(id => id != guideIdStr && id != parseInt(guideId));
                localStorage.setItem('bookmarkedGuides', JSON.stringify(updatedBookmarks));
                console.log('Removed bookmark for guide:', guideId);
            } else {
                // Add bookmark as string
                bookmarkedGuides.push(guideIdStr);
                localStorage.setItem('bookmarkedGuides', JSON.stringify(bookmarkedGuides));
                console.log('Add to bookmarks:', guideId);
            }
            
            // Update button appearance
            updateBookmarkButtons();
        }
        
        function toggleComparison(guideId) {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            // Convert to string for consistent comparison
            const guideIdStr = guideId.toString();
            const isInComparison = comparisonGuides.includes(guideIdStr) || comparisonGuides.includes(parseInt(guideId));
            
            if (isInComparison) {
                // Remove from comparison - handle both string and number formats
                const updatedComparison = comparisonGuides.filter(id => id != guideIdStr && id != parseInt(guideId));
                localStorage.setItem('comparisonGuides', JSON.stringify(updatedComparison));
                console.log('Removed from comparison:', guideId);
            } else {
                // Add to comparison (limit to 3)
                if (comparisonGuides.length >= 3) {
                    alert('Comparison list is limited to 3 guides. Please remove other guides before adding new ones.');
                    return;
                }
                comparisonGuides.push(guideIdStr);
                localStorage.setItem('comparisonGuides', JSON.stringify(comparisonGuides));
                console.log('Add to comparison:', guideId);
            }
            
            // Update button appearance
            updateComparisonButtons();
        }
        
        function updateBookmarkButtons() {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            document.querySelectorAll('.bookmark-btn').forEach(btn => {
                const guideId = btn.getAttribute('data-guide-id');
                // Check both string and number formats for compatibility
                const isBookmarked = bookmarkedGuides.includes(guideId) || bookmarkedGuides.includes(parseInt(guideId));
                
                if (isBookmarked) {
                    btn.classList.remove('btn-outline-warning');
                    btn.classList.add('btn-warning');
                    btn.innerHTML = '★';
                } else {
                    btn.classList.remove('btn-warning');
                    btn.classList.add('btn-outline-warning');
                    btn.innerHTML = '⭐';
                }
            });
        }
        
        function updateComparisonButtons() {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            document.querySelectorAll('.compare-btn').forEach(btn => {
                const guideId = btn.getAttribute('data-guide-id');
                // Check both string and number formats for compatibility
                const isInComparison = comparisonGuides.includes(guideId) || comparisonGuides.includes(parseInt(guideId));
                
                if (isInComparison) {
                    btn.classList.remove('btn-outline-success');
                    btn.classList.add('btn-success');
                    btn.innerHTML = '✓';
                } else {
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-success');
                    btn.innerHTML = '+';
                }
            });
        }
        
        // Show guide detail modal from management center
        function showGuideDetailModalById(guideId) {
            console.log('Opening guide detail modal for guide:', guideId);
            // Use existing viewGuideDetail function if available
            if (window.viewGuideDetail) {
                const fakeEvent = { preventDefault: () => {}, stopPropagation: () => {} };
                window.viewGuideDetail(guideId, fakeEvent);
            } else {
                // Fallback: redirect to main page with guide detail
                alert('Redirecting to main page to show guide details.');
                window.location.href = `/?guideId=${guideId}`;
            }
        }

        // Footer Functions
        function showAbout() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'About Us';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>About TomoTrip</h6>
                <p>TomoTrip is an innovative platform connecting travelers with trusted local guides across Japan.</p>
                <h6>Our Mission</h6>
                <ul>
                    <li>Discover and nurture specialized local guides who showcase regional attractions</li>
                    <li>Provide safe and enriching travel experiences for tourists</li>
                    <li>Promote local economic development and cultural exchange</li>
                    <li>contribute to sustainable tourism industry growth</li>
                </ul>
                <h6>Service Launch</h6>
                <p>Operating nationwide across all 47 prefectures since 2025</p>
            `;
            modal.show();
        }

        function showTerms() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Terms of Service';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Article 1: Service Overview</h6>
                <p>This service is a matching platform between guides and tourists.</p>
                <h6>Article 2: User Responsibilities</h6>
                <ul>
                    <li>Provide accurate information during registration</li>
                    <li>Show consideration for other users</li>
                    <li>Comply with applicable laws and regulations</li>
                </ul>
                <h6>Article 3: Prohibited Activities</h6>
                <ul>
                    <li>Providing false information</li>
                    <li>Business interference activities</li>
                    <li>Activities that cause inconvenience to third parties</li>
                </ul>
                <p class="text-muted small">Last updated: January 1, 2025</p>
            `;
            modal.show();
        }

        function showPrivacy() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Privacy Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Personal Information Handling</h6>
                <p>TomoTrip uses your personal information for the following purposes:</p>
                <ul>
                    <li>Service provision and operation</li>
                    <li>Customer support</li>
                    <li>Safety and security</li>
                    <li>Service improvement analysis</li>
                </ul>
                <h6>Third Party Disclosure</h6>
                <p>We do not provide personal information to third parties without your consent, except as required by law.</p>
                <h6>Contact</h6>
                <p>For privacy-related inquiries: privacy@tomotrip.com</p>
            `;
            modal.show();
        }

        function showFAQ() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Frequently Asked Questions';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq1">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse1">
                                Is guide registration free?
                            </button>
                        </h2>
                        <div id="faqCollapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Yes, guide registration is completely free. Commission is only 20% upon successful booking.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq2">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse2">
                                When do cancellation fees apply?
                            </button>
                        </h2>
                        <div id="faqCollapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Up to 7 days before: Free<br>
                                3-6 days before: 50%<br>
                                2 days or less: 100%
                            </div>
                        </div>
                    </div>
                </div>
            `;
            modal.show();
        }

        function showSafety() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Safety & Insurance';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Safety Measures</h6>
                <ul>
                    <li>Identity verification for all guides</li>
                    <li>24/7 emergency support system</li>
                    <li>GPS location sharing feature</li>
                    <li>Guide rating and review system</li>
                </ul>
                <h6>Insurance Coverage</h6>
                <p>Travel accident insurance applies to all tours.</p>
                <h6>Emergency Contact</h6>
                <p>24-hour support: +81-80-1234-5678</p>
            `;
            modal.show();
        }

        function showCancellation() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Cancellation Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Cancellation Fees</h6>
                <table class="table table-sm">
                    <tr><td>Up to 7 days before</td><td>Free</td></tr>
                    <tr><td>3-6 days before</td><td>50% of fee</td></tr>
                    <tr><td>1-2 days before / Same day</td><td>100% of fee</td></tr>
                </table>
                <h6>Weather Cancellations</h6>
                <p>Full refund provided for weather-related cancellations.</p>
                <h6>Refund Method</h6>
                <p>Credit card refunds are processed within 5-7 business days.</p>
            `;
            modal.show();
        }

        function showCookies() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Cookie Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Cookie Usage</h6>
                <ul>
                    <li>Save user preferences</li>
                    <li>Maintain login status</li>
                    <li>Analyze site usage</li>
                    <li>Provide personalized experiences</li>
                </ul>
                <h6>Changing Cookie Settings</h6>
                <p>You can disable cookies in your browser settings, but some features may be limited.</p>
            `;
            modal.show();
        }

        function createFooterModal() {
            const modalHTML = `
                <div class="modal fade" id="footerModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="footerModalTitle"></h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body" id="footerModalBody"></div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            return document.getElementById('footerModal');
        }
    </script>

    <!-- Footer Modal Functions -->
    <script>
        // Enhanced footer modal creation function
        function createFooterModal() {
            // Remove existing modal
            const existingModal = document.getElementById('footerModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'footerModal';
            modal.setAttribute('tabindex', '-1');
            modal.innerHTML = `
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content bg-dark text-light">
                        <div class="modal-header border-secondary">
                            <h5 class="modal-title text-white" id="footerModalTitle"></h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body" id="footerModalBody">
                        </div>
                        <div class="modal-footer border-secondary">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            return modal;
        }
        
        function showAbout() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'About TomoTrip';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img src="assets/images/tomotrip-logo.png" alt="TomoTrip" style="height: 50px;" class="me-3">
                        <h4 class="text-primary mb-0">TomoTrip</h4>
                    </div>
                    <p class="lead">Connecting travelers with trusted local guides for authentic and safe travel experiences across Japan.</p>
                </div>
                
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card bg-gradient h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-globe me-2"></i>Our Mission</h5>
                                <p class="card-text">To bridge cultures and create meaningful connections between travelers and local communities through authentic experiences.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card bg-gradient h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-shield-check me-2"></i>Our Promise</h5>
                                <p class="card-text">Safe, reliable, and enriching travel experiences with vetted guides who are passionate about sharing their culture.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6 class="fw-bold">Company Information</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <small class="text-muted">Founded</small>
                            <p class="mb-0">2024</p>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">Headquarters</small>
                            <p class="mb-0">Tokyo, Japan</p>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">Languages</small>
                            <p class="mb-0">Japanese, English</p>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showTerms() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Terms of Service';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Last Updated:</strong> January 2025
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">1. Service Overview</h6>
                    <p class="small">TomoTrip is a platform connecting tourists with local guides in Japan. By using our service, you agree to these terms and conditions.</p>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">2. User Responsibilities</h6>
                    <ul class="small">
                        <li>Provide accurate registration information</li>
                        <li>Respect local customs and guidelines</li>
                        <li>Follow safety instructions from guides</li>
                        <li>Make payments as agreed</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">3. Guide Requirements</h6>
                    <ul class="small">
                        <li>Valid identification and certification</li>
                        <li>Comprehensive local knowledge</li>
                        <li>Professional conduct at all times</li>
                        <li>Insurance coverage compliance</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">4. Payment Terms</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Tourist Payments</h6>
                                    <ul class="card-text small">
                                        <li>Full payment required at booking</li>
                                        <li>Credit card fees (3.6%) apply</li>
                                        <li>Debit card processing (2.1%)</li>
                                        <li>Secure payment processing</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Guide Compensation</h6>
                                    <ul class="card-text small">
                                        <li>80% of tour fee after completion</li>
                                        <li>20% platform service fee</li>
                                        <li>Payment within 5 business days</li>
                                        <li>Direct bank transfer</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-exclamation-triangle me-2"></i>These terms are subject to Japanese law. For disputes, Tokyo District Court has jurisdiction.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showPrivacy() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Privacy Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-primary">
                        <i class="bi bi-shield-lock me-2"></i>
                        <strong>Your privacy is our priority.</strong> This policy explains how we collect, use, and protect your personal information.
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Information We Collect</h6>
                    
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-primary">Personal Information</h6>
                                    <ul class="card-text small">
                                        <li>Name and contact details</li>
                                        <li>Profile photos</li>
                                        <li>Identity verification documents</li>
                                        <li>Payment information</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Usage Data</h6>
                                    <ul class="card-text small">
                                        <li>Website interaction data</li>
                                        <li>Search preferences</li>
                                        <li>Booking history</li>
                                        <li>Communication records</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">How We Use Your Information</h6>
                    <ul class="small">
                        <li>Facilitate connections between tourists and guides</li>
                        <li>Process payments and bookings</li>
                        <li>Improve our service quality</li>
                        <li>Ensure safety and security</li>
                        <li>Comply with legal requirements</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Data Protection Rights</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Access</small>
                                    <br><small>View your data</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Correction</small>
                                    <br><small>Update incorrect information</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Deletion</small>
                                    <br><small>Request data removal</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Portability</small>
                                    <br><small>Export your data</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <small><i class="bi bi-envelope me-2"></i>For privacy-related inquiries, contact us at privacy@tomotrip.com</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showFAQ() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Frequently Asked Questions';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <p class="lead">Find answers to common questions about using TomoTrip.</p>
                </div>
                
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                <i class="bi bi-person-check me-2"></i>How do I book a guide?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <p>Booking a guide is simple:</p>
                                <ol>
                                    <li>Browse available guides in your desired location</li>
                                    <li>Check their profiles, reviews, and availability</li>
                                    <li>Register as a tourist (one-time process)</li>
                                    <li>Select your preferred guide and time slot</li>
                                    <li>Complete payment to confirm your booking</li>
                                </ol>
                                <div class="alert alert-info mt-3">
                                    <small><i class="bi bi-lightbulb me-2"></i>Tip: Book in advance, especially during peak seasons!</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                <i class="bi bi-credit-card me-2"></i>What payment methods do you accept?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <p>We accept various payment methods for your convenience:</p>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title text-success">Credit Cards</h6>
                                                <ul class="small">
                                                    <li>Visa, Mastercard, JCB</li>
                                                    <li>3.6% processing fee</li>
                                                    <li>Instant confirmation</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title text-info">Debit Cards</h6>
                                                <ul class="small">
                                                    <li>All major debit cards</li>
                                                    <li>2.1% processing fee</li>
                                                    <li>Direct bank deduction</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                <i class="bi bi-calendar-x me-2"></i>What is your cancellation policy?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="card border-success">
                                            <div class="card-body text-center">
                                                <div class="text-success h4">48+ hours</div>
                                                <small>Full refund</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-warning">
                                            <div class="card-body text-center">
                                                <div class="text-warning h4">24-48 hours</div>
                                                <small>50% refund</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-danger">
                                            <div class="card-body text-center">
                                                <div class="text-danger h4">&lt;24 hours</div>
                                                <small>No refund</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p class="mt-3 small">Refunds are processed within 5-7 business days to your original payment method.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showSafety() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Safety & Insurance';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="bi bi-shield-check me-2"></i>
                        <strong>Your safety is our top priority.</strong> We implement multiple layers of protection for all users.
                    </div>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-person-check me-2"></i>Guide Verification</h5>
                                <ul class="card-text">
                                    <li>Identity verification required</li>
                                    <li>Background checks conducted</li>
                                    <li>Local certification validation</li>
                                    <li>Regular performance reviews</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-shield-lock me-2"></i>Insurance Coverage</h5>
                                <ul class="card-text">
                                    <li>Comprehensive liability insurance</li>
                                    <li>Medical emergency coverage</li>
                                    <li>Activity-specific protection</li>
                                    <li>24/7 emergency support</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Safety Guidelines</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-primary">For Tourists</h6>
                                    <ul class="card-text small">
                                        <li>Share your itinerary with someone</li>
                                        <li>Keep emergency contacts handy</li>
                                        <li>Follow guide instructions</li>
                                        <li>Stay aware of your surroundings</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">For Guides</h6>
                                    <ul class="card-text small">
                                        <li>Conduct safety briefings</li>
                                        <li>Monitor group dynamics</li>
                                        <li>Maintain first aid certification</li>
                                        <li>Report incidents immediately</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-telephone me-2"></i><strong>Emergency Contact:</strong> 080-9999-8888 (24/7 Support)</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCancellation() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Cancellation Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Flexible cancellation options</strong> designed to accommodate unexpected changes while protecting both tourists and guides.
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Cancellation Timeline</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card border-success h-100">
                                <div class="card-body text-center">
                                    <div class="text-success display-6 mb-2"><i class="bi bi-check-circle"></i></div>
                                    <h6 class="card-title text-success">48+ Hours Before</h6>
                                    <p class="card-text">
                                        <strong>100% Refund</strong><br>
                                        <small class="text-muted">Full amount returned to original payment method</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-warning h-100">
                                <div class="card-body text-center">
                                    <div class="text-warning display-6 mb-2"><i class="bi bi-exclamation-circle"></i></div>
                                    <h6 class="card-title text-warning">24-48 Hours Before</h6>
                                    <p class="card-text">
                                        <strong>50% Refund</strong><br>
                                        <small class="text-muted">Partial compensation for guide preparation</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-danger h-100">
                                <div class="card-body text-center">
                                    <div class="text-danger display-6 mb-2"><i class="bi bi-x-circle"></i></div>
                                    <h6 class="card-title text-danger">Less than 24 Hours</h6>
                                    <p class="card-text">
                                        <strong>No Refund</strong><br>
                                        <small class="text-muted">Guide compensation protection</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Special Circumstances</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Weather Conditions</h6>
                                    <ul class="card-text small">
                                        <li>Typhoon/severe weather warnings</li>
                                        <li>Government-issued travel advisories</li>
                                        <li>Full refund provided</li>
                                        <li>Rescheduling options available</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Medical Emergencies</h6>
                                    <ul class="card-text small">
                                        <li>Tourist illness or injury</li>
                                        <li>Guide inability to conduct tour</li>
                                        <li>Medical documentation required</li>
                                        <li>Case-by-case evaluation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">How to Cancel</h6>
                    <ol class="small">
                        <li>Log into your account or use booking confirmation email</li>
                        <li>Navigate to "My Bookings" section</li>
                        <li>Select the booking you wish to cancel</li>
                        <li>Click "Cancel Booking" and confirm</li>
                        <li>Receive cancellation confirmation and refund timeline</li>
                    </ol>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-clock me-2"></i>Refunds are processed within 5-7 business days. For urgent cancellations, contact our support team.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showHelp() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Help Center';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <p class="lead">Need assistance? We're here to help you make the most of your TomoTrip experience.</p>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-headset me-2"></i>Live Chat Support</h5>
                                <p class="card-text">Get instant help from our support team during business hours.</p>
                                <button class="btn btn-light" onclick="window.open('chat.html', '_blank')">
                                    <i class="bi bi-chat-dots me-2"></i>Start Chat
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-envelope me-2"></i>Email Support</h5>
                                <p class="card-text">Send us detailed questions and we'll respond within 24 hours.</p>
                                <button class="btn btn-light" onclick="window.location.href='mailto:support@tomotrip.com'">
                                    <i class="bi bi-envelope me-2"></i>Send Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Quick Help Topics</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="list-group">
                                <div class="list-group-item bg-dark text-light border-secondary">
                                    <h6 class="mb-1">For Tourists</h6>
                                    <small>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showFAQ()">How to book a guide</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showCancellation()">Cancellation policy</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showSafety()">Safety guidelines</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="alert('Payment help coming soon')">Payment issues</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="list-group">
                                <div class="list-group-item bg-dark text-light border-secondary">
                                    <h6 class="mb-1">For Guides</h6>
                                    <small>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Guide registration help coming soon')">Registration process</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Profile optimization tips coming soon')">Profile optimization</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Earnings dashboard coming soon')">Payment schedule</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Guide resources coming soon')">Best practices</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Contact Information</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-telephone text-primary fs-4"></i>
                                    <h6 class="mt-2">Phone Support</h6>
                                    <small>+81-3-1234-5678<br>Mon-Fri 9:00-18:00 JST</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-envelope text-success fs-4"></i>
                                    <h6 class="mt-2">Email</h6>
                                    <small>support@tomotrip.com<br>24h response time</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-exclamation-triangle text-warning fs-4"></i>
                                    <h6 class="mt-2">Emergency</h6>
                                    <small>080-9999-8888<br>24/7 Support</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCompliance() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Legal Compliance';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="bi bi-shield-check me-2"></i>
                        <strong>Full Legal Compliance</strong> - TomoTrip operates in accordance with Japanese and international laws.
                    </div>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title text-primary"><i class="bi bi-building me-2"></i>Business Registration</h5>
                                <ul class="card-text small">
                                    <li>Registered in Tokyo, Japan</li>
                                    <li>Business License: TK-2024-001</li>
                                    <li>Tourism Agency Registration</li>
                                    <li>Regular compliance audits</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title text-success"><i class="bi bi-shield-lock me-2"></i>Data Protection</h5>
                                <ul class="card-text small">
                                    <li>GDPR compliance (EU users)</li>
                                    <li>Japanese Personal Information Protection Act</li>
                                    <li>Secure data encryption</li>
                                    <li>Regular security assessments</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Industry Certifications</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <div class="text-success h4"><i class="bi bi-award"></i></div>
                                    <h6>Tourism Quality</h6>
                                    <small>Certified by Japan Tourism Agency</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-info">
                                <div class="card-body text-center">
                                    <div class="text-info h4"><i class="bi bi-lock"></i></div>
                                    <h6>Security Standards</h6>
                                    <small>ISO 27001 Certified</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-warning">
                                <div class="card-body text-center">
                                    <div class="text-warning h4"><i class="bi bi-credit-card"></i></div>
                                    <h6>Payment Security</h6>
                                    <small>PCI DSS Compliant</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Legal Framework</h6>
                    <div class="table-responsive">
                        <table class="table table-dark table-striped">
                            <thead>
                                <tr>
                                    <th>Law/Regulation</th>
                                    <th>Compliance Status</th>
                                    <th>Last Audit</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Tourism Business Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                                <tr>
                                    <td>Consumer Protection Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                                <tr>
                                    <td>Data Protection Laws</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Dec 2024</td>
                                </tr>
                                <tr>
                                    <td>Payment Services Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <small><i class="bi bi-info-circle me-2"></i>For legal inquiries or compliance questions, contact our legal team at legal@tomotrip.com</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCookies() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Cookie Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <h6 class="fw-bold">What are Cookies?</h6>
                    <p class="small">Cookies are small text files that websites store on your computer to improve your browsing experience and provide better services.</p>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Types of Cookies We Use</h6>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Essential Cookies</h6>
                                    <p class="card-text small">Required for basic website functionality</p>
                                    <ul class="small">
                                        <li>Login session management</li>
                                        <li>Security features</li>
                                        <li>Settings preservation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Analytics Cookies</h6>
                                    <p class="card-text small">Help us improve our services</p>
                                    <ul class="small">
                                        <li>Google Analytics</li>
                                        <li>Usage statistics</li>
                                        <li>Performance monitoring</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Managing Cookie Settings</h6>
                    <p class="small">You can control cookie acceptance through your browser settings. However, disabling essential cookies may affect website functionality.</p>
                    
                    <div class="mt-3">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="alert('Cookie settings panel under development')">Cookie Settings</button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="alert('Cookie deletion feature under development')">Clear All Cookies</button>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-exclamation-triangle me-2"></i>Analytics cookies require your consent. You can use our basic features without accepting analytics cookies.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showManagementCenter() {
            alert('Booking Management Center is under development. Please contact us directly for current booking inquiries.');
        }
    </script>

    
    <!-- Footer Force CSS -->
    <style>
        .footer-forced-visible {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 1000 !important;
            min-height: 400px !important;
        }
        
        /* Footer Emergency Fix */
        #main-footer {
            background-color: #212529 !important;
            color: white !important;
            padding: 3rem 0 !important;
            margin-top: 2rem !important;
            position: relative !important;
            z-index: 100 !important;
            width: 100% !important;
            clear: both !important;
        }
        
        #main-footer .container {
            max-width: 1200px !important;
            margin: 0 auto !important;
            padding: 0 15px !important;
        }
        
        #main-footer .row {
            display: flex !important;
            flex-wrap: wrap !important;
            margin: 0 -15px !important;
        }
        
        #main-footer .col-lg-3,
        #main-footer .col-lg-2,
        #main-footer .col-md-6 {
            padding: 0 15px !important;
            margin-bottom: 2rem !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            flex: 1 1 auto !important;
            min-width: 200px !important;
        }
        
        #main-footer h5,
        #main-footer h6 {
            color: white !important;
            font-weight: bold !important;
            margin-bottom: 1rem !important;
        }
        
        #main-footer p,
        #main-footer li,
        #main-footer a {
            color: #adb5bd !important;
            font-size: 14px !important;
        }
        
        #main-footer a:hover {
            color: #4ecdc4 !important;
        }
        
        #main-footer .text-white {
            color: white !important;
        }
        
        #main-footer .text-muted {
            color: #adb5bd !important;
        }
        
        #main-footer ul {
            list-style: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        
        #main-footer li {
            margin-bottom: 0.5rem !important;
        }
        
        .hover-social:hover {
            color: #4ecdc4 !important;
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        
        .hover-link:hover {
            color: #4ecdc4 !important;
            text-decoration: underline !important;
        }
    </style>

    <!-- Footer -->
    <footer id="main-footer" style="background-color: #212529 !important; color: white !important; padding: 3rem 0 !important; margin-top: 2rem !important; position: relative !important; z-index: 100 !important; width: 100% !important; clear: both !important; display: block !important; visibility: visible !important; opacity: 1 !important;">
        <div class="container">
            <div class="row">
                <!-- Company Info -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img src="assets/images/tomotrip-logo.png" alt="TomoTrip" style="height: 40px;" class="me-2">
                        <h5 class="mb-0">TomoTrip</h5>
                    </div>
                    <p class="text-muted small">Connecting travelers with trusted local guides for authentic and safe travel experiences across Japan.</p>
                    <div class="d-flex gap-3">
                        <a href="https://facebook.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Facebook">
                            <i class="bi bi-facebook fs-5"></i>
                        </a>
                        <a href="https://twitter.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Twitter">
                            <i class="bi bi-twitter fs-5"></i>
                        </a>
                        <a href="https://instagram.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Instagram">
                            <i class="bi bi-instagram fs-5"></i>
                        </a>
                        <a href="https://youtube.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="YouTube">
                            <i class="bi bi-youtube fs-5"></i>
                        </a>
                    </div>
                </div>

                <!-- Services -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">サービス</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#guides-section" class="text-muted text-decoration-none hover-link" onclick="scrollToGuides()">ガイドを探す</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showGuideRegistrationModal()">ガイドになる</a></li>
                        <li class="mb-2"><a href="/tourist-registration-simple.html" class="text-muted text-decoration-none hover-link" target="_blank">観光客登録</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showManagementCenter()">予約管理</a></li>
                        <li class="mb-2"><a href="sponsor-registration.html" class="text-muted text-decoration-none hover-link">スポンサー登録</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">サポート</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showFAQ()">FAQ</a></li>
                        <li class="mb-2"><a href="chat.html" class="text-muted text-decoration-none hover-link">お問い合わせ</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showSafety()">安全・保険</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCancellation()">キャンセルポリシー</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showHelp()">Help Center</a></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">法的事項</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showAbout()">会社案内</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showTerms()">利用規約</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showPrivacy()">プライバシーポリシー</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCookies()">Cookie Policy</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCompliance()">法的遵守</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <h6 class="text-white mb-3">連絡先</h6>
                    <div class="mb-3">
                        <p class="text-muted small mb-2">
                            <i class="bi bi-envelope me-2"></i>
                            <a href="mailto:info@tomotrip.com" class="text-muted text-decoration-none hover-link">info@tomotrip.com</a>
                        </p>
                        <p class="text-muted small mb-2">
                            <i class="bi bi-telephone me-2"></i>
                            <a href="tel:+81-3-1234-5678" class="text-muted text-decoration-none hover-link">+81-3-1234-5678</a>
                        </p>
                        <p class="text-muted small mb-3">
                            <i class="bi bi-clock me-2"></i>Mon-Fri 9:00-18:00 JST
                        </p>
                        <p class="text-muted small mb-2">
                            <i class="bi bi-geo-alt me-2"></i>〒100-0001 Tokyo, Chiyoda, Chiyoda 1-1
                        </p>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted small mb-2">Emergency Support:</p>
                        <p class="text-warning small">
                            <i class="bi bi-telephone-fill me-2"></i>
                            <a href="tel:080-9999-8888" class="text-warning text-decoration-none hover-link">080-9999-8888</a>
                            <br><small class="text-muted">(24/7 Available)</small>
                        </p>
                    </div>
                </div>
            </div>

            <hr class="my-4 border-secondary">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="text-muted small mb-0">&copy; 2025 TomoTrip. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="text-muted small mb-0">Made with ❤️ for travelers and local guides</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Tourist Login Modal -->
    <div class="modal fade" id="touristLoginModal" tabindex="-1" aria-labelledby="touristLoginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="touristLoginModalLabel">
                        <i class="bi bi-person-circle me-2"></i>観光客ログイン
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>観光客向けサービス</strong><br>
                            <small>ガイドの詳細情報を見るには、まず観光客として登録が必要です。</small>
                        </div>
                    </div>
                    
                    <form id="touristLoginForm">
                        <div class="mb-3">
                            <label for="touristEmail" class="form-label fw-bold">
                                <i class="bi bi-envelope me-1"></i>メールアドレス
                            </label>
                            <input type="email" class="form-control" id="touristEmail" placeholder="your@email.com" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        
                        <div class="mb-4">
                            <label for="touristPassword" class="form-label fw-bold">
                                <i class="bi bi-lock me-1"></i>パスワード
                            </label>
                            <input type="password" class="form-control" id="touristPassword" placeholder="パスワードを入力" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; padding: 12px; border-radius: 10px; font-weight: 600;">
                                <i class="bi bi-box-arrow-in-right me-2"></i>ログイン
                            </button>
                            <div class="text-center mt-3">
                                <small class="text-muted">アカウントをお持ちでない場合は</small><br>
                                <button type="button" class="btn btn-link" id="showTouristRegistration">
                                    <i class="bi bi-person-plus me-1"></i>新規登録はこちら
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Guide Login Modal -->
    <div class="modal fade" id="guideLoginModal" tabindex="-1" aria-labelledby="guideLoginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="guideLoginModalLabel">
                        <i class="bi bi-person-badge me-2"></i>ガイドログイン
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="alert alert-success">
                            <i class="bi bi-shield-check me-2"></i>
                            <strong>ガイド専用</strong><br>
                            <small>登録時に発行されたガイドIDとパスワードでログインしてください。</small>
                        </div>
                    </div>
                    
                    <form id="guideLoginForm">
                        <div class="mb-3">
                            <label for="guideId" class="form-label fw-bold">
                                <i class="bi bi-card-text me-1"></i>ガイドID
                            </label>
                            <input type="text" class="form-control" id="guideId" placeholder="GD-XXXXXXXXXX" required style="border-radius: 10px; padding: 12px; font-family: monospace;">
                            <small class="text-muted">例: GD-1A2B3C4D5E-FGHIJ</small>
                        </div>
                        
                        <div class="mb-4">
                            <label for="guidePassword" class="form-label fw-bold">
                                <i class="bi bi-lock me-1"></i>パスワード
                            </label>
                            <input type="password" class="form-control" id="guidePassword" placeholder="パスワードを入力" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success" style="background: linear-gradient(135deg, #28a745, #20c997); border: none; padding: 12px; border-radius: 10px; font-weight: 600;">
                                <i class="bi bi-box-arrow-in-right me-2"></i>ログイン
                            </button>
                            <div class="text-center mt-3">
                                <small class="text-muted">ガイド登録がお済みでない場合は</small><br>
                                <button type="button" class="btn btn-link" id="showGuideRegistration">
                                    <i class="bi bi-person-badge me-1"></i>ガイド登録はこちら
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Emergency button handlers for new tab compatibility -->
    <script type="module" src="/assets/js/emergency-buttons.mjs"></script>
    
    <!-- DIRECT GUIDE RENDERING - Bypass module system completely -->
    <script>
        console.log('🎯 DIRECT: Starting immediate guide rendering');
        
        function renderGuideCardsNow() {
            console.log('🎯 DIRECT: Function called');
            
            const container = document.getElementById('guidesContainer');
            if (!container) {
                console.error('🎯 DIRECT: Container not found');
                return;
            }
            
            console.log('🎯 DIRECT: Container found, rendering...');
            
            // Full guide dataset
            const guides = [
                { id: 1, name: "田中健太", location: "tokyo", rating: 4.8, price: 8000, photo: "/assets/img/guides/default-1.svg", languages: ["ja", "en"] },
                { id: 2, name: "佐藤美咲", location: "osaka", rating: 4.9, price: 7500, photo: "/assets/img/guides/default-2.svg", languages: ["ja", "en", "zh"] },
                { id: 3, name: "鈴木一郎", location: "kyoto", rating: 4.7, price: 9000, photo: "/assets/img/guides/default-3.svg", languages: ["ja", "en"] },
                { id: 4, name: "山田花子", location: "osaka", rating: 4.6, price: 7000, photo: "/assets/img/guides/default-4.svg", languages: ["ja", "en"] },
                { id: 5, name: "Johnson Mike", location: "tokyo", rating: 4.8, price: 8500, photo: "/assets/img/guides/default-5.svg", languages: ["en", "ja"] },
                { id: 6, name: "李美麗", location: "kyoto", rating: 4.9, price: 8800, photo: "attached_assets/image_1754399234136.png", languages: ["zh", "ja", "en"] },
                { id: 7, name: "高橋翔太", location: "hokkaido", rating: 4.7, price: 9500, photo: "attached_assets/image_1754399234136.png", languages: ["ja", "en"] },
                { id: 8, name: "Anderson Sarah", location: "okinawa", rating: 4.8, price: 8200, photo: "attached_assets/image_1754399234136.png", languages: ["en", "ja"] },
                { id: 9, name: "金成民", location: "tokyo", rating: 4.6, price: 7800, photo: "attached_assets/image_1754399234136.png", languages: ["ko", "ja", "en"] },
                { id: 10, name: "伊藤優子", location: "nara", rating: 4.9, price: 8600, photo: "attached_assets/image_1754399234136.png", languages: ["ja", "en"] },
                { id: 11, name: "Rodriguez Carlos", location: "hiroshima", rating: 4.7, price: 8300, photo: "attached_assets/image_1754399234136.png", languages: ["es", "ja", "en"] },
                { id: 12, name: "中村孝", location: "fukuoka", rating: 4.8, price: 7900, photo: "attached_assets/image_1754399234136.png", languages: ["ja", "en"] }
            ];
            
            // Set global reference
            window.defaultGuides = guides;
            
            // Location mapping
            const locationNames = {
                hokkaido: "北海道", tokyo: "東京都", osaka: "大阪府", kyoto: "京都府", 
                nara: "奈良県", hiroshima: "広島県", fukuoka: "福岡県", okinawa: "沖縄県"
            };
            
            const cardsHTML = guides.map(guide => `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="guide-card h-100" style="border: none; border-radius: 15px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.1); transition: all 0.3s ease; background: white;">
                        <div class="position-relative">
                            <img src="${guide.photo || '/assets/img/guides/default-1.svg'}" 
                                 class="card-img-top" alt="${guide.name}" 
                                 style="height: 250px; object-fit: cover;">
                            <div class="position-absolute top-0 end-0 m-2">
                                <span class="badge" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-size: 12px; padding: 5px 10px; border-radius: 15px;">
                                    評価 ${guide.rating} ⭐
                                </span>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <h5 class="card-title fw-bold mb-2" style="color: #2c3e50;">${guide.name}</h5>
                            <p class="text-muted mb-2">
                                <i class="bi bi-geo-alt"></i> ${locationNames[guide.location] || guide.location}
                            </p>
                            <p class="card-text text-muted mb-3" style="font-size: 14px; line-height: 1.4;">
                                地域の魅力をご案内します
                            </p>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">対応言語</small>
                                    <small class="fw-semibold">${Array.isArray(guide.languages) ? guide.languages.map(lang => {
                                        const langMap = {
                                            'ja': '日本語', 'japanese': '日本語',
                                            'en': '英語', 'english': '英語', 
                                            'zh': '中国語', 'chinese': '中国語',
                                            'ko': '韓国語', 'korean': '韓国語',
                                            'es': 'スペイン語', 'spanish': 'スペイン語',
                                            'fr': 'フランス語', 'french': 'フランス語',
                                            'de': 'ドイツ語', 'german': 'ドイツ語',
                                            'it': 'イタリア語', 'italian': 'イタリア語'
                                        };
                                        return langMap[lang.toLowerCase()] || lang;
                                    }).join(', ') : guide.languages}</small>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <small class="text-muted">料金</small>
                                    <small class="fw-bold text-primary">¥${Number(guide.price).toLocaleString()}</small>
                                </div>
                            </div>
                            
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary" 
                                        data-action="view-details" 
                                        data-guide-id="${guide.id}"
                                        style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 10px; padding: 10px;">
                                    詳しく見る
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = cardsHTML;
            
            // Update counters
            const guideCounter = document.getElementById('guideCounter');
            const totalGuideCounter = document.getElementById('totalGuideCounter');
            if (guideCounter) guideCounter.textContent = `${guides.length}人のガイドが見つかりました（全${guides.length}人中）`;
            if (totalGuideCounter) totalGuideCounter.textContent = `総数: ${guides.length}人`;
            
            console.log(`🎯 DIRECT: Successfully rendered ${guides.length} guide cards`);
        }
        
        // Multiple triggers to ensure execution
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', renderGuideCardsNow);
        } else {
            renderGuideCardsNow();
        }
        
        // Backup triggers
        setTimeout(renderGuideCardsNow, 100);
        setTimeout(renderGuideCardsNow, 500);
        setTimeout(renderGuideCardsNow, 1000);
        
        // Add missing guide detail modal function
        // Add hero button event handlers
        window.setupHeroButtons = function() {
            const findGuideBtn = document.getElementById('findGuideBtn');
            const contactBtn = document.getElementById('contactBtn');
            
            if (findGuideBtn && !findGuideBtn.hasAttribute('data-handler-added')) {
                findGuideBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🎯 Find Guide button clicked - scrolling to guides section');
                    const guidesSection = document.getElementById('guides-section');
                    if (guidesSection) {
                        guidesSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    } else {
                        alert('ガイド一覧セクションを表示します');
                    }
                });
                findGuideBtn.setAttribute('data-handler-added', 'true');
                console.log('✅ Find Guide button handler added');
            }
            
            if (contactBtn && !contactBtn.hasAttribute('data-handler-added')) {
                contactBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🎯 Contact button clicked - opening contact page');
                    window.open('chat.html', '_blank');
                });
                contactBtn.setAttribute('data-handler-added', 'true');
                console.log('✅ Contact button handler added');
            }
        };
        
        // DIRECT BUTTON HANDLERS - Immediate setup without module conflicts
        console.log('🔧 Setting up DIRECT button handlers');
        
        // Force immediate button setup
        setTimeout(function() {
            // Hero buttons
            const findGuideBtn = document.getElementById('findGuideBtn');
            const contactBtn = document.getElementById('contactBtn');
            
            if (findGuideBtn) {
                findGuideBtn.onclick = function(e) {
                    e.preventDefault();
                    console.log('🎯 Find Guide clicked - scrolling to guides');
                    
                    // Always scroll to guides section (no registration check)
                    let target = document.getElementById('guides-section') || 
                                document.getElementById('guidesContainer') ||
                                document.querySelector('.guide-card') ||
                                document.querySelector('[id*="guide"]');
                    
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        console.log('✅ Scrolled to guides section');
                    } else {
                        window.scrollTo({ top: 2000, behavior: 'smooth' });
                        console.log('✅ Fallback scroll performed');
                    }
                };
                console.log('✅ Find Guide button setup - direct scroll');
            }
            
            if (contactBtn) {
                contactBtn.onclick = function(e) {
                    e.preventDefault();
                    console.log('🎯 Contact clicked - opening chat');
                    try {
                        window.open('chat.html', '_blank');
                        console.log('✅ Chat opened');
                    } catch (error) {
                        console.error('Chat open error:', error);
                        alert('お問い合わせページ: chat.html');
                    }
                };
                console.log('✅ Contact button setup');
            }
            
            // Guide detail buttons - Check registration before showing details
            document.addEventListener('click', function(e) {
                const target = e.target.closest('[data-action="view-details"]');
                if (target) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const guideId = target.getAttribute('data-guide-id');
                    console.log('🎯 Guide detail clicked:', guideId);
                    
                    // Check if tourist is registered - unified check
                    const isRegistered = localStorage.getItem('isRegisteredTourist') === 'true';
                    const touristData = localStorage.getItem('touristRegistration');
                    
                    if (isRegistered && touristData) {
                        // If registered, navigate to guide detail page
                        console.log('Navigating to guide detail page for registered user');
                        window.location.href = `guide-detail.html?id=${guideId}`;
                    } else {
                        // If not registered, show registration prompt
                        console.log('🔄 Tourist not registered - showing registration prompt');
                        
                        // Create registration prompt modal
                        const promptHtml = `
                            <div class="modal fade" id="registrationPromptModal" tabindex="-1">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content" style="border-radius: 20px; border: none; box-shadow: 0 20px 40px rgba(0,0,0,0.15);">
                                        <div class="modal-header border-0" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 20px 20px 0 0;">
                                            <h5 class="modal-title fw-bold">
                                                <i class="bi bi-info-circle-fill me-2"></i>ガイドサービスのご利用について
                                            </h5>
                                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                        </div>
                                        <div class="modal-body p-4 text-center">
                                            <div class="mb-4">
                                                <i class="bi bi-person-check" style="font-size: 4rem; color: #667eea; opacity: 0.8;"></i>
                                            </div>
                                            <h6 class="fw-bold mb-3" style="color: #2c3e50;">観光客登録が必要です</h6>
                                            <p class="text-muted mb-4" style="line-height: 1.6;">
                                                TomoTripでは、信頼できる地元ガイドとの安全な出会いをサポートしています。<br>
                                                ガイドの詳細情報閲覧やお問い合わせをご利用いただくため、観光客としての登録をお願いいたします。
                                            </p>
                                            <div class="mb-4">
                                                <div class="row text-start">
                                                    <div class="col-12 mb-2">
                                                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                        <small>ガイドの詳細プロフィール閲覧</small>
                                                    </div>
                                                    <div class="col-12 mb-2">
                                                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                        <small>ガイドへの直接お問い合わせ</small>
                                                    </div>
                                                    <div class="col-12 mb-2">
                                                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                        <small>ツアー予約と日程調整</small>
                                                    </div>
                                                    <div class="col-12">
                                                        <i class="bi bi-check-circle-fill text-success me-2"></i>
                                                        <small>安全で信頼できるガイドマッチング</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer border-0 pt-0">
                                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                                                <i class="bi bi-x-circle me-1"></i>キャンセル
                                            </button>
                                            <button type="button" class="btn btn-primary" id="proceedToRegistration" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none;">
                                                <i class="bi bi-person-plus me-1"></i>観光客登録を開始
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        // Remove existing prompt modal if exists
                        const existingPrompt = document.getElementById('registrationPromptModal');
                        if (existingPrompt) existingPrompt.remove();
                        
                        // Add prompt modal to body
                        document.body.insertAdjacentHTML('beforeend', promptHtml);
                        
                        // Show prompt modal
                        const promptModal = new bootstrap.Modal(document.getElementById('registrationPromptModal'));
                        promptModal.show();
                        
                        // Setup proceed button handler
                        document.getElementById('proceedToRegistration').addEventListener('click', function() {
                            // Hide prompt modal
                            promptModal.hide();
                            
                            // Wait for modal to hide, then show registration modal
                            setTimeout(() => {
                                document.getElementById('registrationPromptModal').remove();
                                
                                // Open tourist registration modal
                                const registrationModal = new bootstrap.Modal(document.getElementById('registrationModal'));
                                registrationModal.show();
                                console.log('✅ Registration modal opened from guide detail');
                            }, 300);
                        });
                        
                        // Clean up prompt modal on hide
                        document.getElementById('registrationPromptModal').addEventListener('hidden.bs.modal', function() {
                            this.remove();
                        });
                    }
                }
            }, true); // Use capture phase
            
            console.log('✅ Guide detail delegation setup');
            
        }, 100);
        
        // Setup navigation registration and login buttons
        setTimeout(function() {
            // Main registration button
            const registerBtn = document.getElementById('registerBtn');
            if (registerBtn && !registerBtn.hasAttribute('data-handler-added')) {
                registerBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🎯 Registration button clicked - showing registration choice');
                    
                    // Show registration choice modal (the existing one)
                    const formContainer = document.getElementById('registrationFormContainer');
                    if (formContainer) {
                        // Clear any existing content
                        formContainer.innerHTML = '';
                        
                        // Create inline choice selection
                        const choiceContent = document.createElement('div');
                        choiceContent.className = 'registration-choice-content';
                        choiceContent.id = 'registrationChoiceContent';
                        choiceContent.innerHTML = `
                        <div class="container">
                            <div class="row justify-content-center">
                                <div class="col-lg-8">
                                    <div class="choice-container" style="background: white; border-radius: 20px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15); margin: 2rem 0;">
                                        <div class="choice-header" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 2rem; border-radius: 20px 20px 0 0; text-align: center;">
                                            <h1><i class="bi bi-person-plus me-2"></i>登録タイプを選択</h1>
                                            <p class="mb-0">あなたに最適な登録方法を選んでください</p>
                                        </div>
                                        
                                        <div class="p-4">
                                            <div class="row g-4">
                                                <div class="col-md-6">
                                                    <div class="card h-100 border-primary choice-card" style="cursor: pointer; border-radius: 15px; border-width: 2px; transition: transform 0.2s;" onclick="openTouristRegistration()">
                                                        <div class="card-body text-center p-4">
                                                            <i class="bi bi-camera-fill text-primary mb-3" style="font-size: 3rem;"></i>
                                                            <h6 class="fw-bold text-primary mb-2">観光客登録</h6>
                                                            <p class="text-muted small mb-3">観光客として登録し、ガイドを閲覧・予約できます</p>
                                                            <div class="mt-3">
                                                                <span class="badge bg-primary">簡単登録</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="card h-100 border-success choice-card" style="cursor: pointer; border-radius: 15px; border-width: 2px; transition: transform 0.2s;" onclick="openGuideRegistration()">
                                                        <div class="card-body text-center p-4">
                                                            <i class="bi bi-person-badge-fill text-success mb-3" style="font-size: 3rem;"></i>
                                                            <h6 class="fw-bold text-success mb-2">ガイド登録</h6>
                                                            <p class="text-muted small mb-3">観光ガイドとして登録し、お客様にサービスを提供できます</p>
                                                            <div class="mt-3">
                                                                <span class="badge bg-success">プロフェッショナル</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row g-4 mt-2">
                                                <div class="col-12">
                                                    <div class="card h-100 border-warning choice-card" style="cursor: pointer; border-radius: 15px; border-width: 2px; transition: transform 0.2s;" onclick="handleSponsorRegistration()">
                                                        <div class="card-body text-center p-4">
                                                            <i class="bi bi-building text-warning mb-3" style="font-size: 3rem;"></i>
                                                            <h6 class="fw-bold text-warning mb-2">協賛店登録</h6>
                                                            <p class="text-muted small mb-3">お店や施設を協賛店として登録し、観光客にPRできます</p>
                                                            <div class="mt-3">
                                                                <span class="badge bg-warning">ビジネス向け</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="text-center mt-4">
                                                <small class="text-muted">
                                                    <i class="bi bi-info-circle me-1"></i>
                                                    希望する登録タイプを選択してください。後で変更することも可能です。
                                                </small>
                                            </div>
                                            <div class="text-center mt-3">
                                                <button type="button" class="btn btn-outline-secondary" onclick="hideRegistrationChoice()">
                                                    <i class="bi bi-x-circle me-2"></i>キャンセル
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;
                        
                        // Show the choice content
                        formContainer.appendChild(choiceContent);
                        formContainer.style.display = 'block';
                        
                        // Scroll to the choice section smoothly
                        setTimeout(() => {
                            formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                        
                        console.log('✅ Registration choice shown');
                    }
                });
                registerBtn.setAttribute('data-handler-added', 'true');
                console.log('✅ Main registration button handler added');
            }
            
            // Login dropdown toggle
            const loginDropdown = document.getElementById('loginDropdown');
            if (loginDropdown && !loginDropdown.hasAttribute('data-handler-added')) {
                loginDropdown.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🎯 Login dropdown clicked');
                    
                    const dropdown = document.getElementById('customLoginDropdown');
                    if (dropdown) {
                        if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                            dropdown.style.display = 'block';
                        } else {
                            dropdown.style.display = 'none';
                        }
                    }
                });
                loginDropdown.setAttribute('data-handler-added', 'true');
                console.log('✅ Login dropdown handler added');
            }
            
            // Individual login buttons
            const touristLoginBtn = document.getElementById('directTouristLoginBtn');
            const guideLoginBtn = document.getElementById('directGuideLoginBtn');
            const sponsorDropdownBtn = document.getElementById('sponsorLoginBtn');
            
            if (touristLoginBtn && !touristLoginBtn.hasAttribute('data-handler-added')) {
                touristLoginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🎯 Tourist login clicked');
                    alert('観光客ログイン機能は準備中です');
                });
                touristLoginBtn.setAttribute('data-handler-added', 'true');
            }
            
            if (guideLoginBtn && !guideLoginBtn.hasAttribute('data-handler-added')) {
                guideLoginBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🎯 Guide login clicked');
                    alert('ガイドログイン機能は準備中です');
                });
                guideLoginBtn.setAttribute('data-handler-added', 'true');
            }
            
            // Note: sponsorLoginBtn from dropdown is different from the floating one
            // This one is in the dropdown menu
            if (sponsorDropdownBtn && !sponsorDropdownBtn.hasAttribute('data-handler-added')) {
                sponsorDropdownBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🎯 Sponsor login (dropdown) clicked - redirecting to operations login');
                    window.location.href = 'operations-login.html';
                });
                sponsorDropdownBtn.setAttribute('data-handler-added', 'true');
            }
            
            console.log('✅ Navigation buttons setup complete');
        }, 200);
        
        // Setup hero buttons (backup)
        setupHeroButtons();
        
        window.showGuideDetailModalById = function(guideId) {
            console.log('🎯 Guide detail requested for ID:', guideId);
            
            const guides = window.defaultGuides || [];
            const guide = guides.find(g => g.id == guideId);
            
            if (!guide) {
                alert('ガイド情報が見つかりませんでした');
                return;
            }
            
            const locationNames = {
                hokkaido: "北海道", tokyo: "東京都", osaka: "大阪府", kyoto: "京都府", 
                nara: "奈良県", hiroshima: "広島県", fukuoka: "福岡県", okinawa: "沖縄県"
            };
            
            // This function is now only called for registered tourists
            
            // Create and show modal
            const modalHtml = `
                <div class="modal fade" id="tempGuideDetailModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                <h5 class="modal-title">
                                    <i class="bi bi-person-badge me-2"></i>${guide.name}さんのプロフィール
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-4 text-center">
                                        <img src="${guide.photo || '/assets/img/guides/default-1.svg'}" 
                                             class="img-fluid rounded-circle mb-3" 
                                             style="width: 150px; height: 150px; object-fit: cover;">
                                        <div class="mb-3">
                                            <span class="badge bg-primary">${locationNames[guide.location] || guide.location}</span>
                                        </div>
                                        <div class="mb-3">
                                            <span class="text-muted">評価</span><br>
                                            <span class="h4">${guide.rating} ⭐</span>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <h6><i class="bi bi-translate me-2"></i>対応言語</h6>
                                        <p>${Array.isArray(guide.languages) ? guide.languages.map(lang => {
                                            const langMap = {
                                                'ja': '日本語', 'japanese': '日本語',
                                                'en': '英語', 'english': '英語', 
                                                'zh': '中国語', 'chinese': '中国語',
                                                'ko': '韓国語', 'korean': '韓国語',
                                                'es': 'スペイン語', 'spanish': 'スペイン語',
                                                'fr': 'フランス語', 'french': 'フランス語',
                                                'de': 'ドイツ語', 'german': 'ドイツ語',
                                                'it': 'イタリア語', 'italian': 'イタリア語'
                                            };
                                            return langMap[lang.toLowerCase()] || lang;
                                        }).join(', ') : guide.languages}</p>
                                        
                                        <h6><i class="bi bi-currency-yen me-2"></i>料金</h6>
                                        <p class="h5 text-primary">¥${Number(guide.price).toLocaleString()}/日</p>
                                        
                                        <h6><i class="bi bi-star me-2"></i>専門分野</h6>
                                        <p>${Array.isArray(guide.specialties) ? guide.specialties.join(', ') : guide.specialties || '観光案内全般'}</p>
                                        
                                        <h6><i class="bi bi-info-circle me-2"></i>プロフィール</h6>
                                        <p>地域の魅力を熟知した経験豊富なガイドです。お客様のご希望に合わせて、最高の観光体験をご提供いたします。</p>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" onclick="alert('予約システムは準備中です')">
                                    <i class="bi bi-calendar-check me-2"></i>予約する
                                </button>
                                <button type="button" class="btn btn-outline-primary" onclick="alert('お問い合わせシステムは準備中です')">
                                    <i class="bi bi-chat-dots me-2"></i>お問い合わせ
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing temp modal
            const existingModal = document.getElementById('tempGuideDetailModal');
            if (existingModal) existingModal.remove();
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('tempGuideDetailModal'));
            modal.show();
            
            // Clean up on hide
            document.getElementById('tempGuideDetailModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        };
        
        console.log('✅ Guide detail modal function added');
        
        // Global functions for registration choice
        window.openTouristRegistration = function() {
            console.log('🎯 Tourist registration selected - opening registration page');
            hideRegistrationChoice();
            
            // Open tourist registration page
            window.open('/tourist-registration-simple.html', '_blank', 'width=800,height=900,scrollbars=yes,resizable=yes');
            console.log('✅ Tourist registration page opened');
        };
        
        window.openGuideRegistration = function() {
            console.log('🎯 Guide registration selected');
            
            const formContainer = document.getElementById('registrationFormContainer');
            const originalForm = document.getElementById('detailedGuideRegistrationForm');
            
            if (formContainer && originalForm) {
                formContainer.innerHTML = '';
                formContainer.appendChild(originalForm);
                formContainer.style.display = 'block';
                originalForm.style.display = 'block';
                
                setTimeout(() => {
                    formContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 200);
                
                console.log('✅ Guide registration form displayed');
            } else {
                alert('ガイド登録フォームが見つかりません。');
            }
        };
        
        window.hideRegistrationChoice = function() {
            console.log('🛑 Hiding registration choice');
            const formContainer = document.getElementById('registrationFormContainer');
            if (formContainer) {
                formContainer.style.display = 'none';
                formContainer.innerHTML = '';
                console.log('✅ Registration choice hidden');
            }
        };
        
        // Registration modal clear function moved to app-init.mjs to prevent conflicts
        
        console.log('✅ Global registration functions added');
        
        // Guide registration cancel button handler
        setTimeout(function() {
            const guideRegistrationCancelBtn = document.getElementById('guideRegistrationCancelBtn');
            if (guideRegistrationCancelBtn && !guideRegistrationCancelBtn.hasAttribute('data-handler-added')) {
                guideRegistrationCancelBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🛑 Guide registration cancel clicked');
                    
                    // Hide the guide registration form
                    const formContainer = document.getElementById('registrationFormContainer');
                    const detailedForm = document.getElementById('detailedGuideRegistrationForm');
                    
                    if (formContainer) {
                        formContainer.style.display = 'none';
                        formContainer.innerHTML = '';
                        console.log('✅ Guide registration form hidden');
                    }
                    
                    if (detailedForm) {
                        detailedForm.style.display = 'none';
                        console.log('✅ Detailed guide form hidden');
                    }
                    
                    // Reset the form
                    const guideForm = document.getElementById('detailedGuideForm');
                    if (guideForm) {
                        guideForm.reset();
                        console.log('✅ Guide form reset');
                    }
                    
                    // Scroll to top smoothly
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
                guideRegistrationCancelBtn.setAttribute('data-handler-added', 'true');
                console.log('✅ Guide registration cancel button handler added');
            }
        }, 300);
    </script>
    
    <!-- Main application initialization -->
    <script type="module" src="/assets/js/app-init.mjs"></script>
    <script>
        // Check for unlock notification flag after registration
        document.addEventListener('DOMContentLoaded', function() {
            if (sessionStorage.getItem('showUnlockNotification') === 'true') {
                sessionStorage.removeItem('showUnlockNotification');
                // Wait for app-init.mjs to load
                setTimeout(() => {
                    if (window.showUnlockNotification) {
                        window.showUnlockNotification();
                    }
                }, 500);
            }
        });
    </script>
</body>
</html>