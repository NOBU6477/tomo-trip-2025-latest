<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://replit.com https://*.replit.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; img-src 'self' data: blob: https://images.unsplash.com https://*.unsplash.com; font-src 'self' data: https://fonts.gstatic.com https://cdn.jsdelivr.net; connect-src 'self' https://cdn.jsdelivr.net https://replit.com https://*.replit.com; object-src 'none'; base-uri 'self'; form-action 'self'; frame-src 'self' https://*.replit.dev https://replit.com; report-uri /csp-report;">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>TomoTrip - Âú∞ÂÖÉ„Ç¨„Ç§„Éâ„Å®ÁâπÂà•„Å™ÊóÖ„ÇíÁô∫Ë¶ã</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- CSP compatibility fixes -->
    <script src="env/csp-fix.js"></script>
    <!-- Environment configuration - must be first -->
    <script type="module" src="env/app-config.mjs"></script>
    
    <!-- Build ID and cache cleanup for consistency - CSP compliant -->
    <script src="env/build-id.js"></script>
    <script src="sw-unregister.js"></script>
    
    <!-- Complete error suppression system - TEMPORARILY DISABLED FOR DEBUGGING -->
    <script src="env/csp-fix.js"></script>
    <script src="webgl-fix.js" defer></script>
    <!-- <script src="error_suppressor.js" defer></script> TEMPORARILY DISABLED FOR DEBUGGING -->
    
    <!-- Debug fixes applied - JavaScript execution restored -->
    
    <!-- DEBUG: Test if basic JavaScript works -->
    <script>
        console.log('üî• BOOTSTRAP: Basic JavaScript working! Cache busted: 20250923-1246');
        window.onerror = function(msg, url, line, col, error) {
            console.error('üö® JS ERROR:', msg, 'at', url + ':' + line + ':' + col);
            return false; // Don't suppress default error handling
        };
        window.addEventListener('unhandledrejection', function(event) {
            console.error('üö® UNHANDLED PROMISE REJECTION:', event.reason);
        });
        
        // Force cache refresh for modules
        if (performance.navigation.type === performance.navigation.TYPE_RELOAD) {
            console.log('üîÑ Hard refresh detected - clearing module cache');
        }
        
        // Module loading check - no emergency overrides needed
        console.log('‚úÖ Main app modules will load properly');
    </script>
    
    <!-- Management Center Functions -->
    <script src="management.js" defer></script>
    
    
    <!-- Main application initialization - EMERGENCY CACHE BUST -->
    <script type="module" src="assets/js/app-init.mjs?v=emergency-cache-bust-20250923-1246-new" defer></script>
    
    
    
    <!-- CSS Load Order: Bootstrap CSS ‚Üí Local Icons ‚Üí Custom CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
    <link rel="stylesheet" href="ocean_background.css">
    <link rel="stylesheet" href="assets/css/footer.css">
    <link rel="stylesheet" href="assets/css/auth-modal.css">
    <link rel="stylesheet" href="assets/css/bugfixes.css?v=cache-bust-20250923-1245">

    <style>
        .guide-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* Chat message styling */
        .max-width-70 {
            max-width: 70%;
        }
        
        #chatMessages {
            min-height: 300px;
        }
        
        #chatMessages::-webkit-scrollbar {
            width: 6px;
        }
        
        #chatMessages::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        #chatMessages::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        #chatMessages::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
    </style>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'BIZ UDPGothic', 'Meiryo', sans-serif;
            line-height: 1.6;
            color: #333;
            overflow-x: hidden;
        }

        /* Navigation */
        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: bold;
            font-size: 1.5rem;
            color: #333 !important;
            text-decoration: none;
        }

        .logo-container {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: white;
            padding: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        
        .logo-container img {
            width: 52px;
            height: 52px;
            object-fit: contain;
            border-radius: 50%;
            background: white;
            display: block;
        }

        /* Hero Section - Bright Ocean Yacht Background */
        .hero-section {
            position: relative !important;
            height: 100vh !important;
            min-height: 100vh !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            overflow: hidden !important;
        }
        
        /* Background image layer with bright filters */
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('/assets/images/beach-yacht-tourists.jpg');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: scroll;
            /* Moderately bright, natural filters for ocean yacht scene */
            filter: brightness(1.2) contrast(1.05) saturate(1.1);
            z-index: -2;
        }
        
        /* Mobile background fix for English version */
        @media (max-width: 768px) {
            body, html {
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat scroll !important;
                min-height: 100vh !important;
                width: 100% !important;
            }
            
            .hero-section::before {
                background-attachment: scroll;
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: -10;
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat !important;
            }
        }
        
        /* Extra narrow mobile screens */
        @media (max-width: 480px) {
            body, html, .hero-section {
                background: url('/assets/images/beach-yacht-tourists.jpg') center center / cover no-repeat scroll !important;
                min-height: 100vh !important;
                width: 100vw !important;
            }
        }
        
        /* Light overlay for text readability */
        .hero-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: -1;
        }
        
        /* Ensure content is visible */
        .hero-section .container,
        .hero-section .row,
        .hero-section .col-12,
        .hero-section .text-center {
            position: relative !important;
            z-index: 20 !important;
        }

        /* Language Switcher - Center Position */
        .language-switcher-center {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 0;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border-radius: 25px;
            overflow: hidden;
            background: transparent;
        }

        .lang-btn-jp, .lang-btn-en {
            padding: 15px 30px;
            border: none;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 140px;
            color: white;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ - „É¢„Éê„Ç§„É´ÂØæÂøú */
        @media (max-width: 768px) {
            .language-switcher-center {
                top: 20%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 90%;
                max-width: 320px;
            }
            
            .lang-btn-jp, .lang-btn-en {
                padding: 12px 20px;
                font-size: 14px;
                min-width: 100px;
                flex: 1;
            }
        }

        @media (max-width: 480px) {
            .language-switcher-center {
                top: 18%;
                width: 95%;
                max-width: 280px;
            }
            
            .lang-btn-jp, .lang-btn-en {
                padding: 10px 15px;
                font-size: 13px;
                min-width: 80px;
            }
        }

        .lang-btn-jp {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
        }

        .lang-btn-en {
            background: linear-gradient(135deg, #4287f5, #64a8ff);
        }

        .lang-btn-jp:hover {
            background: linear-gradient(135deg, #ff5252, #ff7979);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255,107,107,0.4);
        }

        .lang-btn-en:hover {
            background: linear-gradient(135deg, #3367d6, #5a9cff);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66,135,245,0.4);
        }

        /* Hero Content */
        .hero-content {
            text-align: center;
            color: white;
            z-index: 50;
            max-width: 800px;
            padding: 0 20px;
            margin-top: 150px;
        }

        .hero-title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 1.5rem;
        }

        .hero-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: white;
            padding: 8px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hero-logo img {
            width: 64px;
            height: 64px;
            object-fit: contain;
            border-radius: 50%;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .hero-content p {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-hero {
            padding: 15px 35px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 35px;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .btn-primary-hero {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-primary-hero:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,123,255,0.4);
        }

        .btn-outline-hero {
            background: transparent;
            color: white;
            border: 2px solid white;
        }

        .btn-outline-hero:hover {
            background: white;
            color: #333;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255,255,255,0.3);
        }

        /* Guide Cards */
        .guide-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            height: 100%;
        }

        .guide-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .guide-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .guide-card-body {
            padding: 1.5rem;
        }

        .guide-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .guide-location {
            color: #6c757d;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .guide-languages {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .language-badge {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1976d2;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .guide-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .stars {
            color: #ffc107;
        }

        .guide-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: #28a745;
            margin-bottom: 1rem;
        }

        .guide-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-guide {
            flex: 1;
            padding: 0.8rem;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn-view {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-view:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-2px);
        }

        .btn-bookmark {
            background: linear-gradient(135deg, #ffc107, #ffb300);
            color: white;
        }

        .btn-bookmark:hover {
            background: linear-gradient(135deg, #ffb300, #ff8f00);
            transform: translateY(-2px);
        }

        /* Right Side Sponsor Buttons */
        .sponsor-buttons {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }

        .sponsor-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
            min-width: 140px;
            text-align: center;
        }

        .sponsor-btn:hover {
            background: linear-gradient(135deg, #218838, #1ea584);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .sponsor-btn.login-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .sponsor-btn.login-btn:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        /* Enhanced Login Buttons Styling */
        .login-btn-tourist:hover {
            background: linear-gradient(135deg, #00b4d8, #0096c7) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 209, 199, 0.5) !important;
        }

        .login-btn-guide:hover {
            background: linear-gradient(135deg, #20c997, #198754) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.5) !important;
        }

        .login-btn-tourist::before,
        .login-btn-guide::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
        }

        .login-btn-tourist:hover::before,
        .login-btn-guide:hover::before {
            width: 300px;
            height: 300px;
        }

        /* Mobile responsiveness for login buttons */
        @media (max-width: 768px) {
            .login-buttons-container {
                flex-direction: column !important;
                gap: 8px !important;
            }
            
            .login-btn-tourist,
            .login-btn-guide {
                padding: 8px 16px !important;
                font-size: 14px !important;
                min-width: 120px;
            }
        }

        /* Management Center Button */
        .management-center {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffc107, #ffb300);
            border: none;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(255, 193, 7, 0.4);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .management-center:hover {
            background: linear-gradient(135deg, #ffb300, #ff8f00);
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(255, 193, 7, 0.5);
        }

        /* Mobile Responsive - Complete Version */
        @media (max-width: 768px) {
            /* Basic structure adjustments */
            body {
                overflow-x: hidden;
            }
            
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            
            /* Navigation adjustments */
            .navbar {
                padding: 8px 0;
            }
            
            .navbar-brand {
                font-size: 1.1rem;
            }
            
            .navbar .d-flex {
                flex-direction: row;
                align-items: center;
                gap: 8px;
                width: auto;
            }
            
            .navbar .btn {
                font-size: 12px;
                padding: 6px 12px;
                white-space: nowrap;
            }
            
            .dropdown-menu {
                min-width: 140px !important;
                right: 0;
                left: auto;
            }
            
            /* Hero section adjustments */
            .hero-section {
                min-height: 100vh;
                padding: 20px 0;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }
            
            .hero-content {
                text-align: center;
                padding: 0 20px;
                max-width: 100%;
            }
            
            .hero-content h1 {
                font-size: 2rem;
                margin-bottom: 1rem;
            }
            
            .hero-content p {
                font-size: 1rem;
                margin-bottom: 2rem;
                line-height: 1.6;
            }
            
            /* Language switcher */
            .language-switcher-center {
                position: relative;
                top: auto;
                left: auto;
                transform: none;
                margin: 0 auto 2rem auto;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 10px;
                width: 100%;
                padding: 0 20px;
                box-sizing: border-box;
            }
            
            .lang-btn-jp, .lang-btn-en {
                width: 100%;
                max-width: 280px;
                font-size: 14px;
                padding: 10px 16px;
                box-sizing: border-box;
                border-radius: 25px;
            }
            
            /* Hero buttons */
            .hero-buttons {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 12px;
                margin: 0 auto;
                padding: 0 20px;
                width: 100%;
                max-width: 280px;
            }
            
            .btn-hero {
                width: 100%;
                font-size: 14px;
                padding: 12px 20px;
                box-sizing: border-box;
                border-radius: 25px;
            }
            
            /* Sponsor buttons */
            .sponsor-buttons {
                position: relative;
                right: auto;
                top: auto;
                transform: none;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                margin: 20px auto;
                padding: 0 20px;
                gap: 10px;
                max-width: 280px;
                width: 100%;
            }
            
            .sponsor-btn {
                width: 100%;
                font-size: 14px;
                padding: 10px 16px;
                box-sizing: border-box;
                border-radius: 20px;
            }
            
            /* Main content */
            .main-content {
                padding: 40px 0 !important;
            }
            
            .filter-section {
                padding: 20px !important;
                margin: 0 10px;
            }
            
            .filter-section .d-flex {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .filter-section .form-select,
            .filter-section .form-control {
                width: 100% !important;
                min-width: auto !important;
                font-size: 14px;
                padding: 10px;
                box-sizing: border-box;
            }
            
            /* Guide cards */
            .guide-card {
                margin-bottom: 15px;
            }
            
            .guide-actions {
                flex-direction: column;
                gap: 8px;
            }
            
            .btn-guide {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            /* Management center button */
            .management-center {
                position: fixed;
                bottom: 15px;
                right: 15px;
                transform: none;
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            /* Modals */
            .modal-dialog {
                margin: 5px;
                max-width: calc(100vw - 10px);
                height: calc(100vh - 10px);
            }
            
            .modal-content {
                height: 100%;
                border-radius: 10px;
            }
            
            .modal-body {
                padding: 15px;
                overflow-y: auto;
            }
            
            .modal-body .form-control,
            .modal-body .form-select {
                font-size: 14px;
                padding: 10px;
            }
            
            .modal-body .btn {
                font-size: 14px;
                padding: 10px 16px;
            }
            
            /* Footer adjustments */
            .footer {
                padding: 20px 0;
            }
            
            .footer .row > .col-md-2,
            .footer .row > .col-md-3 {
                margin-bottom: 15px;
            }
            
            /* Tables */
            .table-responsive {
                font-size: 12px;
            }
            
            /* Search results */
            .search-results {
                padding: 10px;
            }
            
            /* Pagination */
            .pagination {
                justify-content: center;
            }
            
            .page-link {
                font-size: 12px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body class="theme-ocean">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <div class="logo-container">
                    <img src="assets/images/tomotrip-logo.png" alt="TomoTrip Logo" onload="console.log('‚úÖ Logo loaded successfully from:', this.src)" onerror="console.error('‚ùå Logo load failed:', this.src); this.style.display='none'; this.parentElement.innerHTML='<span style=&quot;font-size: 24px; color: white;&quot;>T</span>';" />
                </div>
                TomoTrip
            </a>
            
            <div class="d-flex align-items-center justify-content-end gap-2" style="flex-grow: 1;">
                <button class="btn btn-success btn-sm" id="dashboardBtn" title="Sponsor Management Dashboard" style="font-size: 0.8rem; padding: 6px 10px;">
                    <i class="bi bi-shop"></i> <span class="d-none d-lg-inline">Dashboard</span>
                </button>
                <div class="login-buttons-container d-flex gap-1">
                    <button class="btn login-btn-tourist btn-sm" id="directTouristLoginBtn" type="button" style="background: linear-gradient(135deg, #4fd1c7, #00b4d8); color: white; border: none; padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 0.8rem; transition: all 0.3s ease;">
                        <i class="bi bi-person-circle me-1"></i><span class="d-none d-md-inline">Ë¶≥ÂÖâÂÆ¢</span>
                    </button>
                    <button class="btn login-btn-guide btn-sm" id="directGuideLoginBtn" type="button" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 0.8rem; transition: all 0.3s ease;">
                        <i class="bi bi-person-badge me-1"></i><span class="d-none d-md-inline">„Ç¨„Ç§„Éâ</span>
                    </button>
                </div>
                <button class="btn btn-primary btn-sm" id="registerBtn" style="font-size: 0.8rem; padding: 6px 12px; border-radius: 20px;">Êñ∞Ë¶èÁôªÈå≤</button>
            </div>
        </div>
    </nav>

    <!-- Registration Form Container (right below the nav) -->
    <div id="registrationFormContainer" style="display: none;">
        <!-- Form will be inserted here dynamically -->
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10 col-md-12">
                    <!-- Language Switcher - Perfectly Centered -->
                    <div class="language-switcher-center text-center mb-4" style="display: flex !important; justify-content: center !important; align-items: center !important; width: 100% !important;">
                        <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center gap-3" style="margin: 0 auto !important; width: fit-content !important;">
                            <button class="lang-btn-jp btn" id="jpBtn" style="background: linear-gradient(135deg, #ff6b9d, #ff6b35); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(255, 107, 157, 0.3); transition: all 0.3s ease; min-width: 150px; text-align: center !important;">üáØüáµ Êó•Êú¨Ë™û</button>
                            <button class="lang-btn-en btn" id="enBtn" style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border: none; padding: 12px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3); transition: all 0.3s ease; min-width: 150px; text-align: center !important;">üá∫üá∏ English</button>
                        </div>
                    </div>

                    <!-- Hero Content - Logo Left-aligned with Title -->
                    <div class="hero-content text-center" style="display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%;">
                        <div class="hero-title-container mb-4" style="display: flex; flex-direction: column; align-items: flex-start; width: 100%; max-width: 600px;">
                            <div class="hero-logo mb-3" style="display: flex; justify-content: flex-start; align-self: flex-start;">
                                <img src="assets/images/tomotrip-logo.png" alt="TomoTrip Logo" class="modal-logo" />
                            </div>
                            <h1 class="display-4 fw-bold text-white" style="text-align: left; align-self: flex-start;">ÁâπÂà•„Å™ÊóÖ„ÅÆ‰ΩìÈ®ì„Çí</h1>
                        </div>
                        <p class="lead text-white mb-5" style="text-align: center; max-width: 600px;">Âú∞ÂÖÉ„Ç¨„Ç§„Éâ„Å®‰∏ÄÁ∑í„Å´Ë¶≥ÂÖâÂÆ¢„ÅåÁü•„Çâ„Å™„ÅÑÈö†„Çå„ÅüÂêçÊâÄ„ÇíÁô∫Ë¶ã„Åó„Çà„ÅÜ</p>
                        <div class="hero-buttons" style="display: flex; justify-content: center; width: 100%;">
                            <div class="d-flex flex-column flex-sm-row justify-content-center align-items-center gap-3" style="width: fit-content;">
                                <button class="btn-hero btn-primary-hero btn" id="findGuideBtn" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; padding: 15px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); transition: all 0.3s ease; min-width: 150px; color: white; text-align: center;">„Ç¨„Ç§„Éâ„ÇíÊé¢„Åô</button>
                                <button class="btn-hero btn-outline-hero btn" id="contactBtn" style="background: linear-gradient(135deg, #f093fb, #f5576c); border: none; padding: 15px 30px; border-radius: 25px; font-weight: 500; box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3); transition: all 0.3s ease; min-width: 150px; color: white; text-align: center;">„ÅäÂïè„ÅÑÂêà„Çè„Åõ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Management Center Button - Desktop -->
    <button class="management-center d-none d-lg-block" id="managementBtn" title="Management Center" style="position: fixed; bottom: 30px; right: 30px; z-index: 1000; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #ffd700, #ffed4e); border: none; font-size: 24px; box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4); transition: all 0.3s ease; cursor: pointer;">üèÜ</button>
    
    <!-- Management Center Button - Mobile -->
    <button class="management-center-mobile d-lg-none position-fixed" id="managementBtnMobile" title="Management Center" style="bottom: 80px; right: 20px; z-index: 1000; width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #ffd700, #ffed4e); border: none; font-size: 20px; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4); transition: all 0.3s ease; cursor: pointer;">üèÜ</button>

    <!-- Admin Mode Toggle Button -->
    <button class="admin-mode-toggle d-none d-lg-block" id="adminModeToggleBtn" data-action="toggle-admin-mode" title="ÁÆ°ÁêÜËÄÖ„É¢„Éº„Éâ" style="position: fixed; bottom: 30px; right: 110px; z-index: 1000; width: 60px; height: 60px; border-radius: 50%; background: linear-gradient(135deg, #dc3545, #c82333); border: none; font-size: 24px; color: white; box-shadow: 0 4px 20px rgba(220, 53, 69, 0.4); transition: all 0.3s ease; cursor: pointer;">‚öôÔ∏è</button>

    <!-- Main Content Section -->
    <section class="main-content" style="padding: 80px 0; background: #f8f9fa;">
        <div class="container">
            <!-- Filter Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="filter-section" style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <div class="d-flex flex-wrap gap-3 align-items-center justify-content-between">
                            <div class="d-flex flex-wrap gap-3">
                                <select class="form-select" style="width: auto; min-width: 200px;" id="locationFilter">
                                    <!-- ÈÉΩÈÅìÂ∫úÁúåÈÅ∏ÊäûËÇ¢„ÅØ prefecture-selector.mjs „ÅßÂãïÁöÑÁîüÊàê -->
                                </select>

                                <select class="form-select" style="width: auto; min-width: 160px;" id="languageFilter">
                                    <option value="">„Åô„Åπ„Å¶„ÅÆË®ÄË™û</option>
                                    <optgroup label="Asian Languages">
                                        <option value="japanese">Êó•Êú¨Ë™û</option>
                                        <option value="english">Ëã±Ë™û</option>
                                        <option value="chinese">‰∏≠ÂõΩË™ûÔºàÁ∞°‰ΩìÔºâ</option>
                                        <option value="chinese_traditional">‰∏≠ÂõΩË™ûÔºàÁπÅ‰ΩìÔºâ</option>
                                        <option value="korean">ÈüìÂõΩË™û</option>
                                        <option value="thai">„Çø„Ç§Ë™û</option>
                                        <option value="vietnamese">„Éô„Éà„Éä„É†Ë™û</option>
                                        <option value="indonesian">„Ç§„É≥„Éâ„Éç„Ç∑„Ç¢Ë™û</option>
                                        <option value="tagalog">„Çø„Ç¨„É≠„Ç∞Ë™ûÔºà„Éï„Ç£„É™„Éî„É≥Ôºâ</option>
                                        <option value="hindi">„Éí„É≥„Éá„Ç£„ÉºË™û</option>
                                    </optgroup>
                                    <optgroup label="„É®„Éº„É≠„ÉÉ„ÉëË®ÄË™û">
                                        <option value="spanish">„Çπ„Éö„Ç§„É≥Ë™û</option>
                                        <option value="french">„Éï„É©„É≥„ÇπË™û</option>
                                        <option value="german">„Éâ„Ç§„ÉÑË™û</option>
                                        <option value="italian">„Ç§„Çø„É™„Ç¢Ë™û</option>
                                        <option value="portuguese">„Éù„É´„Éà„Ç¨„É´Ë™û</option>
                                        <option value="russian">„É≠„Ç∑„Ç¢Ë™û</option>
                                        <option value="dutch">„Ç™„É©„É≥„ÉÄË™û</option>
                                        <option value="swedish">„Çπ„Ç¶„Çß„Éº„Éá„É≥Ë™û</option>
                                    </optgroup>
                                    <optgroup label="„Åù„ÅÆ‰ªñ„ÅÆË®ÄË™û">
                                        <option value="arabic">„Ç¢„É©„Éì„Ç¢Ë™û</option>
                                        <option value="hebrew">„Éò„Éñ„É©„Ç§Ë™û</option>
                                        <option value="turkish">„Éà„É´„Ç≥Ë™û</option>
                                        <option value="swahili">„Çπ„ÉØ„Éí„É™Ë™û</option>
                                    </optgroup>
                                </select>
                                
                                <select class="form-select" style="width: auto; min-width: 160px;" id="priceFilter">
                                    <option value="">„Åô„Åπ„Å¶„ÅÆ‰æ°Ê†º</option>
                                    <option value="budget">¬•6,000ÔΩû¬•10,000</option>
                                    <option value="premium">¬•10,001ÔΩû¬•20,000</option>
                                    <option value="luxury">¬•20,001+</option>
                                </select>
                                
                                <input type="text" class="form-control" style="width: auto; min-width: 200px;" id="keywordInput" placeholder="„Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢...">
                            </div>
                            
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary" id="searchBtn" data-action="search">Ê§úÁ¥¢</button>
                                <button class="btn btn-outline-secondary" id="resetBtn" data-action="reset">„É™„Çª„ÉÉ„Éà</button>
                            </div>
                        </div>
                        
                        <div class="mt-3 d-flex justify-content-between align-items-center">
                            <small class="text-muted" id="guideCounter">Ë™≠„ÅøËæº„Åø‰∏≠...</small>
                            <small class="text-info" id="totalGuideCounter">ÂÖ®‰Ωì: Ë™≠„ÅøËæº„Åø‰∏≠...</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guide Cards Section -->
            <div class="row" id="guideCardsContainer">
                <!-- Guide cards will be populated here -->
            </div>
            
            <!-- Pagination Controls -->
            <div class="row mt-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-outline-secondary" id="prevPageBtn" disabled>‚Üê Ââç„ÅÆ„Éö„Éº„Ç∏</button>
                        <div class="pagination-info">
                            <span id="pageInfo" class="fw-bold">„Éö„Éº„Ç∏ 1</span>
                            <small class="text-muted ms-2">(<span id="displayRange">1-12</span> ‰ª∂Ë°®Á§∫‰∏≠)</small>
                        </div>
                        <button class="btn btn-outline-primary" id="nextPageBtn">Ê¨°„ÅÆ„Éö„Éº„Ç∏ ‚Üí</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Detailed Guide Registration Form (with Phone Verification & Document Upload) -->
    <div id="detailedGuideRegistrationForm" style="display: none; margin-top: 2rem;">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="guide-container" style="background: white; border-radius: 20px; box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15); margin: 2rem 0;">
                        <div class="guide-header" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 2rem; border-radius: 20px 20px 0 0; text-align: center;">
                            <h1><i class="bi bi-person-plus-fill me-2"></i>Êñ∞Ë¶è„Ç¨„Ç§„ÉâÁôªÈå≤</h1>
                            <p class="mb-0">ÊµÖËçâË¶≥ÂÖâÊ°àÂÜÖÊâÄ - „Ç¨„Ç§„Éâ„Çπ„Çø„ÉÉ„ÉïÂãüÈõÜ</p>
                        </div>
                        
                        <div class="p-4">
                            <form id="detailedGuideForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="detailedGuideName" required>
                                            <label for="detailedGuideName"><i class="bi bi-person me-1"></i>„Ç¨„Ç§„ÉâÂêç</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="email" class="form-control" id="detailedGuideEmail" required>
                                            <label for="detailedGuideEmail"><i class="bi bi-envelope me-1"></i>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ÈõªË©±Ë™çË®º„Çª„ÇØ„Ç∑„Éß„É≥ -->
                                <h5 class="mb-3 text-success"><i class="bi bi-telephone-fill me-2"></i>ÈõªË©±Ë™çË®º</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="tel" class="form-control" id="detailedGuidePhone" required>
                                            <label for="detailedGuidePhone"><i class="bi bi-telephone me-1"></i>ÈõªË©±Áï™Âè∑</label>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <button type="button" class="btn btn-outline-success w-100" id="sendVerificationCode" style="height: 58px;">
                                            <i class="bi bi-send me-1"></i>Ë™çË®º„Ç≥„Éº„ÉâÈÄÅ‰ø°
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="verificationCode" placeholder="Ë™çË®º„Ç≥„Éº„Éâ" maxlength="6">
                                            <label for="verificationCode"><i class="bi bi-shield-check me-1"></i>Ë™çË®º„Ç≥„Éº„Éâ</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <button type="button" class="btn btn-success" id="verifyPhoneCode" disabled>
                                            <i class="bi bi-check-circle me-1"></i>ÈõªË©±Áï™Âè∑„ÇíË™çË®º„Åô„Çã
                                        </button>
                                        <span id="phoneVerificationStatus" class="text-muted ms-3"></span>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideGender" required>
                                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                <option value="male">Áî∑ÊÄß</option>
                                                <option value="female">Â•≥ÊÄß</option>
                                                <option value="other">„Åù„ÅÆ‰ªñ</option>
                                            </select>
                                            <label for="detailedGuideGender"><i class="bi bi-people me-1"></i>ÊÄßÂà•</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="detailedGuideAge" min="18" max="80" required>
                                            <label for="detailedGuideAge"><i class="bi bi-calendar me-1"></i>Âπ¥ÈΩ¢</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideExperience" required>
                                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                <option value="beginner">ÂàùÂøÉËÄÖÔºà1Âπ¥Êú™Ê∫ÄÔºâ</option>
                                                <option value="intermediate">‰∏≠Á¥öËÄÖÔºà1-3Âπ¥Ôºâ</option>
                                                <option value="advanced">‰∏äÁ¥öËÄÖÔºà3Âπ¥‰ª•‰∏äÔºâ</option>
                                            </select>
                                            <label for="detailedGuideExperience"><i class="bi bi-award me-1"></i>ÁµåÈ®ì„É¨„Éô„É´</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ë∫´ÂàÜË®ºÊòéÊõ∏„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ -->
                                <h5 class="mb-3 text-success"><i class="bi bi-card-checklist me-2"></i>Ë∫´ÂàÜË®ºÊòéÊõ∏</h5>
                                
                                <!-- Ë®ºÊòéÊõ∏„Çø„Ç§„ÉóÈÅ∏Êäû -->
                                <div class="form-floating mb-3">
                                    <select class="form-control" id="documentType" required onchange="updateDocumentUpload()">
                                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                        <option value="drivers_license">ÈÅãËª¢ÂÖçË®±Ë®ºÔºàË°®Èù¢„ÉªË£èÈù¢„ÅÆ2ÊûöÂøÖÈ†àÔºâ</option>
                                        <option value="passport">„Éë„Çπ„Éù„Éº„ÉàÔºàÂÜôÁúü„Éö„Éº„Ç∏1ÊûöÔºâ</option>
                                        <option value="residence_card">‰ΩèÊ∞ëÁ•®Ôºà1ÊûöÔºâ</option>
                                        <option value="insurance_card">ÂÅ•Â∫∑‰øùÈô∫Ë®ºÔºàË°®Èù¢„ÉªË£èÈù¢„ÅÆ2ÊûöÂøÖÈ†àÔºâ</option>
                                        <option value="mynumber_card">„Éû„Ç§„Éä„É≥„Éê„Éº„Ç´„Éº„ÉâÔºàË°®Èù¢„ÅÆ„Åø1ÊûöÔºâ</option>
                                    </select>
                                    <label for="documentType"><i class="bi bi-card-list me-1"></i>ÊèêÂá∫„Åô„ÇãË®ºÊòéÊõ∏„Çø„Ç§„Éó</label>
                                </div>
                                
                                <!-- ÂãïÁöÑË®ºÊòéÊõ∏„Ç¢„ÉÉ„Éó„É≠„Éº„ÉâÊ¨Ñ -->
                                <div id="documentUploadArea" style="display: none;">
                                    <div class="alert alert-info" id="documentInstructions"></div>
                                    <div class="row mb-3" id="documentUploadCards"></div>
                                </div>
                                
                                <!-- „Éó„É≠„Éï„Ç£„Éº„É´ÂÜôÁúü„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ -->
                                <h5 class="mb-3 text-info"><i class="bi bi-person-square me-2"></i>„Éó„É≠„Éï„Ç£„Éº„É´ÂÜôÁúü</h5>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <div class="card border-2 border-dashed border-info" style="min-height: 150px;">
                                            <div class="card-body text-center">
                                                <i class="bi bi-camera fs-1 text-info mb-2"></i>
                                                <p class="text-muted">„Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„Å´Ë°®Á§∫„Åï„Çå„ÇãÂÜôÁúü</p>
                                                <input type="file" class="form-control" id="profilePhoto" accept="image/*" required onchange="previewProfilePhoto(this)">
                                                <small class="text-muted">È¢®ÊôØ„Éª‰∫∫Áâ©„Éª‰ªªÊÑè„ÅÆÂÜôÁúüOK<br>ÔºàJPG„ÄÅPNGÂØæÂøúÔºâ</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" id="profilePhotoPreviewCard" style="display: none;">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">„Éó„É≠„Éï„Ç£„Éº„É´ÂÜôÁúü„Éó„É¨„Éì„É•„Éº</h6>
                                                <img id="profilePhotoPreview" class="img-fluid" style="max-height: 120px; border-radius: 10px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ÁîªÂÉè„Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢ -->
                                <div class="row mb-3" id="imagePreviewArea" style="display: none;">
                                    <div id="documentPreviewCards"></div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">„Éó„É≠„Éï„Ç£„Éº„É´ÂÜôÁúü„Éó„É¨„Éì„É•„Éº</h6>
                                                <img id="profilePreview" class="img-fluid" style="max-height: 200px; border-radius: 10px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <select class="form-control" id="detailedGuideLanguages" multiple required style="min-height: 120px;">
                                        <option value="japanese">Êó•Êú¨Ë™û</option>
                                        <option value="english">Ëã±Ë™û</option>
                                        <option value="chinese">‰∏≠ÂõΩË™û</option>
                                        <option value="korean">ÈüìÂõΩË™û</option>
                                        <option value="spanish">„Çπ„Éö„Ç§„É≥Ë™û</option>
                                        <option value="french">„Éï„É©„É≥„ÇπË™û</option>
                                        <option value="german">„Éâ„Ç§„ÉÑË™û</option>
                                        <option value="italian">„Ç§„Çø„É™„Ç¢Ë™û</option>
                                    </select>
                                    <label for="detailedGuideLanguages"><i class="bi bi-translate me-1"></i>ÂØæÂøúË®ÄË™ûÔºàË§áÊï∞ÈÅ∏ÊäûÂèØÔºâ</label>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="detailedGuideIntroduction" style="height: 120px;" required></textarea>
                                    <label for="detailedGuideIntroduction"><i class="bi bi-chat-text me-1"></i>Ëá™Â∑±Á¥π‰ªã„Éª„Ç¢„Éî„Éº„É´„Éù„Ç§„É≥„Éà</label>
                                </div>
                                
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="detailedGuideSpecialties" style="height: 100px;" required></textarea>
                                    <label for="detailedGuideSpecialties"><i class="bi bi-star me-1"></i>ÂæóÊÑèÂàÜÈáé„ÉªÂ∞ÇÈñÄ„Ç®„É™„Ç¢</label>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <input type="number" class="form-control" id="detailedGuideSessionRate" min="6000" max="25000" step="500" required>
                                            <label for="detailedGuideSessionRate"><i class="bi bi-currency-yen me-1"></i>Â∏åÊúõ„Çª„ÉÉ„Ç∑„Éß„É≥ÊñôÈáëÔºàÂÜÜÔºâ</label>
                                            <small class="text-muted">1„Çª„ÉÉ„Ç∑„Éß„É≥Ôºà2„Äú3ÊôÇÈñìÁ®ãÂ∫¶Ôºâ„ÅÆÊñôÈáë„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºàÔø•6,000„ÄúÔºâ</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating mb-3">
                                            <select class="form-control" id="detailedGuideAvailability" required>
                                                <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                <option value="weekdays">Âπ≥Êó•„ÅÆ„Åø</option>
                                                <option value="weekends">ÈÄ±Êú´„ÅÆ„Åø</option>
                                                <option value="both">Âπ≥Êó•„ÉªÈÄ±Êú´‰∏°Êñπ</option>
                                            </select>
                                            <label for="detailedGuideAvailability"><i class="bi bi-calendar-week me-1"></i>Á®ºÂÉçÂèØËÉΩÊó•</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="detailedAgreeTerms" required>
                                    <label class="form-check-label" for="detailedAgreeTerms">
                                        „Ç¨„Ç§„ÉâË¶èÁ¥ÑÂèä„Å≥Âà©Áî®Ë¶èÁ¥Ñ„Å´ÂêåÊÑè„Åó„Åæ„Åô
                                    </label>
                                </div>
                                
                                <!-- „Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„Éó„É¨„Éì„É•„Éº„Ç®„É™„Ç¢ -->
                                <div id="guideCardPreviewArea" style="display: none;" class="mb-4">
                                    <h5 class="mb-3 text-primary"><i class="bi bi-eye me-2"></i>„Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„Éó„É¨„Éì„É•„Éº</h5>
                                    <div class="alert alert-info">
                                        <i class="bi bi-info-circle me-2"></i>„Åì„Çå„Åå„ÅÇ„Å™„Åü„ÅÆ„Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„Åß„Åô„ÄÇË¶≥ÂÖâÂÆ¢„Å´Ë°®Á§∫„Åï„Çå„ÇãÊÉÖÂ†±„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                    </div>
                                    <div class="row justify-content-center">
                                        <div class="col-md-8">
                                            <div id="guideCardPreview" class="card shadow-lg border-0" style="border-radius: 15px; overflow: hidden;">
                                                <!-- Dynamic guide card content will be inserted here -->
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <button type="button" class="btn btn-outline-primary" onclick="updateGuideCardPreview()">
                                            <i class="bi bi-arrow-clockwise me-2"></i>„Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button type="button" class="btn btn-info mb-3" onclick="showGuideCardPreview()" style="border-radius: 10px;">
                                        <i class="bi bi-eye me-2"></i>„Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„Éó„É¨„Éì„É•„Éº„ÇíË°®Á§∫
                                    </button>
                                    <button type="submit" class="btn btn-guide" style="background: linear-gradient(135deg, #28a745, #20c997); border: none; padding: 12px; border-radius: 10px; color: white; font-weight: 600;">
                                        <i class="bi bi-check-circle me-2"></i>„Ç¨„Ç§„ÉâÁôªÈå≤Áî≥Ë´ã
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary" id="guideRegistrationCancelBtn">
                                        <i class="bi bi-x-circle me-2"></i>„Ç≠„É£„É≥„Çª„É´
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tourist Registration Modal - Completely Japanese with Verification -->
    <div class="modal fade" id="registrationModal" tabindex="-1" aria-labelledby="registrationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: none;">
                <div class="modal-header border-0 position-relative" 
                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #667eea 100%); 
                            color: white; border-radius: 20px 20px 0 0; padding: 25px 30px;">
                    <h5 class="modal-title fw-bold d-flex align-items-center" id="registrationModalLabel">
                        <div class="me-3" style="width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-person-plus-fill" style="font-size: 22px;"></i>
                        </div>
                        <div>
                            <div style="font-size: 1.3rem;">Ë¶≥ÂÖâÂÆ¢ÁôªÈå≤</div>
                            <small style="opacity: 0.9; font-weight: normal;">ÈõªË©±Ë™çË®º„Å®Ë∫´ÂàÜË®ºÊòéÊõ∏„ÅÆÊèêÂá∫„ÅåÂøÖË¶Å„Åß„Åô</small>
                        </div>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã" 
                            style="font-size: 1.2rem; padding: 10px;"></button>
                </div>
                
                <div class="modal-body p-0" style="max-height: 70vh; overflow-y: auto;">
                    <!-- Step Indicator -->
                    <div class="text-center mb-4 px-4 py-3" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-bottom: 1px solid #dee2e6;">
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="step-item active" id="step1-indicator">
                                <span class="badge bg-primary rounded-circle me-2">1</span>
                                Âü∫Êú¨ÊÉÖÂ†±
                            </div>
                            <div class="mx-3">‚Üí</div>
                            <div class="step-item" id="step2-indicator">
                                <span class="badge bg-secondary rounded-circle me-2">2</span>
                                ÈõªË©±Ë™çË®º
                            </div>
                            <div class="mx-3">‚Üí</div>
                            <div class="step-item" id="step3-indicator">
                                <span class="badge bg-secondary rounded-circle me-2">3</span>
                                Ë∫´ÂàÜË®ºÊòéÊõ∏
                            </div>
                        </div>
                    </div>

                    <form id="touristRegistrationForm">
                        <!-- Step 1: Basic Information -->
                        <div class="step-content active" id="step1Content">
                            <div class="p-4">
                                <div class="alert alert-info border-0 mb-4" 
                                     style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 15px;">
                                    <div class="d-flex align-items-start">
                                        <i class="bi bi-info-circle-fill text-primary me-3" style="font-size: 1.5rem; margin-top: 2px;"></i>
                                        <div>
                                            <h6 class="fw-bold mb-2 text-primary">Ë¶≥ÂÖâÂÆ¢ÁôªÈå≤„Å´„Å§„ÅÑ„Å¶</h6>
                                            <small class="text-dark">
                                                TomoTrip„Åß„ÅØ„ÄÅ‰ø°È†º„Åß„Åç„ÇãÂú∞ÂÖÉ„Ç¨„Ç§„Éâ„Å®„ÅÆÂÆâÂÖ®„Å™Âá∫‰ºö„ÅÑ„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
                                                „Ç¨„Ç§„Éâ„ÅÆË©≥Á¥∞ÊÉÖÂ†±Èñ≤Ë¶ß„ÇÑ„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Çí„ÅîÂà©Áî®„ÅÑ„Åü„Å†„Åè„Åü„ÇÅ„ÄÅË¶≥ÂÖâÂÆ¢„Å®„Åó„Å¶„ÅÆÁôªÈå≤„Çí„ÅäÈ°ò„ÅÑ„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ
                                            </small>
                                        </div>
                                    </div>
                                </div>

                                <h4 class="mb-3">Âü∫Êú¨ÊÉÖÂ†±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h4>

                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="touristFirstName" class="form-label">Âêç</label>
                                        <input type="text" class="form-control" id="touristFirstName" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="touristLastName" class="form-label">Âßì</label>
                                        <input type="text" class="form-control" id="touristLastName" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristEmail" class="form-label">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                    <input type="email" class="form-control" id="touristEmail" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristPhone" class="form-label">ÈõªË©±Áï™Âè∑</label>
                                    <input type="tel" class="form-control" id="touristPhone" placeholder="090-1234-5678" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                    <div class="form-text">SMSË™çË®º„Ç≥„Éº„Éâ„ÇíÂèó‰ø°„Åô„ÇãÈõªË©±Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                                </div>
                                
                                <div class="mt-3">
                                    <label for="touristCountry" class="form-label">ÂõΩÁ±ç</label>
                                    <select class="form-control" id="touristCountry" required style="border-radius: 15px; padding: 12px 20px; border: 2px solid #e9ecef;">
                                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                        <option value="japan">Êó•Êú¨</option>
                                        <option value="usa">„Ç¢„É°„É™„Ç´ÂêàË°ÜÂõΩ</option>
                                        <option value="china">‰∏≠ÂõΩ</option>
                                        <option value="korea">ÈüìÂõΩ</option>
                                        <option value="taiwan">Âè∞Êπæ</option>
                                        <option value="other">„Åù„ÅÆ‰ªñ</option>
                                    </select>
                                </div>
                                
                                <div class="d-flex justify-content-end gap-3 mt-4">
                                    <button type="button" class="btn btn-outline-secondary" onclick="clearRegistrationModal(); bootstrap.Modal.getInstance(document.getElementById('registrationModal')).hide();" style="border-radius: 25px; padding: 12px 30px;">„Ç≠„É£„É≥„Çª„É´</button>
                                    <button type="button" class="btn btn-primary" onclick="goToStep2Modal()" style="border-radius: 25px; padding: 12px 30px;">Ê¨°„Å∏</button>
                                </div>
                                
                                <div class="row g-3 mt-1">
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <select class="form-select" id="touristVisitDuration" 
                                                    style="border-radius: 12px; border: 2px solid #e9ecef; height: 58px;">
                                                <option value="">ÊªûÂú®ÊúüÈñì„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                <option value="1-3days">1„Äú3Êó•Èñì</option>
                                                <option value="4-7days">4„Äú7Êó•Èñì</option>
                                                <option value="1-2weeks">1„Äú2ÈÄ±Èñì</option>
                                                <option value="3-4weeks">3„Äú4ÈÄ±Èñì</option>
                                                <option value="1month+">1„É∂Êúà‰ª•‰∏ä</option>
                                            </select>
                                            <label for="touristVisitDuration">
                                                <i class="bi bi-calendar me-2 text-primary"></i>ÊªûÂú®‰∫àÂÆöÊúüÈñì
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-floating">
                                            <select class="form-select" id="touristPreferredLanguage" 
                                                    style="border-radius: 12px; border: 2px solid #e9ecef; height: 58px;">
                                                <option value="">Â∏åÊúõ„Ç¨„Ç§„ÉâË®ÄË™û„ÇíÈÅ∏Êäû</option>
                                                <option value="japanese">Êó•Êú¨Ë™û</option>
                                                <option value="english">Ëã±Ë™û</option>
                                                <option value="chinese">‰∏≠ÂõΩË™û</option>
                                                <option value="korean">ÈüìÂõΩË™û</option>
                                                <option value="other">„Åù„ÅÆ‰ªñ</option>
                                            </select>
                                            <label for="touristPreferredLanguage">
                                                <i class="bi bi-translate me-2 text-primary"></i>Â∏åÊúõ„Ç¨„Ç§„ÉâË®ÄË™û
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-3">
                                    <div class="form-floating">
                                        <textarea class="form-control" id="touristInterests" 
                                                  placeholder="ËààÂë≥„ÉªÂ∏åÊúõ„Å´„Å§„ÅÑ„Å¶Ë©≥„Åó„ÅèÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ" 
                                                  style="border-radius: 12px; border: 2px solid #e9ecef; min-height: 100px; resize: vertical;"></textarea>
                                        <label for="touristInterests">
                                            <i class="bi bi-heart me-2 text-primary"></i>ËààÂë≥„ÉªÂ∏åÊúõÔºàË¶≥ÂÖâÂú∞„ÄÅ„Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£„Å™„Å©Ôºâ
                                        </label>
                                    </div>
                                    <div class="form-text">Ë°å„Åç„Åü„ÅÑÂ†¥ÊâÄ„ÄÅ‰ΩìÈ®ì„Åó„Åü„ÅÑ„Åì„Å®„ÄÅÁâπÂà•„Å™„ÅîË¶ÅÊúõ„Åå„ÅÇ„Çå„Å∞Ë©≥„Åó„Åè„ÅäÊõ∏„Åç„Åè„Å†„Åï„ÅÑ</div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Phone Verification -->
                        <div class="step-content" id="step2Content" style="display: none;">
                            <div class="p-4">
                                <h4 class="mb-3">ÈõªË©±Áï™Âè∑Ë™çË®º</h4>
                                <div class="verification-box p-4 mb-3" style="background: linear-gradient(135deg, #e3f2fd, #f3e5f5); border-radius: 15px; border: 2px solid #2196f3;">
                                    <div class="text-center mb-3">
                                        <i class="bi bi-phone text-primary" style="font-size: 2.5rem;"></i>
                                        <h5 class="text-primary mt-2">üì± ÈõªË©±Áï™Âè∑Ë™çË®º</h5>
                                    </div>
                                    <div class="alert alert-info" role="alert">
                                        <i class="bi bi-info-circle me-2"></i>
                                        <strong>Á∞°Âçò3„Çπ„ÉÜ„ÉÉ„Éó!</strong> SMSË™çË®º„Ç≥„Éº„Éâ„ÅßÊú¨‰∫∫Á¢∫Ë™ç„ÇíË°å„ÅÑ„Åæ„Åô
                                    </div>
                                    <p class="fw-bold mb-1" id="phoneDisplayModal"></p>
                                    
                                    <div class="mb-3" id="sendCodeSectionModal">
                                        <div class="d-grid gap-2">
                                            <button type="button" class="btn btn-primary btn-lg" id="sendCodeBtnModal" style="border-radius: 15px; padding: 15px;">
                                                <i class="bi bi-send-fill me-2"></i>üì≤ Ë™çË®º„Ç≥„Éº„Éâ„ÇíÈÄÅ‰ø°
                                            </button>
                                        </div>
                                        <div class="text-center mt-2">
                                            <small class="text-muted">
                                                <i class="bi bi-shield-check me-1"></i>ÂÆâÂÖ®„Å™Ë™çË®º„Ç∑„Çπ„ÉÜ„É†„ÅßÂÄã‰∫∫ÊÉÖÂ†±„Çí‰øùË≠∑
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3" id="verifyCodeSectionModal" style="display: none;">
                                        <label for="verificationCodeModal" class="form-label">Ë™çË®º„Ç≥„Éº„ÉâÔºà6Ê°ÅÔºâ</label>
                                        <input type="text" class="form-control" id="verificationCodeModal" maxlength="6" placeholder="123456" style="border-radius: 15px; padding: 12px 20px; font-size: 1.5rem; text-align: center; letter-spacing: 0.5rem;">
                                        <div class="form-text">„Éá„É¢Áî®Ë™çË®º„Ç≥„Éº„Éâ: 123456</div>
                                        <button type="button" class="btn btn-primary w-100 mt-2" id="verifyCodeBtnModal" style="border-radius: 15px; padding: 12px;">Ë™çË®º„Åô„Çã</button>
                                    </div>
                                    
                                    <div class="text-success" id="verificationSuccessModal" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> ÈõªË©±Áï™Âè∑Ë™çË®º„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" onclick="goToStep1Modal()" style="border-radius: 25px; padding: 12px 30px;">Êàª„Çã</button>
                                    <button type="button" class="btn btn-primary" id="step2NextBtnModal" onclick="goToStep3Modal()" style="border-radius: 25px; padding: 12px 30px;">Ê¨°„Å∏</button>
                                </div>

                                <!-- Phone Verification -->
                                <div class="verification-section mb-4">
                                    <h6 class="fw-bold mb-3 text-primary">
                                        <i class="bi bi-telephone-fill me-2"></i>ÈõªË©±Áï™Âè∑Ë™çË®º
                                    </h6>
                                    <div class="card border-0 shadow-sm" style="border-radius: 15px;">
                                        <div class="card-body p-4">
                                            <div class="row g-3">
                                                <div class="col-md-8">
                                                    <div class="form-floating">
                                                        <input type="tel" class="form-control" id="verificationPhone" 
                                                               placeholder="ÈõªË©±Áï™Âè∑" readonly 
                                                               style="border-radius: 10px; background-color: #f8f9fa;">
                                                        <label for="verificationPhone">Ë™çË®ºÁî®ÈõªË©±Áï™Âè∑</label>
                                                    </div>
                                                </div>
                                                <div class="col-md-4">
                                                    <button type="button" class="btn btn-outline-primary w-100 h-100" 
                                                            id="sendSmsBtn" style="border-radius: 10px; min-height: 58px;">
                                                        <i class="bi bi-send me-2"></i>SMSÈÄÅ‰ø°
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="mt-3" id="smsVerificationArea" style="display: none;">
                                                <div class="row g-3">
                                                    <div class="col-md-8">
                                                        <div class="form-floating">
                                                            <input type="text" class="form-control" id="smsCode" 
                                                                   placeholder="Ë™çË®º„Ç≥„Éº„Éâ" maxlength="6" 
                                                                   style="border-radius: 10px; font-family: monospace; font-size: 1.2rem; letter-spacing: 0.1em;">
                                                            <label for="smsCode">6Ê°Å„ÅÆË™çË®º„Ç≥„Éº„Éâ</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <button type="button" class="btn btn-success w-100 h-100" 
                                                                id="verifySmsBtn" style="border-radius: 10px; min-height: 58px;">
                                                            <i class="bi bi-check-circle me-2"></i>Ë™çË®º
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="form-text text-center mt-2">
                                                    <i class="bi bi-clock me-1"></i>Ë™çË®º„Ç≥„Éº„Éâ„ÅÆÊúâÂäπÊúüÈôê: <span id="smsTimer">5:00</span>
                                                </div>
                                            </div>
                                            
                                            <div class="verification-status mt-3" id="phoneVerificationStatus">
                                                <div class="text-muted">
                                                    <i class="bi bi-info-circle me-2"></i>ÈõªË©±Áï™Âè∑Ë™çË®º„ÅåÂøÖË¶Å„Åß„Åô
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Document Upload -->
                                <div class="verification-section">
                                    <h6 class="fw-bold mb-3 text-primary">
                                        <i class="bi bi-file-earmark-person me-2"></i>Ë∫´ÂàÜË®ºÊòéÊõ∏„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
                                    </h6>
                                    <div class="card border-0 shadow-sm" style="border-radius: 15px;">
                                        <div class="card-body p-4">
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Ë∫´ÂàÜË®ºÊòéÊõ∏„ÅÆÁ®ÆÈ°û„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ <span class="text-success">(Â§ñÂõΩ‰∫∫„ÅÆÊñπ„ÇÇOK)</span></label>
                                                <div class="row g-2">
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="passport" value="passport">
                                                        <label class="btn btn-outline-primary w-100" for="passport" style="border-radius: 10px;">
                                                            <i class="bi bi-bookmark-star me-2"></i>„Éë„Çπ„Éù„Éº„Éà
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="license" value="license">
                                                        <label class="btn btn-outline-primary w-100" for="license" style="border-radius: 10px;">
                                                            <i class="bi bi-credit-card me-2"></i>ÈÅãËª¢ÂÖçË®±Ë®º
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="residence_card" value="residence_card">
                                                        <label class="btn btn-outline-success w-100" for="residence_card" style="border-radius: 10px;">
                                                            <i class="bi bi-person-badge me-2"></i>Âú®Áïô„Ç´„Éº„Éâ
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="special_resident" value="special_resident">
                                                        <label class="btn btn-outline-success w-100" for="special_resident" style="border-radius: 10px;">
                                                            <i class="bi bi-award me-2"></i>ÁâπÂà•Ê∞∏‰ΩèËÄÖË®ºÊòéÊõ∏
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="insurance_card" value="insurance_card">
                                                        <label class="btn btn-outline-info w-100" for="insurance_card" style="border-radius: 10px;">
                                                            <i class="bi bi-heart me-2"></i>ÂÅ•Â∫∑‰øùÈô∫Ë®º
                                                        </label>
                                                    </div>
                                                    <div class="col-6 col-lg-4">
                                                        <input type="radio" class="btn-check" name="idType" id="student_id" value="student_id">
                                                        <label class="btn btn-outline-warning w-100" for="student_id" style="border-radius: 10px;">
                                                            <i class="bi bi-mortarboard me-2"></i>Â≠¶ÁîüË®º
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="mt-2">
                                                    <small class="text-muted">
                                                        <i class="bi bi-info-circle me-1"></i>
                                                        Â§ñÂõΩ„ÅÆÊñπ: „Éë„Çπ„Éù„Éº„Éà„ÄÅÂú®Áïô„Ç´„Éº„Éâ„ÄÅÁâπÂà•Ê∞∏‰ΩèËÄÖË®ºÊòéÊõ∏„ÅåÂà©Áî®ÂèØËÉΩ
                                                    </small>
                                                </div>
                                            </div>
                                            
                                            <div class="upload-area" id="documentUploadArea">
                                                <div class="alert alert-warning mb-3">
                                                    <i class="bi bi-lightbulb me-2"></i>
                                                    <strong>ÊèêÂá∫ÊñπÊ≥ï:</strong> ‰∏ä„ÅßÈÅ∏Êäû„Åó„ÅüË®ºÊòéÊõ∏„ÅÆÁ®ÆÈ°û„Å´Âøú„Åò„Å¶„ÄÅÂøÖË¶Å„Å™Èù¢„ÇíÊíÆÂΩ±„Åó„Å¶„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                                                </div>
                                                
                                                <div class="row g-3 mb-3" id="uploadStepsGuide">
                                                    <div class="col-md-4">
                                                        <div class="card border-success h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-1-circle-fill text-success" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">Ë®ºÊòéÊõ∏„ÇíÊ∫ñÂÇô</h6>
                                                                <p class="small text-muted">ÈÅ∏Êäû„Åó„ÅüË∫´ÂàÜË®ºÊòéÊõ∏„ÇíÊâãÂÖÉ„Å´Áî®ÊÑè</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="card border-warning h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-2-circle-fill text-warning" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">ÊíÆÂΩ±„Éª„Çπ„Ç≠„É£„É≥</h6>
                                                                <p class="small text-muted">ÈÆÆÊòé„Å´ÊíÆÂΩ±„ÄÅÊñáÂ≠ó„ÅåË™≠„ÇÅ„Çã„Çà„ÅÜ„Å´</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <div class="card border-primary h-100">
                                                            <div class="card-body text-center">
                                                                <i class="bi bi-3-circle-fill text-primary" style="font-size: 2rem;"></i>
                                                                <h6 class="card-title mt-2">„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</h6>
                                                                <p class="small text-muted">‰∏ã„ÅÆ„Éú„Çø„É≥„Åß„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="border border-2 border-dashed border-primary rounded p-4 text-center" 
                                                     style="border-radius: 15px !important; background: linear-gradient(135deg, #f8f9ff, #f0f4ff);">
                                                    <i class="bi bi-cloud-upload text-primary mb-3" style="font-size: 3rem;"></i>
                                                    <h6 class="fw-bold text-primary">üìÑ Ë∫´ÂàÜË®ºÊòéÊõ∏„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</h6>
                                                    <p class="text-muted mb-3">„Éï„Ç°„Ç§„É´„Çí„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó„Åæ„Åü„ÅØ‰∏ã„ÅÆ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ</p>
                                                    <input type="file" class="form-control d-none" id="touristDocumentUpload" 
                                                           accept="image/*,.pdf" multiple>
                                                    <button type="button" class="btn btn-primary btn-lg" onclick="document.getElementById('touristDocumentUpload').click()" 
                                                            style="border-radius: 25px; padding: 12px 30px;">
                                                        <i class="bi bi-camera me-2"></i>üì± ÂÜôÁúü„ÇíÈÅ∏Êäû„ÉªÊíÆÂΩ±
                                                    </button>
                                                    <div class="form-text mt-3">
                                                        <i class="bi bi-check-circle me-1 text-success"></i>
                                                        <strong>ÂØæÂøúÂΩ¢Âºè:</strong> JPG, PNG, PDFÔºàÊúÄÂ§ß5MBÔºâ
                                                        <br>
                                                        <i class="bi bi-shield-check me-1 text-primary"></i>
                                                        <strong>„Çª„Ç≠„É•„É™„ÉÜ„Ç£:</strong> „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åï„Çå„ÅüÁîªÂÉè„ÅØÊöóÂè∑Âåñ„Åï„Çå„Å¶ÂÆâÂÖ®„Å´‰øùÂ≠ò„Åï„Çå„Åæ„Åô
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="uploaded-documents mt-3" id="uploadedDocuments" style="max-height: 200px; overflow-y: auto;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Document Upload -->
                        <div class="step-content" id="step3Content" style="display: none;">
                            <div class="p-4">
                                <h4 class="mb-3">Ë∫´ÂàÜË®ºÊòéÊõ∏„ÅÆÊèêÂá∫</h4>
                                <div class="verification-box p-3 mb-3" style="background: #f8f9fa; border-radius: 15px; border-left: 4px solid #0984e3;">
                                    <p class="mb-3">‰ª•‰∏ã„ÅÆ„ÅÑ„Åö„Çå„Åã„ÅÆË∫´ÂàÜË®ºÊòéÊõ∏„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö</p>
                                    <ul class="mb-3">
                                        <li>„Éë„Çπ„Éù„Éº„Éà</li>
                                        <li>ÈÅãËª¢ÂÖçË®±Ë®º</li>
                                        <li>„Éû„Ç§„Éä„É≥„Éê„Éº„Ç´„Éº„Éâ</li>
                                        <li>Âú®Áïô„Ç´„Éº„ÉâÔºàÂ§ñÂõΩ‰∫∫„ÅÆÊñπÔºâ</li>
                                    </ul>
                                    
                                    <div class="document-upload-area p-4 text-center" id="uploadAreaModal" style="border: 2px dashed #0984e3; border-radius: 15px; background: #f8f9fa; cursor: pointer;">
                                        <i class="bi bi-cloud-upload" style="font-size: 3rem; color: #0984e3;"></i>
                                        <h5 class="mt-3">„Éï„Ç°„Ç§„É´„Çí„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó</h5>
                                        <p class="text-muted">„Åæ„Åü„ÅØ</p>
                                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('fileInputModal').click()" style="border-radius: 15px;">
                                            „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
                                        </button>
                                        <input type="file" id="fileInputModal" accept="image/*,.pdf" style="display: none;">
                                        <div class="form-text mt-2">
                                            ÂØæÂøúÂΩ¢Âºè: JPG, PNG, PDFÔºàÊúÄÂ§ß5MBÔºâ
                                        </div>
                                    </div>
                                    
                                    <div id="uploadPreviewModal" style="display: none;">
                                        <img id="previewImageModal" class="upload-preview" style="max-width: 100%; max-height: 200px; border-radius: 10px; margin-top: 1rem;" alt="„Éó„É¨„Éì„É•„Éº">
                                        <div class="mt-2">
                                            <span id="fileNameModal" class="fw-bold"></span>
                                            <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="removeFileModal()">ÂâäÈô§</button>
                                        </div>
                                    </div>
                                    
                                    <div class="text-success mt-3" id="uploadSuccessModal" style="display: none;">
                                        <i class="bi bi-check-circle-fill"></i> Ë∫´ÂàÜË®ºÊòéÊõ∏„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü
                                    </div>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <button type="button" class="btn btn-outline-secondary" onclick="goToStep2FromStep3()" style="border-radius: 25px; padding: 12px 30px;">Êàª„Çã</button>
                                    <button type="button" class="btn btn-primary" id="completeBtnModal" onclick="completeRegistrationModal()" disabled style="border-radius: 25px; padding: 12px 30px;">ÁôªÈå≤ÂÆå‰∫Ü</button>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Marketing -->
                        <div class="border-top bg-light p-4" id="termsSection">
                            <div class="form-check mb-3">
                                <input type="checkbox" class="form-check-input" id="touristAgreeTerms" required>
                                <label class="form-check-label" for="touristAgreeTerms">
                                    <a href="#" class="text-primary fw-semibold">Âà©Áî®Ë¶èÁ¥Ñ</a>„ÄÅ
                                    <a href="#" class="text-primary fw-semibold">„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº</a>„ÄÅ
                                    <a href="#" class="text-primary fw-semibold">ÂÄã‰∫∫ÊÉÖÂ†±‰øùË≠∑ÊñπÈáù</a>„Å´ÂêåÊÑè„Åó„Åæ„Åô 
                                    <span class="text-danger">*</span>
                                </label>
                            </div>
                            
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="touristReceiveUpdates">
                                <label class="form-check-label" for="touristReceiveUpdates">
                                    Êñ∞„Åó„ÅÑ„Ç¨„Ç§„Éâ„ÇÑÁâπÂà•„Ç™„Éï„Ç°„Éº„Å´Èñ¢„Åô„ÇãÊÉÖÂ†±„ÇíÂèó„ÅëÂèñ„Çã
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                
                <div class="modal-footer border-0 p-4 bg-light" style="border-radius: 0 0 20px 20px;">
                    <div class="w-100">
                        <div class="row g-2">
                            <div class="col-6">
                                <button type="button" class="btn btn-outline-secondary w-100" data-bs-dismiss="modal" 
                                        style="border-radius: 15px; padding: 12px; font-weight: 600;">
                                    <i class="bi bi-x-circle me-2"></i>„Ç≠„É£„É≥„Çª„É´
                                </button>
                            </div>
                            <div class="col-6">
                                <button type="button" class="btn btn-primary w-100" id="nextStepBtn" 
                                        style="border-radius: 15px; padding: 12px; 
                                               background: linear-gradient(135deg, #667eea, #764ba2); 
                                               border: none; font-weight: 600;">
                                    <i class="bi bi-arrow-right me-2"></i>Ê¨°„Å∏
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #6f42c1, #5a32a3); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="loginModalLabel">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Login
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="login-type-indicator" id="loginTypeIndicator">
                            <span class="badge bg-primary fs-6" id="loginTypeBadge">Tourist Login</span>
                        </div>
                    </div>
                    
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label fw-bold">
                                <i class="bi bi-envelope me-2"></i>Email Address
                            </label>
                            <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label fw-bold">
                                <i class="bi bi-lock me-2"></i>Password
                            </label>
                            <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">
                                Remember me
                            </label>
                        </div>
                    </form>
                    
                    <div class="alert alert-info" style="border-radius: 10px;">
                        <small><i class="bi bi-info-circle me-2"></i>For first-time users, please register as a tourist first to access guide details and booking features.</small>
                    </div>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="loginSubmitBtn" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #6f42c1, #5a32a3); border: none;">
                        <i class="bi bi-box-arrow-in-right me-2"></i>Login
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Modal -->
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #20c997, #17a2b8); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="contactModalLabel">
                        <i class="bi bi-envelope me-2"></i>Contact Us
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label fw-bold">
                                <i class="bi bi-person me-2"></i>Name
                            </label>
                            <input type="text" class="form-control" id="contactName" placeholder="Your name" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label fw-bold">
                                <i class="bi bi-envelope me-2"></i>Email
                            </label>
                            <input type="email" class="form-control" id="contactEmail" placeholder="your.email@example.com" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        <div class="mb-3">
                            <label for="contactSubject" class="form-label fw-bold">
                                <i class="bi bi-chat-dots me-2"></i>Subject
                            </label>
                            <select class="form-select" id="contactSubject" required style="border-radius: 10px; padding: 12px;">
                                <option value="">Select a subject</option>
                                <option value="general">General Inquiry</option>
                                <option value="guide">Guide Registration</option>
                                <option value="sponsor">Sponsor Partnership</option>
                                <option value="technical">Technical Support</option>
                                <option value="feedback">Feedback</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label fw-bold">
                                <i class="bi bi-chat-text me-2"></i>Message
                            </label>
                            <textarea class="form-control" id="contactMessage" rows="4" placeholder="Please describe your inquiry or feedback..." required style="border-radius: 10px; padding: 12px;"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="contactSubmitBtn" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #20c997, #17a2b8); border: none;">
                        <i class="bi bi-send me-2"></i>Send Message
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="button-setup.js" defer></script>
    <script>
        // Complete English version with all Japanese functionality

        // Location mappings in English
        const locationNames = {
            'tokyo': 'Tokyo', 'kyoto': 'Kyoto', 'osaka': 'Osaka', 'hiroshima': 'Hiroshima',
            'hokkaido': 'Hokkaido', 'okinawa': 'Okinawa', 'nagano': 'Nagano',
            'aomori': 'Aomori', 'iwate': 'Iwate', 'miyagi': 'Miyagi', 'akita': 'Akita',
            'yamagata': 'Yamagata', 'fukushima': 'Fukushima', 'ibaraki': 'Ibaraki',
            'tochigi': 'Tochigi', 'gunma': 'Gunma', 'saitama': 'Saitama', 'chiba': 'Chiba',
            'kanagawa': 'Kanagawa', 'niigata': 'Niigata', 'toyama': 'Toyama',
            'ishikawa': 'Ishikawa', 'fukui': 'Fukui', 'yamanashi': 'Yamanashi',
            'gifu': 'Gifu', 'shizuoka': 'Shizuoka', 'aichi': 'Aichi', 'mie': 'Mie',
            'shiga': 'Shiga', 'hyogo': 'Hyogo', 'nara': 'Nara', 'wakayama': 'Wakayama',
            'tottori': 'Tottori', 'shimane': 'Shimane', 'okayama': 'Okayama',
            'yamaguchi': 'Yamaguchi', 'tokushima': 'Tokushima', 'kagawa': 'Kagawa',
            'ehime': 'Ehime', 'kochi': 'Kochi', 'fukuoka': 'Fukuoka', 'saga': 'Saga',
            'nagasaki': 'Nagasaki', 'kumamoto': 'Kumamoto', 'oita': 'Oita',
            'miyazaki': 'Miyazaki', 'kagoshima': 'Kagoshima'
        };

        // Guide data now managed by app-init.mjs - removed duplicate defaultGuides

        // Make redirect function globally available
        window.redirectToRegistration = function(guideId) {
            sessionStorage.setItem('pendingGuideId', guideId);
            window.location.href = '/tourist-registration-simple.html';
        };

        // Initialize location names for global access
        window.locationNames = locationNames;

        // Guide cards now handled by app-init.mjs module system

        // Display guides with pagination
        // Language detection for dynamic content
        function getCurrentPageLanguage() {
            const path = window.location.pathname;
            const filename = window.location.pathname.split('/').pop();
            return filename === 'index-en.html' ? 'en' : 'ja';
        }
        
        // Get localized text based on current page
        function getLocalizedText(key) {
            const lang = getCurrentPageLanguage();
            const translations = {
                ja: {
                    viewDetails: 'Ë©≥Á¥∞„ÇíË¶ã„Çã',
                    perDay: '‰∏ÄÊó•„ÅÇ„Åü„Çä',
                    showMore: '„ÇÇ„Å£„Å®Ë¶ã„Çã',
                    loading: 'Ë™≠„ÅøËæº„Åø‰∏≠...',
                    culturalTours: 'ÊñáÂåñ„ÉÑ„Ç¢„Éº',
                    foodTours: '„Éï„Éº„Éâ„ÉÑ„Ç¢„Éº',
                    natureTours: 'Ëá™ÁÑ∂„ÉÑ„Ç¢„Éº',
                    historicalTours: 'Ê≠¥Âè≤„ÉÑ„Ç¢„Éº',
                    templesTours: 'ÂØ∫Èô¢„ÉªÂ∫≠Âúí'
                },
                en: {
                    viewDetails: 'View Details',
                    perDay: 'per day',
                    showMore: 'Show More',
                    loading: 'Ë™≠„ÅøËæº„Åø‰∏≠...',
                    culturalTours: 'Cultural Tours',
                    foodTours: 'Food Tours',
                    natureTours: 'Nature Tours',
                    historicalTours: 'Historical Tours',
                    templesTours: 'Temples & Gardens'
                }
            };
            return translations[lang][key] || key;
        }

        // Guide display now handled by app-init.mjs module system
        
        // Update pagination controls
        function updatePaginationControls(totalGuides) {
            const totalPages = Math.ceil(totalGuides / guidesPerPage);
            const startIndex = (currentPage - 1) * guidesPerPage + 1;
            const endIndex = Math.min(currentPage * guidesPerPage, totalGuides);
            
            document.getElementById('pageInfo').textContent = `Page ${currentPage} / ${totalPages}`;
            document.getElementById('displayRange').textContent = `${startIndex}-${endIndex}`;
            
            const prevBtn = document.getElementById('prevPageBtn');
            const nextBtn = document.getElementById('nextPageBtn');
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            
            prevBtn.style.opacity = currentPage === 1 ? '0.5' : '1';
            nextBtn.style.opacity = currentPage === totalPages ? '0.5' : '1';
        }

        // Update guide counter
        function updateCounter() {
            const totalElement = document.getElementById('totalGuides');
            if (totalElement) {
                totalElement.textContent = currentGuides.length;
            }
            
            // Ê§úÁ¥¢Êï∞Ë°®Á§∫„Ç∑„Çπ„ÉÜ„É† - ÂÖ®‰Ωì„ÅÆ„Ç¨„Ç§„ÉâÊï∞„Å®Ê§úÁ¥¢ÁµêÊûúÊï∞
            updateSearchCounters();
        }
        
        // Ê§úÁ¥¢Êï∞Ë°®Á§∫„Ç´„Ç¶„É≥„Çø„Éº„Ç∑„Çπ„ÉÜ„É†
        function updateSearchCounters() {
            // üîß FIX: „Ç´„Ç¶„É≥„Çø„ÉºÊõ¥Êñ∞„ÅØÁµ±‰∏Ä„Åï„Çå„ÅüupdateGuideCountersÈñ¢Êï∞„Çí‰ΩøÁî®
            // Ôºàguide-renderer.mjs„ÅÆupdateGuideCountersÈñ¢Êï∞„Å´ÂßîË®ó„Åó„Å¶ÈáçË§á„ÇíÈÅø„Åë„ÇãÔºâ
            if (typeof window.updateGuideCounters === 'function') {
                window.updateGuideCounters(currentGuides?.length || 0, currentGuides?.length || 0);
            }
        }

        // Add event listeners to cards
        function addCardEventListeners() {
            console.log('üîß Adding event listeners to View Details buttons...');
            const viewDetailButtons = document.querySelectorAll('.view-detail-btn');
            console.log(`Found ${viewDetailButtons.length} View Details buttons`);
            
            viewDetailButtons.forEach((btn, index) => {
                const guideId = btn.getAttribute('data-guide-id');
                console.log(`Setting up button ${index + 1} for guide ID: ${guideId}`);
                
                // Remove existing listeners
                btn.replaceWith(btn.cloneNode(true));
                const newBtn = document.querySelectorAll('.view-detail-btn')[index];
                
                newBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üî• View Details button clicked for guide:', guideId);
                    viewGuideDetail(guideId);
                });
            });

            document.querySelectorAll('.bookmark-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const guideId = this.getAttribute('data-guide-id');
                    toggleBookmark(guideId);
                });
            });

            document.querySelectorAll('.compare-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const guideId = this.getAttribute('data-guide-id');
                    toggleComparison(guideId);
                });
            });
        }

        // Removed empty viewGuideDetail function - full implementation exists later

        // ‚úÖ Áµ±‰∏Ä„Åï„Çå„Åü„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
        window.BookmarkManager = {
            add: function(guideId) {
                console.log('üìå Adding to bookmarks:', guideId);
                
                const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
                const id = parseInt(guideId);
                
                if (!bookmarkedGuides.includes(id) && !bookmarkedGuides.includes(guideId)) {
                    bookmarkedGuides.push(id);
                    localStorage.setItem('bookmarkedGuides', JSON.stringify(bookmarkedGuides));
                    
                    this.updateButtonStates();
                    this.showNotification('„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
                    
                    console.log('‚úÖ Bookmark added:', id, 'Total bookmarks:', bookmarkedGuides.length);
                    return true;
                } else {
                    console.log('‚ö†Ô∏è Guide already bookmarked:', guideId);
                    return false;
                }
            },
            
            remove: function(guideId) {
                console.log('üìå Removing from bookmarks:', guideId);
                
                const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
                const id = parseInt(guideId);
                
                const updatedBookmarks = bookmarkedGuides.filter(bookmarkId => 
                    bookmarkId !== id && bookmarkId !== guideId
                );
                
                if (updatedBookmarks.length !== bookmarkedGuides.length) {
                    localStorage.setItem('bookmarkedGuides', JSON.stringify(updatedBookmarks));
                    
                    this.updateButtonStates();
                    this.showNotification('„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü', 'info');
                    
                    console.log('‚úÖ Bookmark removed:', id, 'Remaining bookmarks:', updatedBookmarks.length);
                    return true;
                } else {
                    console.log('‚ö†Ô∏è Guide not in bookmarks:', guideId);
                    return false;
                }
            },
            
            toggle: function(guideId) {
                const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
                const id = parseInt(guideId);
                
                if (bookmarkedGuides.includes(id) || bookmarkedGuides.includes(guideId)) {
                    return this.remove(guideId);
                } else {
                    return this.add(guideId);
                }
            },
            
            isBookmarked: function(guideId) {
                const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
                const id = parseInt(guideId);
                return bookmarkedGuides.includes(id) || bookmarkedGuides.includes(guideId);
            },
            
            getAll: function() {
                return JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            },
            
            updateButtonStates: function() {
                document.querySelectorAll('.bookmark-btn').forEach(btn => {
                    const guideId = btn.getAttribute('data-guide-id');
                    const isBookmarked = this.isBookmarked(guideId);
                    
                    if (isBookmarked) {
                        btn.classList.remove('btn-outline-warning');
                        btn.classList.add('btn-warning');
                        btn.innerHTML = '<i class="bi bi-bookmark-fill"></i> <span class="ms-1">‰øùÂ≠òÊ∏à„Åø</span>';
                    } else {
                        btn.classList.remove('btn-warning');
                        btn.classList.add('btn-outline-warning');
                        btn.innerHTML = '<i class="bi bi-bookmark"></i> <span class="ms-1">„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ</span>';
                    }
                });
            },
            
            showNotification: function(message, type = 'info') {
                if (typeof safeShowToast === 'function') {
                    safeShowToast(message, type);
                } else {
                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÈÄöÁü•„Ç∑„Çπ„ÉÜ„É†
                    const notification = document.createElement('div');
                    notification.className = `alert alert-${type === 'success' ? 'success' : 'info'} position-fixed`;
                    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 250px;';
                    notification.innerHTML = `${message} <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>`;
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        if (notification.parentElement) notification.remove();
                    }, 3000);
                }
            }
        };
        
        // ÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ„ÅÆÈñ¢Êï∞„Ç®„Ç§„É™„Ç¢„Çπ
        function addToBookmarks(guideId) {
            return window.BookmarkManager.add(guideId);
        }

        // ‚úÖ Áµ±‰∏Ä„Åï„Çå„ÅüÊØîËºÉÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
        window.ComparisonManager = {
            add: function(guideId) {
                console.log('üìä Adding to comparison:', guideId);
                
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const id = parseInt(guideId);
                
                // ÊØîËºÉ„É™„Çπ„Éà„ÅÆ‰∏äÈôê„ÉÅ„Çß„ÉÉ„ÇØ
                if (comparisonGuides.length >= 3) {
                    this.showNotification('ÊØîËºÉ„É™„Çπ„Éà„ÅØÊúÄÂ§ß3‰ª∂„Åæ„Åß„Åß„Åô', 'warning');
                    return false;
                }
                
                if (!comparisonGuides.includes(id) && !comparisonGuides.includes(guideId)) {
                    comparisonGuides.push(id);
                    localStorage.setItem('comparisonGuides', JSON.stringify(comparisonGuides));
                    
                    this.updateButtonStates();
                    this.showNotification('ÊØîËºÉ„É™„Çπ„Éà„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
                    
                    console.log('‚úÖ Comparison added:', id, 'Total comparisons:', comparisonGuides.length);
                    return true;
                } else {
                    console.log('‚ö†Ô∏è Guide already in comparison:', guideId);
                    return false;
                }
            },
            
            remove: function(guideId) {
                console.log('üìä Removing from comparison:', guideId);
                
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const id = parseInt(guideId);
                
                const updatedComparison = comparisonGuides.filter(compareId => 
                    compareId !== id && compareId !== guideId
                );
                
                if (updatedComparison.length !== comparisonGuides.length) {
                    localStorage.setItem('comparisonGuides', JSON.stringify(updatedComparison));
                    
                    this.updateButtonStates();
                    this.showNotification('ÊØîËºÉ„É™„Çπ„Éà„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü', 'info');
                    
                    console.log('‚úÖ Comparison removed:', id, 'Remaining comparisons:', updatedComparison.length);
                    return true;
                } else {
                    console.log('‚ö†Ô∏è Guide not in comparison:', guideId);
                    return false;
                }
            },
            
            toggle: function(guideId) {
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const id = parseInt(guideId);
                
                if (comparisonGuides.includes(id) || comparisonGuides.includes(guideId)) {
                    return this.remove(guideId);
                } else {
                    return this.add(guideId);
                }
            },
            
            isInComparison: function(guideId) {
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const id = parseInt(guideId);
                return comparisonGuides.includes(id) || comparisonGuides.includes(guideId);
            },
            
            getAll: function() {
                return JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            },
            
            updateButtonStates: function() {
                document.querySelectorAll('.compare-btn').forEach(btn => {
                    const guideId = btn.getAttribute('data-guide-id');
                    const isInComparison = this.isInComparison(guideId);
                    
                    if (isInComparison) {
                        btn.classList.remove('btn-outline-success');
                        btn.classList.add('btn-success');
                        btn.innerHTML = '<i class="bi bi-check2-square-fill"></i> <span class="ms-1">ÊØîËºÉ‰∏≠</span>';
                    } else {
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-outline-success');
                        btn.innerHTML = '<i class="bi bi-check2-square"></i> <span class="ms-1">ÊØîËºÉ</span>';
                    }
                });
            },
            
            showNotification: function(message, type = 'info') {
                if (typeof safeShowToast === 'function') {
                    safeShowToast(message, type);
                } else {
                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÈÄöÁü•„Ç∑„Çπ„ÉÜ„É†
                    const notification = document.createElement('div');
                    notification.className = `alert alert-${type === 'success' ? 'success' : (type === 'warning' ? 'warning' : 'info')} position-fixed`;
                    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 250px;';
                    notification.innerHTML = `${message} <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>`;
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        if (notification.parentElement) notification.remove();
                    }, 3000);
                }
            }
        };
        
        // ÂæåÊñπ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ„ÅÆÈñ¢Êï∞„Ç®„Ç§„É™„Ç¢„Çπ
        function addToComparison(guideId) {
            return window.ComparisonManager.add(guideId);
        }

        // ‚úÖ ÂÖ±Êúâ„Ç¨„Ç§„Éâ„Éá„Éº„ÇøÂæÖÊ©ü„É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£
        window.waitForGuideData = async function(maxWaitTime = 10000) {
            console.log('‚è≥ Waiting for guide data to be ready...');
            
            const startTime = Date.now();
            
            while (Date.now() - startTime < maxWaitTime) {
                // Ë§áÊï∞„ÅÆ„ÇΩ„Éº„Çπ„Åã„Çâ„Ç¨„Ç§„Éâ„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç
                const guides = window.AppState?.originalGuides || window.AppState?.guides || window.guidesData || [];
                
                if (guides && guides.length > 0) {
                    console.log('‚úÖ Guide data ready:', guides.length, 'guides loaded');
                    return guides;
                }
                
                // Áü≠„ÅÑÈñìÈöî„ÅßÂÜç„ÉÅ„Çß„ÉÉ„ÇØ
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            console.warn('‚ö†Ô∏è Guide data not ready after', maxWaitTime, 'ms, proceeding with available data');
            return window.AppState?.originalGuides || window.AppState?.guides || window.guidesData || [];
        };

        // ‚úÖ localStorageÂΩ¢ÂºèÁµ±‰∏Ä„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥Ê©üËÉΩ
        window.migrateStorageFormats = function() {
            console.log('üîÑ Starting localStorage migration...');
            
            try {
                // „Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥Ê∏à„Åø„Éï„É©„Ç∞„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                const migrationKey = 'tomotrip_storage_migrated_v1';
                if (localStorage.getItem(migrationKey) === 'true') {
                    console.log('‚úÖ Storage already migrated, skipping');
                    return;
                }
                
                // „Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„ÅÆ„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥
                const migrateBookmarks = () => {
                    const bookmarkKey = 'bookmarkedGuides';
                    const currentBookmarks = localStorage.getItem(bookmarkKey);
                    
                    if (currentBookmarks) {
                        try {
                            const parsed = JSON.parse(currentBookmarks);
                            
                            // IDÈÖçÂàó„Å´Ê≠£Ë¶èÂåñÔºà„Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÈÖçÂàó„ÅÆÂ†¥ÂêàÔºâ
                            const normalizedIds = parsed.map(item => {
                                if (typeof item === 'object' && item !== null) {
                                    return parseInt(item.id) || item.id;
                                }
                                return parseInt(item) || item;
                            }).filter(id => id !== null && id !== undefined);
                            
                            // ÈáçË§áÈô§Âéª
                            const uniqueIds = [...new Set(normalizedIds)];
                            
                            localStorage.setItem(bookmarkKey, JSON.stringify(uniqueIds));
                            console.log('‚úÖ Migrated bookmarks:', uniqueIds.length, 'items');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Bookmark migration error:', error);
                            localStorage.setItem(bookmarkKey, '[]');
                        }
                    } else {
                        localStorage.setItem(bookmarkKey, '[]');
                    }
                };
                
                // ÊØîËºÉ„É™„Çπ„Éà„ÅÆ„Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥
                const migrateComparisons = () => {
                    const comparisonKey = 'comparisonGuides';
                    const currentComparisons = localStorage.getItem(comparisonKey);
                    
                    if (currentComparisons) {
                        try {
                            const parsed = JSON.parse(currentComparisons);
                            
                            // IDÈÖçÂàó„Å´Ê≠£Ë¶èÂåñÔºà„Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÈÖçÂàó„ÅÆÂ†¥ÂêàÔºâ
                            const normalizedIds = parsed.map(item => {
                                if (typeof item === 'object' && item !== null) {
                                    return parseInt(item.id) || item.id;
                                }
                                return parseInt(item) || item;
                            }).filter(id => id !== null && id !== undefined);
                            
                            // ÈáçË§áÈô§Âéª & 3‰ª∂Âà∂Èôê
                            const uniqueIds = [...new Set(normalizedIds)].slice(0, 3);
                            
                            localStorage.setItem(comparisonKey, JSON.stringify(uniqueIds));
                            console.log('‚úÖ Migrated comparisons:', uniqueIds.length, 'items');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Comparison migration error:', error);
                            localStorage.setItem(comparisonKey, '[]');
                        }
                    } else {
                        localStorage.setItem(comparisonKey, '[]');
                    }
                };
                
                // „Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥ÂÆüË°å
                migrateBookmarks();
                migrateComparisons();
                
                // „Éû„Ç§„Ç∞„É¨„Éº„Ç∑„Éß„É≥ÂÆå‰∫Ü„Éï„É©„Ç∞„ÇíË®≠ÂÆö
                localStorage.setItem(migrationKey, 'true');
                console.log('‚úÖ Storage migration completed successfully');
                
            } catch (error) {
                console.error('‚ùå Storage migration failed:', error);
            }
        };

        // Filter functions moved to app-init.mjs to prevent conflicts

        // Reset function moved to app-init.mjs to prevent conflicts

        // Tourist Registration functions moved to app-init.mjs to prevent conflicts
        
        function goToStep1Modal() {
            document.getElementById('step2Content').style.display = 'none';
            document.getElementById('step1Content').style.display = 'block';
            
            // Reset indicators
            document.getElementById('step1-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-secondary rounded-circle me-2';
        }
        
        function goToStep3Modal() {
            document.getElementById('step2Content').style.display = 'none';
            document.getElementById('step3Content').style.display = 'block';
            
            // Update indicators
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-success rounded-circle me-2';
            document.getElementById('step3-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
        }
        
        function goToStep2FromStep3() {
            document.getElementById('step3Content').style.display = 'none';
            document.getElementById('step2Content').style.display = 'block';
            
            // Reset indicators
            document.getElementById('step2-indicator').querySelector('.badge').className = 'badge bg-primary rounded-circle me-2';
            document.getElementById('step3-indicator').querySelector('.badge').className = 'badge bg-secondary rounded-circle me-2';
        }
        
        function completeRegistrationModal() {
            alert('ÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ');
            const modal = bootstrap.Modal.getInstance(document.getElementById('registrationModal'));
            modal.hide();
        }
        
        function removeFileModal() {
            document.getElementById('uploadPreviewModal').style.display = 'none';
            document.getElementById('fileInputModal').value = '';
            document.getElementById('completeBtnModal').disabled = true;
            document.getElementById('uploadSuccessModal').style.display = 'none';
        }

        // Price conversion function
        function getPriceFromRange(rangeValue) {
            const priceRanges = {
                '¬•6,000~¬•10,000': '¬•8,000',
                '¬•10,000~¬•15,000': '¬•12,500',
                '¬•15,000~¬•20,000': '¬•17,500',
                '¬•20,000~¬•30,000': '¬•25,000',
                '¬•30,000~¬•50,000': '¬•40,000',
                '¬•50,000+': '¬•60,000'
            };
            return priceRanges[rangeValue] || '';
        }



        // Language switching functions
        function switchToJapanese() {
            console.log('üáØüáµ Êó•Êú¨Ë™ûÈÅ∏Êäû - Êó¢„Å´Êó•Êú¨Ë™ûÁâà„Åß„Åô');
            alert('Êó¢„Å´Êó•Êú¨Ë™ûÁâà„ÇíË°®Á§∫„Åó„Å¶„ÅÑ„Åæ„Åô');
        }

        function switchToEnglish() {
            console.log('üá∫üá∏ English selected - switching to English page');
            window.location.href = 'index-en.html';
        }

        // Login dropdown toggle
        function toggleLoginDropdown() {
            const dropdown = document.getElementById('customLoginDropdown');
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('customLoginDropdown');
            const button = document.getElementById('loginDropdown');
            
            if (!button.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });



        // View guide detail with access control - redirect to detail page
        function viewGuideDetail(guideId) {
            console.log('Opening guide detail page for guide:', guideId);
            
            // Check if user is registered
            const touristData = localStorage.getItem('touristRegistrationData');
            console.log('Tourist registration status:', touristData ? 'REGISTERED' : 'NOT REGISTERED');
            
            if (!touristData) {
                // Show registration modal for unregistered users
                console.log('Showing registration modal for unregistered user');
                const registrationModal = new bootstrap.Modal(document.getElementById('registrationModal'));
                registrationModal.show();
                return;
            }

            // Store all guides data for the detail page
            const allGuides = loadAllGuides();
            localStorage.setItem('allGuides', JSON.stringify(allGuides));
            
            // Redirect to guide detail page
            console.log('Redirecting to guide detail page for registered user');
            window.location.href = `/guide-detail.html?id=${guideId}`;
        }

        // Show guide detail modal
        function showGuideDetailModal(guide) {
            console.log('üîß Creating guide detail modal for:', guide.name);
            try {
                const detailModal = document.createElement('div');
                detailModal.className = 'modal fade';
                detailModal.innerHTML = `
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content" style="border-radius: 15px; box-shadow: 0 15px 50px rgba(0,0,0,0.2);">
                        <div class="modal-header border-0" style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border-radius: 15px 15px 0 0;">
                            <h5 class="modal-title fw-bold">
                                <i class="bi bi-person-circle me-2"></i>Guide Details
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row">
                                <div class="col-md-4">
                                    <img src="${guide.image}" class="img-fluid rounded-circle mb-3" style="width: 150px; height: 150px; object-fit: cover;">
                                    <div class="text-center">
                                        <span class="text-warning">‚òÖ</span>
                                        <span class="fw-bold">${guide.rating}</span>
                                    </div>
                                    <div class="fw-bold text-primary fs-4">¬•${Number(guide?.price || 0).toLocaleString()}</div>
                                    <small class="text-muted">${getLocalizedText('perDay')}</small>
                                </div>
                                <div class="col-md-8">
                                    <h6 class="text-primary mb-3">Basic Information</h6>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Location:</strong></div>
                                        <div class="col-sm-8">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Specialty:</strong></div>
                                        <div class="col-sm-8">${guide.specialty}</div>
                                    </div>
                                    <div class="row mb-3">
                                        <div class="col-sm-4"><strong>Languages:</strong></div>
                                        <div class="col-sm-8">
                                            ${guide.languages.map(lang => {
                                                const langMap = {
                                                    'ja': 'Êó•Êú¨Ë™û', 'japanese': 'Êó•Êú¨Ë™û',
                                                    'en': 'Ëã±Ë™û', 'english': 'Ëã±Ë™û', 
                                                    'zh': '‰∏≠ÂõΩË™û', 'chinese': '‰∏≠ÂõΩË™û',
                                                    'ko': 'ÈüìÂõΩË™û', 'korean': 'ÈüìÂõΩË™û',
                                                    'es': '„Çπ„Éö„Ç§„É≥Ë™û', 'spanish': '„Çπ„Éö„Ç§„É≥Ë™û',
                                                    'fr': '„Éï„É©„É≥„ÇπË™û', 'french': '„Éï„É©„É≥„ÇπË™û',
                                                    'de': '„Éâ„Ç§„ÉÑË™û', 'german': '„Éâ„Ç§„ÉÑË™û',
                                                    'it': '„Ç§„Çø„É™„Ç¢Ë™û', 'italian': '„Ç§„Çø„É™„Ç¢Ë™û'
                                                };
                                                return langMap[lang.toLowerCase()] || lang;
                                            }).join(', ')}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="text-primary">Guide Introduction</h6>
                                        <p class="text-muted">${guide.description}</p>
                                    </div>
                                    <div class="mb-3">
                                        <h6 class="text-primary">Service Details</h6>
                                        <ul class="text-muted">
                                            <li>Professional guide service</li>
                                            <li>Safe local support</li>
                                            <li>Photography service</li>
                                            <li>Recommended spot guidance</li>
                                            <li>Cultural and historical explanations</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-success" onclick="bookGuide(${guide.id})">
                                <i class="bi bi-calendar-check me-2"></i>Book Now
                            </button>
                            <button type="button" class="btn btn-outline-primary" onclick="contactGuide(${guide.id})">
                                <i class="bi bi-chat-dots me-2"></i>Message
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            console.log('üì± Appending modal to DOM...');
            document.body.appendChild(detailModal);
            
            console.log('üîß Creating Bootstrap modal instance...');
            const modal = new bootstrap.Modal(detailModal);
            
            console.log('üöÄ Showing modal...');
            modal.show();
            
            console.log('‚úÖ Modal shown successfully');
            
            // Clean up modal after hiding
            detailModal.addEventListener('hidden.bs.modal', function() {
                console.log('üóëÔ∏è Cleaning up modal...');
                detailModal.remove();
            });
            
            } catch (error) {
                console.error('‚ùå Error creating guide detail modal:', error);
                alert('Error showing guide details: ' + error.message);
            }
        }

        // Booking and contact functions
        window.bookGuide = function(guideId) {
            // Close the guide detail modal first
            const openModal = document.querySelector('.modal.show');
            if (openModal) {
                const modalInstance = bootstrap.Modal.getInstance(openModal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            }
            
            // Wait a moment for the modal to close, then open booking
            setTimeout(() => {
                showBookingModal(guideId);
            }, 300);
        }

        window.contactGuide = function(guideId) {
            // Close the guide detail modal first
            const openModal = document.querySelector('.modal.show');
            if (openModal) {
                const modalInstance = bootstrap.Modal.getInstance(openModal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            }
            
            // Wait a moment for the modal to close, then open chat
            setTimeout(() => {
                showChatModal(guideId);
            }, 300);
        }

        // Login functionality
        function showLoginModal(loginType) {
            return new Promise((resolve) => {
                try {
                    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                    loginModal.show();
                    document.getElementById('loginModal').setAttribute('data-login-type', loginType);
                    
                    // Update modal content based on login type
                    const badge = document.getElementById('loginTypeBadge');
                    if (loginType === 'tourist') {
                        badge.textContent = 'Tourist Login';
                        badge.className = 'badge bg-primary fs-6';
                    } else if (loginType === 'guide') {
                        badge.textContent = 'Guide Login';
                        badge.className = 'badge bg-success fs-6';
                    }
                    
                    resolve(true);
                } catch (error) {
                    const modalElement = document.getElementById('loginModal');
                    if (modalElement) {
                        modalElement.style.display = 'block';
                        modalElement.classList.add('show');
                        modalElement.style.backgroundColor = 'rgba(0,0,0,0.5)';
                    }
                    resolve(false);
                }
            });
        }

        // Registration choice modal is now handled by event-handlers.mjs

        // Tourist registration is now handled by event-handlers.mjs

        // All registration functionality is now handled by event-handlers.mjs
        
        // Guide registration is now handled by event-handlers.mjs - function removed to prevent conflicts

        // Setup dropdown listeners (enhanced)
        function setupCustomDropdownListeners() {
            const touristBtn = document.getElementById('directTouristLoginBtn');
            const guideBtn = document.getElementById('directGuideLoginBtn');
            const sponsorBtn = document.getElementById('sponsorLoginBtn');
            
            if (touristBtn && !touristBtn.hasAttribute('data-handler-added')) {
                touristBtn.onclick = function() {
                    console.log('üéØ Tourist login clicked - redirecting to full registration');
                    window.open('tourist-registration-simple.html', '_blank', 'width=800,height=900,scrollbars=yes,resizable=yes');
                    return false;
                };
                touristBtn.setAttribute('data-handler-added', 'true');
            }
            
            if (guideBtn && !guideBtn.hasAttribute('data-handler-added')) {
                guideBtn.onclick = function() {
                    console.log('üéØ Guide login clicked - redirecting to PERFECT guide registration/login');
                    window.open('guide-registration-perfect.html', '_blank', 'width=900,height=1000,scrollbars=yes,resizable=yes');
                    return false;
                };
                guideBtn.setAttribute('data-handler-added', 'true');
            }
            
            if (sponsorBtn && !sponsorBtn.hasAttribute('data-handler-added')) {
                sponsorBtn.onclick = function() {
                    console.log('üéØ Sponsor login clicked');
                    window.location.href = 'operations-login.html';
                    return false;
                };
                sponsorBtn.setAttribute('data-handler-added', 'true');
            }
        }

        // Get price from range selection
        function getPriceFromRange(rangeValue) {
            if (!rangeValue) return null;
            
            const rangeMap = {
                '6000-10000': 8000,
                '10000-15000': 12500,
                '15000-20000': 17500,
                '20000-25000': 22500,
                '25000-30000': 27500,
                '30000+': 35000
            };
            
            return rangeMap[rangeValue] || null;
        }

        // Update guide display with registered guides
        function updateGuideDisplay() {
            const registeredGuides = JSON.parse(localStorage.getItem('registeredGuides') || '[]');
            
            // Combine default guides with registered guides
            currentGuides = [...registeredGuides];
            guideData = currentGuides;
            
            // Re-display guides
            displayGuides(currentGuides);
            
            console.log(`üìä Updated guide display: ${registeredGuides.length} registered = ${currentGuides.length} total`);
        }

        // Global functions now handled by app-init.mjs to prevent conflicts

        // Emergency button setup for immediate functionality
        function setupEmergencyButtons() {
            console.log('üö® Emergency button setup started');
            
            // Dashboard button
            const dashboardBtn = document.getElementById('dashboardBtn');
            if (dashboardBtn && !dashboardBtn.hasAttribute('data-emergency-setup')) {
                dashboardBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üè™ Dashboard clicked');
                    window.open('sponsor-dashboard.html', '_blank');
                });
                dashboardBtn.setAttribute('data-emergency-setup', 'true');
                console.log('‚úÖ Dashboard button setup');
            }
            
            // Login dropdown
            const loginDropdown = document.getElementById('loginDropdown');
            const customLoginDropdown = document.getElementById('customLoginDropdown');
            if (loginDropdown && customLoginDropdown && !loginDropdown.hasAttribute('data-emergency-setup')) {
                loginDropdown.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('üîë Login dropdown clicked');
                    const isVisible = customLoginDropdown.style.display === 'block';
                    customLoginDropdown.style.display = isVisible ? 'none' : 'block';
                });
                loginDropdown.setAttribute('data-emergency-setup', 'true');
                console.log('‚úÖ Login dropdown setup');
            }
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (customLoginDropdown && !loginDropdown.contains(e.target) && !customLoginDropdown.contains(e.target)) {
                    customLoginDropdown.style.display = 'none';
                }
            });
            
            console.log('‚úÖ Emergency button setup completed');
        }
        
        // Run emergency setup immediately and after DOM loads
        setupEmergencyButtons();
        
        // Initialize page - manual event listeners (app-init.mjs handles main initialization)
        document.addEventListener('DOMContentLoaded', function() {
            setupEmergencyButtons(); // Run again after DOM loads
            // Event listeners for search and filter functionality
            const searchBtn = document.getElementById('searchBtn');
            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    if (window.filterGuides) {
                        window.filterGuides();
                    } else {
                        alert('Ê§úÁ¥¢Ê©üËÉΩ„ÇíÊ∫ñÂÇô‰∏≠„Åß„Åô');
                    }
                });
            }
            
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    if (window.resetFilters) {
                        window.resetFilters();
                    } else {
                        location.reload();
                    }
                });
            }
            
            // Tourist registration modal event listeners
            const sendCodeBtn = document.getElementById('sendCodeBtnModal');
            if (sendCodeBtn) {
                sendCodeBtn.addEventListener('click', function() {
                    document.getElementById('sendCodeSectionModal').style.display = 'none';
                    document.getElementById('verifyCodeSectionModal').style.display = 'block';
                });
            }
            
            const verifyCodeBtn = document.getElementById('verifyCodeBtnModal');
            if (verifyCodeBtn) {
                verifyCodeBtn.addEventListener('click', function() {
                    const code = document.getElementById('verificationCodeModal').value;
                    if (code === '123456') {
                        document.getElementById('verifyCodeSectionModal').style.display = 'none';
                        document.getElementById('verificationSuccessModal').style.display = 'block';
                        document.getElementById('step2NextBtnModal').disabled = false;
                    } else {
                        alert('Ë™çË®º„Ç≥„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ');
                    }
                });
            }
            
            const fileInput = document.getElementById('fileInputModal');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        document.getElementById('fileNameModal').textContent = file.name;
                        document.getElementById('uploadPreviewModal').style.display = 'block';
                        document.getElementById('uploadSuccessModal').style.display = 'block';
                        document.getElementById('completeBtnModal').disabled = false;
                        
                        // Show preview for images
                        if (file.type.startsWith('image/')) {
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                document.getElementById('previewImageModal').src = e.target.result;
                            };
                            reader.readAsDataURL(file);
                        }
                    }
                });
            }
            
            // Add change event listeners for filters to enable real-time filtering
            const locationFilter = document.getElementById('locationFilter');
            const languageFilter = document.getElementById('languageFilter');
            const priceFilter = document.getElementById('priceFilter');
            const keywordInput = document.getElementById('keywordInput');
            
            // ‚ö° È´òÈÄü„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Èñ¢Êï∞„ÇíÂÆüË£Ö
            window.filterGuides = function() {
                console.log('üéØ Fast filterGuides function executing...');
                
                try {
                    // „Éï„Ç£„É´„Çø„ÉºÂÄ§„ÇíÂèñÂæó
                    const locationFilter = document.getElementById('locationFilter')?.value || '';
                    const languageFilter = document.getElementById('languageFilter')?.value || '';
                    const priceFilter = document.getElementById('priceFilter')?.value || '';
                    const keywordInput = document.getElementById('keywordInput')?.value?.toLowerCase() || '';
                    
                    console.log('üîç Filter values:', { locationFilter, languageFilter, priceFilter, keywordInput });
                    
                    // „Ç¨„Ç§„Éâ„Éá„Éº„Çø„ÇíÂèñÂæó
                    const allGuides = window.AppState?.originalGuides || window.AppState?.guides || [];
                    
                    if (allGuides.length === 0) {
                        console.warn('‚ö†Ô∏è No guides available for filtering');
                        return;
                    }
                    
                    // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞ÂÆüË°åÔºàÈ´òÈÄüÂåñÔºâ
                    let filteredGuides = allGuides.filter(guide => {
                        // Â†¥ÊâÄ„Éï„Ç£„É´„Çø„Éº
                        if (locationFilter && !guide.location?.includes(locationFilter) && !guide.city?.includes(locationFilter)) {
                            return false;
                        }
                        
                        // Ë®ÄË™û„Éï„Ç£„É´„Çø„Éº
                        if (languageFilter && !guide.languages?.includes(languageFilter)) {
                            return false;
                        }
                        
                        // ‰æ°Ê†º„Éï„Ç£„É´„Çø„Éº
                        if (priceFilter) {
                            const price = parseInt(guide.price || guide.sessionRate || 0);
                            const [minPrice, maxPrice] = priceFilter.split('-').map(p => parseInt(p));
                            if (price < minPrice || (maxPrice && price > maxPrice)) {
                                return false;
                            }
                        }
                        
                        // „Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢
                        if (keywordInput) {
                            const searchText = `${guide.name} ${guide.location} ${guide.specialties || ''} ${guide.introduction || ''}`.toLowerCase();
                            if (!searchText.includes(keywordInput)) {
                                return false;
                            }
                        }
                        
                        return true;
                    });
                    
                    console.log('‚úÖ Filtering complete:', filteredGuides.length, 'guides matched');
                    
                    // AppState„ÇíÊõ¥Êñ∞
                    if (window.AppState) {
                        window.AppState.filteredGuides = filteredGuides;
                        window.AppState.isFiltered = true;
                    }
                    
                    // ÁµêÊûú„ÇíË°®Á§∫
                    if (window.renderGuideCards) {
                        window.renderGuideCards(filteredGuides);
                    } else {
                        console.error('‚ùå renderGuideCards function not available');
                    }
                    
                } catch (error) {
                    console.error('‚ùå filterGuides error:', error);
                }
            };
            
            // „É™„Çª„ÉÉ„ÉàÈñ¢Êï∞„ÇÇÂÆüË£Ö
            window.resetFilters = function() {
                console.log('üîÑ Reset filters function executing...');
                
                try {
                    // „Éï„Ç£„É´„Çø„ÉºË¶ÅÁ¥†„Çí„ÇØ„É™„Ç¢
                    const locationFilter = document.getElementById('locationFilter');
                    const languageFilter = document.getElementById('languageFilter');
                    const priceFilter = document.getElementById('priceFilter');
                    const keywordInput = document.getElementById('keywordInput');
                    
                    if (locationFilter) locationFilter.value = '';
                    if (languageFilter) languageFilter.value = '';
                    if (priceFilter) priceFilter.value = '';
                    if (keywordInput) keywordInput.value = '';
                    
                    // AppState„Çí„É™„Çª„ÉÉ„Éà
                    if (window.AppState) {
                        window.AppState.isFiltered = false;
                        window.AppState.filteredGuides = null;
                    }
                    
                    // „Åô„Åπ„Å¶„ÅÆ„Ç¨„Ç§„Éâ„ÇíË°®Á§∫
                    const allGuides = window.AppState?.originalGuides || window.AppState?.guides || [];
                    if (window.renderGuideCards) {
                        window.renderGuideCards(allGuides);
                    }
                    
                    console.log('‚úÖ Filters reset successfully');
                    
                } catch (error) {
                    console.error('‚ùå resetFilters error:', error);
                }
            };

            // „Éï„Ç£„É´„Çø„Éº„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆöÔºà„Çø„Ç§„Éü„É≥„Ç∞ÂïèÈ°å„ÇíËß£Ê±∫Ôºâ
            function safeFilterGuides() {
                if (window.filterGuides && typeof window.filterGuides === 'function') {
                    window.filterGuides();
                } else {
                    console.warn('‚ö†Ô∏è window.filterGuides not ready, retrying in 100ms...');
                    setTimeout(safeFilterGuides, 100);
                }
            }
            
            if (locationFilter) locationFilter.addEventListener('change', safeFilterGuides);
            if (languageFilter) languageFilter.addEventListener('change', safeFilterGuides);
            if (priceFilter) priceFilter.addEventListener('change', safeFilterGuides);
            if (keywordInput) keywordInput.addEventListener('input', safeFilterGuides);
            
            // Registration button event - show choice modal (handled by app-init.mjs)
            // const regBtn = document.getElementById('registerBtn');
            // if (regBtn) {
            //     regBtn.addEventListener('click', function(e) {
            //         e.preventDefault();
            //         console.log('Registration button clicked!');
            //         showRegistrationChoice();
            //     });
            // }
            
            // Initialize chat listeners
            // initializeChatListeners(); // Handled by app-init.mjs
            
            // Registration form submission
            document.getElementById('registerSubmitBtn').addEventListener('click', function() {
                const form = document.getElementById('registrationForm');
                const formData = {
                    realName: {
                        first: document.getElementById('realFirstName').value.trim(),
                        last: document.getElementById('realLastName').value.trim()
                    },
                    email: document.getElementById('email').value.trim(),
                    country: document.getElementById('country').value,
                    phone: document.getElementById('phone').value.trim(),
                    visitPurpose: document.getElementById('visitPurpose').value,
                    visitDuration: document.getElementById('visitDuration').value,
                    preferredLanguage: document.getElementById('preferredLanguage').value,
                    interests: document.getElementById('interests').value.trim(),
                    agreeTerms: document.getElementById('agreeTerms').checked,
                    receiveUpdates: document.getElementById('receiveUpdates').checked
                };

                // Validate required fields
                if (!formData.realName.first || !formData.realName.last || !formData.email || !formData.country) {
                    alert('Please fill in all required fields (marked with *)');
                    return;
                }

                if (!formData.agreeTerms) {
                    alert('Please agree to the Terms of Service and Privacy Policy');
                    return;
                }

                // Save tourist data
                try {
                    const touristData = {
                        ...formData,
                        registrationDate: new Date().toISOString(),
                        id: Date.now()
                    };
                    
                    localStorage.setItem('touristRegistrationData', JSON.stringify(touristData));
                    
                    // Close modal
                    const registrationModal = bootstrap.Modal.getInstance(document.getElementById('registrationModal'));
                    registrationModal.hide();
                    
                    // Show success message
                    setTimeout(() => {
                        alert('Registration completed successfully!\n\nYou can now view guide details and book tours.');
                    }, 500);
                    
                } catch (error) {
                    console.error('Registration error:', error);
                    alert('An error occurred during registration. Please try again.');
                }
            });

            // Login form submission
            document.getElementById('loginSubmitBtn').addEventListener('click', function() {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                
                if (!email || !password) {
                    alert('Please enter both email and password.');
                    return;
                }
                
                // For development - simulate successful login
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                loginModal.hide();
                
                setTimeout(() => {
                    alert('Login successful!\n\nNote: Login functionality is currently under development. Actual authentication will be implemented soon.');
                }, 500);
            });

            // Contact form submission
            document.getElementById('contactSubmitBtn').addEventListener('click', function() {
                const name = document.getElementById('contactName').value.trim();
                const email = document.getElementById('contactEmail').value.trim();
                const subject = document.getElementById('contactSubject').value;
                const message = document.getElementById('contactMessage').value.trim();
                
                if (!name || !email || !subject || !message) {
                    alert('Please fill in all fields.');
                    return;
                }
                
                // Close modal
                const contactModal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
                contactModal.hide();
                
                setTimeout(() => {
                    alert('Thank you for your message!\n\nWe will respond to your inquiry within 24 hours.');
                }, 500);
            });

            // Guide Registration Functions
            let isGuidePhoneVerified = false;

            // Profile photo preview for guide
            document.getElementById('guideProfilePhoto').addEventListener('change', function(e) {
                const file = e.target.files[0];
                const preview = document.getElementById('guideProfilePreview');
                const placeholder = document.getElementById('guidePhotoPlaceholder');
                
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                        placeholder.style.display = 'none';
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Guide phone verification
            document.getElementById('guideSendVerificationBtn').addEventListener('click', function() {
                const phone = document.getElementById('guidePhoneLogin').value;
                if (phone.match(/^[0-9+\-()]+$/)) {
                    document.getElementById('guideVerificationCodeSection').style.display = 'block';
                    this.disabled = true;
                    this.textContent = 'Sent';
                    
                    // Simulate SMS sending
                    alert('Verification code sent! (Demo: enter "123456")');
                } else {
                    alert('Please enter a valid phone number');
                }
            });

            document.getElementById('guideVerifyCodeBtn').addEventListener('click', function() {
                const code = document.getElementById('guideVerificationCode').value;
                if (code === '123456') {
                    isGuidePhoneVerified = true;
                    this.textContent = 'Verified';
                    this.disabled = true;
                    this.classList.remove('btn-success');
                    this.classList.add('btn-outline-success');
                    document.getElementById('guideVerificationCode').disabled = true;
                    alert('Phone verification completed!');
                } else {
                    alert('Invalid verification code');
                }
            });

            // Guide price handling
            document.getElementById('guidePriceRange').addEventListener('change', function() {
                const priceInput = document.getElementById('guidePriceInput');
                if (this.value) {
                    priceInput.value = '';
                    priceInput.disabled = true;
                } else {
                    priceInput.disabled = false;
                }
            });

            document.getElementById('guidePriceInput').addEventListener('input', function() {
                const priceRange = document.getElementById('guidePriceRange');
                if (this.value) {
                    priceRange.value = '';
                    priceRange.disabled = true;
                } else {
                    priceRange.disabled = false;
                }
            });

            // Detailed guide registration form submission
            const detailedGuideForm = document.getElementById('detailedGuideForm');
            if (detailedGuideForm) {
                detailedGuideForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        guideName: document.getElementById('detailedGuideName').value.trim(),
                        email: document.getElementById('detailedGuideEmail').value.trim(),
                        phone: document.getElementById('detailedGuidePhone').value.trim(),
                        gender: document.getElementById('detailedGuideGender').value,
                        age: parseInt(document.getElementById('detailedGuideAge').value),
                        experience: document.getElementById('detailedGuideExperience').value,
                        languages: Array.from(document.getElementById('detailedGuideLanguages').selectedOptions).map(option => option.value),
                        introduction: document.getElementById('detailedGuideIntroduction').value.trim(),
                        specialties: document.getElementById('detailedGuideSpecialties').value.trim(),
                        hourlyRate: parseFloat(document.getElementById('detailedGuideHourlyRate').value),
                        availability: document.getElementById('detailedGuideAvailability').value,
                        agreeTerms: document.getElementById('detailedAgreeTerms').checked
                    };
                    
                    console.log('Detailed guide registration:', formData);
                    
                    // Basic validation
                    if (!formData.agreeTerms) {
                        alert('Âà©Áî®Ë¶èÁ¥Ñ„Å´ÂêåÊÑè„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        return;
                    }
                    
                    if (formData.languages.length === 0) {
                        alert('ÂØæÂøúË®ÄË™û„ÇíÊúÄ‰Ωé1„Å§ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        return;
                    }
                    
                    // Simulate API call - replace with actual endpoint
                    alert(`„Ç¨„Ç§„ÉâÁôªÈå≤Áî≥Ë´ã„ÇíÂèó„Åë‰ªò„Åë„Åæ„Åó„Åü„ÄÇ\nÁî≥Ë´ãËÄÖ: ${formData.guideName}\nÂØæÂøúË®ÄË™û: ${formData.languages.join(', ')}\nÂØ©ÊüªÂæå„ÄÅ„É°„Éº„É´„Åß„ÅîÈÄ£Áµ°„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ`);
                    
                    // Hide form after successful submission
                    document.getElementById('detailedGuideRegistrationForm').style.display = 'none';
                    
                    // Reset form
                    detailedGuideForm.reset();
                });
            }

            // Guide registration form submission (updated for new modal)
            const guideRegistrationSubmitBtn = document.getElementById('guideRegistrationSubmitBtn');
            if (guideRegistrationSubmitBtn) {
                guideRegistrationSubmitBtn.addEventListener('click', function() {
                    console.log('üéØ Guide registration form submitted');
                    
                    // Validate required fields
                    const guideName = document.getElementById('guideName').value.trim();
                    const guideEmail = document.getElementById('guideEmail').value.trim();
                    const guidePhone = document.getElementById('guidePhoneReg').value.trim();
                    const guideLocation = document.getElementById('guideLocation').value;
                    const guidePrice = document.getElementById('guidePrice').value;
                    const guideDescription = document.getElementById('guideDescription').value.trim();
                    
                    // Get selected languages
                    const selectedLanguages = [];
                    document.querySelectorAll('#guideRegistrationModal input[type="checkbox"]:checked').forEach(checkbox => {
                        selectedLanguages.push(checkbox.value);
                    });
                    
                    // Validation
                    if (!guideName || !guideEmail || !guidePhone || !guideLocation || !guidePrice || !guideDescription) {
                        alert('„Åô„Åπ„Å¶„ÅÆÂøÖÈ†àÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        return;
                    }
                    
                    if (selectedLanguages.length === 0) {
                        alert('Â∞ë„Å™„Åè„Å®„ÇÇ1„Å§„ÅÆÂØæÂøúË®ÄË™û„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        return;
                    }
                    
                    const formData = {
                        name: guideName,
                        email: guideEmail,
                        phone: guidePhone,
                        location: guideLocation,
                        languages: selectedLanguages,
                        price: parseInt(guidePrice),
                        description: guideDescription
                    };

                    // Save guide data
                    try {
                        const guideData = {
                            ...formData,
                            id: Date.now(),
                            registrationDate: new Date().toISOString(),
                            type: 'guide',
                            rating: 4.5 + (Math.random() * 0.5), // Random rating between 4.5-5.0
                            image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=300&h=300&fit=crop&crop=face"
                        };

                        // Get existing registered guides
                        let registeredGuides = JSON.parse(localStorage.getItem('registeredGuides') || '[]');
                        registeredGuides.push(guideData);
                        localStorage.setItem('registeredGuides', JSON.stringify(registeredGuides));

                        console.log('‚úÖ Guide registered successfully:', guideData);

                        // Update guide data for display
                        try {
                            if (typeof updateGuideDisplay === 'function') {
                                updateGuideDisplay();
                            }
                        } catch (error) {
                            console.error('Error updating guide display after registration:', error);
                            // Continue anyway as the registration was successful
                        }

                        // Close modal
                        const guideModal = bootstrap.Modal.getInstance(document.getElementById('guideRegistrationModal'));
                        if (guideModal) {
                            guideModal.hide();
                        }

                        // Reset form
                        document.getElementById('guideRegistrationForm').reset();

                        // Show success message
                        setTimeout(() => {
                            alert('„Ç¨„Ç§„ÉâÁôªÈå≤„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ\n\nÁôªÈå≤ÂÜÖÂÆπ„ÅØ24ÊôÇÈñì‰ª•ÂÜÖ„Å´ÂØ©Êüª„Åï„Çå„ÄÅÊâøË™çÂæå„Å´„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å´„Å™„Çä„Åæ„Åô„ÄÇ');
                        }, 500);

                    } catch (error) {
                        console.error('Guide registration error:', error);
                        alert('ÁôªÈå≤‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    }
            });

            // Setup dropdown listeners
            setupCustomDropdownListeners();
            
            document.getElementById('prevPageBtn').addEventListener('click', () => {
                if (window.AppState && window.AppState.currentPage > 1) {
                    window.AppState.currentPage -= 1;
                    if (window.renderGuideCards) {
                        window.renderGuideCards(window.AppState.guides);
                    }
                }
            });
            
            document.getElementById('nextPageBtn').addEventListener('click', () => {
                if (window.AppState && window.AppState.guides) {
                    const totalPages = Math.ceil(window.AppState.guides.length / 12);
                    if (window.AppState.currentPage < totalPages) {
                        window.AppState.currentPage += 1;
                        if (window.renderGuideCards) {
                            window.renderGuideCards(window.AppState.guides);
                        }
                    }
                }
            });

            console.log('‚úÖ TomoTrip English Version Loaded Successfully - All Features Active');
        });

        // Sponsor Registration and Login Functions
        function handleSponsorRegistration() {
            console.log('üè™ Sponsor registration clicked');
            try {
                // Direct navigation to sponsor registration page
                window.location.href = './sponsor-registration.html';
            } catch (error) {
                console.error('‚ùå Sponsor registration navigation error:', error);
                // Fallback to direct URL
                window.location.href = '/sponsor-registration.html';
            }
        }

        function handleSponsorLogin() {
            console.log('Sponsor login clicked');
            showSponsorLoginModal();
        }

        // Show sponsor login modal
        function showSponsorLoginModal() {
            const modalHtml = `
                <div class="modal fade" id="sponsorLoginModal" tabindex="-1" aria-labelledby="sponsorLoginModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">
                            <div class="modal-header border-0" style="background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; border-radius: 15px 15px 0 0;">
                                <h5 class="modal-title fw-bold" id="sponsorLoginModalLabel">
                                    <i class="bi bi-shop me-2"></i>Store Login
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body p-4">
                                <form id="sponsorLoginForm">
                                    <div class="mb-3">
                                        <label for="sponsorStoreName" class="form-label fw-bold">
                                            <i class="bi bi-shop me-2"></i>Store Name
                                        </label>
                                        <input type="text" class="form-control" id="sponsorStoreName" placeholder="Enter your store name" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorEmail" class="form-label fw-bold">
                                            <i class="bi bi-envelope me-2"></i>Email Address
                                        </label>
                                        <input type="email" class="form-control" id="sponsorEmail" placeholder="Store contact email" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorPhone" class="form-label fw-bold">
                                            <i class="bi bi-telephone me-2"></i>Phone Number
                                        </label>
                                        <input type="tel" class="form-control" id="sponsorPhone" placeholder="Store phone number (e.g., 03-1234-5678)" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3">
                                        <label for="sponsorPassword" class="form-label fw-bold">
                                            <i class="bi bi-lock me-2"></i>Password
                                        </label>
                                        <input type="password" class="form-control" id="sponsorPassword" placeholder="Enter management password" required style="border-radius: 10px; padding: 12px;">
                                    </div>
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="rememberSponsor">
                                        <label class="form-check-label" for="rememberSponsor">
                                            Remember login status
                                        </label>
                                    </div>
                                </form>
                                <div class="alert alert-info" style="border-radius: 10px;">
                                    <small><i class="bi bi-info-circle me-2"></i>First time using as a sponsor store? Please register from "Store Registration".</small>
                                </div>
                            </div>
                            <div class="modal-footer border-0 p-4 pt-0">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">
                                    Cancel
                                </button>
                                <button type="button" class="btn btn-primary" onclick="processSponsorLogin()" style="border-radius: 25px; padding: 10px 30px; background: linear-gradient(135deg, #4ecdc4, #44a08d); border: none;">
                                    <i class="bi bi-box-arrow-in-right me-2"></i>Login
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('sponsorLoginModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('sponsorLoginModal'));
            modal.show();
            
            // Clean up when modal is hidden
            document.getElementById('sponsorLoginModal').addEventListener('hidden.bs.modal', function() {
                this.remove();
            });
        }

        // Process sponsor login
        function processSponsorLogin() {
            const storeName = document.getElementById('sponsorStoreName').value.trim();
            const email = document.getElementById('sponsorEmail').value.trim();
            const phone = document.getElementById('sponsorPhone').value.trim();
            const password = document.getElementById('sponsorPassword').value.trim();
            
            if (!storeName || !email || !phone || !password) {
                alert('Please fill in all fields.');
                return;
            }

            // Check if sponsor exists in registered sponsors
            const registeredSponsors = JSON.parse(localStorage.getItem('registeredSponsors') || '[]');
            const sponsor = registeredSponsors.find(s => 
                s.storeName === storeName && 
                s.email === email && 
                s.phone === phone
            );

            if (!sponsor) {
                alert('Store information not found. Please check your registration details.');
                return;
            }
            
            // Store sponsor session for management access
            sessionStorage.setItem('currentSponsor', JSON.stringify({
                id: sponsor.id,
                storeName: storeName,
                email: email,
                loginTime: new Date().toISOString()
            }));
            
            console.log('Sponsor login successful:', storeName);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('sponsorLoginModal'));
            modal.hide();
            
            // Show success and redirect
            setTimeout(() => {
                const successModal = document.createElement('div');
                successModal.className = 'modal fade';
                successModal.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content" style="border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.2);">
                            <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                                <h5 class="modal-title fw-bold">‚úÖ Store Login Successful</h5>
                            </div>
                            <div class="modal-body p-4 text-center">
                                <div class="mb-4">
                                    <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
                                </div>
                                <h6 class="fw-bold mb-3">Redirecting to Store Management Dashboard</h6>
                                <p class="text-muted mb-0">Store Name: ${storeName}</p>
                                <p class="text-muted mb-0">Email: ${email}</p>
                                <div class="alert alert-success mt-3" style="border-radius: 10px;">
                                    <small><i class="bi bi-check-circle me-2"></i>You can edit and manage your store information.</small>
                                </div>
                            </div>
                            <div class="modal-footer border-0 p-4 pt-0">
                                <button type="button" class="btn btn-success w-100" onclick="redirectToSponsorDashboard()" style="border-radius: 25px; padding: 12px;">
                                    Go to Management Dashboard
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(successModal);
                const modal = new bootstrap.Modal(successModal);
                modal.show();
                
                // Clean up
                successModal.addEventListener('hidden.bs.modal', function() {
                    successModal.remove();
                });
            }, 500);
        }

        // Redirect to sponsor dashboard
        function redirectToSponsorDashboard() {
            const storeName = document.getElementById('sponsorStoreName').value.trim();
            const email = document.getElementById('sponsorEmail').value.trim();
            
            // Find the sponsor's ID for editing
            const registeredSponsors = JSON.parse(localStorage.getItem('registeredSponsors') || '[]');
            const sponsor = registeredSponsors.find(s => s.storeName === storeName && s.email === email);
            
            if (sponsor) {
                console.log('Redirecting to sponsor edit page for:', sponsor.storeName);
                window.location.href = `sponsor-edit.html?id=${sponsor.id}`;
            } else {
                console.error('Sponsor not found for redirect');
                alert('Error: Store information not found for redirection.');
            }
        }

        // Chat functionality (English version)
        let currentChatGuide = null;

        function showChatModal(guideId) {
            console.log('Guide ID: ' + guideId + ' message feature is under development.');
            
            // Find guide data
            const guide = currentGuides.find(g => g.id == guideId);
            if (!guide) {
                console.error('Guide not found for chat:', guideId);
                return;
            }

            currentChatGuide = guide;
            
            // Update modal with guide info
            document.getElementById('chatGuideName').textContent = guide.name;
            document.getElementById('chatGuideImage').src = guide.image;
            
            // Load chat history
            loadChatHistory(guideId);
            
            // Show modal
            const chatModal = new bootstrap.Modal(document.getElementById('chatModal'));
            chatModal.show();
            
            // Show development notice
            setTimeout(() => {
                addSystemMessage('Chat functionality will be fully implemented soon.');
            }, 500);
            
            console.log('Chat modal opened for guide:', guide.name);
        }

        function loadChatHistory(guideId) {
            const chatMessages = document.getElementById('chatMessages');
            const chatKey = `chat_${guideId}`;
            const savedMessages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            // Clear current messages
            chatMessages.innerHTML = '';
            
            // Display saved messages
            savedMessages.forEach(message => {
                displayMessage(message.text, message.sender, message.timestamp, false);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function sendMessage() {
            const messageInput = document.getElementById('chatMessageInput');
            const messageText = messageInput.value.trim();
            
            if (!messageText || !currentChatGuide) return;
            
            // Display user message
            const timestamp = new Date();
            displayMessage(messageText, 'user', timestamp);
            
            // Save message
            saveChatMessage(currentChatGuide.id, messageText, 'user', timestamp);
            
            // Clear input
            messageInput.value = '';
            
            // Simulate guide response (for demonstration)
            setTimeout(() => {
                const responses = [
                    'Thank you! I\'m happy to help you.',
                    'I\'ll answer your questions. Feel free to ask for details.',
                    'I\'ll suggest plans that match your preferences.',
                    'I\'ll support you with your travel planning.'
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                const responseTime = new Date();
                displayMessage(response, 'guide', responseTime);
                saveChatMessage(currentChatGuide.id, response, 'guide', responseTime);
            }, 1000 + Math.random() * 2000);
        }

        function displayMessage(text, sender, timestamp, saveMessage = true) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            const isUser = sender === 'user';
            
            messageDiv.className = `mb-3 d-flex ${isUser ? 'justify-content-end' : 'justify-content-start'}`;
            
            const timeStr = timestamp.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="max-width-70 ${isUser ? 'text-end' : 'text-start'}">
                    <div class="p-3 rounded-3 ${isUser ? 'bg-primary text-white ms-5' : 'bg-white border me-5'}" 
                         style="border-radius: ${isUser ? '20px 20px 5px 20px' : '20px 20px 20px 5px'} !important;">
                        <p class="mb-1">${text}</p>
                        <small class="opacity-75">${timeStr}</small>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addSystemMessage(text) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            
            messageDiv.className = 'mb-3 text-center';
            messageDiv.innerHTML = `
                <div class="badge bg-secondary p-2">
                    <i class="bi bi-info-circle me-1"></i>${text}
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function saveChatMessage(guideId, text, sender, timestamp) {
            const chatKey = `chat_${guideId}`;
            const savedMessages = JSON.parse(localStorage.getItem(chatKey) || '[]');
            
            savedMessages.push({
                text: text,
                sender: sender,
                timestamp: timestamp
            });
            
            // Keep only last 100 messages
            if (savedMessages.length > 100) {
                savedMessages.splice(0, savedMessages.length - 100);
            }
            
            localStorage.setItem(chatKey, JSON.stringify(savedMessages));
        }

        // Booking functionality (English version)
        let currentBookingGuide = null;

        function showBookingModal(guideId) {
            console.log('Starting booking process: Guide ID ' + guideId);
            
            // Find guide data
            const guide = currentGuides.find(g => g.id == guideId);
            if (!guide) {
                console.error('Guide not found for booking:', guideId);
                return;
            }

            currentBookingGuide = guide;
            
            // Update modal with guide info
            document.getElementById('bookingGuideName').textContent = guide.name;
            document.getElementById('bookingGuideImage').src = guide.image;
            document.getElementById('bookingGuidePrice').textContent = guide.price;
            
            // Reset form
            document.getElementById('bookingForm').reset();
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bookingDate').min = today;
            
            updateBookingSummary();
            
            // Show modal
            const bookingModal = new bootstrap.Modal(document.getElementById('bookingModal'));
            bookingModal.show();
            
            console.log('Booking modal opened for guide:', guide.name);
        }

        function updateBookingSummary() {
            if (!currentBookingGuide) return;
            
            const date = document.getElementById('bookingDate').value;
            const time = document.getElementById('bookingTime').value;
            const duration = document.getElementById('bookingDuration').value;
            const participants = document.getElementById('bookingParticipants').value;
            
            const summary = document.getElementById('bookingSummary');
            const totalElement = document.getElementById('bookingTotal');
            
            console.log('Booking calculation debug:', {
                guide: currentBookingGuide.name,
                price: currentBookingGuide.price,
                priceType: typeof currentBookingGuide.price,
                date, time, duration, participants
            });
            
            if (date && time && duration && participants) {
                // Extract price - handle multiple formats
                let basePrice = 5000; // default fallback
                
                if (currentBookingGuide.price) {
                    if (typeof currentBookingGuide.price === 'string') {
                        // Handle string formats like "¬•7000/ÊôÇÈñì" or "7000"
                        const priceMatch = currentBookingGuide.price.match(/\d+/);
                        if (priceMatch) {
                            basePrice = parseInt(priceMatch[0]);
                        }
                    } else if (typeof currentBookingGuide.price === 'number') {
                        basePrice = currentBookingGuide.price;
                    }
                }
                
                console.log('Extracted base price:', basePrice);
                
                const durationMultiplier = duration === '2' ? 1.5 : duration === '4' ? 2.5 : duration === '8' ? 4 : 1;
                const total = Math.round(basePrice * durationMultiplier * parseInt(participants));
                
                summary.innerHTML = `
                    <div class="mb-2"><strong>Guide:</strong> ${currentBookingGuide.name}</div>
                    <div class="mb-2"><strong>Date & Time:</strong> ${date} ${time}</div>
                    <div class="mb-2"><strong>Duration:</strong> ${duration} hours</div>
                    <div class="mb-2"><strong>Participants:</strong> ${participants} people</div>
                    <div class="mb-2"><strong>Base Rate:</strong> ${currentBookingGuide.price}/hour</div>
                `;
                totalElement.textContent = `¬•${Number(total || 0).toLocaleString()}`;
            } else {
                summary.innerHTML = '<p class="text-muted">Please fill in the details</p>';
                totalElement.textContent = '¬•0';
            }
        }

        function submitBooking() {
            const form = document.getElementById('bookingForm');
            const formData = new FormData(form);
            
            // Validate form
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Create booking object
            const booking = {
                id: Date.now(),
                guideId: currentBookingGuide.id,
                guideName: currentBookingGuide.name,
                guideImage: currentBookingGuide.image,
                guideRate: currentBookingGuide.price,
                date: formData.get('date'),
                time: formData.get('time'),
                duration: formData.get('duration'),
                participants: formData.get('participants'),
                specialRequests: formData.get('specialRequests'),
                totalPrice: document.getElementById('bookingTotal').textContent,
                status: 'pending',
                bookingDate: new Date().toISOString()
            };
            
            // Save as temporary booking data for payment with language info
            booking.language = 'en'; // Mark as English booking
            localStorage.setItem('tempBookingData', JSON.stringify(booking));
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('bookingModal'));
            modal.hide();
            
            // Redirect to payment page with language parameter
            window.location.href = 'payment.html?lang=en';
        }

        function saveBooking(booking) {
            const bookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
            bookings.push(booking);
            localStorage.setItem('userBookings', JSON.stringify(bookings));
        }

        function showBookingConfirmation(booking) {
            // Show toast notification
            const toastContainer = document.querySelector('.toast-container') || (() => {
                const container = document.createElement('div');
                container.className = 'toast-container position-fixed top-0 end-0 p-3';
                document.body.appendChild(container);
                return container;
            })();
            
            const toast = document.createElement('div');
            toast.className = 'toast show';
            toast.innerHTML = `
                <div class="toast-header bg-success text-white">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <strong class="me-auto">Booking Confirmed</strong>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    Booking #${booking.id} has been confirmed!
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Auto-remove toast after 5 seconds
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Initialize chat and booking listeners - called from main DOMContentLoaded
        function initializeChatListeners() {
            const sendBtn = document.getElementById('sendMessageBtn');
            const messageInput = document.getElementById('chatMessageInput');
            
            if (sendBtn) {
                sendBtn.addEventListener('click', sendMessage);
            }
            
            if (messageInput) {
                messageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }

            // Booking form event listeners
            const bookingForm = document.getElementById('bookingForm');
            if (bookingForm) {
                const formInputs = bookingForm.querySelectorAll('input, select');
                formInputs.forEach(input => {
                    input.addEventListener('change', updateBookingSummary);
                });
            }

            const submitBookingBtn = document.getElementById('submitBookingBtn');
            if (submitBookingBtn) {
                submitBookingBtn.addEventListener('click', submitBooking);
            }

            // Management Center Button Event Listeners are handled in button-setup.js
            // to avoid duplicated bindings and maintain consistency

            // Initialize on page load
            updateBookmarkButtons();
            updateComparisonButtons();
        }
    </script>

    <!-- Chat Modal -->
    <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true" style="z-index: 2000;">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); height: 600px;">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #17a2b8, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="chatModalLabel">
                        <i class="bi bi-chat-dots me-2"></i>Chat with Guide
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0 d-flex flex-column" style="height: 500px;">
                    <!-- Guide info header -->
                    <div class="bg-light border-bottom p-3">
                        <div class="d-flex align-items-center">
                            <img id="chatGuideImage" src="" class="rounded-circle me-3" style="width: 50px; height: 50px; object-fit: cover;" alt="Guide Image">
                            <div>
                                <h6 class="mb-0 fw-bold" id="chatGuideName">Guide Name</h6>
                                <small class="text-muted">
                                    <i class="bi bi-circle-fill text-success me-1" style="font-size: 8px;"></i>Online
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat messages area -->
                    <div class="flex-grow-1 p-3 overflow-auto" id="chatMessages" style="background-color: #f8f9fa;">
                        <!-- Messages will be added here -->
                    </div>
                    
                    <!-- Message input area -->
                    <div class="border-top p-3 bg-white">
                        <div class="input-group">
                            <input type="text" class="form-control" id="chatMessageInput" 
                                   placeholder="Type your message..." 
                                   style="border-radius: 25px 0 0 25px; border: 2px solid #e9ecef;">
                            <button class="btn btn-primary" type="button" id="sendMessageBtn" 
                                    style="border-radius: 0 25px 25px 0; background: linear-gradient(135deg, #17a2b8, #20c997); border: none;">
                                <i class="bi bi-send"></i>
                            </button>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="bi bi-info-circle me-1"></i>Press Enter to send message
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true" style="z-index: 2100;">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="bookingModalLabel">
                        <i class="bi bi-calendar-check me-2"></i>Book Guide
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="row">
                        <!-- Left Column: Guide Info -->
                        <div class="col-md-4 mb-4">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body text-center">
                                    <img id="bookingGuideImage" src="" class="rounded-circle mb-3" style="width: 120px; height: 120px; object-fit: cover;" alt="Guide Image">
                                    <h5 id="bookingGuideName" class="fw-bold">Guide Name</h5>
                                    <p class="text-primary fw-bold mb-0">
                                        <i class="bi bi-currency-yen me-1"></i>
                                        <span id="bookingGuidePrice">¬•0</span>/hour
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Middle Column: Booking Form -->
                        <div class="col-md-5 mb-4">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-calendar3 me-2"></i>Booking Details
                            </h6>
                            
                            <form id="bookingForm">
                                <div class="mb-3">
                                    <label for="bookingDate" class="form-label fw-bold">Date</label>
                                    <input type="date" class="form-control" id="bookingDate" name="date" required style="border-radius: 10px;">
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingTime" class="form-label fw-bold">Start Time</label>
                                    <select class="form-select" id="bookingTime" name="time" required style="border-radius: 10px;">
                                        <option value="">Select time</option>
                                        <option value="09:00">09:00</option>
                                        <option value="10:00">10:00</option>
                                        <option value="11:00">11:00</option>
                                        <option value="12:00">12:00</option>
                                        <option value="13:00">13:00</option>
                                        <option value="14:00">14:00</option>
                                        <option value="15:00">15:00</option>
                                        <option value="16:00">16:00</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingDuration" class="form-label fw-bold">Duration</label>
                                    <select class="form-select" id="bookingDuration" name="duration" required style="border-radius: 10px;">
                                        <option value="">Select duration</option>
                                        <option value="1">1 hour</option>
                                        <option value="2">2 hours (1.5x rate)</option>
                                        <option value="4">4 hours (2.5x rate)</option>
                                        <option value="8">8 hours (4x rate)</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="bookingParticipants" class="form-label fw-bold">Number of Participants</label>
                                    <select class="form-select" id="bookingParticipants" name="participants" required style="border-radius: 10px;">
                                        <option value="">Select participants</option>
                                        <option value="1">1 person</option>
                                        <option value="2">2 people</option>
                                        <option value="3">3 people</option>
                                        <option value="4">4 people</option>
                                        <option value="5">5 people</option>
                                        <option value="6">6+ people</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="specialRequests" class="form-label fw-bold">Special Requests</label>
                                    <textarea class="form-control" id="specialRequests" name="specialRequests" rows="3" 
                                              placeholder="Allergies, accessibility needs, special interests, etc." 
                                              style="border-radius: 10px;"></textarea>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Right Column: Booking Summary -->
                        <div class="col-md-3">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-receipt me-2"></i>Booking Summary
                            </h6>
                            
                            <div class="card border-0 bg-light">
                                <div class="card-body">
                                    <div id="bookingSummary" class="mb-3">
                                        <p class="text-muted">Please fill in the details</p>
                                    </div>
                                    
                                    <hr>
                                    
                                    <div class="d-flex justify-content-between align-items-center">
                                        <strong>Total Amount:</strong>
                                        <span class="text-success fw-bold fs-5" id="bookingTotal">¬•0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 bg-light" style="border-radius: 0 0 15px 15px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" id="submitBookingBtn" 
                            style="background: linear-gradient(135deg, #28a745, #20c997); border: none; border-radius: 25px; padding: 10px 30px;">
                        <i class="bi bi-calendar-check me-2"></i>Confirm Booking
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Management Center Modal -->
    <div class="modal fade" id="managementModal" tabindex="-1" aria-labelledby="managementModalLabel" aria-hidden="true" style="z-index: 2200;">
        <div class="modal-dialog modal-fullscreen-lg-down modal-xl">
            <div class="modal-content" style="border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: none; backdrop-filter: blur(10px); max-height: 90vh; display: flex; flex-direction: column;">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #ff6b9d 100%); color: white; border-radius: 20px 20px 0 0; padding: 25px 30px; flex-shrink: 0;">
                    <h5 class="modal-title fw-bold d-flex align-items-center" id="managementModalLabel">
                        <div class="me-3" style="width: 45px; height: 45px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <i class="bi bi-gear-fill" style="font-size: 22px;"></i>
                        </div>
                        <div>
                            <div style="font-size: 1.4rem;">üèÜ ÁÆ°ÁêÜ„Çª„É≥„Çø„Éº</div>
                            <small style="opacity: 0.9; font-weight: normal;">„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„ÉªÊØîËºÉ„Éª‰∫àÁ¥ÑÁÆ°ÁêÜ</small>
                        </div>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Èñâ„Åò„Çã"></button>
                </div>
                <div class="modal-body p-0" style="flex: 1; overflow-y: auto;">
                    <!-- Tab Navigation -->
                    <div style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 10;">
                        <ul class="nav nav-pills nav-fill" id="managementTabs" role="tablist" style="background: rgba(255,255,255,0.5); border-radius: 30px; padding: 8px;">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="bookmarks-tab" data-bs-toggle="pill" data-bs-target="#bookmarks" type="button" role="tab" style="border-radius: 25px; margin: 0 5px; font-weight: 600; transition: all 0.3s ease; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none;">
                                    <i class="bi bi-bookmark-star-fill me-2"></i>üìå „Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="comparison-tab" data-bs-toggle="pill" data-bs-target="#comparison" type="button" role="tab" style="border-radius: 25px; margin: 0 5px; font-weight: 600; transition: all 0.3s ease; border: none;">
                                    <i class="bi bi-bar-chart-line-fill me-2"></i>üìä ÊØîËºÉ„É™„Çπ„Éà
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="bookings-tab" data-bs-toggle="pill" data-bs-target="#bookings" type="button" role="tab" style="border-radius: 25px; margin: 0 5px; font-weight: 600; transition: all 0.3s ease; border: none;">
                                    <i class="bi bi-calendar-check-fill me-2"></i>üìÖ ‰∫àÁ¥ÑÂ±•Ê≠¥
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="settings-tab" data-bs-toggle="pill" data-bs-target="#settings" type="button" role="tab" style="border-radius: 25px; margin: 0 5px; font-weight: 600; transition: all 0.3s ease; border: none;">
                                    <i class="bi bi-gear-fill me-2"></i>‚öôÔ∏è Ë®≠ÂÆö
                                </button>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Tab Content -->
                    <div class="tab-content p-4" id="managementTabContent" style="min-height: 400px; padding-bottom: 60px !important;">
                        <!-- Bookmarks Tab -->
                        <div class="tab-pane fade show active" id="bookmarks" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold text-primary">
                                    <i class="bi bi-bookmark-star-fill me-2"></i>‰øùÂ≠ò„Åó„Åü„Ç¨„Ç§„Éâ
                                </h5>
                                <button class="btn btn-outline-danger btn-sm" id="clearBookmarksBtn" style="border-radius: 20px; padding: 8px 16px;">
                                    <i class="bi bi-trash3 me-1"></i>„Åô„Åπ„Å¶ÂâäÈô§
                                </button>
                            </div>
                            <div id="bookmarksList" class="row">
                                <div class="col-12 text-center py-5">
                                    <i class="bi bi-clock-history" style="font-size: 3rem; color: #6c757d; opacity: 0.5;"></i>
                                    <p class="text-muted mt-3 mb-0" style="font-size: 1.1rem;">‰øùÂ≠ò„Åï„Çå„Åü„Ç¨„Ç§„Éâ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                    <small class="text-muted">„Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„ÅÆ‚≠ê„Éú„Çø„É≥„Åß„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„Åß„Åç„Åæ„Åô</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Comparison Tab -->
                        <div class="tab-pane fade" id="comparison" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold text-success">
                                    <i class="bi bi-bar-chart-line-fill me-2"></i>ÊØîËºÉ‰∏≠„ÅÆ„Ç¨„Ç§„Éâ
                                </h5>
                                <button class="btn btn-outline-danger btn-sm" id="clearComparisonBtn" style="border-radius: 20px; padding: 8px 16px;">
                                    <i class="bi bi-trash3 me-1"></i>„Åô„Åπ„Å¶ÂâäÈô§
                                </button>
                            </div>
                            <div id="comparisonList" class="row">
                                <div class="col-12 text-center py-5">
                                    <i class="bi bi-clock-history" style="font-size: 3rem; color: #6c757d; opacity: 0.5;"></i>
                                    <p class="text-muted mt-3 mb-0" style="font-size: 1.1rem;">ÊØîËºÉ‰∏≠„ÅÆ„Ç¨„Ç§„Éâ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                    <small class="text-muted">„Ç¨„Ç§„Éâ„Ç´„Éº„Éâ„ÅÆ‚úì„Éú„Çø„É≥„ÅßÊØîËºÉ„É™„Çπ„Éà„Å´ËøΩÂä†„Åß„Åç„Åæ„ÅôÔºàÊúÄÂ§ß3‰ª∂Ôºâ</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bookings Tab -->
                        <div class="tab-pane fade" id="bookings" role="tabpanel">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <h5 class="mb-0 fw-bold text-info">
                                    <i class="bi bi-calendar-check-fill me-2"></i>‰∫àÁ¥ÑÂ±•Ê≠¥
                                </h5>
                                <button class="btn btn-outline-info btn-sm" id="refreshBookingsBtn" style="border-radius: 20px; padding: 8px 16px;">
                                    <i class="bi bi-arrow-clockwise me-1"></i>Êõ¥Êñ∞
                                </button>
                            </div>
                            <div id="bookingsList" class="row">
                                <div class="col-12 text-center py-5">
                                    <i class="bi bi-calendar-x" style="font-size: 3rem; color: #6c757d; opacity: 0.5;"></i>
                                    <p class="text-muted mt-3 mb-0" style="font-size: 1.1rem;">‰∫àÁ¥ÑÂ±•Ê≠¥„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>
                                    <small class="text-muted">„Ç¨„Ç§„Éâ„Å®‰∫àÁ¥Ñ„ÅåÂÆå‰∫Ü„Åô„Çã„Å®Â±•Ê≠¥„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Settings Tab -->
                        <div class="tab-pane fade" id="settings" role="tabpanel">
                            <div class="row">
                                <div class="col-md-6">
                                    <h5 class="mb-4 fw-bold text-secondary">
                                        <i class="bi bi-sliders me-2"></i>Ë®≠ÂÆö
                                    </h5>
                                    <div class="mb-4">
                                        <label for="defaultLanguageSetting" class="form-label fw-bold">„Éá„Éï„Ç©„É´„ÉàË®ÄË™û</label>
                                        <select class="form-select" id="defaultLanguageSetting" style="border-radius: 10px;">
                                            <option value="en">üá∫üá∏ EnglishÔºàËã±Ë™ûÔºâ</option>
                                            <option value="ja" selected>üáØüáµ JapaneseÔºàÊó•Êú¨Ë™ûÔºâ</option>
                                        </select>
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label fw-bold">ÈÄöÁü•Ë®≠ÂÆö</label>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="notificationsEnabled" checked>
                                            <label class="form-check-label" for="notificationsEnabled">
                                                Êñ∞„Åó„ÅÑ„Ç¨„Ç§„ÉâÁôªÈå≤ÊôÇ„Å´ÈÄöÁü•„ÇíÂèó„ÅëÂèñ„Çã
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h5 class="mb-4 fw-bold text-secondary">
                                        <i class="bi bi-database me-2"></i>„Éá„Éº„ÇøÁÆ°ÁêÜ
                                    </h5>
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-outline-primary" id="exportDataBtn" style="border-radius: 15px; padding: 12px;">
                                            <i class="bi bi-download me-2"></i>üì§ „Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà
                                        </button>
                                        <button class="btn btn-outline-warning" id="clearAllDataBtn" style="border-radius: 15px; padding: 12px;">
                                            <i class="bi bi-exclamation-triangle me-2"></i>üóëÔ∏è ÂÖ®„Éá„Éº„Çø„ÇíÂâäÈô§
                                        </button>
                                        <button class="btn btn-outline-info" id="dataStatsBtn" style="border-radius: 15px; padding: 12px;">
                                            <i class="bi bi-bar-chart me-2"></i>üìä „Çπ„Éà„É¨„Éº„Ç∏‰ΩøÁî®Èáè
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 0 0 20px 20px; padding: 20px 30px;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 25px; background: linear-gradient(135deg, #6c757d, #495057); border: none;">
                        <i class="bi bi-x-circle me-2"></i>Èñâ„Åò„Çã
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Management Center Functions
        function showManagementCenter() {
            console.log('Opening Management Center...');
            try {
                loadManagementData();
                const managementModal = new bootstrap.Modal(document.getElementById('managementModal'));
                managementModal.show();
                console.log('‚úÖ Management Center opened successfully');
            } catch (error) {
                console.error('‚ùå Error showing management center:', error);
                alert('Error opening management center: ' + error.message);
            }
        }
        
        function loadManagementData() {
            console.log('üìä Loading management data...');
            try {
                loadBookmarksList();
                loadComparisonList();
                loadBookingsList();
                loadSettingsData();
                console.log('‚úÖ Management data loaded successfully');
            } catch (error) {
                console.error('‚ùå Error loading management data:', error);
            }
        }
        
        function loadBookmarksList() {
            try {
                const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
                const bookmarksList = document.getElementById('bookmarksList');
                
                if (!bookmarksList) return;
                
                if (bookmarkedGuides.length === 0) {
                    bookmarksList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-bookmark text-muted" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">No saved guides</p>
                        </div>
                    `;
                    return;
                }
                
                const allGuides = loadAllGuides();
                bookmarksList.innerHTML = bookmarkedGuides.map(guideId => {
                    const guide = allGuides.find(g => g.id == guideId);
                    if (!guide) return '';
                    
                    return `
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="row g-0">
                                <div class="col-4">
                                    <img src="${guide.image}" class="img-fluid rounded-start h-100" style="object-fit: cover;" alt="${guide.name}">
                                </div>
                                <div class="col-8">
                                    <div class="card-body p-3">
                                        <h6 class="card-title mb-1">${guide.name}</h6>
                                        <p class="card-text small text-muted mb-2">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</p>
                                        <p class="card-text"><strong>¬•${(guide.price || 0).toLocaleString()}</strong></p>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-outline-primary btn-sm" onclick="showGuideDetailModalById(${guide.id})">Details</button>
                                            <button class="btn btn-outline-danger btn-sm" onclick="removeBookmark(${guide.id})">Remove</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading bookmarks:', error);
                const bookmarksList = document.getElementById('bookmarksList');
                if (bookmarksList) {
                    bookmarksList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading bookmarks</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadComparisonList() {
            try {
                const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
                const comparisonList = document.getElementById('comparisonList');
                
                if (!comparisonList) return;
                
                if (comparisonGuides.length === 0) {
                    comparisonList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-graph-up text-muted" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">No guides in comparison</p>
                        </div>
                    `;
                    return;
                }
                
                const allGuides = loadAllGuides();
            comparisonList.innerHTML = comparisonGuides.map(guideId => {
                const guide = allGuides.find(g => g.id == guideId);
                if (!guide) return '';
                
                return `
                    <div class="col-md-4 mb-3">
                        <div class="card h-100 border-success">
                            <img src="${guide.image}" class="card-img-top" style="height: 120px; object-fit: cover;" alt="${guide.name}">
                            <div class="card-body p-3 d-flex flex-column">
                                <h6 class="card-title mb-1">${guide.name}</h6>
                                <p class="card-text small text-muted mb-1">${locationNames && locationNames[guide.location] ? locationNames[guide.location] : (guide.location || 'Unknown Location')}</p>
                                <p class="card-text small mb-2"><span class="text-warning">‚òÖ</span> ${guide.rating}</p>
                                <p class="card-text mb-3"><strong>¬•${(guide.price || 0).toLocaleString()}</strong></p>
                                <div class="mt-auto">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="showGuideDetailModalById(${guide.id})">
                                            <i class="bi bi-info-circle me-1"></i>Details
                                        </button>
                                        <button class="btn btn-outline-danger btn-sm" onclick="removeFromComparison(${guide.id})">
                                            <i class="bi bi-x me-1"></i>Remove
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('Error loading comparison list:', error);
                const comparisonList = document.getElementById('comparisonList');
                if (comparisonList) {
                    comparisonList.innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading comparison list</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadBookingsList() {
            try {
                const userBookings = JSON.parse(localStorage.getItem('userBookings') || '[]');
                const bookingsList = document.getElementById('bookingsList');
                
                if (!bookingsList) return;
            
            if (userBookings.length === 0) {
                bookingsList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="bi bi-calendar-x text-muted" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3">No booking history</p>
                    </div>
                `;
                return;
            }
            
            const statusBadge = {
                'pending': '<span class="badge bg-warning">Pending</span>',
                'confirmed': '<span class="badge bg-success">Confirmed</span>',
                'completed': '<span class="badge bg-primary">Completed</span>',
                'cancelled': '<span class="badge bg-danger">Cancelled</span>'
            };
            
            bookingsList.innerHTML = userBookings.map(booking => {
                return `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <h6 class="mb-1">${booking.guideName}</h6>
                                    <small class="text-muted">${booking.date}</small>
                                </div>
                                <div class="col-md-3">
                                    <small class="text-muted">Duration</small>
                                    <div>${booking.duration}</div>
                                </div>
                                <div class="col-md-2 text-center">
                                    <strong>${booking.totalPrice}</strong>
                                </div>
                                <div class="col-md-2 text-center">
                                    ${statusBadge[booking.status] || statusBadge['pending']}
                                    <div class="mt-2">
                                        <button class="btn btn-outline-primary btn-sm" onclick="viewBookingDetails(${booking.id})">Details</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            } catch (error) {
                console.error('Error loading bookings:', error);
                const bookingsList = document.getElementById('bookingsList');
                if (bookingsList) {
                    bookingsList.innerHTML = `
                        <div class="text-center py-5">
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
                            <p class="text-muted mt-3">Error loading booking history</p>
                        </div>
                    `;
                }
            }
        }
        
        function loadSettingsData() {
            try {
                // Load saved language preference
                const savedLang = localStorage.getItem('preferredLanguage') || 'en';
                const langSetting = document.getElementById('defaultLanguageSetting');
                if (langSetting) langSetting.value = savedLang;
                
                    // Load notification setting
                const notificationsEnabled = localStorage.getItem('notificationsEnabled') !== 'false';
                const notificationSetting = document.getElementById('notificationsEnabled');
                if (notificationSetting) notificationSetting.checked = notificationsEnabled;
            } catch (error) {
                console.error('Error loading settings:', error);
            }
            
            // Setup delete button event listeners for management center (improved timing)
            const setupDeleteButtons = function() {
                const clearBookmarksBtn = document.getElementById('clearBookmarksBtn');
                if (clearBookmarksBtn && !clearBookmarksBtn.hasAttribute('data-listener-attached')) {
                    clearBookmarksBtn.addEventListener('click', function() {
                        if (typeof clearAllBookmarks === 'function') {
                            clearAllBookmarks();
                        } else {
                            if (confirm('Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆ„Éñ„ÉÉ„ÇØ„Éû„Éº„ÇØ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                                localStorage.removeItem('bookmarkedGuides');
                                if (typeof loadBookmarksList === 'function') loadBookmarksList();
                                if (typeof updateBookmarkButtons === 'function') updateBookmarkButtons();
                                console.log('‚úÖ All bookmarks cleared');
                            }
                        }
                    });
                    clearBookmarksBtn.setAttribute('data-listener-attached', 'true');
                }
            
                
                const clearComparisonBtn = document.getElementById('clearComparisonBtn');
                if (clearComparisonBtn && !clearComparisonBtn.hasAttribute('data-listener-attached')) {
                    clearComparisonBtn.addEventListener('click', function() {
                        if (typeof clearAllComparisons === 'function') {
                            clearAllComparisons();
                        } else {
                            if (confirm('Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆÊØîËºÉ„É™„Çπ„Éà„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                                localStorage.removeItem('comparisonGuides');
                                if (typeof loadComparisonList === 'function') loadComparisonList();
                                if (typeof updateComparisonButtons === 'function') updateComparisonButtons();
                                console.log('‚úÖ All comparison guides cleared');
                            }
                        }
                    });
                    clearComparisonBtn.setAttribute('data-listener-attached', 'true');
                }
            
            document.getElementById('clearBookingsBtn').addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all booking history?')) {
                    localStorage.removeItem('userBookings');
                    loadBookingsList();
                }
            });
            
                
                const clearAllDataBtn = document.getElementById('clearAllDataBtn');
                if (clearAllDataBtn && !clearAllDataBtn.hasAttribute('data-listener-attached')) {
                    clearAllDataBtn.addEventListener('click', function() {
                        if (confirm('Êú¨ÂΩì„Å´„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                            localStorage.clear();
                            alert('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÅåÂâäÈô§„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                            if (typeof loadManagementData === 'function') loadManagementData();
                            if (typeof updateBookmarkButtons === 'function') updateBookmarkButtons();
                            if (typeof updateComparisonButtons === 'function') updateComparisonButtons();
                            console.log('‚úÖ All data cleared');
                        }
                    });
                    clearAllDataBtn.setAttribute('data-listener-attached', 'true');
                }
            };
            
            // Attach to modal events
            const managementModal = document.getElementById('managementModal');
            if (managementModal) {
                managementModal.addEventListener('shown.bs.modal', setupDeleteButtons);
                setTimeout(setupDeleteButtons, 100);
            }
        }
        
        // Management functions
        function removeBookmark(guideId) {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            const updatedBookmarks = bookmarkedGuides.filter(id => id != guideId);
            localStorage.setItem('bookmarkedGuides', JSON.stringify(updatedBookmarks));
            loadBookmarksList();
            
            // Update bookmark buttons throughout the page
            updateBookmarkButtons();
            console.log('Removed bookmark for guide:', guideId);
        }
        
        function removeFromComparison(guideId) {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            const updatedComparison = comparisonGuides.filter(id => id != guideId);
            localStorage.setItem('comparisonGuides', JSON.stringify(updatedComparison));
            loadComparisonList();
            
            // Update comparison buttons throughout the page
            updateComparisonButtons();
            console.log('Removed from comparison:', guideId);
        }
        
        function viewBookingDetails(bookingId) {
            window.location.href = `booking-confirmation.html?id=${bookingId}`;
        }

        // Bookmark and comparison functionality
        function toggleBookmark(guideId) {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            // Convert to string for consistent comparison
            const guideIdStr = guideId.toString();
            const isBookmarked = bookmarkedGuides.includes(guideIdStr) || bookmarkedGuides.includes(parseInt(guideId));
            
            if (isBookmarked) {
                // Remove bookmark - handle both string and number formats
                const updatedBookmarks = bookmarkedGuides.filter(id => id != guideIdStr && id != parseInt(guideId));
                localStorage.setItem('bookmarkedGuides', JSON.stringify(updatedBookmarks));
                console.log('Removed bookmark for guide:', guideId);
            } else {
                // Add bookmark as string
                bookmarkedGuides.push(guideIdStr);
                localStorage.setItem('bookmarkedGuides', JSON.stringify(bookmarkedGuides));
                console.log('Add to bookmarks:', guideId);
            }
            
            // Update button appearance
            updateBookmarkButtons();
        }
        
        function toggleComparison(guideId) {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            // Convert to string for consistent comparison
            const guideIdStr = guideId.toString();
            const isInComparison = comparisonGuides.includes(guideIdStr) || comparisonGuides.includes(parseInt(guideId));
            
            if (isInComparison) {
                // Remove from comparison - handle both string and number formats
                const updatedComparison = comparisonGuides.filter(id => id != guideIdStr && id != parseInt(guideId));
                localStorage.setItem('comparisonGuides', JSON.stringify(updatedComparison));
                console.log('Removed from comparison:', guideId);
            } else {
                // Add to comparison (limit to 3)
                if (comparisonGuides.length >= 3) {
                    alert('Comparison list is limited to 3 guides. Please remove other guides before adding new ones.');
                    return;
                }
                comparisonGuides.push(guideIdStr);
                localStorage.setItem('comparisonGuides', JSON.stringify(comparisonGuides));
                console.log('Add to comparison:', guideId);
            }
            
            // Update button appearance
            updateComparisonButtons();
        }
        
        function updateBookmarkButtons() {
            const bookmarkedGuides = JSON.parse(localStorage.getItem('bookmarkedGuides') || '[]');
            document.querySelectorAll('.bookmark-btn').forEach(btn => {
                const guideId = btn.getAttribute('data-guide-id');
                // Check both string and number formats for compatibility
                const isBookmarked = bookmarkedGuides.includes(guideId) || bookmarkedGuides.includes(parseInt(guideId));
                
                if (isBookmarked) {
                    btn.classList.remove('btn-outline-warning');
                    btn.classList.add('btn-warning');
                    btn.innerHTML = '‚òÖ';
                } else {
                    btn.classList.remove('btn-warning');
                    btn.classList.add('btn-outline-warning');
                    btn.innerHTML = '‚≠ê';
                }
            });
        }
        
        function updateComparisonButtons() {
            const comparisonGuides = JSON.parse(localStorage.getItem('comparisonGuides') || '[]');
            document.querySelectorAll('.compare-btn').forEach(btn => {
                const guideId = btn.getAttribute('data-guide-id');
                // Check both string and number formats for compatibility
                const isInComparison = comparisonGuides.includes(guideId) || comparisonGuides.includes(parseInt(guideId));
                
                if (isInComparison) {
                    btn.classList.remove('btn-outline-success');
                    btn.classList.add('btn-success');
                    btn.innerHTML = '‚úì';
                } else {
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-success');
                    btn.innerHTML = '+';
                }
            });
        }
        
        // Show guide detail modal from management center
        function showGuideDetailModalById(guideId) {
            console.log('Opening guide detail modal for guide:', guideId);
            // Use existing viewGuideDetail function if available
            if (window.viewGuideDetail) {
                const fakeEvent = { preventDefault: () => {}, stopPropagation: () => {} };
                window.viewGuideDetail(guideId, fakeEvent);
            } else {
                // Fallback: redirect to main page with guide detail
                alert('Redirecting to main page to show guide details.');
                window.location.href = `/?guideId=${guideId}`;
            }
        }

        // Footer Functions
        function showAbout() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'About Us';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>About TomoTrip</h6>
                <p>TomoTrip is an innovative platform connecting travelers with trusted local guides across Japan.</p>
                <h6>Our Mission</h6>
                <ul>
                    <li>Discover and nurture specialized local guides who showcase regional attractions</li>
                    <li>Provide safe and enriching travel experiences for tourists</li>
                    <li>Promote local economic development and cultural exchange</li>
                    <li>contribute to sustainable tourism industry growth</li>
                </ul>
                <h6>Service Launch</h6>
                <p>Operating nationwide across all 47 prefectures since 2025</p>
            `;
            modal.show();
        }

        function showTerms() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Terms of Service';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Article 1: Service Overview</h6>
                <p>This service is a matching platform between guides and tourists.</p>
                <h6>Article 2: User Responsibilities</h6>
                <ul>
                    <li>Provide accurate information during registration</li>
                    <li>Show consideration for other users</li>
                    <li>Comply with applicable laws and regulations</li>
                </ul>
                <h6>Article 3: Prohibited Activities</h6>
                <ul>
                    <li>Providing false information</li>
                    <li>Business interference activities</li>
                    <li>Activities that cause inconvenience to third parties</li>
                </ul>
                <p class="text-muted small">Last updated: January 1, 2025</p>
            `;
            modal.show();
        }

        function showPrivacy() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Privacy Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Personal Information Handling</h6>
                <p>TomoTrip uses your personal information for the following purposes:</p>
                <ul>
                    <li>Service provision and operation</li>
                    <li>Customer support</li>
                    <li>Safety and security</li>
                    <li>Service improvement analysis</li>
                </ul>
                <h6>Third Party Disclosure</h6>
                <p>We do not provide personal information to third parties without your consent, except as required by law.</p>
                <h6>Contact</h6>
                <p>For privacy-related inquiries: privacy@tomotrip.com</p>
            `;
            modal.show();
        }

        function showFAQ() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Frequently Asked Questions';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq1">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse1">
                                Is guide registration free?
                            </button>
                        </h2>
                        <div id="faqCollapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Yes, guide registration is completely free. Commission is only 20% upon successful booking.
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="faq2">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse2">
                                When do cancellation fees apply?
                            </button>
                        </h2>
                        <div id="faqCollapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body">
                                Up to 7 days before: Free<br>
                                3-6 days before: 50%<br>
                                2 days or less: 100%
                            </div>
                        </div>
                    </div>
                </div>
            `;
            modal.show();
        }

        function showSafety() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Safety & Insurance';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Safety Measures</h6>
                <ul>
                    <li>Identity verification for all guides</li>
                    <li>24/7 emergency support system</li>
                    <li>GPS location sharing feature</li>
                    <li>Guide rating and review system</li>
                </ul>
                <h6>Insurance Coverage</h6>
                <p>Travel accident insurance applies to all tours.</p>
                <h6>Emergency Contact</h6>
                <p>24-hour support: +81-80-1234-5678</p>
            `;
            modal.show();
        }

        function showCancellation() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Cancellation Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Cancellation Fees</h6>
                <table class="table table-sm">
                    <tr><td>Up to 7 days before</td><td>Free</td></tr>
                    <tr><td>3-6 days before</td><td>50% of fee</td></tr>
                    <tr><td>1-2 days before / Same day</td><td>100% of fee</td></tr>
                </table>
                <h6>Weather Cancellations</h6>
                <p>Full refund provided for weather-related cancellations.</p>
                <h6>Refund Method</h6>
                <p>Credit card refunds are processed within 5-7 business days.</p>
            `;
            modal.show();
        }

        function showCookies() {
            const modal = new bootstrap.Modal(document.getElementById('footerModal') || createFooterModal());
            document.getElementById('footerModalTitle').textContent = 'Cookie Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <h6>Cookie Usage</h6>
                <ul>
                    <li>Save user preferences</li>
                    <li>Maintain login status</li>
                    <li>Analyze site usage</li>
                    <li>Provide personalized experiences</li>
                </ul>
                <h6>„ÇØ„ÉÉ„Ç≠„ÉºË®≠ÂÆö„ÅÆÂ§âÊõ¥</h6>
                <p>„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„Åß„ÇØ„ÉÉ„Ç≠„Éº„ÇíÁÑ°Âäπ„Å´„Åß„Åç„Åæ„Åô„Åå„ÄÅ‰∏ÄÈÉ®„ÅÆÊ©üËÉΩ„ÅåÂà∂Èôê„Åï„Çå„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</p>
            `;
            modal.show();
        }

        function createFooterModal() {
            const modalHTML = `
                <div class="modal fade" id="footerModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="footerModalTitle"></h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body" id="footerModalBody"></div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            return document.getElementById('footerModal');
        }
    </script>

    <!-- Footer Modal Functions -->
    <script>
        // Enhanced footer modal creation function
        function createFooterModal() {
            // Remove existing modal
            const existingModal = document.getElementById('footerModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'footerModal';
            modal.setAttribute('tabindex', '-1');
            modal.innerHTML = `
                <div class="modal-dialog modal-lg modal-dialog-scrollable">
                    <div class="modal-content bg-dark text-light">
                        <div class="modal-header border-secondary">
                            <h5 class="modal-title text-white" id="footerModalTitle"></h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body" id="footerModalBody">
                        </div>
                        <div class="modal-footer border-secondary">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            return modal;
        }
        
        function showAbout() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'About TomoTrip';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img src="assets/images/tomotrip-logo.png" alt="TomoTrip" style="height: 50px;" class="me-3">
                        <h4 class="text-primary mb-0">TomoTrip</h4>
                    </div>
                    <p class="lead">Connecting travelers with trusted local guides for authentic and safe travel experiences across Japan.</p>
                </div>
                
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card bg-gradient h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-globe me-2"></i>Our Mission</h5>
                                <p class="card-text">To bridge cultures and create meaningful connections between travelers and local communities through authentic experiences.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card bg-gradient h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-shield-check me-2"></i>Our Promise</h5>
                                <p class="card-text">Safe, reliable, and enriching travel experiences with vetted guides who are passionate about sharing their culture.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6 class="fw-bold">Company Information</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <small class="text-muted">Founded</small>
                            <p class="mb-0">2024</p>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">Headquarters</small>
                            <p class="mb-0">Tokyo, Japan</p>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">Languages</small>
                            <p class="mb-0">Japanese, English</p>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showTerms() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Terms of Service';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Last Updated:</strong> January 2025
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">1. Service Overview</h6>
                    <p class="small">TomoTrip is a platform connecting tourists with local guides in Japan. By using our service, you agree to these terms and conditions.</p>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">2. User Responsibilities</h6>
                    <ul class="small">
                        <li>Provide accurate registration information</li>
                        <li>Respect local customs and guidelines</li>
                        <li>Follow safety instructions from guides</li>
                        <li>Make payments as agreed</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">3. Guide Requirements</h6>
                    <ul class="small">
                        <li>Valid identification and certification</li>
                        <li>Comprehensive local knowledge</li>
                        <li>Professional conduct at all times</li>
                        <li>Insurance coverage compliance</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">4. Payment Terms</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Tourist Payments</h6>
                                    <ul class="card-text small">
                                        <li>Full payment required at booking</li>
                                        <li>Credit card fees (3.6%) apply</li>
                                        <li>Debit card processing (2.1%)</li>
                                        <li>Secure payment processing</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Guide Compensation</h6>
                                    <ul class="card-text small">
                                        <li>80% of tour fee after completion</li>
                                        <li>20% platform service fee</li>
                                        <li>Payment within 5 business days</li>
                                        <li>Direct bank transfer</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-exclamation-triangle me-2"></i>These terms are subject to Japanese law. For disputes, Tokyo District Court has jurisdiction.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showPrivacy() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Privacy Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-primary">
                        <i class="bi bi-shield-lock me-2"></i>
                        <strong>Your privacy is our priority.</strong> This policy explains how we collect, use, and protect your personal information.
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Information We Collect</h6>
                    
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-primary">Personal Information</h6>
                                    <ul class="card-text small">
                                        <li>Name and contact details</li>
                                        <li>Profile photos</li>
                                        <li>Identity verification documents</li>
                                        <li>Payment information</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Usage Data</h6>
                                    <ul class="card-text small">
                                        <li>Website interaction data</li>
                                        <li>Search preferences</li>
                                        <li>Booking history</li>
                                        <li>Communication records</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">How We Use Your Information</h6>
                    <ul class="small">
                        <li>Facilitate connections between tourists and guides</li>
                        <li>Process payments and bookings</li>
                        <li>Improve our service quality</li>
                        <li>Ensure safety and security</li>
                        <li>Comply with legal requirements</li>
                    </ul>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Data Protection Rights</h6>
                    <div class="row g-2">
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Access</small>
                                    <br><small>View your data</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Correction</small>
                                    <br><small>Update incorrect information</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Deletion</small>
                                    <br><small>Request data removal</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card bg-light text-dark">
                                <div class="card-body p-2">
                                    <small class="fw-bold">Portability</small>
                                    <br><small>Export your data</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <small><i class="bi bi-envelope me-2"></i>For privacy-related inquiries, contact us at privacy@tomotrip.com</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showFAQ() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Frequently Asked Questions';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <p class="lead">Find answers to common questions about using TomoTrip.</p>
                </div>
                
                <div class="accordion" id="faqAccordion">
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                <i class="bi bi-person-check me-2"></i>How do I book a guide?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <p>Booking a guide is simple:</p>
                                <ol>
                                    <li>Browse available guides in your desired location</li>
                                    <li>Check their profiles, reviews, and availability</li>
                                    <li>Register as a tourist (one-time process)</li>
                                    <li>Select your preferred guide and time slot</li>
                                    <li>Complete payment to confirm your booking</li>
                                </ol>
                                <div class="alert alert-info mt-3">
                                    <small><i class="bi bi-lightbulb me-2"></i>Tip: Book in advance, especially during peak seasons!</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                <i class="bi bi-credit-card me-2"></i>What payment methods do you accept?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <p>We accept various payment methods for your convenience:</p>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title text-success">Credit Cards</h6>
                                                <ul class="small">
                                                    <li>Visa, Mastercard, JCB</li>
                                                    <li>3.6% processing fee</li>
                                                    <li>Instant confirmation</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body">
                                                <h6 class="card-title text-info">Debit Cards</h6>
                                                <ul class="small">
                                                    <li>All major debit cards</li>
                                                    <li>2.1% processing fee</li>
                                                    <li>Direct bank deduction</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accordion-item bg-dark border-secondary">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed bg-dark text-light border-0" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                <i class="bi bi-calendar-x me-2"></i>What is your cancellation policy?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                            <div class="accordion-body text-light">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="card border-success">
                                            <div class="card-body text-center">
                                                <div class="text-success h4">48+ hours</div>
                                                <small>Full refund</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-warning">
                                            <div class="card-body text-center">
                                                <div class="text-warning h4">24-48 hours</div>
                                                <small>50% refund</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card border-danger">
                                            <div class="card-body text-center">
                                                <div class="text-danger h4">&lt;24 hours</div>
                                                <small>No refund</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <p class="mt-3 small">Refunds are processed within 5-7 business days to your original payment method.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showSafety() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Safety & Insurance';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="bi bi-shield-check me-2"></i>
                        <strong>Your safety is our top priority.</strong> We implement multiple layers of protection for all users.
                    </div>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-person-check me-2"></i>Guide Verification</h5>
                                <ul class="card-text">
                                    <li>Identity verification required</li>
                                    <li>Background checks conducted</li>
                                    <li>Local certification validation</li>
                                    <li>Regular performance reviews</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-shield-lock me-2"></i>Insurance Coverage</h5>
                                <ul class="card-text">
                                    <li>Comprehensive liability insurance</li>
                                    <li>Medical emergency coverage</li>
                                    <li>Activity-specific protection</li>
                                    <li>24/7 emergency support</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Safety Guidelines</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-primary">For Tourists</h6>
                                    <ul class="card-text small">
                                        <li>Share your itinerary with someone</li>
                                        <li>Keep emergency contacts handy</li>
                                        <li>Follow guide instructions</li>
                                        <li>Stay aware of your surroundings</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">For Guides</h6>
                                    <ul class="card-text small">
                                        <li>Conduct safety briefings</li>
                                        <li>Monitor group dynamics</li>
                                        <li>Maintain first aid certification</li>
                                        <li>Report incidents immediately</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-telephone me-2"></i><strong>Emergency Contact:</strong> 080-9999-8888 (24/7 Support)</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCancellation() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Cancellation Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Flexible cancellation options</strong> designed to accommodate unexpected changes while protecting both tourists and guides.
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Cancellation Timeline</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card border-success h-100">
                                <div class="card-body text-center">
                                    <div class="text-success display-6 mb-2"><i class="bi bi-check-circle"></i></div>
                                    <h6 class="card-title text-success">48+ Hours Before</h6>
                                    <p class="card-text">
                                        <strong>100% Refund</strong><br>
                                        <small class="text-muted">Full amount returned to original payment method</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-warning h-100">
                                <div class="card-body text-center">
                                    <div class="text-warning display-6 mb-2"><i class="bi bi-exclamation-circle"></i></div>
                                    <h6 class="card-title text-warning">24-48 Hours Before</h6>
                                    <p class="card-text">
                                        <strong>50% Refund</strong><br>
                                        <small class="text-muted">Partial compensation for guide preparation</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-danger h-100">
                                <div class="card-body text-center">
                                    <div class="text-danger display-6 mb-2"><i class="bi bi-x-circle"></i></div>
                                    <h6 class="card-title text-danger">Less than 24 Hours</h6>
                                    <p class="card-text">
                                        <strong>No Refund</strong><br>
                                        <small class="text-muted">Guide compensation protection</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Special Circumstances</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Weather Conditions</h6>
                                    <ul class="card-text small">
                                        <li>Typhoon/severe weather warnings</li>
                                        <li>Government-issued travel advisories</li>
                                        <li>Full refund provided</li>
                                        <li>Rescheduling options available</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Medical Emergencies</h6>
                                    <ul class="card-text small">
                                        <li>Tourist illness or injury</li>
                                        <li>Guide inability to conduct tour</li>
                                        <li>Medical documentation required</li>
                                        <li>Case-by-case evaluation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">How to Cancel</h6>
                    <ol class="small">
                        <li>Log into your account or use booking confirmation email</li>
                        <li>Navigate to "My Bookings" section</li>
                        <li>Select the booking you wish to cancel</li>
                        <li>Click "Cancel Booking" and confirm</li>
                        <li>Receive cancellation confirmation and refund timeline</li>
                    </ol>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-clock me-2"></i>Refunds are processed within 5-7 business days. For urgent cancellations, contact our support team.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showHelp() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Help Center';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <p class="lead">Need assistance? We're here to help you make the most of your TomoTrip experience.</p>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-headset me-2"></i>Live Chat Support</h5>
                                <p class="card-text">Get instant help from our support team during business hours.</p>
                                <button class="btn btn-light" onclick="window.open('chat.html', '_blank')">
                                    <i class="bi bi-chat-dots me-2"></i>Start Chat
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="card-body text-white">
                                <h5 class="card-title"><i class="bi bi-envelope me-2"></i>Email Support</h5>
                                <p class="card-text">Send us detailed questions and we'll respond within 24 hours.</p>
                                <button class="btn btn-light" onclick="window.location.href='mailto:support@tomotrip.com'">
                                    <i class="bi bi-envelope me-2"></i>Send Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Quick Help Topics</h6>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="list-group">
                                <div class="list-group-item bg-dark text-light border-secondary">
                                    <h6 class="mb-1">For Tourists</h6>
                                    <small>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showFAQ()">How to book a guide</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showCancellation()">Cancellation policy</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="showSafety()">Safety guidelines</a>
                                        <a href="#" class="text-info text-decoration-none d-block" onclick="alert('Payment help coming soon')">Payment issues</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="list-group">
                                <div class="list-group-item bg-dark text-light border-secondary">
                                    <h6 class="mb-1">For Guides</h6>
                                    <small>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Guide registration help coming soon')">Registration process</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Profile optimization tips coming soon')">Profile optimization</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Earnings dashboard coming soon')">Payment schedule</a>
                                        <a href="#" class="text-success text-decoration-none d-block" onclick="alert('Guide resources coming soon')">Best practices</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Contact Information</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-telephone text-primary fs-4"></i>
                                    <h6 class="mt-2">Phone Support</h6>
                                    <small>+81-3-1234-5678<br>Mon-Fri 9:00-18:00 JST</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-envelope text-success fs-4"></i>
                                    <h6 class="mt-2">Email</h6>
                                    <small>support@tomotrip.com<br>24h response time</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <i class="bi bi-exclamation-triangle text-warning fs-4"></i>
                                    <h6 class="mt-2">Emergency</h6>
                                    <small>080-9999-8888<br>24/7 Support</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCompliance() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Legal Compliance';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <div class="alert alert-success">
                        <i class="bi bi-shield-check me-2"></i>
                        <strong>Full Legal Compliance</strong> - TomoTrip operates in accordance with Japanese and international laws.
                    </div>
                </div>
                
                <div class="row g-4 mb-4">
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title text-primary"><i class="bi bi-building me-2"></i>Business Registration</h5>
                                <ul class="card-text small">
                                    <li>Registered in Tokyo, Japan</li>
                                    <li>Business License: TK-2024-001</li>
                                    <li>Tourism Agency Registration</li>
                                    <li>Regular compliance audits</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card h-100">
                            <div class="card-body">
                                <h5 class="card-title text-success"><i class="bi bi-shield-lock me-2"></i>Data Protection</h5>
                                <ul class="card-text small">
                                    <li>GDPR compliance (EU users)</li>
                                    <li>Japanese Personal Information Protection Act</li>
                                    <li>Secure data encryption</li>
                                    <li>Regular security assessments</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Industry Certifications</h6>
                    <div class="row g-3">
                        <div class="col-md-4">
                            <div class="card border-success">
                                <div class="card-body text-center">
                                    <div class="text-success h4"><i class="bi bi-award"></i></div>
                                    <h6>Tourism Quality</h6>
                                    <small>Certified by Japan Tourism Agency</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-info">
                                <div class="card-body text-center">
                                    <div class="text-info h4"><i class="bi bi-lock"></i></div>
                                    <h6>Security Standards</h6>
                                    <small>ISO 27001 Certified</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="card border-warning">
                                <div class="card-body text-center">
                                    <div class="text-warning h4"><i class="bi bi-credit-card"></i></div>
                                    <h6>Payment Security</h6>
                                    <small>PCI DSS Compliant</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Legal Framework</h6>
                    <div class="table-responsive">
                        <table class="table table-dark table-striped">
                            <thead>
                                <tr>
                                    <th>Law/Regulation</th>
                                    <th>Compliance Status</th>
                                    <th>Last Audit</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Tourism Business Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                                <tr>
                                    <td>Consumer Protection Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                                <tr>
                                    <td>Data Protection Laws</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Dec 2024</td>
                                </tr>
                                <tr>
                                    <td>Payment Services Act</td>
                                    <td><span class="badge bg-success">Compliant</span></td>
                                    <td>Jan 2025</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <small><i class="bi bi-info-circle me-2"></i>For legal inquiries or compliance questions, contact our legal team at legal@tomotrip.com</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showCookies() {
            const modal = createFooterModal();
            document.getElementById('footerModalTitle').textContent = 'Cookie Policy';
            document.getElementById('footerModalBody').innerHTML = `
                <div class="mb-4">
                    <h6 class="fw-bold">What are Cookies?</h6>
                    <p class="small">Cookies are small text files that websites store on your computer to improve your browsing experience and provide better services.</p>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">Types of Cookies We Use</h6>
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-success">Essential Cookies</h6>
                                    <p class="card-text small">Required for basic website functionality</p>
                                    <ul class="small">
                                        <li>Login session management</li>
                                        <li>Security features</li>
                                        <li>Settings preservation</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h6 class="card-title text-info">Analytics Cookies</h6>
                                    <p class="card-text small">Help us improve our services</p>
                                    <ul class="small">
                                        <li>Google Analytics</li>
                                        <li>Usage statistics</li>
                                        <li>Performance monitoring</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h6 class="fw-bold">„ÇØ„ÉÉ„Ç≠„ÉºË®≠ÂÆö„ÅÆÁÆ°ÁêÜ</h6>
                    <p class="small">„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„Åß„ÇØ„ÉÉ„Ç≠„Éº„ÅÆÂèó„ÅëÂÖ•„Çå„ÇíÂà∂Âæ°„Åß„Åç„Åæ„Åô„ÄÇ„Åü„Å†„Åó„ÄÅÂøÖÈ†à„ÇØ„ÉÉ„Ç≠„Éº„ÇíÁÑ°Âäπ„Å´„Åô„Çã„Å®„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÅÆÊ©üËÉΩ„Å´ÂΩ±Èüø„Åô„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ</p>
                    
                    <div class="mt-3">
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="alert('„ÇØ„ÉÉ„Ç≠„ÉºË®≠ÂÆö„Éë„Éç„É´„ÅØÈñãÁô∫‰∏≠„Åß„Åô')">„ÇØ„ÉÉ„Ç≠„ÉºË®≠ÂÆö</button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="alert('„ÇØ„ÉÉ„Ç≠„ÉºÂâäÈô§Ê©üËÉΩ„ÅØÈñãÁô∫‰∏≠„Åß„Åô')">„Åô„Åπ„Å¶„ÅÆ„ÇØ„ÉÉ„Ç≠„Éº„ÇíÂâäÈô§</button>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <small><i class="bi bi-exclamation-triangle me-2"></i>Analytics cookies require your consent. You can use our basic features without accepting analytics cookies.</small>
                </div>
            `;
            new bootstrap.Modal(modal).show();
        }
        
        function showManagementCenter() {
            alert('Booking Management Center is under development. Please contact us directly for current booking inquiries.');
        }
    </script>

    
    <!-- Footer Force CSS -->
    <style>
        .footer-forced-visible {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
            z-index: 1000 !important;
            min-height: 400px !important;
        }
        
        /* Footer Emergency Fix */
        #main-footer {
            background-color: #212529 !important;
            color: white !important;
            padding: 3rem 0 !important;
            margin-top: 2rem !important;
            position: relative !important;
            z-index: 100 !important;
            width: 100% !important;
            clear: both !important;
        }
        
        #main-footer .container {
            max-width: 1200px !important;
            margin: 0 auto !important;
            padding: 0 15px !important;
        }
        
        #main-footer .row {
            display: flex !important;
            flex-wrap: wrap !important;
            margin: 0 -15px !important;
        }
        
        #main-footer .col-lg-3,
        #main-footer .col-lg-2,
        #main-footer .col-md-6 {
            padding: 0 15px !important;
            margin-bottom: 2rem !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            flex: 1 1 auto !important;
            min-width: 200px !important;
        }
        
        #main-footer h5,
        #main-footer h6 {
            color: white !important;
            font-weight: bold !important;
            margin-bottom: 1rem !important;
        }
        
        #main-footer p,
        #main-footer li,
        #main-footer a {
            color: #adb5bd !important;
            font-size: 14px !important;
        }
        
        #main-footer a:hover {
            color: #4ecdc4 !important;
        }
        
        #main-footer .text-white {
            color: white !important;
        }
        
        #main-footer .text-muted {
            color: #adb5bd !important;
        }
        
        #main-footer ul {
            list-style: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        
        #main-footer li {
            margin-bottom: 0.5rem !important;
        }
        
        .hover-social:hover {
            color: #4ecdc4 !important;
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        
        .hover-link:hover {
            color: #4ecdc4 !important;
            text-decoration: underline !important;
        }
    </style>

    <!-- Footer -->
    <footer id="main-footer" style="background-color: #212529 !important; color: white !important; padding: 3rem 0 !important; margin-top: 2rem !important; position: relative !important; z-index: 100 !important; width: 100% !important; clear: both !important; display: block !important; visibility: visible !important; opacity: 1 !important;">
        <div class="container">
            <div class="row">
                <!-- Company Info -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <div class="d-flex align-items-center mb-3">
                        <img src="assets/images/tomotrip-logo.png" alt="TomoTrip" style="height: 40px;" class="me-2">
                        <h5 class="mb-0">TomoTrip</h5>
                    </div>
                    <p class="text-muted small">Connecting travelers with trusted local guides for authentic and safe travel experiences across Japan.</p>
                    <div class="d-flex gap-3">
                        <a href="https://facebook.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Facebook">
                            <i class="bi bi-facebook fs-5"></i>
                        </a>
                        <a href="https://twitter.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Twitter">
                            <i class="bi bi-twitter fs-5"></i>
                        </a>
                        <a href="https://instagram.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="Instagram">
                            <i class="bi bi-instagram fs-5"></i>
                        </a>
                        <a href="https://youtube.com/tomotrip" class="text-muted hover-social" target="_blank" rel="noopener" title="YouTube">
                            <i class="bi bi-youtube fs-5"></i>
                        </a>
                    </div>
                </div>

                <!-- Services -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">„Çµ„Éº„Éì„Çπ</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#guides-section" class="text-muted text-decoration-none hover-link" onclick="scrollToGuides()">„Ç¨„Ç§„Éâ„ÇíÊé¢„Åô</a></li>
                        <li class="mb-2"><a href="guide-registration-perfect.html" class="text-muted text-decoration-none hover-link" target="_blank">„Ç¨„Ç§„Éâ„Å´„Å™„Çã</a></li>
                        <li class="mb-2"><a href="/tourist-registration-simple.html" class="text-muted text-decoration-none hover-link" target="_blank">Ë¶≥ÂÖâÂÆ¢ÁôªÈå≤</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showManagementCenter()">‰∫àÁ¥ÑÁÆ°ÁêÜ</a></li>
                        <li class="mb-2"><a href="sponsor-registration.html" class="text-muted text-decoration-none hover-link">„Çπ„Éù„É≥„Çµ„ÉºÁôªÈå≤</a></li>
                        <li class="mb-2"><a href="admin-login.html" class="text-muted text-decoration-none hover-link">üîê ÈÅãÂñ∂ËÄÖ„É≠„Ç∞„Ç§„É≥</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">„Çµ„Éù„Éº„Éà</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showFAQ()">FAQ</a></li>
                        <li class="mb-2"><a href="chat.html" class="text-muted text-decoration-none hover-link">„ÅäÂïè„ÅÑÂêà„Çè„Åõ</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showSafety()">ÂÆâÂÖ®„Éª‰øùÈô∫</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCancellation()">„Ç≠„É£„É≥„Çª„É´„Éù„É™„Ç∑„Éº</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showHelp()">Help Center</a></li>
                    </ul>
                </div>

                <!-- Legal -->
                <div class="col-lg-2 col-md-6 mb-4">
                    <h6 class="text-white mb-3">Ê≥ïÁöÑ‰∫ãÈ†Ö</h6>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showAbout()">‰ºöÁ§æÊ°àÂÜÖ</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showTerms()">Âà©Áî®Ë¶èÁ¥Ñ</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showPrivacy()">„Éó„É©„Ç§„Éê„Ç∑„Éº„Éù„É™„Ç∑„Éº</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCookies()">Cookie Policy</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none hover-link" onclick="showCompliance()">Ê≥ïÁöÑÈÅµÂÆà</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div class="col-lg-3 col-md-6 mb-4">
                    <h6 class="text-white mb-3">ÈÄ£Áµ°ÂÖà</h6>
                    <div class="mb-3">
                        <p class="text-muted small mb-2">
                            <i class="bi bi-envelope me-2"></i>
                            <a href="mailto:info@tomotrip.com" class="text-muted text-decoration-none hover-link">info@tomotrip.com</a>
                        </p>
                        <p class="text-muted small mb-2">
                            <i class="bi bi-telephone me-2"></i>
                            <a href="tel:+81-3-1234-5678" class="text-muted text-decoration-none hover-link">+81-3-1234-5678</a>
                        </p>
                        <p class="text-muted small mb-3">
                            <i class="bi bi-clock me-2"></i>Mon-Fri 9:00-18:00 JST
                        </p>
                        <p class="text-muted small mb-2">
                            <i class="bi bi-geo-alt me-2"></i>„Äí100-0001 Tokyo, Chiyoda, Chiyoda 1-1
                        </p>
                    </div>
                    <div class="mt-3">
                        <p class="text-muted small mb-2">Emergency Support:</p>
                        <p class="text-warning small">
                            <i class="bi bi-telephone-fill me-2"></i>
                            <a href="tel:080-9999-8888" class="text-warning text-decoration-none hover-link">080-9999-8888</a>
                            <br><small class="text-muted">(24/7 Available)</small>
                        </p>
                    </div>
                </div>
            </div>

            <hr class="my-4 border-secondary">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="text-muted small mb-0">&copy; 2025 TomoTrip. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="text-muted small mb-0">Made with ‚ù§Ô∏è for travelers and local guides</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Tourist Login Modal -->
    <div class="modal fade" id="touristLoginModal" tabindex="-1" aria-labelledby="touristLoginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="touristLoginModalLabel">
                        <i class="bi bi-person-circle me-2"></i>Ë¶≥ÂÖâÂÆ¢„É≠„Ç∞„Ç§„É≥
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Ë¶≥ÂÖâÂÆ¢Âêë„Åë„Çµ„Éº„Éì„Çπ</strong><br>
                            <small>„Ç¨„Ç§„Éâ„ÅÆË©≥Á¥∞ÊÉÖÂ†±„ÇíË¶ã„Çã„Å´„ÅØ„ÄÅ„Åæ„ÅöË¶≥ÂÖâÂÆ¢„Å®„Åó„Å¶ÁôªÈå≤„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ</small>
                        </div>
                    </div>
                    
                    <form id="touristLoginForm">
                        <div class="mb-3">
                            <label for="touristEmailRegister" class="form-label fw-bold">
                                <i class="bi bi-envelope me-1"></i>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ
                            </label>
                            <input type="email" class="form-control" id="touristEmailRegister" placeholder="your@email.com" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        
                        <div class="mb-4">
                            <label for="touristPassword" class="form-label fw-bold">
                                <i class="bi bi-lock me-1"></i>„Éë„Çπ„ÉØ„Éº„Éâ
                            </label>
                            <input type="password" class="form-control" id="touristPassword" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ" required style="border-radius: 10px; padding: 12px;">
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; padding: 12px; border-radius: 10px; font-weight: 600;">
                                <i class="bi bi-box-arrow-in-right me-2"></i>„É≠„Ç∞„Ç§„É≥
                            </button>
                            <div class="text-center mt-3">
                                <small class="text-muted">„Ç¢„Ç´„Ç¶„É≥„Éà„Çí„ÅäÊåÅ„Å°„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ</small><br>
                                <button type="button" class="btn btn-link" id="showTouristRegistration">
                                    <i class="bi bi-person-plus me-1"></i>Êñ∞Ë¶èÁôªÈå≤„ÅØ„Åì„Å°„Çâ
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Guide Login Modal -->
    <div class="modal fade" id="guideLoginModal" tabindex="-1" aria-labelledby="guideLoginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="guideLoginModalLabel">
                        <i class="bi bi-person-badge me-2"></i>„Ç¨„Ç§„Éâ„É≠„Ç∞„Ç§„É≥
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="alert alert-success">
                            <i class="bi bi-shield-check me-2"></i>
                            <strong>„Ç¨„Ç§„ÉâÂ∞ÇÁî®</strong><br>
                            <small>„Ç¨„Ç§„ÉâID„Å®ÈõªË©±Áï™Âè∑„Åß„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</small>
                        </div>
                    </div>
                    
                    <form id="guideLoginForm" onsubmit="handleGuideLogin(event)">
                        <div class="mb-3">
                            <label for="guideIdentifier" class="form-label fw-bold">
                                <i class="bi bi-person me-1"></i>„Ç¨„Ç§„ÉâID„Åæ„Åü„ÅØ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ
                            </label>
                            <input type="text" class="form-control" id="guideIdentifier" placeholder="„Ç¨„Ç§„ÉâID„Åæ„Åü„ÅØ„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÇíÂÖ•Âäõ" required style="border-radius: 10px; padding: 12px;">
                            <small class="text-muted">ÁôªÈå≤ÊôÇ„Å´Áô∫Ë°å„Åï„Çå„Åü„Ç¨„Ç§„ÉâID„Åæ„Åü„ÅØÁôªÈå≤„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</small>
                        </div>
                        
                        <div class="mb-4">
                            <label for="guidePhoneLogin" class="form-label fw-bold">
                                <i class="bi bi-telephone me-1"></i>ÈõªË©±Áï™Âè∑
                            </label>
                            <input type="tel" class="form-control" id="guidePhoneLogin" placeholder="080-1234-5678" required style="border-radius: 10px; padding: 12px;">
                            <small class="text-muted">ÁôªÈå≤ÊôÇ„Å´‰ΩøÁî®„Åó„ÅüÈõªË©±Áï™Âè∑</small>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success" style="background: linear-gradient(135deg, #28a745, #20c997); border: none; padding: 12px; border-radius: 10px; font-weight: 600;">
                                <i class="bi bi-box-arrow-in-right me-2"></i>„É≠„Ç∞„Ç§„É≥
                            </button>
                            <div class="text-center mt-3">
                                <small class="text-muted">„Ç¨„Ç§„ÉâÁôªÈå≤„Åå„ÅäÊ∏à„Åø„Åß„Å™„ÅÑÂ†¥Âêà„ÅØ</small><br>
                                <a href="guide-registration-perfect.html" class="btn btn-link" target="_blank">
                                    <i class="bi bi-person-badge me-1"></i>„Ç¨„Ç§„ÉâÁôªÈå≤„ÅØ„Åì„Å°„Çâ
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Guide Registration Modal (DISABLED - use detailed form instead) -->
    <div class="modal fade" id="guideRegistrationModal" tabindex="-1" aria-labelledby="guideRegistrationModalLabel" aria-hidden="true" style="display: none !important;" data-disabled="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content" style="border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                <div class="modal-header border-0" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 15px 15px 0 0;">
                    <h5 class="modal-title fw-bold" id="guideRegistrationModalLabel">
                        <i class="bi bi-map me-2"></i>„Ç¨„Ç§„ÉâÁôªÈå≤
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="guideRegistrationForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="guideName" class="form-label">„Ç¨„Ç§„ÉâÂêç <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="guideName" required style="border-radius: 10px;">
                            </div>
                            <div class="col-md-6">
                                <label for="guideEmail" class="form-label">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="guideEmail" required style="border-radius: 10px;">
                            </div>
                            <div class="col-md-6">
                                <label for="guidePhoneReg" class="form-label">ÈõªË©±Áï™Âè∑ <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="guidePhoneReg" required style="border-radius: 10px;">
                            </div>
                            <div class="col-md-6">
                                <label for="guideLocation" class="form-label">Ê¥ªÂãïÂú∞Âüü <span class="text-danger">*</span></label>
                                <select class="form-select" id="guideLocation" required style="border-radius: 10px;">
                                    <option value="">Âú∞Âüü„ÇíÈÅ∏Êäû</option>
                                    <option value="Êù±‰∫¨ÈÉΩ">Êù±‰∫¨ÈÉΩ</option>
                                    <option value="Â§ßÈò™Â∫ú">Â§ßÈò™Â∫ú</option>
                                    <option value="‰∫¨ÈÉΩÂ∫ú">‰∫¨ÈÉΩÂ∫ú</option>
                                    <option value="Á•ûÂ•àÂ∑ùÁúå">Á•ûÂ•àÂ∑ùÁúå</option>
                                    <option value="ÊÑõÁü•Áúå">ÊÑõÁü•Áúå</option>
                                    <option value="Á¶èÂ≤°Áúå">Á¶èÂ≤°Áúå</option>
                                    <option value="ÂåóÊµ∑ÈÅì">ÂåóÊµ∑ÈÅì</option>
                                    <option value="Ê≤ñÁ∏ÑÁúå">Ê≤ñÁ∏ÑÁúå</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="guideLanguages" class="form-label">ÂØæÂøúË®ÄË™û <span class="text-danger">*</span></label>
                                <div class="form-check-container" style="max-height: 120px; overflow-y: auto; border: 1px solid #ced4da; border-radius: 10px; padding: 10px;">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Êó•Êú¨Ë™û" id="lang-japanese">
                                        <label class="form-check-label" for="lang-japanese">Êó•Êú¨Ë™û</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="Ëã±Ë™û" id="lang-english">
                                        <label class="form-check-label" for="lang-english">Ëã±Ë™û</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="‰∏≠ÂõΩË™û" id="lang-chinese">
                                        <label class="form-check-label" for="lang-chinese">‰∏≠ÂõΩË™û</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="ÈüìÂõΩË™û" id="lang-korean">
                                        <label class="form-check-label" for="lang-korean">ÈüìÂõΩË™û</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="„Çπ„Éö„Ç§„É≥Ë™û" id="lang-spanish">
                                        <label class="form-check-label" for="lang-spanish">„Çπ„Éö„Ç§„É≥Ë™û</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="„Éï„É©„É≥„ÇπË™û" id="lang-french">
                                        <label class="form-check-label" for="lang-french">„Éï„É©„É≥„ÇπË™û</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="guidePrice" class="form-label">ÊñôÈáë (ÂÜÜ/Êó•) <span class="text-danger">*</span></label>
                                <input type="number" class="form-control" id="guidePrice" required min="1000" max="50000" style="border-radius: 10px;">
                            </div>
                            <div class="col-12">
                                <label for="guideDescription" class="form-label">Ëá™Â∑±Á¥π‰ªã„ÉªÁµåÈ®ì <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="guideDescription" rows="4" required style="border-radius: 10px;" placeholder="„ÅÇ„Å™„Åü„ÅÆÁµåÈ®ì„ÄÅÂ∞ÇÈñÄÁü•Ë≠ò„ÄÅ„Ç¨„Ç§„Éâ„Å®„Åó„Å¶„ÅÆÈ≠ÖÂäõ„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer border-0 p-4 pt-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="border-radius: 25px; padding: 10px 20px;">„Ç≠„É£„É≥„Çª„É´</button>
                    <button type="button" class="btn btn-success" id="guideRegistrationSubmitBtn" style="border-radius: 25px; padding: 10px 20px; background: linear-gradient(135deg, #28a745, #20c997); border: none;">
                        <i class="bi bi-check-circle me-2"></i>„Ç¨„Ç§„Éâ„Å®„Åó„Å¶ÁôªÈå≤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- All JavaScript functionality handled by app-init.mjs ESM module system -->
    <!-- No inline scripts needed - CSP compliant architecture -->
    

</body>
</html>
