# ガイド・協賛店連携システム仕様書

## 概要
ガイドが協賛店を紹介し、その成果を追跡・管理するシステムです。ガイドと協賛店の間につながりを作り、双方にメリットを提供します。

## 主要機能

### 1. 紹介コードシステム
- **機能**: ガイド専用の紹介コードを自動生成
- **形式**: `GUIDE_{ガイドID}_{タイムスタンプ}_{ランダム}`
- **例**: `GUIDE_DEMO_001_SAMPLE1`

### 2. 紹介リンク生成
- **機能**: 協賛店登録ページに紹介コードを含むURLを生成
- **形式**: `sponsor-registration.html?ref={紹介コード}`
- **用途**: ガイドが協賛店候補に送信

### 3. 紹介追跡システム
- **登録時追跡**: 協賛店登録時に紹介コードを自動検出
- **データ連携**: 協賛店データに紹介情報を追加
- **実績記録**: ガイドの紹介履歴として保存

### 4. コミッション計算
```javascript
基本コミッション: ¥1,000
業種別倍率:
- レストラン: 1.5倍 (¥1,500)
- ホテル: 2.0倍 (¥2,000)
- カフェ: 1.2倍 (¥1,200)
- ショップ: 1.0倍 (¥1,000)
- アクティビティ: 1.8倍 (¥1,800)
- 交通: 1.3倍 (¥1,300)
- その他: 1.0倍 (¥1,000)
```

### 5. ステータス管理
- **pending**: 審査中 - 協賛店登録完了、管理者承認待ち
- **approved**: 承認済み - コミッション確定
- **rejected**: 却下 - コミッション対象外

## ページ構成

### ガイド紹介ダッシュボード (guide-referral-dashboard.html)
- 紹介実績の統計表示
- 専用紹介リンクの管理
- 紹介履歴の確認
- コミッション収益の追跡

### 協賛店登録ページ (sponsor-registration.html)
- 紹介コード検出機能
- 紹介情報の表示
- 自動紹介記録

### 協賛店一覧ページ (sponsor-list.html)
- 紹介による登録の表示
- 紹介元ガイド情報

## データ構造

### 紹介データ (localStorage: guide_referral_{ガイドID})
```javascript
{
  referralCode: "GUIDE_DEMO_001_ABC123",
  referrals: [
    {
      id: "referral_001",
      sponsorId: "sponsor_001",
      sponsorName: "桜カフェ",
      sponsorType: "cafe",
      referralDate: "2025-06-26T10:00:00.000Z",
      status: "approved",
      commission: 1200,
      referralCode: "GUIDE_DEMO_001_ABC123"
    }
  ],
  totalCommission: 1200,
  createdAt: "2025-06-26T10:00:00.000Z"
}
```

### 協賛店データ (sponsorData配列内の追加項目)
```javascript
{
  // 既存の協賛店データ...
  referredBy: {
    id: "referral_001",
    referralCode: "GUIDE_DEMO_001_ABC123",
    // 紹介記録の詳細...
  }
}
```

## 利用フロー

### ガイド側
1. ダッシュボードで専用リンクを取得
2. 協賛店候補にリンクを送信
3. 登録完了通知を受信
4. 実績とコミッションを確認

### 協賛店側
1. ガイドからの紹介リンクをクリック
2. 登録フォームで紹介情報を確認
3. 通常通り登録を完了
4. 審査結果を待機

### システム側
1. URLパラメータから紹介コードを検出
2. 登録時に紹介情報を自動記録
3. ガイド実績とコミッションを更新
4. 両者の関係を可視化

## 技術実装

### JavaScriptモジュール
- `guide-sponsor-connection.js`: 核となる連携システム
- `guide-referral-dashboard.js`: ダッシュボード機能
- 既存ファイルへの統合: 登録・一覧ページに機能追加

### ローカルストレージ活用
- ガイド別紹介データ管理
- 協賛店データとの連携
- リアルタイム実績更新

### URL パラメータ処理
- 紹介コードの自動検出
- フォーム自動入力
- ユーザビリティ向上

## 拡張可能性

### 将来的な機能追加
- 紹介成果の詳細分析
- 月次/年次レポート生成
- コミッション支払い管理
- ガイドランキングシステム
- 協賛店とガイドの直接連絡機能

### データベース連携
- 現在はローカルストレージベース
- 本格運用時はサーバーサイドDB連携
- リアルタイム同期機能

この仕様に基づいて、ガイドと協賛店の効果的な連携システムが構築されています。